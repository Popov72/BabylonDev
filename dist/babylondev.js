/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/Main.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/babylonjs-gui/babylon.gui.min.js":
/*!*******************************************************!*\
  !*** ./node_modules/babylonjs-gui/babylon.gui.min.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(global) {!function(t,e){ true?module.exports=e(__webpack_require__(/*! babylonjs */ "babylonjs")):undefined}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this,(function(t){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(e,i){e.exports=t},function(t,e,i){(function(t,r){var n;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o,s=200,a="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",h="Expected a function",u="__lodash_hash_undefined__",l=500,c="__lodash_placeholder__",f=1,_=2,d=4,p=1,g=2,m=1,b=2,y=4,v=8,O=16,w=32,C=64,x=128,T=256,P=512,M=30,k="...",I=800,A=16,S=1,E=2,R=1/0,L=9007199254740991,D=17976931348623157e292,N=NaN,B=4294967295,V=B-1,H=B>>>1,j=[["ary",x],["bind",m],["bindKey",b],["curry",v],["curryRight",O],["flip",P],["partial",w],["partialRight",C],["rearg",T]],F="[object Arguments]",z="[object Array]",W="[object AsyncFunction]",G="[object Boolean]",U="[object Date]",X="[object DOMException]",Y="[object Error]",q="[object Function]",K="[object GeneratorFunction]",Z="[object Map]",$="[object Number]",J="[object Null]",Q="[object Object]",tt="[object Proxy]",et="[object RegExp]",it="[object Set]",rt="[object String]",nt="[object Symbol]",ot="[object Undefined]",st="[object WeakMap]",at="[object WeakSet]",ht="[object ArrayBuffer]",ut="[object DataView]",lt="[object Float32Array]",ct="[object Float64Array]",ft="[object Int8Array]",_t="[object Int16Array]",dt="[object Int32Array]",pt="[object Uint8Array]",gt="[object Uint8ClampedArray]",mt="[object Uint16Array]",bt="[object Uint32Array]",yt=/\b__p \+= '';/g,vt=/\b(__p \+=) '' \+/g,Ot=/(__e\(.*?\)|\b__t\)) \+\n'';/g,wt=/&(?:amp|lt|gt|quot|#39);/g,Ct=/[&<>"']/g,xt=RegExp(wt.source),Tt=RegExp(Ct.source),Pt=/<%-([\s\S]+?)%>/g,Mt=/<%([\s\S]+?)%>/g,kt=/<%=([\s\S]+?)%>/g,It=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,At=/^\w*$/,St=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Et=/[\\^$.*+?()[\]{}|]/g,Rt=RegExp(Et.source),Lt=/^\s+|\s+$/g,Dt=/^\s+/,Nt=/\s+$/,Bt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Vt=/\{\n\/\* \[wrapped with (.+)\] \*/,Ht=/,? & /,jt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ft=/\\(\\)?/g,zt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Wt=/\w*$/,Gt=/^[-+]0x[0-9a-f]+$/i,Ut=/^0b[01]+$/i,Xt=/^\[object .+?Constructor\]$/,Yt=/^0o[0-7]+$/i,qt=/^(?:0|[1-9]\d*)$/,Kt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zt=/($^)/,$t=/['\n\r\u2028\u2029\\]/g,Jt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Qt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",te="[\\ud800-\\udfff]",ee="["+Qt+"]",ie="["+Jt+"]",re="\\d+",ne="[\\u2700-\\u27bf]",oe="[a-z\\xdf-\\xf6\\xf8-\\xff]",se="[^\\ud800-\\udfff"+Qt+re+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",ae="\\ud83c[\\udffb-\\udfff]",he="[^\\ud800-\\udfff]",ue="(?:\\ud83c[\\udde6-\\uddff]){2}",le="[\\ud800-\\udbff][\\udc00-\\udfff]",ce="[A-Z\\xc0-\\xd6\\xd8-\\xde]",fe="(?:"+oe+"|"+se+")",_e="(?:"+ce+"|"+se+")",de="(?:"+ie+"|"+ae+")"+"?",pe="[\\ufe0e\\ufe0f]?"+de+("(?:\\u200d(?:"+[he,ue,le].join("|")+")[\\ufe0e\\ufe0f]?"+de+")*"),ge="(?:"+[ne,ue,le].join("|")+")"+pe,me="(?:"+[he+ie+"?",ie,ue,le,te].join("|")+")",be=RegExp("['’]","g"),ye=RegExp(ie,"g"),ve=RegExp(ae+"(?="+ae+")|"+me+pe,"g"),Oe=RegExp([ce+"?"+oe+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[ee,ce,"$"].join("|")+")",_e+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[ee,ce+fe,"$"].join("|")+")",ce+"?"+fe+"+(?:['’](?:d|ll|m|re|s|t|ve))?",ce+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",re,ge].join("|"),"g"),we=RegExp("[\\u200d\\ud800-\\udfff"+Jt+"\\ufe0e\\ufe0f]"),Ce=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,xe=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Te=-1,Pe={};Pe[lt]=Pe[ct]=Pe[ft]=Pe[_t]=Pe[dt]=Pe[pt]=Pe[gt]=Pe[mt]=Pe[bt]=!0,Pe[F]=Pe[z]=Pe[ht]=Pe[G]=Pe[ut]=Pe[U]=Pe[Y]=Pe[q]=Pe[Z]=Pe[$]=Pe[Q]=Pe[et]=Pe[it]=Pe[rt]=Pe[st]=!1;var Me={};Me[F]=Me[z]=Me[ht]=Me[ut]=Me[G]=Me[U]=Me[lt]=Me[ct]=Me[ft]=Me[_t]=Me[dt]=Me[Z]=Me[$]=Me[Q]=Me[et]=Me[it]=Me[rt]=Me[nt]=Me[pt]=Me[gt]=Me[mt]=Me[bt]=!0,Me[Y]=Me[q]=Me[st]=!1;var ke={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ie=parseFloat,Ae=parseInt,Se="object"==typeof t&&t&&t.Object===Object&&t,Ee="object"==typeof self&&self&&self.Object===Object&&self,Re=Se||Ee||Function("return this")(),Le=e&&!e.nodeType&&e,De=Le&&"object"==typeof r&&r&&!r.nodeType&&r,Ne=De&&De.exports===Le,Be=Ne&&Se.process,Ve=function(){try{var t=De&&De.require&&De.require("util").types;return t||Be&&Be.binding&&Be.binding("util")}catch(t){}}(),He=Ve&&Ve.isArrayBuffer,je=Ve&&Ve.isDate,Fe=Ve&&Ve.isMap,ze=Ve&&Ve.isRegExp,We=Ve&&Ve.isSet,Ge=Ve&&Ve.isTypedArray;function Ue(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Xe(t,e,i,r){for(var n=-1,o=null==t?0:t.length;++n<o;){var s=t[n];e(r,s,i(s),t)}return r}function Ye(t,e){for(var i=-1,r=null==t?0:t.length;++i<r&&!1!==e(t[i],i,t););return t}function qe(t,e){for(var i=null==t?0:t.length;i--&&!1!==e(t[i],i,t););return t}function Ke(t,e){for(var i=-1,r=null==t?0:t.length;++i<r;)if(!e(t[i],i,t))return!1;return!0}function Ze(t,e){for(var i=-1,r=null==t?0:t.length,n=0,o=[];++i<r;){var s=t[i];e(s,i,t)&&(o[n++]=s)}return o}function $e(t,e){return!!(null==t?0:t.length)&&ai(t,e,0)>-1}function Je(t,e,i){for(var r=-1,n=null==t?0:t.length;++r<n;)if(i(e,t[r]))return!0;return!1}function Qe(t,e){for(var i=-1,r=null==t?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}function ti(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}function ei(t,e,i,r){var n=-1,o=null==t?0:t.length;for(r&&o&&(i=t[++n]);++n<o;)i=e(i,t[n],n,t);return i}function ii(t,e,i,r){var n=null==t?0:t.length;for(r&&n&&(i=t[--n]);n--;)i=e(i,t[n],n,t);return i}function ri(t,e){for(var i=-1,r=null==t?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}var ni=ci("length");function oi(t,e,i){var r;return i(t,(function(t,i,n){if(e(t,i,n))return r=i,!1})),r}function si(t,e,i,r){for(var n=t.length,o=i+(r?1:-1);r?o--:++o<n;)if(e(t[o],o,t))return o;return-1}function ai(t,e,i){return e==e?function(t,e,i){var r=i-1,n=t.length;for(;++r<n;)if(t[r]===e)return r;return-1}(t,e,i):si(t,ui,i)}function hi(t,e,i,r){for(var n=i-1,o=t.length;++n<o;)if(r(t[n],e))return n;return-1}function ui(t){return t!=t}function li(t,e){var i=null==t?0:t.length;return i?di(t,e)/i:N}function ci(t){return function(e){return null==e?o:e[t]}}function fi(t){return function(e){return null==t?o:t[e]}}function _i(t,e,i,r,n){return n(t,(function(t,n,o){i=r?(r=!1,t):e(i,t,n,o)})),i}function di(t,e){for(var i,r=-1,n=t.length;++r<n;){var s=e(t[r]);s!==o&&(i=i===o?s:i+s)}return i}function pi(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}function gi(t){return function(e){return t(e)}}function mi(t,e){return Qe(e,(function(e){return t[e]}))}function bi(t,e){return t.has(e)}function yi(t,e){for(var i=-1,r=t.length;++i<r&&ai(e,t[i],0)>-1;);return i}function vi(t,e){for(var i=t.length;i--&&ai(e,t[i],0)>-1;);return i}var Oi=fi({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),wi=fi({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Ci(t){return"\\"+ke[t]}function xi(t){return we.test(t)}function Ti(t){var e=-1,i=Array(t.size);return t.forEach((function(t,r){i[++e]=[r,t]})),i}function Pi(t,e){return function(i){return t(e(i))}}function Mi(t,e){for(var i=-1,r=t.length,n=0,o=[];++i<r;){var s=t[i];s!==e&&s!==c||(t[i]=c,o[n++]=i)}return o}function ki(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}function Ii(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=[t,t]})),i}function Ai(t){return xi(t)?function(t){var e=ve.lastIndex=0;for(;ve.test(t);)++e;return e}(t):ni(t)}function Si(t){return xi(t)?function(t){return t.match(ve)||[]}(t):function(t){return t.split("")}(t)}var Ei=fi({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Ri=function t(e){var i,r=(e=null==e?Re:Ri.defaults(Re.Object(),e,Ri.pick(Re,xe))).Array,n=e.Date,Jt=e.Error,Qt=e.Function,te=e.Math,ee=e.Object,ie=e.RegExp,re=e.String,ne=e.TypeError,oe=r.prototype,se=Qt.prototype,ae=ee.prototype,he=e["__core-js_shared__"],ue=se.toString,le=ae.hasOwnProperty,ce=0,fe=(i=/[^.]+$/.exec(he&&he.keys&&he.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",_e=ae.toString,de=ue.call(ee),pe=Re._,ge=ie("^"+ue.call(le).replace(Et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),me=Ne?e.Buffer:o,ve=e.Symbol,we=e.Uint8Array,ke=me?me.allocUnsafe:o,Se=Pi(ee.getPrototypeOf,ee),Ee=ee.create,Le=ae.propertyIsEnumerable,De=oe.splice,Be=ve?ve.isConcatSpreadable:o,Ve=ve?ve.iterator:o,ni=ve?ve.toStringTag:o,fi=function(){try{var t=Ho(ee,"defineProperty");return t({},"",{}),t}catch(t){}}(),Li=e.clearTimeout!==Re.clearTimeout&&e.clearTimeout,Di=n&&n.now!==Re.Date.now&&n.now,Ni=e.setTimeout!==Re.setTimeout&&e.setTimeout,Bi=te.ceil,Vi=te.floor,Hi=ee.getOwnPropertySymbols,ji=me?me.isBuffer:o,Fi=e.isFinite,zi=oe.join,Wi=Pi(ee.keys,ee),Gi=te.max,Ui=te.min,Xi=n.now,Yi=e.parseInt,qi=te.random,Ki=oe.reverse,Zi=Ho(e,"DataView"),$i=Ho(e,"Map"),Ji=Ho(e,"Promise"),Qi=Ho(e,"Set"),tr=Ho(e,"WeakMap"),er=Ho(ee,"create"),ir=tr&&new tr,rr={},nr=cs(Zi),or=cs($i),sr=cs(Ji),ar=cs(Qi),hr=cs(tr),ur=ve?ve.prototype:o,lr=ur?ur.valueOf:o,cr=ur?ur.toString:o;function fr(t){if(ka(t)&&!ma(t)&&!(t instanceof gr)){if(t instanceof pr)return t;if(le.call(t,"__wrapped__"))return fs(t)}return new pr(t)}var _r=function(){function t(){}return function(e){if(!Ma(e))return{};if(Ee)return Ee(e);t.prototype=e;var i=new t;return t.prototype=o,i}}();function dr(){}function pr(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=o}function gr(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=B,this.__views__=[]}function mr(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function br(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function yr(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function vr(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new yr;++e<i;)this.add(t[e])}function Or(t){var e=this.__data__=new br(t);this.size=e.size}function wr(t,e){var i=ma(t),r=!i&&ga(t),n=!i&&!r&&Oa(t),o=!i&&!r&&!n&&Na(t),s=i||r||n||o,a=s?pi(t.length,re):[],h=a.length;for(var u in t)!e&&!le.call(t,u)||s&&("length"==u||n&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Xo(u,h))||a.push(u);return a}function Cr(t){var e=t.length;return e?t[On(0,e-1)]:o}function xr(t,e){return hs(io(t),Rr(e,0,t.length))}function Tr(t){return hs(io(t))}function Pr(t,e,i){(i===o||_a(t[e],i))&&(i!==o||e in t)||Sr(t,e,i)}function Mr(t,e,i){var r=t[e];le.call(t,e)&&_a(r,i)&&(i!==o||e in t)||Sr(t,e,i)}function kr(t,e){for(var i=t.length;i--;)if(_a(t[i][0],e))return i;return-1}function Ir(t,e,i,r){return Vr(t,(function(t,n,o){e(r,t,i(t),o)})),r}function Ar(t,e){return t&&ro(e,nh(e),t)}function Sr(t,e,i){"__proto__"==e&&fi?fi(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}function Er(t,e){for(var i=-1,n=e.length,s=r(n),a=null==t;++i<n;)s[i]=a?o:Qa(t,e[i]);return s}function Rr(t,e,i){return t==t&&(i!==o&&(t=t<=i?t:i),e!==o&&(t=t>=e?t:e)),t}function Lr(t,e,i,r,n,s){var a,h=e&f,u=e&_,l=e&d;if(i&&(a=n?i(t,r,n,s):i(t)),a!==o)return a;if(!Ma(t))return t;var c=ma(t);if(c){if(a=function(t){var e=t.length,i=new t.constructor(e);e&&"string"==typeof t[0]&&le.call(t,"index")&&(i.index=t.index,i.input=t.input);return i}(t),!h)return io(t,a)}else{var p=zo(t),g=p==q||p==K;if(Oa(t))return Zn(t,h);if(p==Q||p==F||g&&!n){if(a=u||g?{}:Go(t),!h)return u?function(t,e){return ro(t,Fo(t),e)}(t,function(t,e){return t&&ro(e,oh(e),t)}(a,t)):function(t,e){return ro(t,jo(t),e)}(t,Ar(a,t))}else{if(!Me[p])return n?t:{};a=function(t,e,i){var r=t.constructor;switch(e){case ht:return $n(t);case G:case U:return new r(+t);case ut:return function(t,e){var i=e?$n(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}(t,i);case lt:case ct:case ft:case _t:case dt:case pt:case gt:case mt:case bt:return Jn(t,i);case Z:return new r;case $:case rt:return new r(t);case et:return function(t){var e=new t.constructor(t.source,Wt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case it:return new r;case nt:return n=t,lr?ee(lr.call(n)):{}}var n}(t,p,h)}}s||(s=new Or);var m=s.get(t);if(m)return m;s.set(t,a),Ra(t)?t.forEach((function(r){a.add(Lr(r,e,i,r,t,s))})):Ia(t)&&t.forEach((function(r,n){a.set(n,Lr(r,e,i,n,t,s))}));var b=c?o:(l?u?Eo:So:u?oh:nh)(t);return Ye(b||t,(function(r,n){b&&(r=t[n=r]),Mr(a,n,Lr(r,e,i,n,t,s))})),a}function Dr(t,e,i){var r=i.length;if(null==t)return!r;for(t=ee(t);r--;){var n=i[r],s=e[n],a=t[n];if(a===o&&!(n in t)||!s(a))return!1}return!0}function Nr(t,e,i){if("function"!=typeof t)throw new ne(h);return ns((function(){t.apply(o,i)}),e)}function Br(t,e,i,r){var n=-1,o=$e,a=!0,h=t.length,u=[],l=e.length;if(!h)return u;i&&(e=Qe(e,gi(i))),r?(o=Je,a=!1):e.length>=s&&(o=bi,a=!1,e=new vr(e));t:for(;++n<h;){var c=t[n],f=null==i?c:i(c);if(c=r||0!==c?c:0,a&&f==f){for(var _=l;_--;)if(e[_]===f)continue t;u.push(c)}else o(e,f,r)||u.push(c)}return u}fr.templateSettings={escape:Pt,evaluate:Mt,interpolate:kt,variable:"",imports:{_:fr}},fr.prototype=dr.prototype,fr.prototype.constructor=fr,pr.prototype=_r(dr.prototype),pr.prototype.constructor=pr,gr.prototype=_r(dr.prototype),gr.prototype.constructor=gr,mr.prototype.clear=function(){this.__data__=er?er(null):{},this.size=0},mr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},mr.prototype.get=function(t){var e=this.__data__;if(er){var i=e[t];return i===u?o:i}return le.call(e,t)?e[t]:o},mr.prototype.has=function(t){var e=this.__data__;return er?e[t]!==o:le.call(e,t)},mr.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=er&&e===o?u:e,this},br.prototype.clear=function(){this.__data__=[],this.size=0},br.prototype.delete=function(t){var e=this.__data__,i=kr(e,t);return!(i<0)&&(i==e.length-1?e.pop():De.call(e,i,1),--this.size,!0)},br.prototype.get=function(t){var e=this.__data__,i=kr(e,t);return i<0?o:e[i][1]},br.prototype.has=function(t){return kr(this.__data__,t)>-1},br.prototype.set=function(t,e){var i=this.__data__,r=kr(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this},yr.prototype.clear=function(){this.size=0,this.__data__={hash:new mr,map:new($i||br),string:new mr}},yr.prototype.delete=function(t){var e=Bo(this,t).delete(t);return this.size-=e?1:0,e},yr.prototype.get=function(t){return Bo(this,t).get(t)},yr.prototype.has=function(t){return Bo(this,t).has(t)},yr.prototype.set=function(t,e){var i=Bo(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this},vr.prototype.add=vr.prototype.push=function(t){return this.__data__.set(t,u),this},vr.prototype.has=function(t){return this.__data__.has(t)},Or.prototype.clear=function(){this.__data__=new br,this.size=0},Or.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},Or.prototype.get=function(t){return this.__data__.get(t)},Or.prototype.has=function(t){return this.__data__.has(t)},Or.prototype.set=function(t,e){var i=this.__data__;if(i instanceof br){var r=i.__data__;if(!$i||r.length<s-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new yr(r)}return i.set(t,e),this.size=i.size,this};var Vr=so(Xr),Hr=so(Yr,!0);function jr(t,e){var i=!0;return Vr(t,(function(t,r,n){return i=!!e(t,r,n)})),i}function Fr(t,e,i){for(var r=-1,n=t.length;++r<n;){var s=t[r],a=e(s);if(null!=a&&(h===o?a==a&&!Da(a):i(a,h)))var h=a,u=s}return u}function zr(t,e){var i=[];return Vr(t,(function(t,r,n){e(t,r,n)&&i.push(t)})),i}function Wr(t,e,i,r,n){var o=-1,s=t.length;for(i||(i=Uo),n||(n=[]);++o<s;){var a=t[o];e>0&&i(a)?e>1?Wr(a,e-1,i,r,n):ti(n,a):r||(n[n.length]=a)}return n}var Gr=ao(),Ur=ao(!0);function Xr(t,e){return t&&Gr(t,e,nh)}function Yr(t,e){return t&&Ur(t,e,nh)}function qr(t,e){return Ze(e,(function(e){return xa(t[e])}))}function Kr(t,e){for(var i=0,r=(e=Xn(e,t)).length;null!=t&&i<r;)t=t[ls(e[i++])];return i&&i==r?t:o}function Zr(t,e,i){var r=e(t);return ma(t)?r:ti(r,i(t))}function $r(t){return null==t?t===o?ot:J:ni&&ni in ee(t)?function(t){var e=le.call(t,ni),i=t[ni];try{t[ni]=o;var r=!0}catch(t){}var n=_e.call(t);r&&(e?t[ni]=i:delete t[ni]);return n}(t):function(t){return _e.call(t)}(t)}function Jr(t,e){return t>e}function Qr(t,e){return null!=t&&le.call(t,e)}function tn(t,e){return null!=t&&e in ee(t)}function en(t,e,i){for(var n=i?Je:$e,s=t[0].length,a=t.length,h=a,u=r(a),l=1/0,c=[];h--;){var f=t[h];h&&e&&(f=Qe(f,gi(e))),l=Ui(f.length,l),u[h]=!i&&(e||s>=120&&f.length>=120)?new vr(h&&f):o}f=t[0];var _=-1,d=u[0];t:for(;++_<s&&c.length<l;){var p=f[_],g=e?e(p):p;if(p=i||0!==p?p:0,!(d?bi(d,g):n(c,g,i))){for(h=a;--h;){var m=u[h];if(!(m?bi(m,g):n(t[h],g,i)))continue t}d&&d.push(g),c.push(p)}}return c}function rn(t,e,i){var r=null==(t=es(t,e=Xn(e,t)))?t:t[ls(Cs(e))];return null==r?o:Ue(r,t,i)}function nn(t){return ka(t)&&$r(t)==F}function on(t,e,i,r,n){return t===e||(null==t||null==e||!ka(t)&&!ka(e)?t!=t&&e!=e:function(t,e,i,r,n,s){var a=ma(t),h=ma(e),u=a?z:zo(t),l=h?z:zo(e),c=(u=u==F?Q:u)==Q,f=(l=l==F?Q:l)==Q,_=u==l;if(_&&Oa(t)){if(!Oa(e))return!1;a=!0,c=!1}if(_&&!c)return s||(s=new Or),a||Na(t)?Io(t,e,i,r,n,s):function(t,e,i,r,n,o,s){switch(i){case ut:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ht:return!(t.byteLength!=e.byteLength||!o(new we(t),new we(e)));case G:case U:case $:return _a(+t,+e);case Y:return t.name==e.name&&t.message==e.message;case et:case rt:return t==e+"";case Z:var a=Ti;case it:var h=r&p;if(a||(a=ki),t.size!=e.size&&!h)return!1;var u=s.get(t);if(u)return u==e;r|=g,s.set(t,e);var l=Io(a(t),a(e),r,n,o,s);return s.delete(t),l;case nt:if(lr)return lr.call(t)==lr.call(e)}return!1}(t,e,u,i,r,n,s);if(!(i&p)){var d=c&&le.call(t,"__wrapped__"),m=f&&le.call(e,"__wrapped__");if(d||m){var b=d?t.value():t,y=m?e.value():e;return s||(s=new Or),n(b,y,i,r,s)}}if(!_)return!1;return s||(s=new Or),function(t,e,i,r,n,s){var a=i&p,h=So(t),u=h.length,l=So(e).length;if(u!=l&&!a)return!1;var c=u;for(;c--;){var f=h[c];if(!(a?f in e:le.call(e,f)))return!1}var _=s.get(t);if(_&&s.get(e))return _==e;var d=!0;s.set(t,e),s.set(e,t);var g=a;for(;++c<u;){f=h[c];var m=t[f],b=e[f];if(r)var y=a?r(b,m,f,e,t,s):r(m,b,f,t,e,s);if(!(y===o?m===b||n(m,b,i,r,s):y)){d=!1;break}g||(g="constructor"==f)}if(d&&!g){var v=t.constructor,O=e.constructor;v!=O&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof O&&O instanceof O)&&(d=!1)}return s.delete(t),s.delete(e),d}(t,e,i,r,n,s)}(t,e,i,r,on,n))}function sn(t,e,i,r){var n=i.length,s=n,a=!r;if(null==t)return!s;for(t=ee(t);n--;){var h=i[n];if(a&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++n<s;){var u=(h=i[n])[0],l=t[u],c=h[1];if(a&&h[2]){if(l===o&&!(u in t))return!1}else{var f=new Or;if(r)var _=r(l,c,u,t,e,f);if(!(_===o?on(c,l,p|g,r,f):_))return!1}}return!0}function an(t){return!(!Ma(t)||(e=t,fe&&fe in e))&&(xa(t)?ge:Xt).test(cs(t));var e}function hn(t){return"function"==typeof t?t:null==t?Ah:"object"==typeof t?ma(t)?dn(t[0],t[1]):_n(t):Hh(t)}function un(t){if(!$o(t))return Wi(t);var e=[];for(var i in ee(t))le.call(t,i)&&"constructor"!=i&&e.push(i);return e}function ln(t){if(!Ma(t))return function(t){var e=[];if(null!=t)for(var i in ee(t))e.push(i);return e}(t);var e=$o(t),i=[];for(var r in t)("constructor"!=r||!e&&le.call(t,r))&&i.push(r);return i}function cn(t,e){return t<e}function fn(t,e){var i=-1,n=ya(t)?r(t.length):[];return Vr(t,(function(t,r,o){n[++i]=e(t,r,o)})),n}function _n(t){var e=Vo(t);return 1==e.length&&e[0][2]?Qo(e[0][0],e[0][1]):function(i){return i===t||sn(i,t,e)}}function dn(t,e){return qo(t)&&Jo(e)?Qo(ls(t),e):function(i){var r=Qa(i,t);return r===o&&r===e?th(i,t):on(e,r,p|g)}}function pn(t,e,i,r,n){t!==e&&Gr(e,(function(s,a){if(n||(n=new Or),Ma(s))!function(t,e,i,r,n,s,a){var h=is(t,i),u=is(e,i),l=a.get(u);if(l)return void Pr(t,i,l);var c=s?s(h,u,i+"",t,e,a):o,f=c===o;if(f){var _=ma(u),d=!_&&Oa(u),p=!_&&!d&&Na(u);c=u,_||d||p?ma(h)?c=h:va(h)?c=io(h):d?(f=!1,c=Zn(u,!0)):p?(f=!1,c=Jn(u,!0)):c=[]:Sa(u)||ga(u)?(c=h,ga(h)?c=Ga(h):Ma(h)&&!xa(h)||(c=Go(u))):f=!1}f&&(a.set(u,c),n(c,u,r,s,a),a.delete(u));Pr(t,i,c)}(t,e,a,i,pn,r,n);else{var h=r?r(is(t,a),s,a+"",t,e,n):o;h===o&&(h=s),Pr(t,a,h)}}),oh)}function gn(t,e){var i=t.length;if(i)return Xo(e+=e<0?i:0,i)?t[e]:o}function mn(t,e,i){var r=-1;return e=Qe(e.length?e:[Ah],gi(No())),function(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}(fn(t,(function(t,i,n){return{criteria:Qe(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,i){var r=-1,n=t.criteria,o=e.criteria,s=n.length,a=i.length;for(;++r<s;){var h=Qn(n[r],o[r]);if(h){if(r>=a)return h;var u=i[r];return h*("desc"==u?-1:1)}}return t.index-e.index}(t,e,i)}))}function bn(t,e,i){for(var r=-1,n=e.length,o={};++r<n;){var s=e[r],a=Kr(t,s);i(a,s)&&Pn(o,Xn(s,t),a)}return o}function yn(t,e,i,r){var n=r?hi:ai,o=-1,s=e.length,a=t;for(t===e&&(e=io(e)),i&&(a=Qe(t,gi(i)));++o<s;)for(var h=0,u=e[o],l=i?i(u):u;(h=n(a,l,h,r))>-1;)a!==t&&De.call(a,h,1),De.call(t,h,1);return t}function vn(t,e){for(var i=t?e.length:0,r=i-1;i--;){var n=e[i];if(i==r||n!==o){var o=n;Xo(n)?De.call(t,n,1):Vn(t,n)}}return t}function On(t,e){return t+Vi(qi()*(e-t+1))}function wn(t,e){var i="";if(!t||e<1||e>L)return i;do{e%2&&(i+=t),(e=Vi(e/2))&&(t+=t)}while(e);return i}function Cn(t,e){return os(ts(t,e,Ah),t+"")}function xn(t){return Cr(_h(t))}function Tn(t,e){var i=_h(t);return hs(i,Rr(e,0,i.length))}function Pn(t,e,i,r){if(!Ma(t))return t;for(var n=-1,s=(e=Xn(e,t)).length,a=s-1,h=t;null!=h&&++n<s;){var u=ls(e[n]),l=i;if(n!=a){var c=h[u];(l=r?r(c,u,h):o)===o&&(l=Ma(c)?c:Xo(e[n+1])?[]:{})}Mr(h,u,l),h=h[u]}return t}var Mn=ir?function(t,e){return ir.set(t,e),t}:Ah,kn=fi?function(t,e){return fi(t,"toString",{configurable:!0,enumerable:!1,value:Mh(e),writable:!0})}:Ah;function In(t){return hs(_h(t))}function An(t,e,i){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(i=i>o?o:i)<0&&(i+=o),o=e>i?0:i-e>>>0,e>>>=0;for(var s=r(o);++n<o;)s[n]=t[n+e];return s}function Sn(t,e){var i;return Vr(t,(function(t,r,n){return!(i=e(t,r,n))})),!!i}function En(t,e,i){var r=0,n=null==t?r:t.length;if("number"==typeof e&&e==e&&n<=H){for(;r<n;){var o=r+n>>>1,s=t[o];null!==s&&!Da(s)&&(i?s<=e:s<e)?r=o+1:n=o}return n}return Rn(t,e,Ah,i)}function Rn(t,e,i,r){e=i(e);for(var n=0,s=null==t?0:t.length,a=e!=e,h=null===e,u=Da(e),l=e===o;n<s;){var c=Vi((n+s)/2),f=i(t[c]),_=f!==o,d=null===f,p=f==f,g=Da(f);if(a)var m=r||p;else m=l?p&&(r||_):h?p&&_&&(r||!d):u?p&&_&&!d&&(r||!g):!d&&!g&&(r?f<=e:f<e);m?n=c+1:s=c}return Ui(s,V)}function Ln(t,e){for(var i=-1,r=t.length,n=0,o=[];++i<r;){var s=t[i],a=e?e(s):s;if(!i||!_a(a,h)){var h=a;o[n++]=0===s?0:s}}return o}function Dn(t){return"number"==typeof t?t:Da(t)?N:+t}function Nn(t){if("string"==typeof t)return t;if(ma(t))return Qe(t,Nn)+"";if(Da(t))return cr?cr.call(t):"";var e=t+"";return"0"==e&&1/t==-R?"-0":e}function Bn(t,e,i){var r=-1,n=$e,o=t.length,a=!0,h=[],u=h;if(i)a=!1,n=Je;else if(o>=s){var l=e?null:Co(t);if(l)return ki(l);a=!1,n=bi,u=new vr}else u=e?[]:h;t:for(;++r<o;){var c=t[r],f=e?e(c):c;if(c=i||0!==c?c:0,a&&f==f){for(var _=u.length;_--;)if(u[_]===f)continue t;e&&u.push(f),h.push(c)}else n(u,f,i)||(u!==h&&u.push(f),h.push(c))}return h}function Vn(t,e){return null==(t=es(t,e=Xn(e,t)))||delete t[ls(Cs(e))]}function Hn(t,e,i,r){return Pn(t,e,i(Kr(t,e)),r)}function jn(t,e,i,r){for(var n=t.length,o=r?n:-1;(r?o--:++o<n)&&e(t[o],o,t););return i?An(t,r?0:o,r?o+1:n):An(t,r?o+1:0,r?n:o)}function Fn(t,e){var i=t;return i instanceof gr&&(i=i.value()),ei(e,(function(t,e){return e.func.apply(e.thisArg,ti([t],e.args))}),i)}function zn(t,e,i){var n=t.length;if(n<2)return n?Bn(t[0]):[];for(var o=-1,s=r(n);++o<n;)for(var a=t[o],h=-1;++h<n;)h!=o&&(s[o]=Br(s[o]||a,t[h],e,i));return Bn(Wr(s,1),e,i)}function Wn(t,e,i){for(var r=-1,n=t.length,s=e.length,a={};++r<n;){var h=r<s?e[r]:o;i(a,t[r],h)}return a}function Gn(t){return va(t)?t:[]}function Un(t){return"function"==typeof t?t:Ah}function Xn(t,e){return ma(t)?t:qo(t,e)?[t]:us(Ua(t))}var Yn=Cn;function qn(t,e,i){var r=t.length;return i=i===o?r:i,!e&&i>=r?t:An(t,e,i)}var Kn=Li||function(t){return Re.clearTimeout(t)};function Zn(t,e){if(e)return t.slice();var i=t.length,r=ke?ke(i):new t.constructor(i);return t.copy(r),r}function $n(t){var e=new t.constructor(t.byteLength);return new we(e).set(new we(t)),e}function Jn(t,e){var i=e?$n(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function Qn(t,e){if(t!==e){var i=t!==o,r=null===t,n=t==t,s=Da(t),a=e!==o,h=null===e,u=e==e,l=Da(e);if(!h&&!l&&!s&&t>e||s&&a&&u&&!h&&!l||r&&a&&u||!i&&u||!n)return 1;if(!r&&!s&&!l&&t<e||l&&i&&n&&!r&&!s||h&&i&&n||!a&&n||!u)return-1}return 0}function to(t,e,i,n){for(var o=-1,s=t.length,a=i.length,h=-1,u=e.length,l=Gi(s-a,0),c=r(u+l),f=!n;++h<u;)c[h]=e[h];for(;++o<a;)(f||o<s)&&(c[i[o]]=t[o]);for(;l--;)c[h++]=t[o++];return c}function eo(t,e,i,n){for(var o=-1,s=t.length,a=-1,h=i.length,u=-1,l=e.length,c=Gi(s-h,0),f=r(c+l),_=!n;++o<c;)f[o]=t[o];for(var d=o;++u<l;)f[d+u]=e[u];for(;++a<h;)(_||o<s)&&(f[d+i[a]]=t[o++]);return f}function io(t,e){var i=-1,n=t.length;for(e||(e=r(n));++i<n;)e[i]=t[i];return e}function ro(t,e,i,r){var n=!i;i||(i={});for(var s=-1,a=e.length;++s<a;){var h=e[s],u=r?r(i[h],t[h],h,i,t):o;u===o&&(u=t[h]),n?Sr(i,h,u):Mr(i,h,u)}return i}function no(t,e){return function(i,r){var n=ma(i)?Xe:Ir,o=e?e():{};return n(i,t,No(r,2),o)}}function oo(t){return Cn((function(e,i){var r=-1,n=i.length,s=n>1?i[n-1]:o,a=n>2?i[2]:o;for(s=t.length>3&&"function"==typeof s?(n--,s):o,a&&Yo(i[0],i[1],a)&&(s=n<3?o:s,n=1),e=ee(e);++r<n;){var h=i[r];h&&t(e,h,r,s)}return e}))}function so(t,e){return function(i,r){if(null==i)return i;if(!ya(i))return t(i,r);for(var n=i.length,o=e?n:-1,s=ee(i);(e?o--:++o<n)&&!1!==r(s[o],o,s););return i}}function ao(t){return function(e,i,r){for(var n=-1,o=ee(e),s=r(e),a=s.length;a--;){var h=s[t?a:++n];if(!1===i(o[h],h,o))break}return e}}function ho(t){return function(e){var i=xi(e=Ua(e))?Si(e):o,r=i?i[0]:e.charAt(0),n=i?qn(i,1).join(""):e.slice(1);return r[t]()+n}}function uo(t){return function(e){return ei(xh(gh(e).replace(be,"")),t,"")}}function lo(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=_r(t.prototype),r=t.apply(i,e);return Ma(r)?r:i}}function co(t){return function(e,i,r){var n=ee(e);if(!ya(e)){var s=No(i,3);e=nh(e),i=function(t){return s(n[t],t,n)}}var a=t(e,i,r);return a>-1?n[s?e[a]:a]:o}}function fo(t){return Ao((function(e){var i=e.length,r=i,n=pr.prototype.thru;for(t&&e.reverse();r--;){var s=e[r];if("function"!=typeof s)throw new ne(h);if(n&&!a&&"wrapper"==Lo(s))var a=new pr([],!0)}for(r=a?r:i;++r<i;){var u=Lo(s=e[r]),l="wrapper"==u?Ro(s):o;a=l&&Ko(l[0])&&l[1]==(x|v|w|T)&&!l[4].length&&1==l[9]?a[Lo(l[0])].apply(a,l[3]):1==s.length&&Ko(s)?a[u]():a.thru(s)}return function(){var t=arguments,r=t[0];if(a&&1==t.length&&ma(r))return a.plant(r).value();for(var n=0,o=i?e[n].apply(this,t):r;++n<i;)o=e[n].call(this,o);return o}}))}function _o(t,e,i,n,s,a,h,u,l,c){var f=e&x,_=e&m,d=e&b,p=e&(v|O),g=e&P,y=d?o:lo(t);return function m(){for(var b=arguments.length,v=r(b),O=b;O--;)v[O]=arguments[O];if(p)var w=Do(m),C=function(t,e){for(var i=t.length,r=0;i--;)t[i]===e&&++r;return r}(v,w);if(n&&(v=to(v,n,s,p)),a&&(v=eo(v,a,h,p)),b-=C,p&&b<c){var x=Mi(v,w);return Oo(t,e,_o,m.placeholder,i,v,x,u,l,c-b)}var T=_?i:this,P=d?T[t]:t;return b=v.length,u?v=function(t,e){var i=t.length,r=Ui(e.length,i),n=io(t);for(;r--;){var s=e[r];t[r]=Xo(s,i)?n[s]:o}return t}(v,u):g&&b>1&&v.reverse(),f&&l<b&&(v.length=l),this&&this!==Re&&this instanceof m&&(P=y||lo(P)),P.apply(T,v)}}function po(t,e){return function(i,r){return function(t,e,i,r){return Xr(t,(function(t,n,o){e(r,i(t),n,o)})),r}(i,t,e(r),{})}}function go(t,e){return function(i,r){var n;if(i===o&&r===o)return e;if(i!==o&&(n=i),r!==o){if(n===o)return r;"string"==typeof i||"string"==typeof r?(i=Nn(i),r=Nn(r)):(i=Dn(i),r=Dn(r)),n=t(i,r)}return n}}function mo(t){return Ao((function(e){return e=Qe(e,gi(No())),Cn((function(i){var r=this;return t(e,(function(t){return Ue(t,r,i)}))}))}))}function bo(t,e){var i=(e=e===o?" ":Nn(e)).length;if(i<2)return i?wn(e,t):e;var r=wn(e,Bi(t/Ai(e)));return xi(e)?qn(Si(r),0,t).join(""):r.slice(0,t)}function yo(t){return function(e,i,n){return n&&"number"!=typeof n&&Yo(e,i,n)&&(i=n=o),e=ja(e),i===o?(i=e,e=0):i=ja(i),function(t,e,i,n){for(var o=-1,s=Gi(Bi((e-t)/(i||1)),0),a=r(s);s--;)a[n?s:++o]=t,t+=i;return a}(e,i,n=n===o?e<i?1:-1:ja(n),t)}}function vo(t){return function(e,i){return"string"==typeof e&&"string"==typeof i||(e=Wa(e),i=Wa(i)),t(e,i)}}function Oo(t,e,i,r,n,s,a,h,u,l){var c=e&v;e|=c?w:C,(e&=~(c?C:w))&y||(e&=~(m|b));var f=[t,e,n,c?s:o,c?a:o,c?o:s,c?o:a,h,u,l],_=i.apply(o,f);return Ko(t)&&rs(_,f),_.placeholder=r,ss(_,t,e)}function wo(t){var e=te[t];return function(t,i){if(t=Wa(t),(i=null==i?0:Ui(Fa(i),292))&&Fi(t)){var r=(Ua(t)+"e").split("e");return+((r=(Ua(e(r[0]+"e"+(+r[1]+i)))+"e").split("e"))[0]+"e"+(+r[1]-i))}return e(t)}}var Co=Qi&&1/ki(new Qi([,-0]))[1]==R?function(t){return new Qi(t)}:Dh;function xo(t){return function(e){var i=zo(e);return i==Z?Ti(e):i==it?Ii(e):function(t,e){return Qe(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function To(t,e,i,n,s,a,u,l){var f=e&b;if(!f&&"function"!=typeof t)throw new ne(h);var _=n?n.length:0;if(_||(e&=~(w|C),n=s=o),u=u===o?u:Gi(Fa(u),0),l=l===o?l:Fa(l),_-=s?s.length:0,e&C){var d=n,p=s;n=s=o}var g=f?o:Ro(t),P=[t,e,i,n,s,d,p,a,u,l];if(g&&function(t,e){var i=t[1],r=e[1],n=i|r,o=n<(m|b|x),s=r==x&&i==v||r==x&&i==T&&t[7].length<=e[8]||r==(x|T)&&e[7].length<=e[8]&&i==v;if(!o&&!s)return t;r&m&&(t[2]=e[2],n|=i&m?0:y);var a=e[3];if(a){var h=t[3];t[3]=h?to(h,a,e[4]):a,t[4]=h?Mi(t[3],c):e[4]}(a=e[5])&&(h=t[5],t[5]=h?eo(h,a,e[6]):a,t[6]=h?Mi(t[5],c):e[6]);(a=e[7])&&(t[7]=a);r&x&&(t[8]=null==t[8]?e[8]:Ui(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=n}(P,g),t=P[0],e=P[1],i=P[2],n=P[3],s=P[4],!(l=P[9]=P[9]===o?f?0:t.length:Gi(P[9]-_,0))&&e&(v|O)&&(e&=~(v|O)),e&&e!=m)M=e==v||e==O?function(t,e,i){var n=lo(t);return function s(){for(var a=arguments.length,h=r(a),u=a,l=Do(s);u--;)h[u]=arguments[u];var c=a<3&&h[0]!==l&&h[a-1]!==l?[]:Mi(h,l);return(a-=c.length)<i?Oo(t,e,_o,s.placeholder,o,h,c,o,o,i-a):Ue(this&&this!==Re&&this instanceof s?n:t,this,h)}}(t,e,l):e!=w&&e!=(m|w)||s.length?_o.apply(o,P):function(t,e,i,n){var o=e&m,s=lo(t);return function e(){for(var a=-1,h=arguments.length,u=-1,l=n.length,c=r(l+h),f=this&&this!==Re&&this instanceof e?s:t;++u<l;)c[u]=n[u];for(;h--;)c[u++]=arguments[++a];return Ue(f,o?i:this,c)}}(t,e,i,n);else var M=function(t,e,i){var r=e&m,n=lo(t);return function e(){return(this&&this!==Re&&this instanceof e?n:t).apply(r?i:this,arguments)}}(t,e,i);return ss((g?Mn:rs)(M,P),t,e)}function Po(t,e,i,r){return t===o||_a(t,ae[i])&&!le.call(r,i)?e:t}function Mo(t,e,i,r,n,s){return Ma(t)&&Ma(e)&&(s.set(e,t),pn(t,e,o,Mo,s),s.delete(e)),t}function ko(t){return Sa(t)?o:t}function Io(t,e,i,r,n,s){var a=i&p,h=t.length,u=e.length;if(h!=u&&!(a&&u>h))return!1;var l=s.get(t);if(l&&s.get(e))return l==e;var c=-1,f=!0,_=i&g?new vr:o;for(s.set(t,e),s.set(e,t);++c<h;){var d=t[c],m=e[c];if(r)var b=a?r(m,d,c,e,t,s):r(d,m,c,t,e,s);if(b!==o){if(b)continue;f=!1;break}if(_){if(!ri(e,(function(t,e){if(!bi(_,e)&&(d===t||n(d,t,i,r,s)))return _.push(e)}))){f=!1;break}}else if(d!==m&&!n(d,m,i,r,s)){f=!1;break}}return s.delete(t),s.delete(e),f}function Ao(t){return os(ts(t,o,bs),t+"")}function So(t){return Zr(t,nh,jo)}function Eo(t){return Zr(t,oh,Fo)}var Ro=ir?function(t){return ir.get(t)}:Dh;function Lo(t){for(var e=t.name+"",i=rr[e],r=le.call(rr,e)?i.length:0;r--;){var n=i[r],o=n.func;if(null==o||o==t)return n.name}return e}function Do(t){return(le.call(fr,"placeholder")?fr:t).placeholder}function No(){var t=fr.iteratee||Sh;return t=t===Sh?hn:t,arguments.length?t(arguments[0],arguments[1]):t}function Bo(t,e){var i,r,n=t.__data__;return("string"==(r=typeof(i=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof e?"string":"hash"]:n.map}function Vo(t){for(var e=nh(t),i=e.length;i--;){var r=e[i],n=t[r];e[i]=[r,n,Jo(n)]}return e}function Ho(t,e){var i=function(t,e){return null==t?o:t[e]}(t,e);return an(i)?i:o}var jo=Hi?function(t){return null==t?[]:(t=ee(t),Ze(Hi(t),(function(e){return Le.call(t,e)})))}:zh,Fo=Hi?function(t){for(var e=[];t;)ti(e,jo(t)),t=Se(t);return e}:zh,zo=$r;function Wo(t,e,i){for(var r=-1,n=(e=Xn(e,t)).length,o=!1;++r<n;){var s=ls(e[r]);if(!(o=null!=t&&i(t,s)))break;t=t[s]}return o||++r!=n?o:!!(n=null==t?0:t.length)&&Pa(n)&&Xo(s,n)&&(ma(t)||ga(t))}function Go(t){return"function"!=typeof t.constructor||$o(t)?{}:_r(Se(t))}function Uo(t){return ma(t)||ga(t)||!!(Be&&t&&t[Be])}function Xo(t,e){var i=typeof t;return!!(e=null==e?L:e)&&("number"==i||"symbol"!=i&&qt.test(t))&&t>-1&&t%1==0&&t<e}function Yo(t,e,i){if(!Ma(i))return!1;var r=typeof e;return!!("number"==r?ya(i)&&Xo(e,i.length):"string"==r&&e in i)&&_a(i[e],t)}function qo(t,e){if(ma(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Da(t))||(At.test(t)||!It.test(t)||null!=e&&t in ee(e))}function Ko(t){var e=Lo(t),i=fr[e];if("function"!=typeof i||!(e in gr.prototype))return!1;if(t===i)return!0;var r=Ro(i);return!!r&&t===r[0]}(Zi&&zo(new Zi(new ArrayBuffer(1)))!=ut||$i&&zo(new $i)!=Z||Ji&&"[object Promise]"!=zo(Ji.resolve())||Qi&&zo(new Qi)!=it||tr&&zo(new tr)!=st)&&(zo=function(t){var e=$r(t),i=e==Q?t.constructor:o,r=i?cs(i):"";if(r)switch(r){case nr:return ut;case or:return Z;case sr:return"[object Promise]";case ar:return it;case hr:return st}return e});var Zo=he?xa:Wh;function $o(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ae)}function Jo(t){return t==t&&!Ma(t)}function Qo(t,e){return function(i){return null!=i&&(i[t]===e&&(e!==o||t in ee(i)))}}function ts(t,e,i){return e=Gi(e===o?t.length-1:e,0),function(){for(var n=arguments,o=-1,s=Gi(n.length-e,0),a=r(s);++o<s;)a[o]=n[e+o];o=-1;for(var h=r(e+1);++o<e;)h[o]=n[o];return h[e]=i(a),Ue(t,this,h)}}function es(t,e){return e.length<2?t:Kr(t,An(e,0,-1))}function is(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var rs=as(Mn),ns=Ni||function(t,e){return Re.setTimeout(t,e)},os=as(kn);function ss(t,e,i){var r=e+"";return os(t,function(t,e){var i=e.length;if(!i)return t;var r=i-1;return e[r]=(i>1?"& ":"")+e[r],e=e.join(i>2?", ":" "),t.replace(Bt,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Ye(j,(function(i){var r="_."+i[0];e&i[1]&&!$e(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(Vt);return e?e[1].split(Ht):[]}(r),i)))}function as(t){var e=0,i=0;return function(){var r=Xi(),n=A-(r-i);if(i=r,n>0){if(++e>=I)return arguments[0]}else e=0;return t.apply(o,arguments)}}function hs(t,e){var i=-1,r=t.length,n=r-1;for(e=e===o?r:e;++i<e;){var s=On(i,n),a=t[s];t[s]=t[i],t[i]=a}return t.length=e,t}var us=function(t){var e=aa(t,(function(t){return i.size===l&&i.clear(),t})),i=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(St,(function(t,i,r,n){e.push(r?n.replace(Ft,"$1"):i||t)})),e}));function ls(t){if("string"==typeof t||Da(t))return t;var e=t+"";return"0"==e&&1/t==-R?"-0":e}function cs(t){if(null!=t){try{return ue.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function fs(t){if(t instanceof gr)return t.clone();var e=new pr(t.__wrapped__,t.__chain__);return e.__actions__=io(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var _s=Cn((function(t,e){return va(t)?Br(t,Wr(e,1,va,!0)):[]})),ds=Cn((function(t,e){var i=Cs(e);return va(i)&&(i=o),va(t)?Br(t,Wr(e,1,va,!0),No(i,2)):[]})),ps=Cn((function(t,e){var i=Cs(e);return va(i)&&(i=o),va(t)?Br(t,Wr(e,1,va,!0),o,i):[]}));function gs(t,e,i){var r=null==t?0:t.length;if(!r)return-1;var n=null==i?0:Fa(i);return n<0&&(n=Gi(r+n,0)),si(t,No(e,3),n)}function ms(t,e,i){var r=null==t?0:t.length;if(!r)return-1;var n=r-1;return i!==o&&(n=Fa(i),n=i<0?Gi(r+n,0):Ui(n,r-1)),si(t,No(e,3),n,!0)}function bs(t){return(null==t?0:t.length)?Wr(t,1):[]}function ys(t){return t&&t.length?t[0]:o}var vs=Cn((function(t){var e=Qe(t,Gn);return e.length&&e[0]===t[0]?en(e):[]})),Os=Cn((function(t){var e=Cs(t),i=Qe(t,Gn);return e===Cs(i)?e=o:i.pop(),i.length&&i[0]===t[0]?en(i,No(e,2)):[]})),ws=Cn((function(t){var e=Cs(t),i=Qe(t,Gn);return(e="function"==typeof e?e:o)&&i.pop(),i.length&&i[0]===t[0]?en(i,o,e):[]}));function Cs(t){var e=null==t?0:t.length;return e?t[e-1]:o}var xs=Cn(Ts);function Ts(t,e){return t&&t.length&&e&&e.length?yn(t,e):t}var Ps=Ao((function(t,e){var i=null==t?0:t.length,r=Er(t,e);return vn(t,Qe(e,(function(t){return Xo(t,i)?+t:t})).sort(Qn)),r}));function Ms(t){return null==t?t:Ki.call(t)}var ks=Cn((function(t){return Bn(Wr(t,1,va,!0))})),Is=Cn((function(t){var e=Cs(t);return va(e)&&(e=o),Bn(Wr(t,1,va,!0),No(e,2))})),As=Cn((function(t){var e=Cs(t);return e="function"==typeof e?e:o,Bn(Wr(t,1,va,!0),o,e)}));function Ss(t){if(!t||!t.length)return[];var e=0;return t=Ze(t,(function(t){if(va(t))return e=Gi(t.length,e),!0})),pi(e,(function(e){return Qe(t,ci(e))}))}function Es(t,e){if(!t||!t.length)return[];var i=Ss(t);return null==e?i:Qe(i,(function(t){return Ue(e,o,t)}))}var Rs=Cn((function(t,e){return va(t)?Br(t,e):[]})),Ls=Cn((function(t){return zn(Ze(t,va))})),Ds=Cn((function(t){var e=Cs(t);return va(e)&&(e=o),zn(Ze(t,va),No(e,2))})),Ns=Cn((function(t){var e=Cs(t);return e="function"==typeof e?e:o,zn(Ze(t,va),o,e)})),Bs=Cn(Ss);var Vs=Cn((function(t){var e=t.length,i=e>1?t[e-1]:o;return i="function"==typeof i?(t.pop(),i):o,Es(t,i)}));function Hs(t){var e=fr(t);return e.__chain__=!0,e}function js(t,e){return e(t)}var Fs=Ao((function(t){var e=t.length,i=e?t[0]:0,r=this.__wrapped__,n=function(e){return Er(e,t)};return!(e>1||this.__actions__.length)&&r instanceof gr&&Xo(i)?((r=r.slice(i,+i+(e?1:0))).__actions__.push({func:js,args:[n],thisArg:o}),new pr(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(o),t}))):this.thru(n)}));var zs=no((function(t,e,i){le.call(t,i)?++t[i]:Sr(t,i,1)}));var Ws=co(gs),Gs=co(ms);function Us(t,e){return(ma(t)?Ye:Vr)(t,No(e,3))}function Xs(t,e){return(ma(t)?qe:Hr)(t,No(e,3))}var Ys=no((function(t,e,i){le.call(t,i)?t[i].push(e):Sr(t,i,[e])}));var qs=Cn((function(t,e,i){var n=-1,o="function"==typeof e,s=ya(t)?r(t.length):[];return Vr(t,(function(t){s[++n]=o?Ue(e,t,i):rn(t,e,i)})),s})),Ks=no((function(t,e,i){Sr(t,i,e)}));function Zs(t,e){return(ma(t)?Qe:fn)(t,No(e,3))}var $s=no((function(t,e,i){t[i?0:1].push(e)}),(function(){return[[],[]]}));var Js=Cn((function(t,e){if(null==t)return[];var i=e.length;return i>1&&Yo(t,e[0],e[1])?e=[]:i>2&&Yo(e[0],e[1],e[2])&&(e=[e[0]]),mn(t,Wr(e,1),[])})),Qs=Di||function(){return Re.Date.now()};function ta(t,e,i){return e=i?o:e,e=t&&null==e?t.length:e,To(t,x,o,o,o,o,e)}function ea(t,e){var i;if("function"!=typeof e)throw new ne(h);return t=Fa(t),function(){return--t>0&&(i=e.apply(this,arguments)),t<=1&&(e=o),i}}var ia=Cn((function(t,e,i){var r=m;if(i.length){var n=Mi(i,Do(ia));r|=w}return To(t,r,e,i,n)})),ra=Cn((function(t,e,i){var r=m|b;if(i.length){var n=Mi(i,Do(ra));r|=w}return To(e,r,t,i,n)}));function na(t,e,i){var r,n,s,a,u,l,c=0,f=!1,_=!1,d=!0;if("function"!=typeof t)throw new ne(h);function p(e){var i=r,s=n;return r=n=o,c=e,a=t.apply(s,i)}function g(t){var i=t-l;return l===o||i>=e||i<0||_&&t-c>=s}function m(){var t=Qs();if(g(t))return b(t);u=ns(m,function(t){var i=e-(t-l);return _?Ui(i,s-(t-c)):i}(t))}function b(t){return u=o,d&&r?p(t):(r=n=o,a)}function y(){var t=Qs(),i=g(t);if(r=arguments,n=this,l=t,i){if(u===o)return function(t){return c=t,u=ns(m,e),f?p(t):a}(l);if(_)return Kn(u),u=ns(m,e),p(l)}return u===o&&(u=ns(m,e)),a}return e=Wa(e)||0,Ma(i)&&(f=!!i.leading,s=(_="maxWait"in i)?Gi(Wa(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d),y.cancel=function(){u!==o&&Kn(u),c=0,r=l=n=u=o},y.flush=function(){return u===o?a:b(Qs())},y}var oa=Cn((function(t,e){return Nr(t,1,e)})),sa=Cn((function(t,e,i){return Nr(t,Wa(e)||0,i)}));function aa(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new ne(h);var i=function(){var r=arguments,n=e?e.apply(this,r):r[0],o=i.cache;if(o.has(n))return o.get(n);var s=t.apply(this,r);return i.cache=o.set(n,s)||o,s};return i.cache=new(aa.Cache||yr),i}function ha(t){if("function"!=typeof t)throw new ne(h);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}aa.Cache=yr;var ua=Yn((function(t,e){var i=(e=1==e.length&&ma(e[0])?Qe(e[0],gi(No())):Qe(Wr(e,1),gi(No()))).length;return Cn((function(r){for(var n=-1,o=Ui(r.length,i);++n<o;)r[n]=e[n].call(this,r[n]);return Ue(t,this,r)}))})),la=Cn((function(t,e){var i=Mi(e,Do(la));return To(t,w,o,e,i)})),ca=Cn((function(t,e){var i=Mi(e,Do(ca));return To(t,C,o,e,i)})),fa=Ao((function(t,e){return To(t,T,o,o,o,e)}));function _a(t,e){return t===e||t!=t&&e!=e}var da=vo(Jr),pa=vo((function(t,e){return t>=e})),ga=nn(function(){return arguments}())?nn:function(t){return ka(t)&&le.call(t,"callee")&&!Le.call(t,"callee")},ma=r.isArray,ba=He?gi(He):function(t){return ka(t)&&$r(t)==ht};function ya(t){return null!=t&&Pa(t.length)&&!xa(t)}function va(t){return ka(t)&&ya(t)}var Oa=ji||Wh,wa=je?gi(je):function(t){return ka(t)&&$r(t)==U};function Ca(t){if(!ka(t))return!1;var e=$r(t);return e==Y||e==X||"string"==typeof t.message&&"string"==typeof t.name&&!Sa(t)}function xa(t){if(!Ma(t))return!1;var e=$r(t);return e==q||e==K||e==W||e==tt}function Ta(t){return"number"==typeof t&&t==Fa(t)}function Pa(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=L}function Ma(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ka(t){return null!=t&&"object"==typeof t}var Ia=Fe?gi(Fe):function(t){return ka(t)&&zo(t)==Z};function Aa(t){return"number"==typeof t||ka(t)&&$r(t)==$}function Sa(t){if(!ka(t)||$r(t)!=Q)return!1;var e=Se(t);if(null===e)return!0;var i=le.call(e,"constructor")&&e.constructor;return"function"==typeof i&&i instanceof i&&ue.call(i)==de}var Ea=ze?gi(ze):function(t){return ka(t)&&$r(t)==et};var Ra=We?gi(We):function(t){return ka(t)&&zo(t)==it};function La(t){return"string"==typeof t||!ma(t)&&ka(t)&&$r(t)==rt}function Da(t){return"symbol"==typeof t||ka(t)&&$r(t)==nt}var Na=Ge?gi(Ge):function(t){return ka(t)&&Pa(t.length)&&!!Pe[$r(t)]};var Ba=vo(cn),Va=vo((function(t,e){return t<=e}));function Ha(t){if(!t)return[];if(ya(t))return La(t)?Si(t):io(t);if(Ve&&t[Ve])return function(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}(t[Ve]());var e=zo(t);return(e==Z?Ti:e==it?ki:_h)(t)}function ja(t){return t?(t=Wa(t))===R||t===-R?(t<0?-1:1)*D:t==t?t:0:0===t?t:0}function Fa(t){var e=ja(t),i=e%1;return e==e?i?e-i:e:0}function za(t){return t?Rr(Fa(t),0,B):0}function Wa(t){if("number"==typeof t)return t;if(Da(t))return N;if(Ma(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Ma(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Lt,"");var i=Ut.test(t);return i||Yt.test(t)?Ae(t.slice(2),i?2:8):Gt.test(t)?N:+t}function Ga(t){return ro(t,oh(t))}function Ua(t){return null==t?"":Nn(t)}var Xa=oo((function(t,e){if($o(e)||ya(e))ro(e,nh(e),t);else for(var i in e)le.call(e,i)&&Mr(t,i,e[i])})),Ya=oo((function(t,e){ro(e,oh(e),t)})),qa=oo((function(t,e,i,r){ro(e,oh(e),t,r)})),Ka=oo((function(t,e,i,r){ro(e,nh(e),t,r)})),Za=Ao(Er);var $a=Cn((function(t,e){t=ee(t);var i=-1,r=e.length,n=r>2?e[2]:o;for(n&&Yo(e[0],e[1],n)&&(r=1);++i<r;)for(var s=e[i],a=oh(s),h=-1,u=a.length;++h<u;){var l=a[h],c=t[l];(c===o||_a(c,ae[l])&&!le.call(t,l))&&(t[l]=s[l])}return t})),Ja=Cn((function(t){return t.push(o,Mo),Ue(ah,o,t)}));function Qa(t,e,i){var r=null==t?o:Kr(t,e);return r===o?i:r}function th(t,e){return null!=t&&Wo(t,e,tn)}var eh=po((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=_e.call(e)),t[e]=i}),Mh(Ah)),ih=po((function(t,e,i){null!=e&&"function"!=typeof e.toString&&(e=_e.call(e)),le.call(t,e)?t[e].push(i):t[e]=[i]}),No),rh=Cn(rn);function nh(t){return ya(t)?wr(t):un(t)}function oh(t){return ya(t)?wr(t,!0):ln(t)}var sh=oo((function(t,e,i){pn(t,e,i)})),ah=oo((function(t,e,i,r){pn(t,e,i,r)})),hh=Ao((function(t,e){var i={};if(null==t)return i;var r=!1;e=Qe(e,(function(e){return e=Xn(e,t),r||(r=e.length>1),e})),ro(t,Eo(t),i),r&&(i=Lr(i,f|_|d,ko));for(var n=e.length;n--;)Vn(i,e[n]);return i}));var uh=Ao((function(t,e){return null==t?{}:function(t,e){return bn(t,e,(function(e,i){return th(t,i)}))}(t,e)}));function lh(t,e){if(null==t)return{};var i=Qe(Eo(t),(function(t){return[t]}));return e=No(e),bn(t,i,(function(t,i){return e(t,i[0])}))}var ch=xo(nh),fh=xo(oh);function _h(t){return null==t?[]:mi(t,nh(t))}var dh=uo((function(t,e,i){return e=e.toLowerCase(),t+(i?ph(e):e)}));function ph(t){return Ch(Ua(t).toLowerCase())}function gh(t){return(t=Ua(t))&&t.replace(Kt,Oi).replace(ye,"")}var mh=uo((function(t,e,i){return t+(i?"-":"")+e.toLowerCase()})),bh=uo((function(t,e,i){return t+(i?" ":"")+e.toLowerCase()})),yh=ho("toLowerCase");var vh=uo((function(t,e,i){return t+(i?"_":"")+e.toLowerCase()}));var Oh=uo((function(t,e,i){return t+(i?" ":"")+Ch(e)}));var wh=uo((function(t,e,i){return t+(i?" ":"")+e.toUpperCase()})),Ch=ho("toUpperCase");function xh(t,e,i){return t=Ua(t),(e=i?o:e)===o?function(t){return Ce.test(t)}(t)?function(t){return t.match(Oe)||[]}(t):function(t){return t.match(jt)||[]}(t):t.match(e)||[]}var Th=Cn((function(t,e){try{return Ue(t,o,e)}catch(t){return Ca(t)?t:new Jt(t)}})),Ph=Ao((function(t,e){return Ye(e,(function(e){e=ls(e),Sr(t,e,ia(t[e],t))})),t}));function Mh(t){return function(){return t}}var kh=fo(),Ih=fo(!0);function Ah(t){return t}function Sh(t){return hn("function"==typeof t?t:Lr(t,f))}var Eh=Cn((function(t,e){return function(i){return rn(i,t,e)}})),Rh=Cn((function(t,e){return function(i){return rn(t,i,e)}}));function Lh(t,e,i){var r=nh(e),n=qr(e,r);null!=i||Ma(e)&&(n.length||!r.length)||(i=e,e=t,t=this,n=qr(e,nh(e)));var o=!(Ma(i)&&"chain"in i&&!i.chain),s=xa(t);return Ye(n,(function(i){var r=e[i];t[i]=r,s&&(t.prototype[i]=function(){var e=this.__chain__;if(o||e){var i=t(this.__wrapped__),n=i.__actions__=io(this.__actions__);return n.push({func:r,args:arguments,thisArg:t}),i.__chain__=e,i}return r.apply(t,ti([this.value()],arguments))})})),t}function Dh(){}var Nh=mo(Qe),Bh=mo(Ke),Vh=mo(ri);function Hh(t){return qo(t)?ci(ls(t)):function(t){return function(e){return Kr(e,t)}}(t)}var jh=yo(),Fh=yo(!0);function zh(){return[]}function Wh(){return!1}var Gh=go((function(t,e){return t+e}),0),Uh=wo("ceil"),Xh=go((function(t,e){return t/e}),1),Yh=wo("floor");var qh,Kh=go((function(t,e){return t*e}),1),Zh=wo("round"),$h=go((function(t,e){return t-e}),0);return fr.after=function(t,e){if("function"!=typeof e)throw new ne(h);return t=Fa(t),function(){if(--t<1)return e.apply(this,arguments)}},fr.ary=ta,fr.assign=Xa,fr.assignIn=Ya,fr.assignInWith=qa,fr.assignWith=Ka,fr.at=Za,fr.before=ea,fr.bind=ia,fr.bindAll=Ph,fr.bindKey=ra,fr.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return ma(t)?t:[t]},fr.chain=Hs,fr.chunk=function(t,e,i){e=(i?Yo(t,e,i):e===o)?1:Gi(Fa(e),0);var n=null==t?0:t.length;if(!n||e<1)return[];for(var s=0,a=0,h=r(Bi(n/e));s<n;)h[a++]=An(t,s,s+=e);return h},fr.compact=function(t){for(var e=-1,i=null==t?0:t.length,r=0,n=[];++e<i;){var o=t[e];o&&(n[r++]=o)}return n},fr.concat=function(){var t=arguments.length;if(!t)return[];for(var e=r(t-1),i=arguments[0],n=t;n--;)e[n-1]=arguments[n];return ti(ma(i)?io(i):[i],Wr(e,1))},fr.cond=function(t){var e=null==t?0:t.length,i=No();return t=e?Qe(t,(function(t){if("function"!=typeof t[1])throw new ne(h);return[i(t[0]),t[1]]})):[],Cn((function(i){for(var r=-1;++r<e;){var n=t[r];if(Ue(n[0],this,i))return Ue(n[1],this,i)}}))},fr.conforms=function(t){return function(t){var e=nh(t);return function(i){return Dr(i,t,e)}}(Lr(t,f))},fr.constant=Mh,fr.countBy=zs,fr.create=function(t,e){var i=_r(t);return null==e?i:Ar(i,e)},fr.curry=function t(e,i,r){var n=To(e,v,o,o,o,o,o,i=r?o:i);return n.placeholder=t.placeholder,n},fr.curryRight=function t(e,i,r){var n=To(e,O,o,o,o,o,o,i=r?o:i);return n.placeholder=t.placeholder,n},fr.debounce=na,fr.defaults=$a,fr.defaultsDeep=Ja,fr.defer=oa,fr.delay=sa,fr.difference=_s,fr.differenceBy=ds,fr.differenceWith=ps,fr.drop=function(t,e,i){var r=null==t?0:t.length;return r?An(t,(e=i||e===o?1:Fa(e))<0?0:e,r):[]},fr.dropRight=function(t,e,i){var r=null==t?0:t.length;return r?An(t,0,(e=r-(e=i||e===o?1:Fa(e)))<0?0:e):[]},fr.dropRightWhile=function(t,e){return t&&t.length?jn(t,No(e,3),!0,!0):[]},fr.dropWhile=function(t,e){return t&&t.length?jn(t,No(e,3),!0):[]},fr.fill=function(t,e,i,r){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&Yo(t,e,i)&&(i=0,r=n),function(t,e,i,r){var n=t.length;for((i=Fa(i))<0&&(i=-i>n?0:n+i),(r=r===o||r>n?n:Fa(r))<0&&(r+=n),r=i>r?0:za(r);i<r;)t[i++]=e;return t}(t,e,i,r)):[]},fr.filter=function(t,e){return(ma(t)?Ze:zr)(t,No(e,3))},fr.flatMap=function(t,e){return Wr(Zs(t,e),1)},fr.flatMapDeep=function(t,e){return Wr(Zs(t,e),R)},fr.flatMapDepth=function(t,e,i){return i=i===o?1:Fa(i),Wr(Zs(t,e),i)},fr.flatten=bs,fr.flattenDeep=function(t){return(null==t?0:t.length)?Wr(t,R):[]},fr.flattenDepth=function(t,e){return(null==t?0:t.length)?Wr(t,e=e===o?1:Fa(e)):[]},fr.flip=function(t){return To(t,P)},fr.flow=kh,fr.flowRight=Ih,fr.fromPairs=function(t){for(var e=-1,i=null==t?0:t.length,r={};++e<i;){var n=t[e];r[n[0]]=n[1]}return r},fr.functions=function(t){return null==t?[]:qr(t,nh(t))},fr.functionsIn=function(t){return null==t?[]:qr(t,oh(t))},fr.groupBy=Ys,fr.initial=function(t){return(null==t?0:t.length)?An(t,0,-1):[]},fr.intersection=vs,fr.intersectionBy=Os,fr.intersectionWith=ws,fr.invert=eh,fr.invertBy=ih,fr.invokeMap=qs,fr.iteratee=Sh,fr.keyBy=Ks,fr.keys=nh,fr.keysIn=oh,fr.map=Zs,fr.mapKeys=function(t,e){var i={};return e=No(e,3),Xr(t,(function(t,r,n){Sr(i,e(t,r,n),t)})),i},fr.mapValues=function(t,e){var i={};return e=No(e,3),Xr(t,(function(t,r,n){Sr(i,r,e(t,r,n))})),i},fr.matches=function(t){return _n(Lr(t,f))},fr.matchesProperty=function(t,e){return dn(t,Lr(e,f))},fr.memoize=aa,fr.merge=sh,fr.mergeWith=ah,fr.method=Eh,fr.methodOf=Rh,fr.mixin=Lh,fr.negate=ha,fr.nthArg=function(t){return t=Fa(t),Cn((function(e){return gn(e,t)}))},fr.omit=hh,fr.omitBy=function(t,e){return lh(t,ha(No(e)))},fr.once=function(t){return ea(2,t)},fr.orderBy=function(t,e,i,r){return null==t?[]:(ma(e)||(e=null==e?[]:[e]),ma(i=r?o:i)||(i=null==i?[]:[i]),mn(t,e,i))},fr.over=Nh,fr.overArgs=ua,fr.overEvery=Bh,fr.overSome=Vh,fr.partial=la,fr.partialRight=ca,fr.partition=$s,fr.pick=uh,fr.pickBy=lh,fr.property=Hh,fr.propertyOf=function(t){return function(e){return null==t?o:Kr(t,e)}},fr.pull=xs,fr.pullAll=Ts,fr.pullAllBy=function(t,e,i){return t&&t.length&&e&&e.length?yn(t,e,No(i,2)):t},fr.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?yn(t,e,o,i):t},fr.pullAt=Ps,fr.range=jh,fr.rangeRight=Fh,fr.rearg=fa,fr.reject=function(t,e){return(ma(t)?Ze:zr)(t,ha(No(e,3)))},fr.remove=function(t,e){var i=[];if(!t||!t.length)return i;var r=-1,n=[],o=t.length;for(e=No(e,3);++r<o;){var s=t[r];e(s,r,t)&&(i.push(s),n.push(r))}return vn(t,n),i},fr.rest=function(t,e){if("function"!=typeof t)throw new ne(h);return Cn(t,e=e===o?e:Fa(e))},fr.reverse=Ms,fr.sampleSize=function(t,e,i){return e=(i?Yo(t,e,i):e===o)?1:Fa(e),(ma(t)?xr:Tn)(t,e)},fr.set=function(t,e,i){return null==t?t:Pn(t,e,i)},fr.setWith=function(t,e,i,r){return r="function"==typeof r?r:o,null==t?t:Pn(t,e,i,r)},fr.shuffle=function(t){return(ma(t)?Tr:In)(t)},fr.slice=function(t,e,i){var r=null==t?0:t.length;return r?(i&&"number"!=typeof i&&Yo(t,e,i)?(e=0,i=r):(e=null==e?0:Fa(e),i=i===o?r:Fa(i)),An(t,e,i)):[]},fr.sortBy=Js,fr.sortedUniq=function(t){return t&&t.length?Ln(t):[]},fr.sortedUniqBy=function(t,e){return t&&t.length?Ln(t,No(e,2)):[]},fr.split=function(t,e,i){return i&&"number"!=typeof i&&Yo(t,e,i)&&(e=i=o),(i=i===o?B:i>>>0)?(t=Ua(t))&&("string"==typeof e||null!=e&&!Ea(e))&&!(e=Nn(e))&&xi(t)?qn(Si(t),0,i):t.split(e,i):[]},fr.spread=function(t,e){if("function"!=typeof t)throw new ne(h);return e=null==e?0:Gi(Fa(e),0),Cn((function(i){var r=i[e],n=qn(i,0,e);return r&&ti(n,r),Ue(t,this,n)}))},fr.tail=function(t){var e=null==t?0:t.length;return e?An(t,1,e):[]},fr.take=function(t,e,i){return t&&t.length?An(t,0,(e=i||e===o?1:Fa(e))<0?0:e):[]},fr.takeRight=function(t,e,i){var r=null==t?0:t.length;return r?An(t,(e=r-(e=i||e===o?1:Fa(e)))<0?0:e,r):[]},fr.takeRightWhile=function(t,e){return t&&t.length?jn(t,No(e,3),!1,!0):[]},fr.takeWhile=function(t,e){return t&&t.length?jn(t,No(e,3)):[]},fr.tap=function(t,e){return e(t),t},fr.throttle=function(t,e,i){var r=!0,n=!0;if("function"!=typeof t)throw new ne(h);return Ma(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),na(t,e,{leading:r,maxWait:e,trailing:n})},fr.thru=js,fr.toArray=Ha,fr.toPairs=ch,fr.toPairsIn=fh,fr.toPath=function(t){return ma(t)?Qe(t,ls):Da(t)?[t]:io(us(Ua(t)))},fr.toPlainObject=Ga,fr.transform=function(t,e,i){var r=ma(t),n=r||Oa(t)||Na(t);if(e=No(e,4),null==i){var o=t&&t.constructor;i=n?r?new o:[]:Ma(t)&&xa(o)?_r(Se(t)):{}}return(n?Ye:Xr)(t,(function(t,r,n){return e(i,t,r,n)})),i},fr.unary=function(t){return ta(t,1)},fr.union=ks,fr.unionBy=Is,fr.unionWith=As,fr.uniq=function(t){return t&&t.length?Bn(t):[]},fr.uniqBy=function(t,e){return t&&t.length?Bn(t,No(e,2)):[]},fr.uniqWith=function(t,e){return e="function"==typeof e?e:o,t&&t.length?Bn(t,o,e):[]},fr.unset=function(t,e){return null==t||Vn(t,e)},fr.unzip=Ss,fr.unzipWith=Es,fr.update=function(t,e,i){return null==t?t:Hn(t,e,Un(i))},fr.updateWith=function(t,e,i,r){return r="function"==typeof r?r:o,null==t?t:Hn(t,e,Un(i),r)},fr.values=_h,fr.valuesIn=function(t){return null==t?[]:mi(t,oh(t))},fr.without=Rs,fr.words=xh,fr.wrap=function(t,e){return la(Un(e),t)},fr.xor=Ls,fr.xorBy=Ds,fr.xorWith=Ns,fr.zip=Bs,fr.zipObject=function(t,e){return Wn(t||[],e||[],Mr)},fr.zipObjectDeep=function(t,e){return Wn(t||[],e||[],Pn)},fr.zipWith=Vs,fr.entries=ch,fr.entriesIn=fh,fr.extend=Ya,fr.extendWith=qa,Lh(fr,fr),fr.add=Gh,fr.attempt=Th,fr.camelCase=dh,fr.capitalize=ph,fr.ceil=Uh,fr.clamp=function(t,e,i){return i===o&&(i=e,e=o),i!==o&&(i=(i=Wa(i))==i?i:0),e!==o&&(e=(e=Wa(e))==e?e:0),Rr(Wa(t),e,i)},fr.clone=function(t){return Lr(t,d)},fr.cloneDeep=function(t){return Lr(t,f|d)},fr.cloneDeepWith=function(t,e){return Lr(t,f|d,e="function"==typeof e?e:o)},fr.cloneWith=function(t,e){return Lr(t,d,e="function"==typeof e?e:o)},fr.conformsTo=function(t,e){return null==e||Dr(t,e,nh(e))},fr.deburr=gh,fr.defaultTo=function(t,e){return null==t||t!=t?e:t},fr.divide=Xh,fr.endsWith=function(t,e,i){t=Ua(t),e=Nn(e);var r=t.length,n=i=i===o?r:Rr(Fa(i),0,r);return(i-=e.length)>=0&&t.slice(i,n)==e},fr.eq=_a,fr.escape=function(t){return(t=Ua(t))&&Tt.test(t)?t.replace(Ct,wi):t},fr.escapeRegExp=function(t){return(t=Ua(t))&&Rt.test(t)?t.replace(Et,"\\$&"):t},fr.every=function(t,e,i){var r=ma(t)?Ke:jr;return i&&Yo(t,e,i)&&(e=o),r(t,No(e,3))},fr.find=Ws,fr.findIndex=gs,fr.findKey=function(t,e){return oi(t,No(e,3),Xr)},fr.findLast=Gs,fr.findLastIndex=ms,fr.findLastKey=function(t,e){return oi(t,No(e,3),Yr)},fr.floor=Yh,fr.forEach=Us,fr.forEachRight=Xs,fr.forIn=function(t,e){return null==t?t:Gr(t,No(e,3),oh)},fr.forInRight=function(t,e){return null==t?t:Ur(t,No(e,3),oh)},fr.forOwn=function(t,e){return t&&Xr(t,No(e,3))},fr.forOwnRight=function(t,e){return t&&Yr(t,No(e,3))},fr.get=Qa,fr.gt=da,fr.gte=pa,fr.has=function(t,e){return null!=t&&Wo(t,e,Qr)},fr.hasIn=th,fr.head=ys,fr.identity=Ah,fr.includes=function(t,e,i,r){t=ya(t)?t:_h(t),i=i&&!r?Fa(i):0;var n=t.length;return i<0&&(i=Gi(n+i,0)),La(t)?i<=n&&t.indexOf(e,i)>-1:!!n&&ai(t,e,i)>-1},fr.indexOf=function(t,e,i){var r=null==t?0:t.length;if(!r)return-1;var n=null==i?0:Fa(i);return n<0&&(n=Gi(r+n,0)),ai(t,e,n)},fr.inRange=function(t,e,i){return e=ja(e),i===o?(i=e,e=0):i=ja(i),function(t,e,i){return t>=Ui(e,i)&&t<Gi(e,i)}(t=Wa(t),e,i)},fr.invoke=rh,fr.isArguments=ga,fr.isArray=ma,fr.isArrayBuffer=ba,fr.isArrayLike=ya,fr.isArrayLikeObject=va,fr.isBoolean=function(t){return!0===t||!1===t||ka(t)&&$r(t)==G},fr.isBuffer=Oa,fr.isDate=wa,fr.isElement=function(t){return ka(t)&&1===t.nodeType&&!Sa(t)},fr.isEmpty=function(t){if(null==t)return!0;if(ya(t)&&(ma(t)||"string"==typeof t||"function"==typeof t.splice||Oa(t)||Na(t)||ga(t)))return!t.length;var e=zo(t);if(e==Z||e==it)return!t.size;if($o(t))return!un(t).length;for(var i in t)if(le.call(t,i))return!1;return!0},fr.isEqual=function(t,e){return on(t,e)},fr.isEqualWith=function(t,e,i){var r=(i="function"==typeof i?i:o)?i(t,e):o;return r===o?on(t,e,o,i):!!r},fr.isError=Ca,fr.isFinite=function(t){return"number"==typeof t&&Fi(t)},fr.isFunction=xa,fr.isInteger=Ta,fr.isLength=Pa,fr.isMap=Ia,fr.isMatch=function(t,e){return t===e||sn(t,e,Vo(e))},fr.isMatchWith=function(t,e,i){return i="function"==typeof i?i:o,sn(t,e,Vo(e),i)},fr.isNaN=function(t){return Aa(t)&&t!=+t},fr.isNative=function(t){if(Zo(t))throw new Jt(a);return an(t)},fr.isNil=function(t){return null==t},fr.isNull=function(t){return null===t},fr.isNumber=Aa,fr.isObject=Ma,fr.isObjectLike=ka,fr.isPlainObject=Sa,fr.isRegExp=Ea,fr.isSafeInteger=function(t){return Ta(t)&&t>=-L&&t<=L},fr.isSet=Ra,fr.isString=La,fr.isSymbol=Da,fr.isTypedArray=Na,fr.isUndefined=function(t){return t===o},fr.isWeakMap=function(t){return ka(t)&&zo(t)==st},fr.isWeakSet=function(t){return ka(t)&&$r(t)==at},fr.join=function(t,e){return null==t?"":zi.call(t,e)},fr.kebabCase=mh,fr.last=Cs,fr.lastIndexOf=function(t,e,i){var r=null==t?0:t.length;if(!r)return-1;var n=r;return i!==o&&(n=(n=Fa(i))<0?Gi(r+n,0):Ui(n,r-1)),e==e?function(t,e,i){for(var r=i+1;r--;)if(t[r]===e)return r;return r}(t,e,n):si(t,ui,n,!0)},fr.lowerCase=bh,fr.lowerFirst=yh,fr.lt=Ba,fr.lte=Va,fr.max=function(t){return t&&t.length?Fr(t,Ah,Jr):o},fr.maxBy=function(t,e){return t&&t.length?Fr(t,No(e,2),Jr):o},fr.mean=function(t){return li(t,Ah)},fr.meanBy=function(t,e){return li(t,No(e,2))},fr.min=function(t){return t&&t.length?Fr(t,Ah,cn):o},fr.minBy=function(t,e){return t&&t.length?Fr(t,No(e,2),cn):o},fr.stubArray=zh,fr.stubFalse=Wh,fr.stubObject=function(){return{}},fr.stubString=function(){return""},fr.stubTrue=function(){return!0},fr.multiply=Kh,fr.nth=function(t,e){return t&&t.length?gn(t,Fa(e)):o},fr.noConflict=function(){return Re._===this&&(Re._=pe),this},fr.noop=Dh,fr.now=Qs,fr.pad=function(t,e,i){t=Ua(t);var r=(e=Fa(e))?Ai(t):0;if(!e||r>=e)return t;var n=(e-r)/2;return bo(Vi(n),i)+t+bo(Bi(n),i)},fr.padEnd=function(t,e,i){t=Ua(t);var r=(e=Fa(e))?Ai(t):0;return e&&r<e?t+bo(e-r,i):t},fr.padStart=function(t,e,i){t=Ua(t);var r=(e=Fa(e))?Ai(t):0;return e&&r<e?bo(e-r,i)+t:t},fr.parseInt=function(t,e,i){return i||null==e?e=0:e&&(e=+e),Yi(Ua(t).replace(Dt,""),e||0)},fr.random=function(t,e,i){if(i&&"boolean"!=typeof i&&Yo(t,e,i)&&(e=i=o),i===o&&("boolean"==typeof e?(i=e,e=o):"boolean"==typeof t&&(i=t,t=o)),t===o&&e===o?(t=0,e=1):(t=ja(t),e===o?(e=t,t=0):e=ja(e)),t>e){var r=t;t=e,e=r}if(i||t%1||e%1){var n=qi();return Ui(t+n*(e-t+Ie("1e-"+((n+"").length-1))),e)}return On(t,e)},fr.reduce=function(t,e,i){var r=ma(t)?ei:_i,n=arguments.length<3;return r(t,No(e,4),i,n,Vr)},fr.reduceRight=function(t,e,i){var r=ma(t)?ii:_i,n=arguments.length<3;return r(t,No(e,4),i,n,Hr)},fr.repeat=function(t,e,i){return e=(i?Yo(t,e,i):e===o)?1:Fa(e),wn(Ua(t),e)},fr.replace=function(){var t=arguments,e=Ua(t[0]);return t.length<3?e:e.replace(t[1],t[2])},fr.result=function(t,e,i){var r=-1,n=(e=Xn(e,t)).length;for(n||(n=1,t=o);++r<n;){var s=null==t?o:t[ls(e[r])];s===o&&(r=n,s=i),t=xa(s)?s.call(t):s}return t},fr.round=Zh,fr.runInContext=t,fr.sample=function(t){return(ma(t)?Cr:xn)(t)},fr.size=function(t){if(null==t)return 0;if(ya(t))return La(t)?Ai(t):t.length;var e=zo(t);return e==Z||e==it?t.size:un(t).length},fr.snakeCase=vh,fr.some=function(t,e,i){var r=ma(t)?ri:Sn;return i&&Yo(t,e,i)&&(e=o),r(t,No(e,3))},fr.sortedIndex=function(t,e){return En(t,e)},fr.sortedIndexBy=function(t,e,i){return Rn(t,e,No(i,2))},fr.sortedIndexOf=function(t,e){var i=null==t?0:t.length;if(i){var r=En(t,e);if(r<i&&_a(t[r],e))return r}return-1},fr.sortedLastIndex=function(t,e){return En(t,e,!0)},fr.sortedLastIndexBy=function(t,e,i){return Rn(t,e,No(i,2),!0)},fr.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var i=En(t,e,!0)-1;if(_a(t[i],e))return i}return-1},fr.startCase=Oh,fr.startsWith=function(t,e,i){return t=Ua(t),i=null==i?0:Rr(Fa(i),0,t.length),e=Nn(e),t.slice(i,i+e.length)==e},fr.subtract=$h,fr.sum=function(t){return t&&t.length?di(t,Ah):0},fr.sumBy=function(t,e){return t&&t.length?di(t,No(e,2)):0},fr.template=function(t,e,i){var r=fr.templateSettings;i&&Yo(t,e,i)&&(e=o),t=Ua(t),e=qa({},e,r,Po);var n,s,a=qa({},e.imports,r.imports,Po),h=nh(a),u=mi(a,h),l=0,c=e.interpolate||Zt,f="__p += '",_=ie((e.escape||Zt).source+"|"+c.source+"|"+(c===kt?zt:Zt).source+"|"+(e.evaluate||Zt).source+"|$","g"),d="//# sourceURL="+(le.call(e,"sourceURL")?(e.sourceURL+"").replace(/[\r\n]/g," "):"lodash.templateSources["+ ++Te+"]")+"\n";t.replace(_,(function(e,i,r,o,a,h){return r||(r=o),f+=t.slice(l,h).replace($t,Ci),i&&(n=!0,f+="' +\n__e("+i+") +\n'"),a&&(s=!0,f+="';\n"+a+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=h+e.length,e})),f+="';\n";var p=le.call(e,"variable")&&e.variable;p||(f="with (obj) {\n"+f+"\n}\n"),f=(s?f.replace(yt,""):f).replace(vt,"$1").replace(Ot,"$1;"),f="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(n?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var g=Th((function(){return Qt(h,d+"return "+f).apply(o,u)}));if(g.source=f,Ca(g))throw g;return g},fr.times=function(t,e){if((t=Fa(t))<1||t>L)return[];var i=B,r=Ui(t,B);e=No(e),t-=B;for(var n=pi(r,e);++i<t;)e(i);return n},fr.toFinite=ja,fr.toInteger=Fa,fr.toLength=za,fr.toLower=function(t){return Ua(t).toLowerCase()},fr.toNumber=Wa,fr.toSafeInteger=function(t){return t?Rr(Fa(t),-L,L):0===t?t:0},fr.toString=Ua,fr.toUpper=function(t){return Ua(t).toUpperCase()},fr.trim=function(t,e,i){if((t=Ua(t))&&(i||e===o))return t.replace(Lt,"");if(!t||!(e=Nn(e)))return t;var r=Si(t),n=Si(e);return qn(r,yi(r,n),vi(r,n)+1).join("")},fr.trimEnd=function(t,e,i){if((t=Ua(t))&&(i||e===o))return t.replace(Nt,"");if(!t||!(e=Nn(e)))return t;var r=Si(t);return qn(r,0,vi(r,Si(e))+1).join("")},fr.trimStart=function(t,e,i){if((t=Ua(t))&&(i||e===o))return t.replace(Dt,"");if(!t||!(e=Nn(e)))return t;var r=Si(t);return qn(r,yi(r,Si(e))).join("")},fr.truncate=function(t,e){var i=M,r=k;if(Ma(e)){var n="separator"in e?e.separator:n;i="length"in e?Fa(e.length):i,r="omission"in e?Nn(e.omission):r}var s=(t=Ua(t)).length;if(xi(t)){var a=Si(t);s=a.length}if(i>=s)return t;var h=i-Ai(r);if(h<1)return r;var u=a?qn(a,0,h).join(""):t.slice(0,h);if(n===o)return u+r;if(a&&(h+=u.length-h),Ea(n)){if(t.slice(h).search(n)){var l,c=u;for(n.global||(n=ie(n.source,Ua(Wt.exec(n))+"g")),n.lastIndex=0;l=n.exec(c);)var f=l.index;u=u.slice(0,f===o?h:f)}}else if(t.indexOf(Nn(n),h)!=h){var _=u.lastIndexOf(n);_>-1&&(u=u.slice(0,_))}return u+r},fr.unescape=function(t){return(t=Ua(t))&&xt.test(t)?t.replace(wt,Ei):t},fr.uniqueId=function(t){var e=++ce;return Ua(t)+e},fr.upperCase=wh,fr.upperFirst=Ch,fr.each=Us,fr.eachRight=Xs,fr.first=ys,Lh(fr,(qh={},Xr(fr,(function(t,e){le.call(fr.prototype,e)||(qh[e]=t)})),qh),{chain:!1}),fr.VERSION="4.17.15",Ye(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){fr[t].placeholder=fr})),Ye(["drop","take"],(function(t,e){gr.prototype[t]=function(i){i=i===o?1:Gi(Fa(i),0);var r=this.__filtered__&&!e?new gr(this):this.clone();return r.__filtered__?r.__takeCount__=Ui(i,r.__takeCount__):r.__views__.push({size:Ui(i,B),type:t+(r.__dir__<0?"Right":"")}),r},gr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),Ye(["filter","map","takeWhile"],(function(t,e){var i=e+1,r=i==S||3==i;gr.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:No(t,3),type:i}),e.__filtered__=e.__filtered__||r,e}})),Ye(["head","last"],(function(t,e){var i="take"+(e?"Right":"");gr.prototype[t]=function(){return this[i](1).value()[0]}})),Ye(["initial","tail"],(function(t,e){var i="drop"+(e?"":"Right");gr.prototype[t]=function(){return this.__filtered__?new gr(this):this[i](1)}})),gr.prototype.compact=function(){return this.filter(Ah)},gr.prototype.find=function(t){return this.filter(t).head()},gr.prototype.findLast=function(t){return this.reverse().find(t)},gr.prototype.invokeMap=Cn((function(t,e){return"function"==typeof t?new gr(this):this.map((function(i){return rn(i,t,e)}))})),gr.prototype.reject=function(t){return this.filter(ha(No(t)))},gr.prototype.slice=function(t,e){t=Fa(t);var i=this;return i.__filtered__&&(t>0||e<0)?new gr(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==o&&(i=(e=Fa(e))<0?i.dropRight(-e):i.take(e-t)),i)},gr.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},gr.prototype.toArray=function(){return this.take(B)},Xr(gr.prototype,(function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),n=fr[r?"take"+("last"==e?"Right":""):e],s=r||/^find/.test(e);n&&(fr.prototype[e]=function(){var e=this.__wrapped__,a=r?[1]:arguments,h=e instanceof gr,u=a[0],l=h||ma(e),c=function(t){var e=n.apply(fr,ti([t],a));return r&&f?e[0]:e};l&&i&&"function"==typeof u&&1!=u.length&&(h=l=!1);var f=this.__chain__,_=!!this.__actions__.length,d=s&&!f,p=h&&!_;if(!s&&l){e=p?e:new gr(this);var g=t.apply(e,a);return g.__actions__.push({func:js,args:[c],thisArg:o}),new pr(g,f)}return d&&p?t.apply(this,a):(g=this.thru(c),d?r?g.value()[0]:g.value():g)})})),Ye(["pop","push","shift","sort","splice","unshift"],(function(t){var e=oe[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);fr.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var n=this.value();return e.apply(ma(n)?n:[],t)}return this[i]((function(i){return e.apply(ma(i)?i:[],t)}))}})),Xr(gr.prototype,(function(t,e){var i=fr[e];if(i){var r=i.name+"";le.call(rr,r)||(rr[r]=[]),rr[r].push({name:e,func:i})}})),rr[_o(o,b).name]=[{name:"wrapper",func:o}],gr.prototype.clone=function(){var t=new gr(this.__wrapped__);return t.__actions__=io(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=io(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=io(this.__views__),t},gr.prototype.reverse=function(){if(this.__filtered__){var t=new gr(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},gr.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,i=ma(t),r=e<0,n=i?t.length:0,o=function(t,e,i){var r=-1,n=i.length;for(;++r<n;){var o=i[r],s=o.size;switch(o.type){case"drop":t+=s;break;case"dropRight":e-=s;break;case"take":e=Ui(e,t+s);break;case"takeRight":t=Gi(t,e-s)}}return{start:t,end:e}}(0,n,this.__views__),s=o.start,a=o.end,h=a-s,u=r?a:s-1,l=this.__iteratees__,c=l.length,f=0,_=Ui(h,this.__takeCount__);if(!i||!r&&n==h&&_==h)return Fn(t,this.__actions__);var d=[];t:for(;h--&&f<_;){for(var p=-1,g=t[u+=e];++p<c;){var m=l[p],b=m.iteratee,y=m.type,v=b(g);if(y==E)g=v;else if(!v){if(y==S)continue t;break t}}d[f++]=g}return d},fr.prototype.at=Fs,fr.prototype.chain=function(){return Hs(this)},fr.prototype.commit=function(){return new pr(this.value(),this.__chain__)},fr.prototype.next=function(){this.__values__===o&&(this.__values__=Ha(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?o:this.__values__[this.__index__++]}},fr.prototype.plant=function(t){for(var e,i=this;i instanceof dr;){var r=fs(i);r.__index__=0,r.__values__=o,e?n.__wrapped__=r:e=r;var n=r;i=i.__wrapped__}return n.__wrapped__=t,e},fr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof gr){var e=t;return this.__actions__.length&&(e=new gr(this)),(e=e.reverse()).__actions__.push({func:js,args:[Ms],thisArg:o}),new pr(e,this.__chain__)}return this.thru(Ms)},fr.prototype.toJSON=fr.prototype.valueOf=fr.prototype.value=function(){return Fn(this.__wrapped__,this.__actions__)},fr.prototype.first=fr.prototype.head,Ve&&(fr.prototype[Ve]=function(){return this}),fr}();Re._=Ri,(n=function(){return Ri}.call(e,i,e,r))===o||(r.exports=n)}).call(this)}).call(this,i(3),i(5)(t))},function(t,e,i){"use strict";i.r(e);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function n(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var o=function(){return(o=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function s(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(o<3?n(s):o>3?n(e,i,s):n(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s}var a=i(0),h=function(){function t(e,i,r){void 0===i&&(i=t.UNITMODE_PIXEL),void 0===r&&(r=!0),this.unit=i,this.negativeValueAllowed=r,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=e,this._originalUnit=i}return Object.defineProperty(t.prototype,"isPercentage",{get:function(){return this.unit===t.UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPixel",{get:function(){return this.unit===t.UNITMODE_PIXEL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"internalValue",{get:function(){return this._value},enumerable:!0,configurable:!0}),t.prototype.getValueInPixel=function(t,e){return this.isPixel?this.getValue(t):this.getValue(t)*e},t.prototype.updateInPlace=function(e,i){return void 0===i&&(i=t.UNITMODE_PIXEL),this._value=e,this.unit=i,this},t.prototype.getValue=function(e){if(e&&!this.ignoreAdaptiveScaling&&this.unit!==t.UNITMODE_PERCENTAGE){var i=0,r=0;if(e.idealWidth&&(i=this._value*e.getSize().width/e.idealWidth),e.idealHeight&&(r=this._value*e.getSize().height/e.idealHeight),e.useSmallestIdeal&&e.idealWidth&&e.idealHeight)return window.innerWidth<window.innerHeight?i:r;if(e.idealWidth)return i;if(e.idealHeight)return r}return this._value},t.prototype.toString=function(e,i){switch(this.unit){case t.UNITMODE_PERCENTAGE:var r=100*this.getValue(e);return(i?r.toFixed(i):r)+"%";case t.UNITMODE_PIXEL:var n=this.getValue(e);return(i?n.toFixed(i):n)+"px"}return this.unit.toString()},t.prototype.fromString=function(e){var i=t._Regex.exec(e.toString());if(!i||0===i.length)return!1;var r=parseFloat(i[1]),n=this._originalUnit;if(this.negativeValueAllowed||r<0&&(r=0),4===i.length)switch(i[3]){case"px":n=t.UNITMODE_PIXEL;break;case"%":n=t.UNITMODE_PERCENTAGE,r/=100}return(r!==this._value||n!==this.unit)&&(this._value=r,this.unit=n,!0)},Object.defineProperty(t,"UNITMODE_PERCENTAGE",{get:function(){return t._UNITMODE_PERCENTAGE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UNITMODE_PIXEL",{get:function(){return t._UNITMODE_PIXEL},enumerable:!0,configurable:!0}),t._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,t._UNITMODE_PERCENTAGE=0,t._UNITMODE_PIXEL=1,t}(),u=[new a.Vector2(0,0),new a.Vector2(0,0),new a.Vector2(0,0),new a.Vector2(0,0)],l=[new a.Vector2(0,0),new a.Vector2(0,0),new a.Vector2(0,0),new a.Vector2(0,0)],c=new a.Vector2(0,0),f=new a.Vector2(0,0),_=function(){function t(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r}return t.prototype.copyFrom=function(t){this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height},t.prototype.copyFromFloats=function(t,e,i,r){this.left=t,this.top=e,this.width=i,this.height=r},t.CombineToRef=function(t,e,i){var r=Math.min(t.left,e.left),n=Math.min(t.top,e.top),o=Math.max(t.left+t.width,e.left+e.width),s=Math.max(t.top+t.height,e.top+e.height);i.left=r,i.top=n,i.width=o-r,i.height=s-n},t.prototype.transformToRef=function(t,e){u[0].copyFromFloats(this.left,this.top),u[1].copyFromFloats(this.left+this.width,this.top),u[2].copyFromFloats(this.left+this.width,this.top+this.height),u[3].copyFromFloats(this.left,this.top+this.height),c.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),f.copyFromFloats(0,0);for(var i=0;i<4;i++)t.transformCoordinates(u[i].x,u[i].y,l[i]),c.x=Math.floor(Math.min(c.x,l[i].x)),c.y=Math.floor(Math.min(c.y,l[i].y)),f.x=Math.ceil(Math.max(f.x,l[i].x)),f.y=Math.ceil(Math.max(f.y,l[i].y));e.left=c.x,e.top=c.y,e.width=f.x-c.x,e.height=f.y-c.y},t.prototype.isEqualsTo=function(t){return this.left===t.left&&(this.top===t.top&&(this.width===t.width&&this.height===t.height))},t.Empty=function(){return new t(0,0,0,0)},t}(),d=function(t){function e(e,i){void 0===i&&(i=0);var r=t.call(this,e.x,e.y)||this;return r.buttonIndex=i,r}return n(e,t),e}(a.Vector2),p=function(){function t(t,e,i,r,n,o){this.m=new Float32Array(6),this.fromValues(t,e,i,r,n,o)}return t.prototype.fromValues=function(t,e,i,r,n,o){return this.m[0]=t,this.m[1]=e,this.m[2]=i,this.m[3]=r,this.m[4]=n,this.m[5]=o,this},t.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},t.prototype.invertToRef=function(t){var e=this.m[0],i=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],s=this.m[5],h=this.determinant();if(h<a.Epsilon*a.Epsilon)return t.m[0]=0,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[5]=0,this;var u=1/h,l=r*s-n*o,c=i*o-e*s;return t.m[0]=n*u,t.m[1]=-i*u,t.m[2]=-r*u,t.m[3]=e*u,t.m[4]=l*u,t.m[5]=c*u,this},t.prototype.multiplyToRef=function(t,e){var i=this.m[0],r=this.m[1],n=this.m[2],o=this.m[3],s=this.m[4],a=this.m[5],h=t.m[0],u=t.m[1],l=t.m[2],c=t.m[3],f=t.m[4],_=t.m[5];return e.m[0]=i*h+r*l,e.m[1]=i*u+r*c,e.m[2]=n*h+o*l,e.m[3]=n*u+o*c,e.m[4]=s*h+a*l+f,e.m[5]=s*u+a*c+_,this},t.prototype.transformCoordinates=function(t,e,i){return i.x=t*this.m[0]+e*this.m[2]+this.m[4],i.y=t*this.m[1]+e*this.m[3]+this.m[5],this},t.Identity=function(){return new t(1,0,0,1,0,0)},t.TranslationToRef=function(t,e,i){i.fromValues(1,0,0,1,t,e)},t.ScalingToRef=function(t,e,i){i.fromValues(t,0,0,e,0,0)},t.RotationToRef=function(t,e){var i=Math.sin(t),r=Math.cos(t);e.fromValues(r,i,-i,r,0,0)},t.ComposeToRef=function(e,i,r,n,o,s,a){t.TranslationToRef(e,i,t._TempPreTranslationMatrix),t.ScalingToRef(n,o,t._TempScalingMatrix),t.RotationToRef(r,t._TempRotationMatrix),t.TranslationToRef(-e,-i,t._TempPostTranslationMatrix),t._TempPreTranslationMatrix.multiplyToRef(t._TempScalingMatrix,t._TempCompose0),t._TempCompose0.multiplyToRef(t._TempRotationMatrix,t._TempCompose1),s?(t._TempCompose1.multiplyToRef(t._TempPostTranslationMatrix,t._TempCompose2),t._TempCompose2.multiplyToRef(s,a)):t._TempCompose1.multiplyToRef(t._TempPostTranslationMatrix,a)},t._TempPreTranslationMatrix=t.Identity(),t._TempPostTranslationMatrix=t.Identity(),t._TempRotationMatrix=t.Identity(),t._TempScalingMatrix=t.Identity(),t._TempCompose0=t.Identity(),t._TempCompose1=t.Identity(),t._TempCompose2=t.Identity(),t}(),g=function(){function t(e){this.name=e,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=_.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new h(18,h.UNITMODE_PIXEL,!1),this._width=new h(1,h.UNITMODE_PERCENTAGE,!1),this._height=new h(1,h.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=t.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=t.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=_.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=_.Empty(),this._cachedParentMeasure=_.Empty(),this._paddingLeft=new h(0),this._paddingRight=new h(0),this._paddingTop=new h(0),this._paddingBottom=new h(0),this._left=new h(0),this._top=new h(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=p.Identity(),this._invertTransformMatrix=p.Identity(),this._transformedPosition=a.Vector2.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._fontSet=!1,this._dummyVector2=a.Vector2.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new h(0),this._linkOffsetY=new h(0),this.onPointerMoveObservable=new a.Observable,this.onPointerOutObservable=new a.Observable,this.onPointerDownObservable=new a.Observable,this.onPointerUpObservable=new a.Observable,this.onPointerClickObservable=new a.Observable,this.onPointerEnterObservable=new a.Observable,this.onDirtyObservable=new a.Observable,this.onBeforeDrawObservable=new a.Observable,this.onAfterDrawObservable=new a.Observable,this._tmpMeasureA=new _(0,0,0,0)}return Object.defineProperty(t.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(t){this._shadowOffsetX!==t&&(this._shadowOffsetX=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(t){this._shadowOffsetY!==t&&(this._shadowOffsetY=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(t){this._shadowBlur!==t&&(this._shadowBlur=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(t){this._shadowColor!==t&&(this._shadowColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(t){this._fontOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alphaSet=!0,this._alpha=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(t){this._isHighlighted!==t&&(this._isHighlighted=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(t){this._transformCenterY!==t&&(this._transformCenterY=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(t){this._transformCenterX!==t&&(this._transformCenterX=t,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(t){this._horizontalAlignment!==t&&(this._horizontalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(t){this._verticalAlignment!==t&&(this._verticalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.width=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(t){this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.height=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(t){var e=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=t,this._style&&(this._styleObserver=this._style.onChangedObservable.add((function(){e._markAsDirty(),e._resetFontCache()}))),this._markAsDirty(),this._resetFontCache()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSizeInPixels",{get:function(){var t=this._style?this._style._fontSize:this._fontSize;return t.isPixel?t.getValue(this._host):t.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.fontSize=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color!==t&&(this._color=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this.zIndex!==t&&(this._zIndex=t,this.parent&&this.parent._reOrderControl(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(t){this._doNotRender!==t&&(this._doNotRender=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},set:function(t){this._isVisible!==t&&(this._isVisible=t,this._markAsDirty(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(t){this._paddingLeft.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.paddingLeft=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(t){this._paddingRight.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.paddingRight=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(t){this._paddingTop.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.paddingTop=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(t){this._paddingBottom.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.paddingBottom=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(t){this._left.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.left=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(t){this._top.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.top=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(t){this._linkOffsetX.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(t){isNaN(t)||(this.linkOffsetX=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(t){this._linkOffsetY.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(t){isNaN(t)||(this.linkOffsetY=t+"px")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(t){this._isEnabled!==t&&(this._isEnabled=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype._getTypeName=function(){return"Control"},t.prototype.getAscendantOfClass=function(t){return this.parent?this.parent.getClassName()===t?this.parent:this.parent.getAscendantOfClass(t):null},t.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},t.prototype.isAscendant=function(t){return!!this.parent&&(this.parent===t||this.parent.isAscendant(t))},t.prototype.getLocalCoordinates=function(t){var e=a.Vector2.Zero();return this.getLocalCoordinatesToRef(t,e),e},t.prototype.getLocalCoordinatesToRef=function(t,e){return e.x=t.x-this._currentMeasure.left,e.y=t.y-this._currentMeasure.top,this},t.prototype.getParentLocalCoordinates=function(t){var e=a.Vector2.Zero();return e.x=t.x-this._cachedParentMeasure.left,e.y=t.y-this._cachedParentMeasure.top,e},t.prototype.moveToVector3=function(e,i){if(this._host&&this.parent===this._host._rootContainer){this.horizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=t.VERTICAL_ALIGNMENT_TOP;var r=this._host._getGlobalViewport(i),n=a.Vector3.Project(e,a.Matrix.Identity(),i.getTransformMatrix(),r);this._moveToProjectedPosition(n),n.z<0||n.z>1?this.notRenderable=!0:this.notRenderable=!1}else a.Tools.Error("Cannot move a control to a vector3 if the control is not at root level")},t.prototype.getDescendantsToRef=function(t,e,i){void 0===e&&(e=!1)},t.prototype.getDescendants=function(t,e){var i=new Array;return this.getDescendantsToRef(i,t,e),i},t.prototype.linkWithMesh=function(e){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)e&&a.Tools.Error("Cannot link a control to a mesh if the control is not at root level");else{var i=this._host._linkedControls.indexOf(this);if(-1!==i)return this._linkedMesh=e,void(e||this._host._linkedControls.splice(i,1));e&&(this.horizontalAlignment=t.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=t.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=e,this._host._linkedControls.push(this))}},t.prototype._moveToProjectedPosition=function(t){var e=this._left.getValue(this._host),i=this._top.getValue(this._host),r=t.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=t.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(r-e)<.5&&(r=e),Math.abs(n-i)<.5&&(n=i)),this.left=r+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},t.prototype._offsetLeft=function(t){this._isDirty=!0,this._currentMeasure.left+=t},t.prototype._offsetTop=function(t){this._isDirty=!0,this._currentMeasure.top+=t},t.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},t.prototype._flagDescendantsAsMatrixDirty=function(){},t.prototype._intersectsRect=function(t){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=t.left+t.width)&&(!(this._tmpMeasureA.top>=t.top+t.height)&&(!(this._tmpMeasureA.left+this._tmpMeasureA.width<=t.left)&&!(this._tmpMeasureA.top+this._tmpMeasureA.height<=t.top)))},t.prototype.invalidateRect=function(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization)if(this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),_.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var t=this.shadowOffsetX,e=this.shadowOffsetY,i=this.shadowBlur,r=Math.min(Math.min(t,0)-2*i,0),n=Math.max(Math.max(t,0)+2*i,0),o=Math.min(Math.min(e,0)-2*i,0),s=Math.max(Math.max(e,0)+2*i,0);this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+r),Math.floor(this._tmpMeasureA.top+o),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+n),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+s))}else this.host.invalidateRect(Math.floor(this._tmpMeasureA.left),Math.floor(this._tmpMeasureA.top),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height))},t.prototype._markAsDirty=function(t){void 0===t&&(t=!1),(this._isVisible||t)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},t.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},t.prototype._link=function(t){this._host=t,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},t.prototype._transform=function(t){if(this._isMatrixDirty||1!==this._scaleX||1!==this._scaleY||0!==this._rotation){var e=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;t&&(t.translate(e,i),t.rotate(this._rotation),t.scale(this._scaleX,this._scaleY),t.translate(-e,-i)),(this._isMatrixDirty||this._cachedOffsetX!==e||this._cachedOffsetY!==i)&&(this._cachedOffsetX=e,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),p.ComposeToRef(-e,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix))}},t.prototype._renderHighlight=function(t){this.isHighlighted&&(t.save(),t.strokeStyle="#4affff",t.lineWidth=2,this._renderHighlightSpecific(t),t.restore())},t.prototype._renderHighlightSpecific=function(t){t.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},t.prototype._applyStates=function(e){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(e.font=this._font),this._color&&(e.fillStyle=this._color),t.AllowAlphaInheritance?e.globalAlpha*=this._alpha:this._alphaSet&&(e.globalAlpha=this.parent?this.parent.alpha*this._alpha:this._alpha)},t.prototype._layout=function(e,i){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){t.numLayoutCalls++,this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace),i.save(),this._applyStates(i);var r=0;do{this._rebuildLayout=!1,this._processMeasures(e,i),r++}while(this._rebuildLayout&&r<3);r>=3&&a.Logger.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),i.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0},t.prototype._processMeasures=function(t,e){this._currentMeasure.copyFrom(t),this._preMeasure(t,e),this._measure(),this._computeAlignment(t,e),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(t,e),this._cachedParentMeasure.copyFrom(t),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},t.prototype._evaluateClippingState=function(t){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>t.left+t.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<t.left)return void(this._isClipped=!0);if(this._currentMeasure.top>t.top+t.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<t.top)return void(this._isClipped=!0)}this._isClipped=!1},t.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host)},t.prototype._computeAlignment=function(e,i){var r=this._currentMeasure.width,n=this._currentMeasure.height,o=e.width,s=e.height,a=0,h=0;switch(this.horizontalAlignment){case t.HORIZONTAL_ALIGNMENT_LEFT:a=0;break;case t.HORIZONTAL_ALIGNMENT_RIGHT:a=o-r;break;case t.HORIZONTAL_ALIGNMENT_CENTER:a=(o-r)/2}switch(this.verticalAlignment){case t.VERTICAL_ALIGNMENT_TOP:h=0;break;case t.VERTICAL_ALIGNMENT_BOTTOM:h=s-n;break;case t.VERTICAL_ALIGNMENT_CENTER:h=(s-n)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=o*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=o*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=o*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=s*this._paddingTop.getValue(this._host),this._currentMeasure.height-=s*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=s*this._paddingBottom.getValue(this._host),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=o*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=s*this._top.getValue(this._host),this._currentMeasure.left+=a,this._currentMeasure.top+=h},t.prototype._preMeasure=function(t,e){},t.prototype._additionalProcessing=function(t,e){},t.prototype._clipForChildren=function(t){},t.prototype._clip=function(e,i){if(e.beginPath(),t._ClipMeasure.copyFrom(this._currentMeasure),i){i.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);var r=new _(0,0,0,0);r.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),r.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),r.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-r.left,r.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-r.top,t._ClipMeasure.copyFrom(r)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var n=this.shadowOffsetX,o=this.shadowOffsetY,s=this.shadowBlur,a=Math.min(Math.min(n,0)-2*s,0),h=Math.max(Math.max(n,0)+2*s,0),u=Math.min(Math.min(o,0)-2*s,0),l=Math.max(Math.max(o,0)+2*s,0);e.rect(t._ClipMeasure.left+a,t._ClipMeasure.top+u,t._ClipMeasure.width+h-a,t._ClipMeasure.height+l-u)}else e.rect(t._ClipMeasure.left,t._ClipMeasure.top,t._ClipMeasure.width,t._ClipMeasure.height);e.clip()},t.prototype._render=function(e,i){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(t.numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,i),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,i),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)},t.prototype._draw=function(t,e){},t.prototype.contains=function(t,e){return this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y,!(t<this._currentMeasure.left)&&(!(t>this._currentMeasure.left+this._currentMeasure.width)&&(!(e<this._currentMeasure.top)&&(!(e>this._currentMeasure.top+this._currentMeasure.height)&&(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0))))},t.prototype._processPicking=function(t,e,i,r,n){return!!this._isEnabled&&(!(!this.isHitTestVisible||!this.isVisible||this._doNotRender)&&(!!this.contains(t,e)&&(this._processObservables(i,t,e,r,n),!0)))},t.prototype._onPointerMove=function(t,e,i){this.onPointerMoveObservable.notifyObservers(e,-1,t,this)&&null!=this.parent&&this.parent._onPointerMove(t,e,i)},t.prototype._onPointerEnter=function(t){return!!this._isEnabled&&(!(this._enterCount>0)&&(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,t,this)&&null!=this.parent&&this.parent._onPointerEnter(t),!0))},t.prototype._onPointerOut=function(t,e){if(void 0===e&&(e=!1),e||this._isEnabled&&t!==this){this._enterCount=0;var i=!0;t.isAscendant(this)||(i=this.onPointerOutObservable.notifyObservers(this,-1,t,this)),i&&null!=this.parent&&this.parent._onPointerOut(t,e)}},t.prototype._onPointerDown=function(t,e,i,r){return this._onPointerEnter(this),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new d(e,r),-1,t,this)&&null!=this.parent&&this.parent._onPointerDown(t,e,i,r),!0)},t.prototype._onPointerUp=function(t,e,i,r,n){if(this._isEnabled){this._downCount=0,delete this._downPointerIds[i];var o=n;n&&(this._enterCount>0||-1===this._enterCount)&&(o=this.onPointerClickObservable.notifyObservers(new d(e,r),-1,t,this)),this.onPointerUpObservable.notifyObservers(new d(e,r),-1,t,this)&&null!=this.parent&&this.parent._onPointerUp(t,e,i,r,o)}},t.prototype._forcePointerUp=function(t){if(void 0===t&&(t=null),null!==t)this._onPointerUp(this,a.Vector2.Zero(),t,0,!0);else for(var e in this._downPointerIds)this._onPointerUp(this,a.Vector2.Zero(),+e,0,!0)},t.prototype._processObservables=function(t,e,i,r,n){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(e,i),t===a.PointerEventTypes.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,r);var o=this._host._lastControlOver[r];return o&&o!==this&&o._onPointerOut(this),o!==this&&this._onPointerEnter(this),this._host._lastControlOver[r]=this,!0}return t===a.PointerEventTypes.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,r,n),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0):t===a.PointerEventTypes.POINTERUP&&(this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,n,!0),delete this._host._lastControlDown[r],!0)},t.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=t._GetFontOffset(this._font))},t.prototype.dispose=function(){(this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host)&&(this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null))},Object.defineProperty(t,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return t._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return t._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!0,configurable:!0}),Object.defineProperty(t,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return t._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VERTICAL_ALIGNMENT_TOP",{get:function(){return t._VERTICAL_ALIGNMENT_TOP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return t._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!0,configurable:!0}),Object.defineProperty(t,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return t._VERTICAL_ALIGNMENT_CENTER},enumerable:!0,configurable:!0}),t._GetFontOffset=function(e){if(t._FontHeightSizes[e])return t._FontHeightSizes[e];var i=document.createElement("span");i.innerHTML="Hg",i.style.font=e;var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";var n=document.createElement("div");n.appendChild(i),n.appendChild(r),document.body.appendChild(n);var o=0,s=0;try{s=r.getBoundingClientRect().top-i.getBoundingClientRect().top,r.style.verticalAlign="baseline",o=r.getBoundingClientRect().top-i.getBoundingClientRect().top}finally{document.body.removeChild(n)}var a={ascent:o,height:s,descent:s-o};return t._FontHeightSizes[e]=a,a},t.drawEllipse=function(t,e,i,r,n){n.translate(t,e),n.scale(i,r),n.beginPath(),n.arc(0,0,1,0,2*Math.PI),n.closePath(),n.scale(1/i,1/r),n.translate(-t,-e)},t.AllowAlphaInheritance=!1,t.numLayoutCalls=0,t.numRenderCalls=0,t._ClipMeasure=new _(0,0,0,0),t._HORIZONTAL_ALIGNMENT_LEFT=0,t._HORIZONTAL_ALIGNMENT_RIGHT=1,t._HORIZONTAL_ALIGNMENT_CENTER=2,t._VERTICAL_ALIGNMENT_TOP=0,t._VERTICAL_ALIGNMENT_BOTTOM=1,t._VERTICAL_ALIGNMENT_CENTER=2,t._FontHeightSizes={},t.AddHeader=function(){},t}();a._TypeStore.RegisteredTypes["BABYLON.GUI.Control"]=g;var m=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._children=new Array,i._measureForChildren=_.Empty(),i._background="",i._adaptWidthToChildren=!1,i._adaptHeightToChildren=!1,i.logLayoutCycleErrors=!1,i.maxLayoutCycle=3,i}return n(e,t),Object.defineProperty(e.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(t){this._adaptHeightToChildren!==t&&(this._adaptHeightToChildren=t,t&&(this.height="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(t){this._adaptWidthToChildren!==t&&(this._adaptWidthToChildren=t,t&&(this.width="100%"),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Container"},e.prototype._flagDescendantsAsMatrixDirty=function(){for(var t=0,e=this.children;t<e.length;t++){e[t]._markMatrixAsDirty()}},e.prototype.getChildByName=function(t){for(var e=0,i=this.children;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},e.prototype.getChildByType=function(t,e){for(var i=0,r=this.children;i<r.length;i++){var n=r[i];if(n.typeName===e)return n}return null},e.prototype.containsControl=function(t){return-1!==this.children.indexOf(t)},e.prototype.addControl=function(t){return t?-1!==this._children.indexOf(t)?this:(t._link(this._host),t._markAllAsDirty(),this._reOrderControl(t),this._markAsDirty(),this):this},e.prototype.clearControls=function(){for(var t=0,e=this.children.slice();t<e.length;t++){var i=e[t];this.removeControl(i)}return this},e.prototype.removeControl=function(t){var e=this._children.indexOf(t);return-1!==e&&(this._children.splice(e,1),t.parent=null),t.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(t),this._markAsDirty(),this},e.prototype._reOrderControl=function(t){this.removeControl(t);for(var e=!1,i=0;i<this._children.length;i++)if(this._children[i].zIndex>t.zIndex){this._children.splice(i,0,t),e=!0;break}e||this._children.push(t),t.parent=this,this._markAsDirty()},e.prototype._offsetLeft=function(e){t.prototype._offsetLeft.call(this,e);for(var i=0,r=this._children;i<r.length;i++){r[i]._offsetLeft(e)}},e.prototype._offsetTop=function(e){t.prototype._offsetTop.call(this,e);for(var i=0,r=this._children;i<r.length;i++){r[i]._offsetTop(e)}},e.prototype._markAllAsDirty=function(){t.prototype._markAllAsDirty.call(this);for(var e=0;e<this._children.length;e++)this._children[e]._markAllAsDirty()},e.prototype._localDraw=function(t){this._background&&(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.restore())},e.prototype._link=function(e){t.prototype._link.call(this,e);for(var i=0,r=this._children;i<r.length;i++){r[i]._link(e)}},e.prototype._beforeLayout=function(){},e.prototype._processMeasures=function(e,i){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(e)||(t.prototype._processMeasures.call(this,e,i),this._evaluateClippingState(e))},e.prototype._layout=function(t,e){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;g.numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var i=0;e.save(),this._applyStates(e),this._beforeLayout();do{var r=-1,n=-1;if(this._rebuildLayout=!1,this._processMeasures(t,e),!this._isClipped){for(var o=0,s=this._children;o<s.length;o++){var h=s[o];h._tempParentMeasure.copyFrom(this._measureForChildren),h._layout(this._measureForChildren,e)&&(this.adaptWidthToChildren&&h._width.isPixel&&(r=Math.max(r,h._currentMeasure.width)),this.adaptHeightToChildren&&h._height.isPixel&&(n=Math.max(n,h._currentMeasure.height)))}this.adaptWidthToChildren&&r>=0&&this.width!==r+"px"&&(this.width=r+"px",this._rebuildLayout=!0),this.adaptHeightToChildren&&n>=0&&this.height!==n+"px"&&(this.height=n+"px",this._rebuildLayout=!0),this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return i>=3&&this.logLayoutCycleErrors&&a.Logger.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),e.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},e.prototype._postMeasure=function(){},e.prototype._draw=function(t,e){this._localDraw(t),this.clipChildren&&this._clipForChildren(t);for(var i=0,r=this._children;i<r.length;i++){var n=r[i];e&&!n._intersectsRect(e)||n._render(t,e)}},e.prototype.getDescendantsToRef=function(t,e,i){if(void 0===e&&(e=!1),this.children)for(var r=0;r<this.children.length;r++){var n=this.children[r];i&&!i(n)||t.push(n),e||n.getDescendantsToRef(t,!1,i)}},e.prototype._processPicking=function(e,i,r,n,o){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!t.prototype.contains.call(this,e,i))return!1;for(var s=this._children.length-1;s>=0;s--){var a=this._children[s];if(a._processPicking(e,i,r,n,o))return a.hoverCursor&&this._host._changeCursor(a.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(r,e,i,n,o)},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.copyFrom(this._currentMeasure)},e.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=this.children.length-1;e>=0;e--)this.children[e].dispose()},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.Container"]=m;var b,y=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._thickness=1,i._cornerRadius=0,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cornerRadius",{get:function(){return this._cornerRadius},set:function(t){t<0&&(t=0),this._cornerRadius!==t&&(this._cornerRadius=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Rectangle"},e.prototype._localDraw=function(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._background&&(t.fillStyle=this._background,this._cornerRadius?(this._drawRoundedRect(t,this._thickness/2),t.fill()):t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(t,this._thickness/2),t.stroke()):t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},e.prototype._drawRoundedRect=function(t,e){void 0===e&&(e=0);var i=this._currentMeasure.left+e,r=this._currentMeasure.top+e,n=this._currentMeasure.width-2*e,o=this._currentMeasure.height-2*e,s=Math.min(o/2-2,Math.min(n/2-2,this._cornerRadius));t.beginPath(),t.moveTo(i+s,r),t.lineTo(i+n-s,r),t.quadraticCurveTo(i+n,r,i+n,r+s),t.lineTo(i+n,r+o-s),t.quadraticCurveTo(i+n,r+o,i+n-s,r+o),t.lineTo(i+s,r+o),t.quadraticCurveTo(i,r+o,i,r+o-s),t.lineTo(i,r+s),t.quadraticCurveTo(i,r,i+s,r),t.closePath()},e.prototype._clipForChildren=function(t){this._cornerRadius&&(this._drawRoundedRect(t,this._thickness),t.clip())},e}(m);a._TypeStore.RegisteredTypes["BABYLON.GUI.Rectangle"]=y,function(t){t[t.Clip=0]="Clip",t[t.WordWrap=1]="WordWrap",t[t.Ellipsis=2]="Ellipsis"}(b||(b={}));var v=function(t){function e(e,i){void 0===i&&(i="");var r=t.call(this,e)||this;return r.name=e,r._text="",r._textWrapping=b.Clip,r._textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_CENTER,r._textVerticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,r._resizeToFit=!1,r._lineSpacing=new h(0),r._outlineWidth=0,r._outlineColor="white",r.onTextChangedObservable=new a.Observable,r.onLinesReadyObservable=new a.Observable,r.text=i,r}return n(e,t),Object.defineProperty(e.prototype,"lines",{get:function(){return this._lines},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(t){this._resizeToFit!==t&&(this._resizeToFit=t,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(t){this._textWrapping!==t&&(this._textWrapping=+t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(t){this._textHorizontalAlignment!==t&&(this._textHorizontalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(t){this._textVerticalAlignment!==t&&(this._textVerticalAlignment=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(t){this._lineSpacing.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this._outlineColor!==t&&(this._outlineColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"TextBlock"},e.prototype._processMeasures=function(e,i){this._fontOffset||(this._fontOffset=g._GetFontOffset(i.font)),t.prototype._processMeasures.call(this,e,i),this._lines=this._breakLines(this._currentMeasure.width,i),this.onLinesReadyObservable.notifyObservers(this);for(var r=0,n=0;n<this._lines.length;n++){var o=this._lines[n];o.width>r&&(r=o.width)}if(this._resizeToFit){if(this._textWrapping===b.Clip){var s=this.paddingLeftInPixels+this.paddingRightInPixels+r;s!==this._width.internalValue&&(this._width.updateInPlace(s,h.UNITMODE_PIXEL),this._rebuildLayout=!0)}var a=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){var u=0;u=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),a+=(this._lines.length-1)*u}a!==this._height.internalValue&&(this._height.updateInPlace(a,h.UNITMODE_PIXEL),this._rebuildLayout=!0)}},e.prototype._drawText=function(t,e,i,r){var n=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case g.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case g.HORIZONTAL_ALIGNMENT_RIGHT:o=n-e;break;case g.HORIZONTAL_ALIGNMENT_CENTER:o=(n-e)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&r.strokeText(t,this._currentMeasure.left+o,i),r.fillText(t,this._currentMeasure.left+o,i)},e.prototype._draw=function(t,e){t.save(),this._applyStates(t),this._renderLines(t),t.restore()},e.prototype._applyStates=function(e){t.prototype._applyStates.call(this,e),this.outlineWidth&&(e.lineWidth=this.outlineWidth,e.strokeStyle=this.outlineColor)},e.prototype._breakLines=function(t,e){var i=[],r=this.text.split("\n");if(this._textWrapping===b.Ellipsis)for(var n=0,o=r;n<o.length;n++){var s=o[n];i.push(this._parseLineEllipsis(s,t,e))}else if(this._textWrapping===b.WordWrap)for(var a=0,h=r;a<h.length;a++){s=h[a];i.push.apply(i,this._parseLineWordWrap(s,t,e))}else for(var u=0,l=r;u<l.length;u++){s=l[u];i.push(this._parseLine(s,e))}return i},e.prototype._parseLine=function(t,e){return void 0===t&&(t=""),{text:t,width:e.measureText(t).width}},e.prototype._parseLineEllipsis=function(t,e,i){void 0===t&&(t="");var r=i.measureText(t).width;for(r>e&&(t+="…");t.length>2&&r>e;)t=t.slice(0,-2)+"…",r=i.measureText(t).width;return{text:t,width:r}},e.prototype._parseLineWordWrap=function(t,e,i){void 0===t&&(t="");for(var r=[],n=t.split(" "),o=0,s=0;s<n.length;s++){var a=s>0?t+" "+n[s]:n[0],h=i.measureText(a).width;h>e&&s>0?(r.push({text:t,width:o}),t=n[s],o=i.measureText(t).width):(o=h,t=a)}return r.push({text:t,width:o}),r},e.prototype._renderLines=function(t){var e=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case g.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case g.VERTICAL_ALIGNMENT_BOTTOM:i=e-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case g.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(e-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(var r=0;r<this._lines.length;r++){var n=this._lines[r];0!==r&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(n.text,n.width,i,t),i+=this._fontOffset.height}},e.prototype.computeExpectedHeight=function(){if(this.text&&this.widthInPixels){var t=document.createElement("canvas").getContext("2d");if(t){this._applyStates(t),this._fontOffset||(this._fontOffset=g._GetFontOffset(t.font));var e=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,t),i=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*e.length;if(e.length>0&&0!==this._lineSpacing.internalValue){var r=0;r=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),i+=(e.length-1)*r}return i}}return 0},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.onTextChangedObservable.clear()},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.TextBlock"]=v;var O=function(t){function e(i,r){void 0===r&&(r=null);var n=t.call(this,i)||this;return n.name=i,n._workingCanvas=null,n._loaded=!1,n._stretch=e.STRETCH_FILL,n._autoScale=!1,n._sourceLeft=0,n._sourceTop=0,n._sourceWidth=0,n._sourceHeight=0,n._cellWidth=0,n._cellHeight=0,n._cellId=-1,n._populateNinePatchSlicesFromImage=!1,n.onImageLoadedObservable=new a.Observable,n.onSVGAttributesComputedObservable=new a.Observable,n.source=r,n}return n(e,t),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"populateNinePatchSlicesFromImage",{get:function(){return this._populateNinePatchSlicesFromImage},set:function(t){this._populateNinePatchSlicesFromImage!==t&&(this._populateNinePatchSlicesFromImage=t,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"detectPointerOnOpaqueOnly",{get:function(){return this._detectPointerOnOpaqueOnly},set:function(t){this._detectPointerOnOpaqueOnly!==t&&(this._detectPointerOnOpaqueOnly=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceLeft",{get:function(){return this._sliceLeft},set:function(t){this._sliceLeft!==t&&(this._sliceLeft=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceRight",{get:function(){return this._sliceRight},set:function(t){this._sliceRight!==t&&(this._sliceRight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceTop",{get:function(){return this._sliceTop},set:function(t){this._sliceTop!==t&&(this._sliceTop=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sliceBottom",{get:function(){return this._sliceBottom},set:function(t){this._sliceBottom!==t&&(this._sliceBottom=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceLeft",{get:function(){return this._sourceLeft},set:function(t){this._sourceLeft!==t&&(this._sourceLeft=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceTop",{get:function(){return this._sourceTop},set:function(t){this._sourceTop!==t&&(this._sourceTop=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceWidth",{get:function(){return this._sourceWidth},set:function(t){this._sourceWidth!==t&&(this._sourceWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceHeight",{get:function(){return this._sourceHeight},set:function(t){this._sourceHeight!==t&&(this._sourceHeight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoScale",{get:function(){return this._autoScale},set:function(t){this._autoScale!==t&&(this._autoScale=t,t&&this._loaded&&this.synchronizeSizeWithContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stretch",{get:function(){return this._stretch},set:function(t){this._stretch!==t&&(this._stretch=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._rotate90=function(t){var i=document.createElement("canvas"),r=i.getContext("2d"),n=this._domImage.width,o=this._domImage.height;i.width=o,i.height=n,r.translate(i.width/2,i.height/2),r.rotate(t*Math.PI/2),r.drawImage(this._domImage,0,0,n,o,-n/2,-o/2,n,o);var s=i.toDataURL("image/jpg");return new e(this.name+"rotated",s)},Object.defineProperty(e.prototype,"domImage",{get:function(){return this._domImage},set:function(t){var e=this;this._domImage=t,this._loaded=!1,this._domImage.width?this._onImageLoaded():this._domImage.onload=function(){e._onImageLoaded()}},enumerable:!0,configurable:!0}),e.prototype._onImageLoaded=function(){this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()},e.prototype._extractNinePatchSliceDataFromImage=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"));var t=this._workingCanvas,e=t.getContext("2d"),i=this._domImage.width,r=this._domImage.height;t.width=i,t.height=r,e.drawImage(this._domImage,0,0,i,r);var n=e.getImageData(0,0,i,r);this._sliceLeft=-1,this._sliceRight=-1;for(var o=0;o<i;o++){if((a=n.data[4*o+3])>127&&-1===this._sliceLeft)this._sliceLeft=o;else if(a<127&&this._sliceLeft>-1){this._sliceRight=o;break}}this._sliceTop=-1,this._sliceBottom=-1;for(var s=0;s<r;s++){var a;if((a=n.data[s*i*4+3])>127&&-1===this._sliceTop)this._sliceTop=s;else if(a<127&&this._sliceTop>-1){this._sliceBottom=s;break}}},Object.defineProperty(e.prototype,"source",{set:function(t){var e=this;this._source!==t&&(this._loaded=!1,this._source=t,t&&(t=this._svgCheck(t)),this._domImage=document.createElement("img"),this._domImage.onload=function(){e._onImageLoaded()},t&&(a.Tools.SetCorsBehavior(t,this._domImage),this._domImage.src=t))},enumerable:!0,configurable:!0}),e.prototype._svgCheck=function(t){var e=this;if(window.SVGSVGElement&&-1!==t.search(/.svg#/gi)&&t.indexOf("#")===t.lastIndexOf("#")){var i=t.split("#")[0],r=t.split("#")[1],n=document.body.querySelector('object[data="'+i+'"]');if(n){var o=n.contentDocument;if(o&&o.documentElement){var s=o.documentElement.getAttribute("viewBox"),a=Number(o.documentElement.getAttribute("width")),h=Number(o.documentElement.getAttribute("height"));if(s&&a&&h)return this._getSVGAttribs(n,r),t}n.addEventListener("load",(function(){e._getSVGAttribs(n,r)}))}else{var u=document.createElement("object");u.data=i,u.type="image/svg+xml",u.width="0%",u.height="0%",document.body.appendChild(u),u.onload=function(){var t=document.body.querySelector('object[data="'+i+'"]');t&&e._getSVGAttribs(t,r)}}return i}return t},e.prototype._getSVGAttribs=function(t,e){var i=t.contentDocument;if(i&&i.documentElement){var r=i.documentElement.getAttribute("viewBox"),n=Number(i.documentElement.getAttribute("width")),o=Number(i.documentElement.getAttribute("height")),s=i.getElementById(e);if(r&&n&&o){var a=Number(r.split(" ")[2]),h=Number(r.split(" ")[3]),u=s.getBBox(),l=1,c=1,f=0,_=0;s.transform&&s.transform.baseVal.consolidate()&&(l=s.transform.baseVal.consolidate().matrix.a,c=s.transform.baseVal.consolidate().matrix.d,f=s.transform.baseVal.consolidate().matrix.e,_=s.transform.baseVal.consolidate().matrix.f),this.sourceLeft=(l*u.x+f)*n/a,this.sourceTop=(c*u.y+_)*o/h,this.sourceWidth=u.width*l*(n/a),this.sourceHeight=u.height*c*(o/h),this.onSVGAttributesComputedObservable.notifyObservers(this)}}},Object.defineProperty(e.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(t){this._cellWidth!==t&&(this._cellWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(t){this._cellHeight!==t&&(this._cellHeight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellId",{get:function(){return this._cellId},set:function(t){this._cellId!==t&&(this._cellId=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype.contains=function(e,i){if(!t.prototype.contains.call(this,e,i))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;var r=this._workingCanvas.getContext("2d"),n=0|this._currentMeasure.width,o=0|this._currentMeasure.height;return r.getImageData(0,0,n,o).data[4*((e=e-this._currentMeasure.left|0)+(i=i-this._currentMeasure.top|0)*this._currentMeasure.width)+3]>0},e.prototype._getTypeName=function(){return"Image"},e.prototype.synchronizeSizeWithContent=function(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")},e.prototype._processMeasures=function(i,r){if(this._loaded)switch(this._stretch){case e.STRETCH_NONE:case e.STRETCH_FILL:case e.STRETCH_UNIFORM:case e.STRETCH_NINE_PATCH:break;case e.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}t.prototype._processMeasures.call(this,i,r)},e.prototype._prepareWorkingCanvasForOpaqueDetection=function(){if(this._detectPointerOnOpaqueOnly){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"));var t=this._workingCanvas,e=this._currentMeasure.width,i=this._currentMeasure.height,r=t.getContext("2d");t.width=e,t.height=i,r.clearRect(0,0,e,i)}},e.prototype._drawImage=function(t,e,i,r,n,o,s,a,h){(t.drawImage(this._domImage,e,i,r,n,o,s,a,h),this._detectPointerOnOpaqueOnly)&&(t=this._workingCanvas.getContext("2d")).drawImage(this._domImage,e,i,r,n,o-this._currentMeasure.left,s-this._currentMeasure.top,a,h)},e.prototype._draw=function(t){var i,r,n,o;if(t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)i=this._sourceLeft,r=this._sourceTop,n=this._sourceWidth?this._sourceWidth:this._imageWidth,o=this._sourceHeight?this._sourceHeight:this._imageHeight;else{var s=this._domImage.naturalWidth/this.cellWidth,a=this.cellId/s>>0,h=this.cellId%s;i=this.cellWidth*h,r=this.cellHeight*a,n=this.cellWidth,o=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(t),this._loaded)switch(this._stretch){case e.STRETCH_NONE:case e.STRETCH_FILL:this._drawImage(t,i,r,n,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case e.STRETCH_UNIFORM:var u=this._currentMeasure.width/n,l=this._currentMeasure.height/o,c=Math.min(u,l),f=(this._currentMeasure.width-n*c)/2,_=(this._currentMeasure.height-o*c)/2;this._drawImage(t,i,r,n,o,this._currentMeasure.left+f,this._currentMeasure.top+_,n*c,o*c);break;case e.STRETCH_EXTEND:this._drawImage(t,i,r,n,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case e.STRETCH_NINE_PATCH:this._renderNinePatch(t)}t.restore()},e.prototype._renderCornerPatch=function(t,e,i,r,n,o,s){this._drawImage(t,e,i,r,n,this._currentMeasure.left+o,this._currentMeasure.top+s,r,n)},e.prototype._renderNinePatch=function(t){var e=this._imageHeight,i=this._sliceLeft,r=this._sliceTop,n=this._imageHeight-this._sliceBottom,o=this._imageWidth-this._sliceRight,s=0,a=0;this._populateNinePatchSlicesFromImage&&(s=1,a=1,e-=2,i-=1,r-=1,n-=1,o-=1);var h=this._sliceRight-this._sliceLeft+1,u=this._currentMeasure.width-o-this.sliceLeft+1,l=this._currentMeasure.height-e+this._sliceBottom;this._renderCornerPatch(t,s,a,i,r,0,0),this._renderCornerPatch(t,s,this._sliceBottom,i,e-this._sliceBottom,0,l),this._renderCornerPatch(t,this._sliceRight,a,o,r,this._currentMeasure.width-o,0),this._renderCornerPatch(t,this._sliceRight,this._sliceBottom,o,e-this._sliceBottom,this._currentMeasure.width-o,l),this._drawImage(t,this._sliceLeft,this._sliceTop,h,this._sliceBottom-this._sliceTop+1,this._currentMeasure.left+i,this._currentMeasure.top+r,u,l-r+1),this._drawImage(t,s,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left,this._currentMeasure.top+r,i,l-r),this._drawImage(t,this._sliceRight,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left+this._currentMeasure.width-o,this._currentMeasure.top+r,i,l-r),this._drawImage(t,this._sliceLeft,a,h,r,this._currentMeasure.left+i,this._currentMeasure.top,u,r),this._drawImage(t,this._sliceLeft,this._sliceBottom,h,n,this._currentMeasure.left+i,this._currentMeasure.top+l,u,n)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear()},e.STRETCH_NONE=0,e.STRETCH_FILL=1,e.STRETCH_UNIFORM=2,e.STRETCH_EXTEND=3,e.STRETCH_NINE_PATCH=4,e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.Image"]=O;var w=function(t){function e(e){var i=t.call(this,e)||this;i.name=e,i.delegatePickingToChildren=!1,i.thickness=1,i.isPointerBlocker=!0;var r=null;return i.pointerEnterAnimation=function(){r=i.alpha,i.alpha-=.1},i.pointerOutAnimation=function(){null!==r&&(i.alpha=r)},i.pointerDownAnimation=function(){i.scaleX-=.05,i.scaleY-=.05},i.pointerUpAnimation=function(){i.scaleX+=.05,i.scaleY+=.05},i}return n(e,t),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Button"},e.prototype._processPicking=function(e,i,r,n,o){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!t.prototype.contains.call(this,e,i))return!1;if(this.delegatePickingToChildren){for(var s=!1,a=this._children.length-1;a>=0;a--){var h=this._children[a];if(h.isEnabled&&h.isHitTestVisible&&h.isVisible&&!h.notRenderable&&h.contains(e,i)){s=!0;break}}if(!s)return!1}return this._processObservables(r,e,i,n,o),!0},e.prototype._onPointerEnter=function(e){return!!t.prototype._onPointerEnter.call(this,e)&&(this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},e.prototype._onPointerOut=function(e,i){void 0===i&&(i=!1),this.pointerOutAnimation&&this.pointerOutAnimation(),t.prototype._onPointerOut.call(this,e,i)},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},e.prototype._onPointerUp=function(e,i,r,n,o){this.pointerUpAnimation&&this.pointerUpAnimation(),t.prototype._onPointerUp.call(this,e,i,r,n,o)},e.CreateImageButton=function(t,i,r){var n=new e(t),o=new v(t+"_button",i);o.textWrapping=!0,o.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_CENTER,o.paddingLeft="20%",n.addControl(o);var s=new O(t+"_icon",r);return s.width="20%",s.stretch=O.STRETCH_UNIFORM,s.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,n.addControl(s),n._image=s,n._textBlock=o,n},e.CreateImageOnlyButton=function(t,i){var r=new e(t),n=new O(t+"_icon",i);return n.stretch=O.STRETCH_FILL,n.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(n),r._image=n,r},e.CreateSimpleButton=function(t,i){var r=new e(t),n=new v(t+"_button",i);return n.textWrapping=!0,n.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_CENTER,r.addControl(n),r._textBlock=n,r},e.CreateImageWithCenterTextButton=function(t,i,r){var n=new e(t),o=new O(t+"_icon",r);o.stretch=O.STRETCH_FILL,n.addControl(o);var s=new v(t+"_button",i);return s.textWrapping=!0,s.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_CENTER,n.addControl(s),n._image=o,n._textBlock=s,n},e}(y);a._TypeStore.RegisteredTypes["BABYLON.GUI.Button"]=w;var C=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._isVertical=!0,i._manualWidth=!1,i._manualHeight=!1,i._doNotTrackManualChanges=!1,i.ignoreLayoutWarnings=!1,i}return n(e,t),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==t&&this._width.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(t){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==t&&this._height.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"StackPanel"},e.prototype._preMeasure=function(e,i){for(var r=0,n=this._children;r<n.length;r++){var o=n[r];this._isVertical?o.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP:o.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT}t.prototype._preMeasure.call(this,e,i)},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.copyFrom(e),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)},e.prototype._postMeasure=function(){for(var e=0,i=0,r=0,n=this._children;r<n.length;r++){var o=n[r];o.isVisible&&!o.notRenderable&&(this._isVertical?(o.top!==i+"px"&&(o.top=i+"px",this._rebuildLayout=!0,o._top.ignoreAdaptiveScaling=!0),o._height.isPercentage&&!o._automaticSize?this.ignoreLayoutWarnings||a.Tools.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using height in percentage mode inside a vertical StackPanel"):i+=o._currentMeasure.height+o.paddingTopInPixels+o.paddingBottomInPixels):(o.left!==e+"px"&&(o.left=e+"px",this._rebuildLayout=!0,o._left.ignoreAdaptiveScaling=!0),o._width.isPercentage&&!o._automaticSize?this.ignoreLayoutWarnings||a.Tools.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using width in percentage mode inside a horizontal StackPanel"):e+=o._currentMeasure.width+o.paddingLeftInPixels+o.paddingRightInPixels))}this._doNotTrackManualChanges=!0;var s=!1,h=!1;if(!this._manualHeight&&this._isVertical){var u=this.height;this.height=i+"px",h=u!==this.height||!this._height.ignoreAdaptiveScaling}if(!this._manualWidth&&!this._isVertical){var l=this.width;this.width=e+"px",s=l!==this.width||!this._width.ignoreAdaptiveScaling}h&&(this._height.ignoreAdaptiveScaling=!0),s&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(s||h)&&(this._rebuildLayout=!0),t.prototype._postMeasure.call(this)},e}(m);a._TypeStore.RegisteredTypes["BABYLON.GUI.StackPanel"]=C;var x=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.onIsCheckedChangedObservable=new a.Observable,i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChecked",{get:function(){return this._isChecked},set:function(t){this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t))},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Checkbox"},e.prototype._draw=function(t,e){t.save(),this._applyStates(t);var i=this._currentMeasure.width-this._thickness,r=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._isChecked){t.fillStyle=this._isEnabled?this.color:this._disabledColor;var n=i*this._checkSizeRatio,o=r*this._checkSizeRatio;t.fillRect(this._currentMeasure.left+this._thickness/2+(i-n)/2,this._currentMeasure.top+this._thickness/2+(r-o)/2,n,o)}t.strokeStyle=this.color,t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,r),t.restore()},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this.isChecked=!this.isChecked,!0)},e.AddCheckBoxWithHeader=function(t,i){var r=new C;r.isVertical=!1,r.height="30px";var n=new e;n.width="20px",n.height="20px",n.isChecked=!0,n.color="green",n.onIsCheckedChangedObservable.add(i),r.addControl(n);var o=new v;return o.text=t,o.width="180px",o.paddingLeft="5px",o.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,o.color="white",r.addControl(o),r},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.Checkbox"]=x;var T=function(t){function e(e,i){void 0===i&&(i="");var r=t.call(this,e)||this;return r.name=e,r._text="",r._placeholderText="",r._background="#222222",r._focusedBackground="#000000",r._focusedColor="white",r._placeholderColor="gray",r._thickness=1,r._margin=new h(10,h.UNITMODE_PIXEL),r._autoStretchWidth=!0,r._maxWidth=new h(1,h.UNITMODE_PERCENTAGE,!1),r._isFocused=!1,r._blinkIsEven=!1,r._cursorOffset=0,r._deadKey=!1,r._addKey=!0,r._currentKey="",r._isTextHighlightOn=!1,r._textHighlightColor="#d5e0ff",r._highligherOpacity=.4,r._highlightedText="",r._startHighlightIndex=0,r._endHighlightIndex=0,r._cursorIndex=-1,r._onFocusSelectAll=!1,r._isPointerDown=!1,r.promptMessage="Please enter text:",r.disableMobilePrompt=!1,r.onTextChangedObservable=new a.Observable,r.onBeforeKeyAddObservable=new a.Observable,r.onFocusObservable=new a.Observable,r.onBlurObservable=new a.Observable,r.onTextHighlightObservable=new a.Observable,r.onTextCopyObservable=new a.Observable,r.onTextCutObservable=new a.Observable,r.onTextPasteObservable=new a.Observable,r.onKeyboardEventProcessedObservable=new a.Observable,r.text=i,r.isPointerBlocker=!0,r}return n(e,t),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth.toString(this._host)},set:function(t){this._maxWidth.toString(this._host)!==t&&this._maxWidth.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxWidthInPixels",{get:function(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highligherOpacity",{get:function(){return this._highligherOpacity},set:function(t){this._highligherOpacity!==t&&(this._highligherOpacity=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onFocusSelectAll",{get:function(){return this._onFocusSelectAll},set:function(t){this._onFocusSelectAll!==t&&(this._onFocusSelectAll=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textHighlightColor",{get:function(){return this._textHighlightColor},set:function(t){this._textHighlightColor!==t&&(this._textHighlightColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"margin",{get:function(){return this._margin.toString(this._host)},set:function(t){this._margin.toString(this._host)!==t&&this._margin.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"marginInPixels",{get:function(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"autoStretchWidth",{get:function(){return this._autoStretchWidth},set:function(t){this._autoStretchWidth!==t&&(this._autoStretchWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focusedBackground",{get:function(){return this._focusedBackground},set:function(t){this._focusedBackground!==t&&(this._focusedBackground=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"focusedColor",{get:function(){return this._focusedColor},set:function(t){this._focusedColor!==t&&(this._focusedColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholderColor",{get:function(){return this._placeholderColor},set:function(t){this._placeholderColor!==t&&(this._placeholderColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholderText",{get:function(){return this._placeholderText},set:function(t){this._placeholderText!==t&&(this._placeholderText=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"deadKey",{get:function(){return this._deadKey},set:function(t){this._deadKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightedText",{get:function(){return this._highlightedText},set:function(t){this._highlightedText!==t&&(this._highlightedText=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"addKey",{get:function(){return this._addKey},set:function(t){this._addKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentKey",{get:function(){return this._currentKey},set:function(t){this._currentKey=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){var e=t.toString();this._text!==e&&(this._text=e,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._width.toString(this._host)!==t&&(this._width.fromString(t)&&this._markAsDirty(),this.autoStretchWidth=!1)},enumerable:!0,configurable:!0}),e.prototype.onBlur=function(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);var t=this._host.getScene();this._onPointerDblTapObserver&&t&&t.onPointerObservable.remove(this._onPointerDblTapObserver)},e.prototype.onFocus=function(){var t=this;if(this._isEnabled){if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),-1!==navigator.userAgent.indexOf("Mobile")&&!this.disableMobilePrompt){var e=prompt(this.promptMessage);return null!==e&&(this.text=e),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add((function(e){switch(e.type){case a.ClipboardEventTypes.COPY:t._onCopyText(e.event),t.onTextCopyObservable.notifyObservers(t);break;case a.ClipboardEventTypes.CUT:t._onCutText(e.event),t.onTextCutObservable.notifyObservers(t);break;case a.ClipboardEventTypes.PASTE:t._onPasteText(e.event),t.onTextPasteObservable.notifyObservers(t);break;default:return}}));var i=this._host.getScene();i&&(this._onPointerDblTapObserver=i.onPointerObservable.add((function(e){t._isFocused&&e.type===a.PointerEventTypes.POINTERDOUBLETAP&&t._processDblClick(e)}))),this._onFocusSelectAll&&this._selectAllText()}},e.prototype._getTypeName=function(){return"InputText"},e.prototype.keepsFocusWith=function(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null},e.prototype.processKey=function(t,e,i){if(!i||!i.ctrlKey&&!i.metaKey||67!==t&&86!==t&&88!==t){if(i&&(i.ctrlKey||i.metaKey)&&65===t)return this._selectAllText(),void i.preventDefault();switch(t){case 32:e=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._text&&this._text.length>0){if(this._isTextHighlightOn)return this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());if(0===this._cursorOffset)this.text=this._text.substr(0,this._text.length-1);else(n=this._text.length-this._cursorOffset)>0&&(this.text=this._text.slice(0,n-1)+this._text.slice(n))}return void(i&&i.preventDefault());case 46:if(this._isTextHighlightOn){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex);for(var r=this._endHighlightIndex-this._startHighlightIndex;r>0&&this._cursorOffset>0;)this._cursorOffset--;return this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex,void(i&&i.preventDefault())}if(this._text&&this._text.length>0&&this._cursorOffset>0){var n=this._text.length-this._cursorOffset;this.text=this._text.slice(0,n)+this._text.slice(n+1),this._cursorOffset--}return void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this._isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._text.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._text.length&&(this._cursorOffset=this._text.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(this._text.length===this._cursorOffset)return;this._endHighlightIndex=this._text.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=this._text.length,this._isTextHighlightOn=!0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._text.length:this._text.length-this._startHighlightIndex+1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._text.length?this._text.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._startHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this.text.length,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._text.length-this._cursorOffset-1}return this._endHighlightIndex=this._text.length,this._isTextHighlightOn=!0,this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._text.length-this._startHighlightIndex,this._cursorOffset=this._text.length===this._endHighlightIndex?0:this._text.length-this._endHighlightIndex-1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._text.length-this._endHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 222:i&&i.preventDefault(),this._cursorIndex=-1,this.deadKey=!0}if(e&&(-1===t||32===t||t>47&&t<64||t>64&&t<91||t>159&&t<193||t>218&&t<223||t>95&&t<112)&&(this._currentKey=e,this.onBeforeKeyAddObservable.notifyObservers(this),e=this._currentKey,this._addKey))if(this._isTextHighlightOn)this.text=this._text.slice(0,this._startHighlightIndex)+e+this._text.slice(this._endHighlightIndex),this._cursorOffset=this.text.length-(this._startHighlightIndex+1),this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=e;else{var o=this._text.length-this._cursorOffset;this.text=this._text.slice(0,o)+e+this._text.slice(o)}}},e.prototype._updateValueFromCursorIndex=function(t){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=t;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._text.length-this._cursorIndex,this._startHighlightIndex=this._text.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this._isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._text.length-this._cursorOffset,this._startHighlightIndex=this._text.length-this._cursorIndex}this._isTextHighlightOn=!0,this._markAsDirty()},e.prototype._processDblClick=function(t){this._startHighlightIndex=this._text.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;var e,i,r=/\w+/g;do{i=this._endHighlightIndex<this._text.length&&-1!==this._text[this._endHighlightIndex].search(r)?++this._endHighlightIndex:0,e=this._startHighlightIndex>0&&-1!==this._text[this._startHighlightIndex-1].search(r)?--this._startHighlightIndex:0}while(e||i);this._cursorOffset=this.text.length-this._startHighlightIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()},e.prototype._selectAllText=function(){this._blinkIsEven=!0,this._isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._text.length,this._cursorOffset=this._text.length,this._cursorIndex=-1,this._markAsDirty()},e.prototype.processKeyboard=function(t){this.processKey(t.keyCode,t.key,t),this.onKeyboardEventProcessedObservable.notifyObservers(t)},e.prototype._onCopyText=function(t){this._isTextHighlightOn=!1;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText},e.prototype._onCutText=function(t){if(this._highlightedText){this.text=this._text.slice(0,this._startHighlightIndex)+this._text.slice(this._endHighlightIndex),this._isTextHighlightOn=!1,this._cursorOffset=this.text.length-this._startHighlightIndex;try{t.clipboardData&&t.clipboardData.setData("text/plain",this._highlightedText)}catch(t){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}},e.prototype._onPasteText=function(t){var e="";e=t.clipboardData&&-1!==t.clipboardData.types.indexOf("text/plain")?t.clipboardData.getData("text/plain"):this._host.clipboardData;var i=this._text.length-this._cursorOffset;this.text=this._text.slice(0,i)+e+this._text.slice(i)},e.prototype._draw=function(t,e){var i=this;t.save(),this._applyStates(t),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(t.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._fontOffset||(this._fontOffset=g._GetFontOffset(t.font));var r=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(t.fillStyle=this.color);var n=this._beforeRenderText(this._text);this._isFocused||this._text||!this._placeholderText||(n=this._placeholderText,this._placeholderColor&&(t.fillStyle=this._placeholderColor)),this._textWidth=t.measureText(n).width;var o=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+o)+"px");var s=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,a=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-o;if(t.save(),t.beginPath(),t.rect(r,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,a+2,this._currentMeasure.height),t.clip(),this._isFocused&&this._textWidth>a){var h=r-this._textWidth+a;this._scrollLeft||(this._scrollLeft=h)}else this._scrollLeft=r;if(t.fillText(n,this._scrollLeft,this._currentMeasure.top+s),this._isFocused){if(this._clickedCoordinate){var u=this._scrollLeft+this._textWidth-this._clickedCoordinate,l=0;this._cursorOffset=0;var c=0;do{this._cursorOffset&&(c=Math.abs(u-l)),this._cursorOffset++,l=t.measureText(n.substr(n.length-this._cursorOffset,this._cursorOffset)).width}while(l<u&&n.length>=this._cursorOffset);Math.abs(u-l)>c&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){var f=this.text.substr(this._text.length-this._cursorOffset),_=t.measureText(f).width,d=this._scrollLeft+this._textWidth-_;d<r?(this._scrollLeft+=r-d,d=r,this._markAsDirty()):d>r+a&&(this._scrollLeft+=r+a-d,d=r+a,this._markAsDirty()),this._isTextHighlightOn||t.fillRect(d,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout((function(){i._blinkIsEven=!i._blinkIsEven,i._markAsDirty()}),500),this._isTextHighlightOn){clearTimeout(this._blinkTimeout);var p=t.measureText(this.text.substring(this._startHighlightIndex)).width,m=this._scrollLeft+this._textWidth-p;this._highlightedText=this.text.substring(this._startHighlightIndex,this._endHighlightIndex);var b=t.measureText(this.text.substring(this._startHighlightIndex,this._endHighlightIndex)).width;m<r&&((b-=r-m)||(b=t.measureText(this.text.charAt(this.text.length-this._cursorOffset)).width),m=r),t.globalAlpha=this._highligherOpacity,t.fillStyle=this._textHighlightColor,t.fillRect(m,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,b,this._fontOffset.height),t.globalAlpha=1}}t.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(t.strokeStyle=this.focusedColor):this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),t.restore()},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this._clickedCoordinate=i.x,this._isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[r]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),!0):!!this._isEnabled&&(this._host.focusedControl=this,!0))},e.prototype._onPointerMove=function(e,i,r){this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinate=i.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),t.prototype._onPointerMove.call(this,e,i,r)},e.prototype._onPointerUp=function(e,i,r,n,o){this._isPointerDown=!1,delete this._host._capturingControl[r],t.prototype._onPointerUp.call(this,e,i,r,n,o)},e.prototype._beforeRenderText=function(t){return t},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.InputText"]=T;var P=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._rowDefinitions=new Array,i._columnDefinitions=new Array,i._cells={},i._childControls=new Array,i}return n(e,t),Object.defineProperty(e.prototype,"columnCount",{get:function(){return this._columnDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rowCount",{get:function(){return this._rowDefinitions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._childControls},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),e.prototype.getRowDefinition=function(t){return t<0||t>=this._rowDefinitions.length?null:this._rowDefinitions[t]},e.prototype.getColumnDefinition=function(t){return t<0||t>=this._columnDefinitions.length?null:this._columnDefinitions[t]},e.prototype.addRowDefinition=function(t,e){return void 0===e&&(e=!1),this._rowDefinitions.push(new h(t,e?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},e.prototype.addColumnDefinition=function(t,e){return void 0===e&&(e=!1),this._columnDefinitions.push(new h(t,e?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},e.prototype.setRowDefinition=function(t,e,i){if(void 0===i&&(i=!1),t<0||t>=this._rowDefinitions.length)return this;var r=this._rowDefinitions[t];return r&&r.isPixel===i&&r.internalValue===e?this:(this._rowDefinitions[t]=new h(e,i?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE),this._markAsDirty(),this)},e.prototype.setColumnDefinition=function(t,e,i){if(void 0===i&&(i=!1),t<0||t>=this._columnDefinitions.length)return this;var r=this._columnDefinitions[t];return r&&r.isPixel===i&&r.internalValue===e?this:(this._columnDefinitions[t]=new h(e,i?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE),this._markAsDirty(),this)},e.prototype.getChildrenAt=function(t,e){var i=this._cells[t+":"+e];return i?i.children:null},e.prototype.getChildCellInfo=function(t){return t._tag},e.prototype._removeCell=function(e,i){if(e){t.prototype.removeControl.call(this,e);for(var r=0,n=e.children;r<n.length;r++){var o=n[r],s=this._childControls.indexOf(o);-1!==s&&this._childControls.splice(s,1)}delete this._cells[i]}},e.prototype._offsetCell=function(t,e){if(this._cells[e]){this._cells[t]=this._cells[e];for(var i=0,r=this._cells[t].children;i<r.length;i++){r[i]._tag=t}delete this._cells[e]}},e.prototype.removeColumnDefinition=function(t){if(t<0||t>=this._columnDefinitions.length)return this;for(var e=0;e<this._rowDefinitions.length;e++){var i=e+":"+t,r=this._cells[i];this._removeCell(r,i)}for(e=0;e<this._rowDefinitions.length;e++)for(var n=t+1;n<this._columnDefinitions.length;n++){var o=e+":"+(n-1);i=e+":"+n;this._offsetCell(o,i)}return this._columnDefinitions.splice(t,1),this._markAsDirty(),this},e.prototype.removeRowDefinition=function(t){if(t<0||t>=this._rowDefinitions.length)return this;for(var e=0;e<this._columnDefinitions.length;e++){var i=t+":"+e,r=this._cells[i];this._removeCell(r,i)}for(e=0;e<this._columnDefinitions.length;e++)for(var n=t+1;n<this._rowDefinitions.length;n++){var o=n-1+":"+e;i=n+":"+e;this._offsetCell(o,i)}return this._rowDefinitions.splice(t,1),this._markAsDirty(),this},e.prototype.addControl=function(e,i,r){if(void 0===i&&(i=0),void 0===r&&(r=0),0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(e))return a.Tools.Warn("Control (Name:"+e.name+", UniqueId:"+e.uniqueId+") is already associated with this grid. You must remove it before reattaching it"),this;var n=Math.min(i,this._rowDefinitions.length-1)+":"+Math.min(r,this._columnDefinitions.length-1),o=this._cells[n];return o||(o=new m(n),this._cells[n]=o,o.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,t.prototype.addControl.call(this,o)),o.addControl(e),this._childControls.push(e),e._tag=n,e.parent=this,this._markAsDirty(),this},e.prototype.removeControl=function(t){var e=this._childControls.indexOf(t);-1!==e&&this._childControls.splice(e,1);var i=this._cells[t._tag];return i&&(i.removeControl(t),t._tag=null),this._markAsDirty(),this},e.prototype._getTypeName=function(){return"Grid"},e.prototype._getGridDefinitions=function(t){for(var e=[],i=[],r=[],n=[],o=this._currentMeasure.width,s=0,a=this._currentMeasure.height,h=0,u=0,l=0,c=this._rowDefinitions;l<c.length;l++){if((g=c[l]).isPixel)a-=p=g.getValue(this._host),i[u]=p;else h+=g.internalValue;u++}var f=0;u=0;for(var _=0,d=this._rowDefinitions;_<d.length;_++){var p,g=d[_];if(n.push(f),g.isPixel)f+=g.getValue(this._host);else f+=p=g.internalValue/h*a,i[u]=p;u++}u=0;for(var m=0,b=this._columnDefinitions;m<b.length;m++){if((g=b[m]).isPixel)o-=w=g.getValue(this._host),e[u]=w;else s+=g.internalValue;u++}var y=0;u=0;for(var v=0,O=this._columnDefinitions;v<O.length;v++){var w;g=O[v];if(r.push(y),g.isPixel)y+=g.getValue(this._host);else y+=w=g.internalValue/s*o,e[u]=w;u++}t(r,n,e,i)},e.prototype._additionalProcessing=function(e,i){var r=this;this._getGridDefinitions((function(t,e,i,n){for(var o in r._cells)if(r._cells.hasOwnProperty(o)){var s=o.split(":"),a=parseInt(s[0]),h=parseInt(s[1]),u=r._cells[o];u.left=t[h]+"px",u.top=e[a]+"px",u.width=i[h]+"px",u.height=n[a]+"px",u._left.ignoreAdaptiveScaling=!0,u._top.ignoreAdaptiveScaling=!0,u._width.ignoreAdaptiveScaling=!0,u._height.ignoreAdaptiveScaling=!0}})),t.prototype._additionalProcessing.call(this,e,i)},e.prototype._flagDescendantsAsMatrixDirty=function(){for(var t in this._cells){if(this._cells.hasOwnProperty(t))this._cells[t]._markMatrixAsDirty()}},e.prototype._renderHighlightSpecific=function(e){var i=this;t.prototype._renderHighlightSpecific.call(this,e),this._getGridDefinitions((function(t,r,n,o){for(var s=0;s<t.length;s++){var a=i._currentMeasure.left+t[s]+n[s];e.beginPath(),e.moveTo(a,i._currentMeasure.top),e.lineTo(a,i._currentMeasure.top+i._currentMeasure.height),e.stroke()}for(s=0;s<r.length;s++){var h=i._currentMeasure.top+r[s]+o[s];e.beginPath(),e.moveTo(i._currentMeasure.left,h),e.lineTo(i._currentMeasure.left+i._currentMeasure.width,h),e.stroke()}})),e.restore()},e.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=0,i=this._childControls;e<i.length;e++){i[e].dispose()}this._childControls=[]},e}(m);a._TypeStore.RegisteredTypes["BABYLON.GUI.Grid"]=P;var M=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._value=a.Color3.Red(),i._tmpColor=new a.Color3,i._pointerStartedOnSquare=!1,i._pointerStartedOnWheel=!1,i._squareLeft=0,i._squareTop=0,i._squareSize=0,i._h=360,i._s=1,i._v=1,i._lastPointerDownID=-1,i.onValueChangedObservable=new a.Observable,i._pointerIsDown=!1,i.value=new a.Color3(.88,.1,.1),i.size="200px",i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value.equals(t)||(this._value.copyFrom(t),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=e._Epsilon&&(this._value.r=0),this._value.g<=e._Epsilon&&(this._value.g=0),this._value.b<=e._Epsilon&&(this._value.b=0),this._value.r>=1-e._Epsilon&&(this._value.r=1),this._value.g>=1-e._Epsilon&&(this._value.g=1),this._value.b>=1-e._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(t){this._width.toString(this._host)!==t&&this._width.fromString(t)&&(this._height.fromString(t),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(t){this._height.toString(this._host)!==t&&this._height.fromString(t)&&(this._width.fromString(t),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.width},set:function(t){this.width=t},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"ColorPicker"},e.prototype._preMeasure=function(t,e){t.width<t.height?this._currentMeasure.height=t.width:this._currentMeasure.width=t.height},e.prototype._updateSquareProps=function(){var t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),e=2*(t-.2*t)/Math.sqrt(2),i=t-.5*e;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=e},e.prototype._drawGradientSquare=function(t,e,i,r,n,o){var s=o.createLinearGradient(e,i,r+e,i);s.addColorStop(0,"#fff"),s.addColorStop(1,"hsl("+t+", 100%, 50%)"),o.fillStyle=s,o.fillRect(e,i,r,n);var a=o.createLinearGradient(e,i,e,n+i);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"#000"),o.fillStyle=a,o.fillRect(e,i,r,n)},e.prototype._drawCircle=function(t,e,i,r){r.beginPath(),r.arc(t,e,i+1,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#333333",r.stroke(),r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#ffffff",r.stroke()},e.prototype._createColorWheelCanvas=function(t,e){var i=document.createElement("canvas");i.width=2*t,i.height=2*t;for(var r=i.getContext("2d"),n=r.getImageData(0,0,2*t,2*t),o=n.data,s=this._tmpColor,h=t*t,u=t-e,l=u*u,c=-t;c<t;c++)for(var f=-t;f<t;f++){var _=c*c+f*f;if(!(_>h||_<l)){var d=Math.sqrt(_),p=Math.atan2(f,c);a.Color3.HSVtoRGBToRef(180*p/Math.PI+180,d/t,1,s);var g=4*(c+t+2*(f+t)*t);o[g]=255*s.r,o[g+1]=255*s.g,o[g+2]=255*s.b;var m=.2;m=t<50?.2:t>150?.04:-.16*(t-50)/100+.2;var b=(d-u)/(t-u);o[g+3]=b<m?b/m*255:b>1-m?255*(1-(b-(1-m))/m):255}}return r.putImageData(n,0,0),i},e.prototype._draw=function(t){t.save(),this._applyStates(t);var e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*e,r=this._currentMeasure.left,n=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*e||(this._colorWheelCanvas=this._createColorWheelCanvas(e,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),t.drawImage(this._colorWheelCanvas,r,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,t);var o=this._squareLeft+this._squareSize*this._s,s=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,s,.04*e,t);var a=e-.5*i;o=r+e+Math.cos((this._h-180)*Math.PI/180)*a,s=n+e+Math.sin((this._h-180)*Math.PI/180)*a,this._drawCircle(o,s,.35*i,t),t.restore()},e.prototype._updateValueFromPointer=function(t,i){if(this._pointerStartedOnWheel){var r=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),n=r+this._currentMeasure.left,o=r+this._currentMeasure.top;this._h=180*Math.atan2(i-o,t-n)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(t-this._squareLeft)/this._squareSize,this._v=1-(i-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,e._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,e._Epsilon));a.Color3.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor},e.prototype._isPointOnSquare=function(t,e){this._updateSquareProps();var i=this._squareLeft,r=this._squareTop,n=this._squareSize;return t>=i&&t<=i+n&&e>=r&&e<=r+n},e.prototype._isPointOnWheel=function(t,e){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),r=i-.2*i,n=t-(i+this._currentMeasure.left),o=e-(i+this._currentMeasure.top),s=n*n+o*o;return s<=i*i&&s>=r*r},e.prototype._onPointerDown=function(e,i,r,n){if(!t.prototype._onPointerDown.call(this,e,i,r,n))return!1;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var o=this._transformedPosition.x,s=this._transformedPosition.y;return this._isPointOnSquare(o,s)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(o,s)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(o,s),this._host._capturingControl[r]=this,this._lastPointerDownID=r,!0},e.prototype._onPointerMove=function(e,i,r){if(r==this._lastPointerDownID){this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var n=this._transformedPosition.x,o=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(n,o),t.prototype._onPointerMove.call(this,e,i,r)}},e.prototype._onPointerUp=function(e,i,r,n,o){this._pointerIsDown=!1,delete this._host._capturingControl[r],t.prototype._onPointerUp.call(this,e,i,r,n,o)},e.ShowPickerDialogAsync=function(t,i){return new Promise((function(r,n){i.pickerWidth=i.pickerWidth||"640px",i.pickerHeight=i.pickerHeight||"400px",i.headerHeight=i.headerHeight||"35px",i.lastColor=i.lastColor||"#000000",i.swatchLimit=i.swatchLimit||20,i.numSwatchesPerLine=i.numSwatchesPerLine||10;var o,s,h,u,l,c,f,_,d,p,m,b,O,C,x,M,k,I,A,S=i.swatchLimit/i.numSwatchesPerLine,E=parseFloat(i.pickerWidth)/i.numSwatchesPerLine,R=Math.floor(.25*E),L=R*(i.numSwatchesPerLine+1),D=Math.floor((parseFloat(i.pickerWidth)-L)/i.numSwatchesPerLine),N=D*S+R*(S+1),B=(parseInt(i.pickerHeight)+N+Math.floor(.25*D)).toString()+"px",V="#c0c0c0",H="#535353",j="#414141",F="515151",z="#555555",W="#454545",G=a.Color3.FromHexString("#dddddd"),U=G.r+G.g+G.b,X="#aaaaaa",Y="#ffffff",q=["R","G","B"],K=!1;function Z(t,e){A=e;var i=t.toHexString();if(k.background=i,p.name!=A&&(p.text=Math.floor(255*t.r).toString()),m.name!=A&&(m.text=Math.floor(255*t.g).toString()),b.name!=A&&(b.text=Math.floor(255*t.b).toString()),O.name!=A&&(O.text=t.r.toString()),C.name!=A&&(C.text=t.g.toString()),x.name!=A&&(x.text=t.b.toString()),M.name!=A){var r=i.split("#");M.text=r[1]}d.name!=A&&(d.value=t)}function $(t,e){var i=t.text;if(/[^0-9]/g.test(i))t.text=I;else if(""!=i&&(Math.floor(parseInt(i))<0?i="0":Math.floor(parseInt(i))>255?i="255":isNaN(parseInt(i))&&(i="0")),A==t.name&&(I=i),""!=i){i=parseInt(i).toString(),t.text=i;var r=a.Color3.FromHexString(k.background);A==t.name&&Z("r"==e?new a.Color3(parseInt(i)/255,r.g,r.b):"g"==e?new a.Color3(r.r,parseInt(i)/255,r.b):new a.Color3(r.r,r.g,parseInt(i)/255),t.name)}}function J(t,e){var i=t.text;if(/[^0-9\.]/g.test(i))t.text=I;else{""!=i&&"."!=i&&0!=parseFloat(i)&&(parseFloat(i)<0?i="0.0":parseFloat(i)>1?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),A==t.name&&(I=i),""!=i&&"."!=i&&0!=parseFloat(i)?(i=parseFloat(i).toString(),t.text=i):i="0.0";var r=a.Color3.FromHexString(k.background);A==t.name&&Z("r"==e?new a.Color3(parseFloat(i),r.g,r.b):"g"==e?new a.Color3(r.r,parseFloat(i),r.b):new a.Color3(r.r,r.g,parseFloat(i)),t.name)}}function Q(){if(i.savedColors&&i.savedColors[f]){if(K)var t="b";else t="";var e=w.CreateSimpleButton("Swatch_"+f,t);e.fontFamily="BabylonJSglyphs";var r=a.Color3.FromHexString(i.savedColors[f]),n=r.r+r.g+r.b;e.color=n>U?X:Y,e.fontSize=Math.floor(.7*D),e.textBlock.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,e.height=e.width=D.toString()+"px",e.background=i.savedColors[f],e.thickness=2;var o=f;return e.pointerDownAnimation=function(){e.thickness=4},e.pointerUpAnimation=function(){e.thickness=3},e.pointerEnterAnimation=function(){e.thickness=3},e.pointerOutAnimation=function(){e.thickness=2},e.onPointerClickObservable.add((function(){var t;K?(t=o,i.savedColors&&i.savedColors.splice(t,1),i.savedColors&&0==i.savedColors.length&&(it(!1),K=!1),et("",Nt)):i.savedColors&&Z(a.Color3.FromHexString(i.savedColors[o]),e.name)})),e}return null}function tt(t){if(void 0!==t&&(K=t),K){for(var e=0;e<_.children.length;e++){_.children[e].textBlock.text="b"}void 0!==h&&(h.textBlock.text="Done")}else{for(e=0;e<_.children.length;e++){_.children[e].textBlock.text=""}void 0!==h&&(h.textBlock.text="Edit")}}function et(t,e){if(i.savedColors){""!=t&&i.savedColors.push(t),f=0,_.clearControls();var r=Math.ceil(i.savedColors.length/i.numSwatchesPerLine);if(0==r)var n=0;else n=r+1;if(_.rowCount!=r+n){for(var o=_.rowCount,s=0;s<o;s++)_.removeRowDefinition(0);for(s=0;s<r+n;s++)s%2?_.addRowDefinition(D,!0):_.addRowDefinition(R,!0)}_.height=(D*r+n*R).toString()+"px";for(var a=1,h=1;a<r+n;a+=2,h++){if(i.savedColors.length>h*i.numSwatchesPerLine)var u=i.numSwatchesPerLine;else u=i.savedColors.length-(h-1)*i.numSwatchesPerLine;for(var l=Math.min(Math.max(u,0),i.numSwatchesPerLine),c=0,d=1;c<l;c++)if(!(c>i.numSwatchesPerLine)){var p=Q();null!=p&&(_.addControl(p,a,d),d+=2,f++)}}i.savedColors.length>=i.swatchLimit?rt(e,!0):rt(e,!1)}}function it(t){t?((h=w.CreateSimpleButton("butEdit","Edit")).width=u,h.height=l,h.left=Math.floor(.1*parseInt(u)).toString()+"px",h.top=(-1*parseFloat(h.left)).toString()+"px",h.verticalAlignment=g.VERTICAL_ALIGNMENT_BOTTOM,h.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,h.thickness=2,h.color=V,h.fontSize=s,h.background=H,h.onPointerEnterObservable.add((function(){h.background=j})),h.onPointerOutObservable.add((function(){h.background=H})),h.pointerDownAnimation=function(){h.background=F},h.pointerUpAnimation=function(){h.background=j},h.onPointerClickObservable.add((function(){K=!K,tt()})),bt.addControl(h,1,0)):bt.removeControl(h)}function rt(t,e){e?(t.color=z,t.background=W):(t.color=V,t.background=H)}function nt(e){i.savedColors&&i.savedColors.length>0?r({savedColors:i.savedColors,pickedColor:e}):r({pickedColor:e}),t.removeControl(ot)}var ot=new P;if(ot.name="Dialog Container",ot.width=i.pickerWidth,i.savedColors){ot.height=B;var st=parseInt(i.pickerHeight)/parseInt(B);ot.addRowDefinition(st,!1),ot.addRowDefinition(1-st,!1)}else ot.height=i.pickerHeight,ot.addRowDefinition(1,!1);if(t.addControl(ot),i.savedColors){(_=new P).name="Swatch Drawer",_.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,_.background=H,_.width=i.pickerWidth;var at=i.savedColors.length/i.numSwatchesPerLine;if(0==at)var ht=0;else ht=at+1;_.height=(D*at+ht*R).toString()+"px",_.top=Math.floor(.25*D).toString()+"px";for(var ut=0;ut<2*Math.ceil(i.savedColors.length/i.numSwatchesPerLine)+1;ut++)ut%2!=0?_.addRowDefinition(D,!0):_.addRowDefinition(R,!0);for(ut=0;ut<2*i.numSwatchesPerLine+1;ut++)ut%2!=0?_.addColumnDefinition(D,!0):_.addColumnDefinition(R,!0);ot.addControl(_,1,0)}var lt=new P;lt.name="Picker Panel",lt.height=i.pickerHeight;var ct=parseInt(i.headerHeight)/parseInt(i.pickerHeight),ft=[ct,1-ct];lt.addRowDefinition(ft[0],!1),lt.addRowDefinition(ft[1],!1),ot.addControl(lt,0,0);var _t=new y;_t.name="Dialogue Header Bar",_t.background="#cccccc",_t.thickness=0,lt.addControl(_t,0,0);var dt=w.CreateSimpleButton("closeButton","a");dt.fontFamily="BabylonJSglyphs";var pt=a.Color3.FromHexString(_t.background);o=new a.Color3(1-pt.r,1-pt.g,1-pt.b),dt.color=o.toHexString(),dt.fontSize=Math.floor(.6*parseInt(i.headerHeight)),dt.textBlock.textVerticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,dt.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_RIGHT,dt.height=dt.width=i.headerHeight,dt.background=_t.background,dt.thickness=0,dt.pointerDownAnimation=function(){},dt.pointerUpAnimation=function(){dt.background=_t.background},dt.pointerEnterAnimation=function(){dt.color=_t.background,dt.background="red"},dt.pointerOutAnimation=function(){dt.color=o.toHexString(),dt.background=_t.background},dt.onPointerClickObservable.add((function(){nt(At.background)})),lt.addControl(dt,0,0);var gt=new P;gt.name="Dialogue Body",gt.background=H;var mt=[.4375,.5625];gt.addRowDefinition(1,!1),gt.addColumnDefinition(mt[0],!1),gt.addColumnDefinition(mt[1],!1),lt.addControl(gt,1,0);var bt=new P;bt.name="Picker Grid",bt.addRowDefinition(.85,!1),bt.addRowDefinition(.15,!1),gt.addControl(bt,0,0),(d=new e).name="GUI Color Picker",i.pickerHeight<i.pickerWidth?d.width=.89:d.height=.89,d.value=a.Color3.FromHexString(i.lastColor),d.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_CENTER,d.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,d.onPointerDownObservable.add((function(){A=d.name,I="",tt(!1)})),d.onValueChangedObservable.add((function(t){A==d.name&&Z(t,d.name)})),bt.addControl(d,0,0);var yt=new P;yt.name="Dialogue Right Half",yt.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT;var vt=[.514,.486];yt.addRowDefinition(vt[0],!1),yt.addRowDefinition(vt[1],!1),gt.addControl(yt,1,1);var Ot=new P;Ot.name="Swatches and Buttons";var wt=[.417,.583];Ot.addRowDefinition(1,!1),Ot.addColumnDefinition(wt[0],!1),Ot.addColumnDefinition(wt[1],!1),yt.addControl(Ot,0,0);var Ct=new P;Ct.name="New and Current Swatches";var xt=[.04,.16,.64,.16];Ct.addRowDefinition(xt[0],!1),Ct.addRowDefinition(xt[1],!1),Ct.addRowDefinition(xt[2],!1),Ct.addRowDefinition(xt[3],!1),Ot.addControl(Ct,0,0);var Tt=new P;Tt.name="Active Swatches",Tt.width=.67,Tt.addRowDefinition(.5,!1),Tt.addRowDefinition(.5,!1),Ct.addControl(Tt,2,0);var Pt=Math.floor(parseInt(i.pickerWidth)*mt[1]*wt[0]*.11),Mt=Math.floor(parseInt(i.pickerHeight)*ft[1]*vt[0]*xt[1]*.5);if(i.pickerWidth>i.pickerHeight)var kt=Mt;else kt=Pt;var It=new v;It.text="new",It.name="New Color Label",It.color=V,It.fontSize=kt,Ct.addControl(It,1,0),(k=new y).name="New Color Swatch",k.background=i.lastColor,k.thickness=0,Tt.addControl(k,0,0);var At=w.CreateSimpleButton("currentSwatch","");At.background=i.lastColor,At.thickness=0,At.onPointerClickObservable.add((function(){Z(a.Color3.FromHexString(At.background),At.name),tt(!1)})),At.pointerDownAnimation=function(){},At.pointerUpAnimation=function(){},At.pointerEnterAnimation=function(){},At.pointerOutAnimation=function(){},Tt.addControl(At,1,0);var St=new y;St.name="Swatch Outline",St.width=.67,St.thickness=2,St.color="#404040",St.isHitTestVisible=!1,Ct.addControl(St,2,0);var Et=new v;Et.name="Current Color Label",Et.text="current",Et.color=V,Et.fontSize=kt,Ct.addControl(Et,3,0);var Rt=new P;Rt.name="Button Grid",Rt.height=.8;Rt.addRowDefinition(1/3,!1),Rt.addRowDefinition(1/3,!1),Rt.addRowDefinition(1/3,!1),Ot.addControl(Rt,0,1),u=Math.floor(parseInt(i.pickerWidth)*mt[1]*wt[1]*.67).toString()+"px",l=Math.floor(parseInt(i.pickerHeight)*ft[1]*vt[0]*(parseFloat(Rt.height.toString())/100)*(1/3)*.7).toString()+"px",s=parseFloat(u)>parseFloat(l)?Math.floor(.45*parseFloat(l)):Math.floor(.11*parseFloat(u));var Lt=w.CreateSimpleButton("butOK","OK");Lt.width=u,Lt.height=l,Lt.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,Lt.thickness=2,Lt.color=V,Lt.fontSize=s,Lt.background=H,Lt.onPointerEnterObservable.add((function(){Lt.background=j})),Lt.onPointerOutObservable.add((function(){Lt.background=H})),Lt.pointerDownAnimation=function(){Lt.background=F},Lt.pointerUpAnimation=function(){Lt.background=j},Lt.onPointerClickObservable.add((function(){tt(!1),nt(k.background)})),Rt.addControl(Lt,0,0);var Dt=w.CreateSimpleButton("butCancel","Cancel");if(Dt.width=u,Dt.height=l,Dt.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,Dt.thickness=2,Dt.color=V,Dt.fontSize=s,Dt.background=H,Dt.onPointerEnterObservable.add((function(){Dt.background=j})),Dt.onPointerOutObservable.add((function(){Dt.background=H})),Dt.pointerDownAnimation=function(){Dt.background=F},Dt.pointerUpAnimation=function(){Dt.background=j},Dt.onPointerClickObservable.add((function(){tt(!1),nt(At.background)})),Rt.addControl(Dt,1,0),i.savedColors){var Nt=w.CreateSimpleButton("butSave","Save");Nt.width=u,Nt.height=l,Nt.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,Nt.thickness=2,Nt.fontSize=s,i.savedColors.length<i.swatchLimit?(Nt.color=V,Nt.background=H):rt(Nt,!0),Nt.onPointerEnterObservable.add((function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=j)})),Nt.onPointerOutObservable.add((function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=H)})),Nt.pointerDownAnimation=function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=F)},Nt.pointerUpAnimation=function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Nt.background=j)},Nt.onPointerClickObservable.add((function(){i.savedColors&&(0==i.savedColors.length&&it(!0),i.savedColors.length<i.swatchLimit&&et(k.background,Nt),tt(!1))})),i.savedColors.length>0&&it(!0),Rt.addControl(Nt,2,0)}var Bt=new P;Bt.name="Dialog Lower Right",Bt.addRowDefinition(.02,!1),Bt.addRowDefinition(.63,!1),Bt.addRowDefinition(.21,!1),Bt.addRowDefinition(.14,!1),yt.addControl(Bt,1,0),c=a.Color3.FromHexString(i.lastColor);var Vt=new P;Vt.name="RGB Values",Vt.width=.82,Vt.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,Vt.addRowDefinition(1/3,!1),Vt.addRowDefinition(1/3,!1),Vt.addRowDefinition(1/3,!1),Vt.addColumnDefinition(.1,!1),Vt.addColumnDefinition(.2,!1),Vt.addColumnDefinition(.7,!1),Bt.addControl(Vt,1,0);for(ut=0;ut<q.length;ut++){(Ht=new v).text=q[ut],Ht.color=V,Ht.fontSize=s,Vt.addControl(Ht,ut,0)}(p=new T).width=.83,p.height=.72,p.name="rIntField",p.fontSize=s,p.text=(255*c.r).toString(),p.color="#f0f0f0",p.background="#454545",p.onFocusObservable.add((function(){A=p.name,I=p.text,tt(!1)})),p.onBlurObservable.add((function(){""==p.text&&(p.text="0"),$(p,"r"),A==p.name&&(A="")})),p.onTextChangedObservable.add((function(){A==p.name&&$(p,"r")})),Vt.addControl(p,0,1),(m=new T).width=.83,m.height=.72,m.name="gIntField",m.fontSize=s,m.text=(255*c.g).toString(),m.color="#f0f0f0",m.background="#454545",m.onFocusObservable.add((function(){A=m.name,I=m.text,tt(!1)})),m.onBlurObservable.add((function(){""==m.text&&(m.text="0"),$(m,"g"),A==m.name&&(A="")})),m.onTextChangedObservable.add((function(){A==m.name&&$(m,"g")})),Vt.addControl(m,1,1),(b=new T).width=.83,b.height=.72,b.name="bIntField",b.fontSize=s,b.text=(255*c.b).toString(),b.color="#f0f0f0",b.background="#454545",b.onFocusObservable.add((function(){A=b.name,I=b.text,tt(!1)})),b.onBlurObservable.add((function(){""==b.text&&(b.text="0"),$(b,"b"),A==b.name&&(A="")})),b.onTextChangedObservable.add((function(){A==b.name&&$(b,"b")})),Vt.addControl(b,2,1),(O=new T).width=.95,O.height=.72,O.name="rDecField",O.fontSize=s,O.text=c.r.toString(),O.color="#f0f0f0",O.background="#454545",O.onFocusObservable.add((function(){A=O.name,I=O.text,tt(!1)})),O.onBlurObservable.add((function(){0!=parseFloat(O.text)&&""!=O.text||(O.text="0",J(O,"r")),A==O.name&&(A="")})),O.onTextChangedObservable.add((function(){A==O.name&&J(O,"r")})),Vt.addControl(O,0,2),(C=new T).width=.95,C.height=.72,C.name="gDecField",C.fontSize=s,C.text=c.g.toString(),C.color="#f0f0f0",C.background="#454545",C.onFocusObservable.add((function(){A=C.name,I=C.text,tt(!1)})),C.onBlurObservable.add((function(){0!=parseFloat(C.text)&&""!=C.text||(C.text="0",J(C,"g")),A==C.name&&(A="")})),C.onTextChangedObservable.add((function(){A==C.name&&J(C,"g")})),Vt.addControl(C,1,2),(x=new T).width=.95,x.height=.72,x.name="bDecField",x.fontSize=s,x.text=c.b.toString(),x.color="#f0f0f0",x.background="#454545",x.onFocusObservable.add((function(){A=x.name,I=x.text,tt(!1)})),x.onBlurObservable.add((function(){0!=parseFloat(x.text)&&""!=x.text||(x.text="0",J(x,"b")),A==x.name&&(A="")})),x.onTextChangedObservable.add((function(){A==x.name&&J(x,"b")})),Vt.addControl(x,2,2);var Ht,jt=new P;jt.name="Hex Value",jt.width=.82,jt.addRowDefinition(1,!1),jt.addColumnDefinition(.1,!1),jt.addColumnDefinition(.9,!1),Bt.addControl(jt,2,0),(Ht=new v).text="#",Ht.color=V,Ht.fontSize=s,jt.addControl(Ht,0,0),(M=new T).width=.96,M.height=.72,M.name="hexField",M.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_CENTER,M.fontSize=s;var Ft=i.lastColor.split("#");M.text=Ft[1],M.color="#f0f0f0",M.background="#454545",M.onFocusObservable.add((function(){A=M.name,I=M.text,tt(!1)})),M.onBlurObservable.add((function(){if(3==M.text.length){var t=M.text.split("");M.text=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]}""==M.text&&(M.text="000000",Z(a.Color3.FromHexString(M.text),"b")),A==M.name&&(A="")})),M.onTextChangedObservable.add((function(){var t=M.text,e=/[^0-9A-F]/i.test(t);if((M.text.length>6||e)&&A==M.name)M.text=I;else{if(M.text.length<6)for(var i=6-M.text.length,r=0;r<i;r++)t="0"+t;if(3==M.text.length){var n=M.text.split("");t=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]}t="#"+t,A==M.name&&(I=M.text,Z(a.Color3.FromHexString(t),M.name))}})),jt.addControl(M,0,1),i.savedColors&&i.savedColors.length>0&&et("",Nt)}))},e._Epsilon=1e-6,e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.ColorPicker"]=M;var k=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._thickness=1,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Ellipse"},e.prototype._localDraw=function(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),g.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,t),this._background&&(t.fillStyle=this._background,t.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),this._thickness&&(this.color&&(t.strokeStyle=this.color),t.lineWidth=this._thickness,t.stroke()),t.restore()},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},e.prototype._clipForChildren=function(t){g.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,t),t.clip()},e}(m);a._TypeStore.RegisteredTypes["BABYLON.GUI.Ellipse"]=k;var I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._beforeRenderText=function(t){for(var e="",i=0;i<t.length;i++)e+="•";return e},e}(T);a._TypeStore.RegisteredTypes["BABYLON.GUI.InputPassword"]=I;var A=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._lineWidth=1,i._x1=new h(0),i._y1=new h(0),i._x2=new h(0),i._y2=new h(0),i._dash=new Array,i._automaticSize=!0,i.isHitTestVisible=!1,i._horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,i}return n(e,t),Object.defineProperty(e.prototype,"dash",{get:function(){return this._dash},set:function(t){this._dash!==t&&(this._dash=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connectedControl",{get:function(){return this._connectedControl},set:function(t){var e=this;this._connectedControl!==t&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),t&&(this._connectedControlDirtyObserver=t.onDirtyObservable.add((function(){return e._markAsDirty()}))),this._connectedControl=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1.toString(this._host)},set:function(t){this._x1.toString(this._host)!==t&&this._x1.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1.toString(this._host)},set:function(t){this._y1.toString(this._host)!==t&&this._y1.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2.toString(this._host)},set:function(t){this._x2.toString(this._host)!==t&&this._x2.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2.toString(this._host)},set:function(t){this._y2.toString(this._host)!==t&&this._y2.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_effectiveX2",{get:function(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_effectiveY2",{get:function(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Line"},e.prototype._draw=function(t){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath(),t.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),t.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),t.stroke(),t.restore()},e.prototype._measure=function(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth},e.prototype._computeAlignment=function(t,e){this._currentMeasure.left=t.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=t.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2},e.prototype.moveToVector3=function(t,e,i){if(void 0===i&&(i=!1),this._host&&this.parent===this._host._rootContainer){var r=this._host._getGlobalViewport(e),n=a.Vector3.Project(t,a.Matrix.Identity(),e.getTransformMatrix(),r);this._moveToProjectedPosition(n,i),n.z<0||n.z>1?this.notRenderable=!0:this.notRenderable=!1}else a.Tools.Error("Cannot move a control to a vector3 if the control is not at root level")},e.prototype._moveToProjectedPosition=function(t,e){void 0===e&&(e=!1);var i=t.x+this._linkOffsetX.getValue(this._host)+"px",r=t.y+this._linkOffsetY.getValue(this._host)+"px";e?(this.x2=i,this.y2=r,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=r,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.Line"]=A;var S=function(){function t(t){this._multiLine=t,this._x=new h(0),this._y=new h(0),this._point=new a.Vector2(0,0)}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x.toString(this._multiLine._host)},set:function(t){this._x.toString(this._multiLine._host)!==t&&this._x.fromString(t)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y.toString(this._multiLine._host)},set:function(t){this._y.toString(this._multiLine._host)!==t&&this._y.fromString(t)&&this._multiLine._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"control",{get:function(){return this._control},set:function(t){this._control!==t&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=t,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=t,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!0,configurable:!0}),t.prototype.resetLinks=function(){this.control=null,this.mesh=null},t.prototype.translate=function(){return this._point=this._translatePoint(),this._point},t.prototype._translatePoint=function(){if(null!=this._mesh)return this._multiLine._host.getProjectedPosition(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new a.Vector2(this._control.centerX,this._control.centerY);var t=this._multiLine._host,e=this._x.getValueInPixel(t,Number(t._canvas.width)),i=this._y.getValueInPixel(t,Number(t._canvas.height));return new a.Vector2(e,i)},t.prototype.dispose=function(){this.resetLinks()},t}(),E=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._lineWidth=1,i.onPointUpdate=function(){i._markAsDirty()},i._automaticSize=!0,i.isHitTestVisible=!1,i._horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,i._dash=[],i._points=[],i}return n(e,t),Object.defineProperty(e.prototype,"dash",{get:function(){return this._dash},set:function(t){this._dash!==t&&(this._dash=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype.getAt=function(t){return this._points[t]||(this._points[t]=new S(this)),this._points[t]},e.prototype.add=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.map((function(e){return t.push(e)}))},e.prototype.push=function(t){var e=this.getAt(this._points.length);return null==t?e:(t instanceof a.AbstractMesh?e.mesh=t:t instanceof g?e.control=t:null!=t.x&&null!=t.y&&(e.x=t.x,e.y=t.y),e)},e.prototype.remove=function(t){var e;if(t instanceof S){if(-1===(e=this._points.indexOf(t)))return}else e=t;var i=this._points[e];i&&(i.dispose(),this._points.splice(e,1))},e.prototype.reset=function(){for(;this._points.length>0;)this.remove(this._points.length-1)},e.prototype.resetLinks=function(){this._points.forEach((function(t){null!=t&&t.resetLinks()}))},Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(t){this._lineWidth!==t&&(this._lineWidth=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{set:function(t){},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"MultiLine"},e.prototype._draw=function(t,e){t.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._applyStates(t),t.strokeStyle=this.color,t.lineWidth=this._lineWidth,t.setLineDash(this._dash),t.beginPath();var i=!0;this._points.forEach((function(e){e&&(i?(t.moveTo(e._point.x,e._point.y),i=!1):t.lineTo(e._point.x,e._point.y))})),t.stroke(),t.restore()},e.prototype._additionalProcessing=function(t,e){var i=this;this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach((function(t,e){t&&(t.translate(),(null==i._minX||t._point.x<i._minX)&&(i._minX=t._point.x),(null==i._minY||t._point.y<i._minY)&&(i._minY=t._point.y),(null==i._maxX||t._point.x>i._maxX)&&(i._maxX=t._point.x),(null==i._maxY||t._point.y>i._maxY)&&(i._maxY=t._point.y))})),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)},e.prototype._measure=function(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)},e.prototype._computeAlignment=function(t,e){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)},e.prototype.dispose=function(){this.reset(),t.prototype.dispose.call(this)},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.MultiLine"]=E;var R=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.group="",i.onIsCheckedChangedObservable=new a.Observable,i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"thickness",{get:function(){return this._thickness},set:function(t){this._thickness!==t&&(this._thickness=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(t){t=Math.max(Math.min(1,t),0),this._checkSizeRatio!==t&&(this._checkSizeRatio=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChecked",{get:function(){return this._isChecked},set:function(t){var e=this;this._isChecked!==t&&(this._isChecked=t,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(t),this._isChecked&&this._host&&this._host.executeOnAllControls((function(t){if(t!==e&&void 0!==t.group){var i=t;i.group===e.group&&(i.isChecked=!1)}})))},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"RadioButton"},e.prototype._draw=function(t){t.save(),this._applyStates(t);var e=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),g.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,t),t.fillStyle=this._isEnabled?this._background:this._disabledColor,t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this.color,t.lineWidth=this._thickness,t.stroke(),this._isChecked){t.fillStyle=this._isEnabled?this.color:this._disabledColor;var r=e*this._checkSizeRatio,n=i*this._checkSizeRatio;g.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,r/2-this._thickness/2,n/2-this._thickness/2,t),t.fill()}t.restore()},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this.isChecked||(this.isChecked=!0),!0)},e.AddRadioButtonWithHeader=function(t,i,r,n){var o=new C;o.isVertical=!1,o.height="30px";var s=new e;s.width="20px",s.height="20px",s.isChecked=r,s.color="green",s.group=i,s.onIsCheckedChangedObservable.add((function(t){return n(s,t)})),o.addControl(s);var a=new v;return a.text=t,a.width="180px",a.paddingLeft="5px",a.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,a.color="white",o.addControl(a),o},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.RadioButton"]=R;var L=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._thumbWidth=new h(20,h.UNITMODE_PIXEL,!1),i._minimum=0,i._maximum=100,i._value=50,i._isVertical=!1,i._barOffset=new h(5,h.UNITMODE_PIXEL,!1),i._isThumbClamped=!1,i._displayThumb=!0,i._step=0,i._lastPointerDownID=-1,i._effectiveBarOffset=0,i.onValueChangedObservable=new a.Observable,i._pointerIsDown=!1,i.isPointerBlocker=!0,i}return n(e,t),Object.defineProperty(e.prototype,"displayThumb",{get:function(){return this._displayThumb},set:function(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"step",{get:function(){return this._step},set:function(t){this._step!==t&&(this._step=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barOffset",{get:function(){return this._barOffset.toString(this._host)},set:function(t){this._barOffset.toString(this._host)!==t&&this._barOffset.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barOffsetInPixels",{get:function(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbWidth",{get:function(){return this._thumbWidth.toString(this._host)},set:function(t){this._thumbWidth.toString(this._host)!==t&&this._thumbWidth.fromString(t)&&this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbWidthInPixels",{get:function(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minimum",{get:function(){return this._minimum},set:function(t){this._minimum!==t&&(this._minimum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximum",{get:function(){return this._maximum},set:function(t){this._maximum!==t&&(this._maximum=t,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){t=Math.max(Math.min(t,this._maximum),this._minimum),this._value!==t&&(this._value=t,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(t){this._isVertical!==t&&(this._isVertical=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isThumbClamped",{get:function(){return this._isThumbClamped},set:function(t){this._isThumbClamped!==t&&(this._isThumbClamped=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"BaseSlider"},e.prototype._getThumbPosition=function(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength},e.prototype._getThumbThickness=function(t){var e=0;switch(t){case"circle":e=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":e=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return e},e.prototype._prepareRenderingData=function(t){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(t),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?console.error("Height should be greater than width"):(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))},e.prototype._updateValueFromPointer=function(t,e){var i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum);var r=1/this._step|0;this.value=this._step?(i*r|0)/r:i},e.prototype._onPointerDown=function(e,i,r,n){return!!t.prototype._onPointerDown.call(this,e,i,r,n)&&(this._pointerIsDown=!0,this._updateValueFromPointer(i.x,i.y),this._host._capturingControl[r]=this,this._lastPointerDownID=r,!0)},e.prototype._onPointerMove=function(e,i,r){r==this._lastPointerDownID&&(this._pointerIsDown&&this._updateValueFromPointer(i.x,i.y),t.prototype._onPointerMove.call(this,e,i,r))},e.prototype._onPointerUp=function(e,i,r,n,o){this._pointerIsDown=!1,delete this._host._capturingControl[r],t.prototype._onPointerUp.call(this,e,i,r,n,o)},e}(g),D=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._background="black",i._borderColor="white",i._isThumbCircle=!1,i._displayValueBar=!0,i}return n(e,t),Object.defineProperty(e.prototype,"displayValueBar",{get:function(){return this._displayValueBar},set:function(t){this._displayValueBar!==t&&(this._displayValueBar=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isThumbCircle",{get:function(){return this._isThumbCircle},set:function(t){this._isThumbCircle!==t&&(this._isThumbCircle=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Slider"},e.prototype._draw=function(t,e){t.save(),this._applyStates(t),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");var i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight,s=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?r+=this._effectiveThumbThickness/2:i+=this._effectiveThumbThickness/2,s=this._backgroundBoxThickness/2):s=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY);var a=this._getThumbPosition();t.fillStyle=this._background,this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(i+this._backgroundBoxThickness/2,r,s,Math.PI,2*Math.PI),t.fill(),t.fillRect(i,r,n,o)):t.fillRect(i,r,n,o+this._effectiveThumbThickness):t.fillRect(i,r,n,o):this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(i+this._backgroundBoxLength,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),t.fill(),t.fillRect(i,r,n,o)):t.fillRect(i,r,n+this._effectiveThumbThickness,o):t.fillRect(i,r,n,o),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillStyle=this.color,this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(t.beginPath(),t.arc(i+this._backgroundBoxThickness/2,r+this._backgroundBoxLength,s,0,2*Math.PI),t.fill(),t.fillRect(i,r+a,n,o-a)):t.fillRect(i,r+a,n,o-a+this._effectiveThumbThickness):t.fillRect(i,r+a,n,o-a):this.isThumbClamped&&this.isThumbCircle?(t.beginPath(),t.arc(i,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),t.fill(),t.fillRect(i,r,a,o)):t.fillRect(i,r,a,o)),this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(t.beginPath(),this.isVertical?t.arc(i+this._backgroundBoxThickness/2,r+a,s,0,2*Math.PI):t.arc(i+a,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),t.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,t.stroke()):(this.isVertical?t.fillRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):t.fillRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.strokeStyle=this._borderColor,this.isVertical?t.strokeRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):t.strokeRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),t.restore()},e}(L);a._TypeStore.RegisteredTypes["BABYLON.GUI.Slider"]=D;var N=function(){function t(t){this.name=t,this._groupPanel=new C,this._selectors=new Array,this._groupPanel.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(t)}return Object.defineProperty(t.prototype,"groupPanel",{get:function(){return this._groupPanel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectors",{get:function(){return this._selectors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"header",{get:function(){return this._groupHeader.text},set:function(t){"label"!==this._groupHeader.text&&(this._groupHeader.text=t)},enumerable:!0,configurable:!0}),t.prototype._addGroupHeader=function(t){var e=new v("groupHead",t);return e.width=.9,e.height="30px",e.textWrapping=!0,e.color="black",e.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,e.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,e.left="2px",this._groupPanel.addControl(e),e},t.prototype._getSelector=function(t){if(!(t<0||t>=this._selectors.length))return this._selectors[t]},t.prototype.removeSelector=function(t){t<0||t>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[t]),this._selectors.splice(t,1))},t}(),B=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.addCheckbox=function(t,e,i){void 0===e&&(e=function(t){}),void 0===i&&(i=!1);i=i||!1;var r=new x;r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add((function(t){e(t)}));var n=g.AddHeader(r,t,"200px",{isHorizontal:!0,controlFirst:!0});n.height="30px",n.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,n.left="4px",this.groupPanel.addControl(n),this.selectors.push(n),r.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)},e.prototype._setSelectorLabel=function(t,e){this.selectors[t].children[1].text=e},e.prototype._setSelectorLabelColor=function(t,e){this.selectors[t].children[1].color=e},e.prototype._setSelectorButtonColor=function(t,e){this.selectors[t].children[0].color=e},e.prototype._setSelectorButtonBackground=function(t,e){this.selectors[t].children[0].background=e},e}(N),V=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._selectNb=0,e}return n(e,t),e.prototype.addRadio=function(t,e,i){void 0===e&&(e=function(t){}),void 0===i&&(i=!1);var r=this._selectNb++,n=new R;n.name=t,n.width="20px",n.height="20px",n.color="#364249",n.background="#CCCCCC",n.group=this.name,n.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,n.onIsCheckedChangedObservable.add((function(t){t&&e(r)}));var o=g.AddHeader(n,t,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),n.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(n.color=this.groupPanel.parent.parent.buttonColor,n.background=this.groupPanel.parent.parent.buttonBackground)},e.prototype._setSelectorLabel=function(t,e){this.selectors[t].children[1].text=e},e.prototype._setSelectorLabelColor=function(t,e){this.selectors[t].children[1].color=e},e.prototype._setSelectorButtonColor=function(t,e){this.selectors[t].children[0].color=e},e.prototype._setSelectorButtonBackground=function(t,e){this.selectors[t].children[0].background=e},e}(N),H=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.addSlider=function(t,e,i,r,n,o,s){void 0===e&&(e=function(t){}),void 0===i&&(i="Units"),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=function(t){return 0|t});var a=new D;a.name=i,a.value=o,a.minimum=r,a.maximum=n,a.width=.9,a.height="20px",a.color="#364249",a.background="#CCCCCC",a.borderColor="black",a.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,a.left="4px",a.paddingBottom="4px",a.onValueChangedObservable.add((function(t){a.parent.children[0].text=a.parent.children[0].name+": "+s(t)+" "+a.name,e(t)}));var h=g.AddHeader(a,t+": "+s(o)+" "+i,"30px",{isHorizontal:!1,controlFirst:!1});h.height="60px",h.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,h.left="4px",h.children[0].name=t,this.groupPanel.addControl(h),this.selectors.push(h),this.groupPanel.parent&&this.groupPanel.parent.parent&&(a.color=this.groupPanel.parent.parent.buttonColor,a.background=this.groupPanel.parent.parent.buttonBackground)},e.prototype._setSelectorLabel=function(t,e){this.selectors[t].children[0].name=e,this.selectors[t].children[0].text=e+": "+this.selectors[t].children[1].value+" "+this.selectors[t].children[1].name},e.prototype._setSelectorLabelColor=function(t,e){this.selectors[t].children[0].color=e},e.prototype._setSelectorButtonColor=function(t,e){this.selectors[t].children[1].color=e},e.prototype._setSelectorButtonBackground=function(t,e){this.selectors[t].children[1].background=e},e}(N),j=function(t){function e(e,i){void 0===i&&(i=[]);var r=t.call(this,e)||this;if(r.name=e,r.groups=i,r._buttonColor="#364249",r._buttonBackground="#CCCCCC",r._headerColor="black",r._barColor="white",r._barHeight="2px",r._spacerHeight="20px",r._bars=new Array,r._groups=i,r.thickness=2,r._panel=new C,r._panel.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,r._panel.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r._panel.top=5,r._panel.left=5,r._panel.width=.95,i.length>0){for(var n=0;n<i.length-1;n++)r._panel.addControl(i[n].groupPanel),r._addSpacer();r._panel.addControl(i[i.length-1].groupPanel)}return r.addControl(r._panel),r}return n(e,t),e.prototype._getTypeName=function(){return"SelectionPanel"},Object.defineProperty(e.prototype,"headerColor",{get:function(){return this._headerColor},set:function(t){this._headerColor!==t&&(this._headerColor=t,this._setHeaderColor())},enumerable:!0,configurable:!0}),e.prototype._setHeaderColor=function(){for(var t=0;t<this._groups.length;t++)this._groups[t].groupPanel.children[0].color=this._headerColor},Object.defineProperty(e.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(t){this._buttonColor!==t&&(this._buttonColor=t,this._setbuttonColor())},enumerable:!0,configurable:!0}),e.prototype._setbuttonColor=function(){for(var t=0;t<this._groups.length;t++)for(var e=0;e<this._groups[t].selectors.length;e++)this._groups[t]._setSelectorButtonColor(e,this._buttonColor)},Object.defineProperty(e.prototype,"labelColor",{get:function(){return this._labelColor},set:function(t){this._labelColor!==t&&(this._labelColor=t,this._setLabelColor())},enumerable:!0,configurable:!0}),e.prototype._setLabelColor=function(){for(var t=0;t<this._groups.length;t++)for(var e=0;e<this._groups[t].selectors.length;e++)this._groups[t]._setSelectorLabelColor(e,this._labelColor)},Object.defineProperty(e.prototype,"buttonBackground",{get:function(){return this._buttonBackground},set:function(t){this._buttonBackground!==t&&(this._buttonBackground=t,this._setButtonBackground())},enumerable:!0,configurable:!0}),e.prototype._setButtonBackground=function(){for(var t=0;t<this._groups.length;t++)for(var e=0;e<this._groups[t].selectors.length;e++)this._groups[t]._setSelectorButtonBackground(e,this._buttonBackground)},Object.defineProperty(e.prototype,"barColor",{get:function(){return this._barColor},set:function(t){this._barColor!==t&&(this._barColor=t,this._setBarColor())},enumerable:!0,configurable:!0}),e.prototype._setBarColor=function(){for(var t=0;t<this._bars.length;t++)this._bars[t].children[0].background=this._barColor},Object.defineProperty(e.prototype,"barHeight",{get:function(){return this._barHeight},set:function(t){this._barHeight!==t&&(this._barHeight=t,this._setBarHeight())},enumerable:!0,configurable:!0}),e.prototype._setBarHeight=function(){for(var t=0;t<this._bars.length;t++)this._bars[t].children[0].height=this._barHeight},Object.defineProperty(e.prototype,"spacerHeight",{get:function(){return this._spacerHeight},set:function(t){this._spacerHeight!==t&&(this._spacerHeight=t,this._setSpacerHeight())},enumerable:!0,configurable:!0}),e.prototype._setSpacerHeight=function(){for(var t=0;t<this._bars.length;t++)this._bars[t].height=this._spacerHeight},e.prototype._addSpacer=function(){var t=new m;t.width=1,t.height=this._spacerHeight,t.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT;var e=new y;e.width=1,e.height=this._barHeight,e.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,e.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,e.background=this._barColor,e.color="transparent",t.addControl(e),this._panel.addControl(t),this._bars.push(t)},e.prototype.addGroup=function(t){this._groups.length>0&&this._addSpacer(),this._panel.addControl(t.groupPanel),this._groups.push(t),t.groupPanel.children[0].color=this._headerColor;for(var e=0;e<t.selectors.length;e++)t._setSelectorButtonColor(e,this._buttonColor),t._setSelectorButtonBackground(e,this._buttonBackground)},e.prototype.removeGroup=function(t){if(!(t<0||t>=this._groups.length)){var e=this._groups[t];this._panel.removeControl(e.groupPanel),this._groups.splice(t,1),t<this._bars.length&&(this._panel.removeControl(this._bars[t]),this._bars.splice(t,1))}},e.prototype.setHeaderName=function(t,e){e<0||e>=this._groups.length||(this._groups[e].groupPanel.children[0].text=t)},e.prototype.relabel=function(t,e,i){if(!(e<0||e>=this._groups.length)){var r=this._groups[e];i<0||i>=r.selectors.length||r._setSelectorLabel(i,t)}},e.prototype.removeFromGroupSelector=function(t,e){if(!(t<0||t>=this._groups.length)){var i=this._groups[t];e<0||e>=i.selectors.length||i.removeSelector(e)}},e.prototype.addToGroupCheckbox=function(t,e,i,r){(void 0===i&&(i=function(){}),void 0===r&&(r=!1),t<0||t>=this._groups.length)||this._groups[t].addCheckbox(e,i,r)},e.prototype.addToGroupRadio=function(t,e,i,r){(void 0===i&&(i=function(){}),void 0===r&&(r=!1),t<0||t>=this._groups.length)||this._groups[t].addRadio(e,i,r)},e.prototype.addToGroupSlider=function(t,e,i,r,n,o,s,a){(void 0===i&&(i=function(){}),void 0===r&&(r="Units"),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=function(t){return 0|t}),t<0||t>=this._groups.length)||this._groups[t].addSlider(e,i,r,n,o,s,a)},e}(y),F=function(t){function e(e){var i=t.call(this,e)||this;return i._freezeControls=!1,i}return n(e,t),Object.defineProperty(e.prototype,"freezeControls",{get:function(){return this._freezeControls},set:function(t){if(this._freezeControls!==t){this._freezeControls=!1;var e=this.host.getSize(),i=e.width,r=e.height,n=this.host.getContext(),o=new _(0,0,i,r);g.numLayoutCalls=0,this.host._rootContainer._layout(o,n),t&&this._updateMeasures(),this._freezeControls=t,this.host.markAsDirty()}},enumerable:!0,configurable:!0}),e.prototype._updateMeasures=function(){var t=0|this.leftInPixels,e=0|this.topInPixels;this._measureForChildren.left-=t,this._measureForChildren.top-=e,this._currentMeasure.left-=t,this._currentMeasure.top-=e,this._updateChildrenMeasures(this._children,t,e)},e.prototype._updateChildrenMeasures=function(t,e,i){for(var r=0;r<t.length;++r){var n=t[r];n._currentMeasure.left-=e,n._currentMeasure.top-=i,n._customData._origLeft=n._currentMeasure.left,n._customData._origTop=n._currentMeasure.top,n instanceof m&&n._children.length>0&&this._updateChildrenMeasures(n._children,e,i)}},e.prototype._getTypeName=function(){return"ScrollViewerWindow"},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._parentMeasure=e,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=e.width,this._measureForChildren.height=e.height},e.prototype._layout=function(e,i){return this._freezeControls?(this.invalidateRect(),!1):t.prototype._layout.call(this,e,i)},e.prototype._scrollChildren=function(t,e,i){for(var r=0;r<t.length;++r){var n=t[r];n._currentMeasure.left=n._customData._origLeft+e,n._currentMeasure.top=n._customData._origTop+i,n._isClipped=!1,n instanceof m&&n._children.length>0&&this._scrollChildren(n._children,e,i)}},e.prototype._draw=function(e,i){if(this._freezeControls){this._localDraw(e),this.clipChildren&&this._clipForChildren(e);var r=this.leftInPixels,n=this.topInPixels;this._scrollChildren(this._children,r,n);for(var o=0,s=this._children;o<s.length;o++){var a=s[o];a._intersectsRect(this._parentMeasure)&&a._render(e,this._parentMeasure)}}else t.prototype._draw.call(this,e,i)},e.prototype._postMeasure=function(){if(this._freezeControls)t.prototype._postMeasure.call(this);else{for(var e=this.parentClientWidth,i=this.parentClientHeight,r=0,n=this.children;r<n.length;r++){var o=n[r];o.isVisible&&!o.notRenderable&&(o.horizontalAlignment===g.HORIZONTAL_ALIGNMENT_CENTER&&o._offsetLeft(this._currentMeasure.left-o._currentMeasure.left),o.verticalAlignment===g.VERTICAL_ALIGNMENT_CENTER&&o._offsetTop(this._currentMeasure.top-o._currentMeasure.top),e=Math.max(e,o._currentMeasure.left-this._currentMeasure.left+o._currentMeasure.width),i=Math.max(i,o._currentMeasure.top-this._currentMeasure.top+o._currentMeasure.height))}this._currentMeasure.width!==e&&(this._width.updateInPlace(e,h.UNITMODE_PIXEL),this._currentMeasure.width=e,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==i&&(this._height.updateInPlace(i,h.UNITMODE_PIXEL),this._currentMeasure.height=i,this._rebuildLayout=!0,this._isDirty=!0),t.prototype._postMeasure.call(this)}},e}(m),z=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._background="black",i._borderColor="white",i._tempMeasure=new _(0,0,0,0),i}return n(e,t),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){this._borderColor!==t&&(this._borderColor=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"Scrollbar"},e.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},e.prototype._draw=function(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");var e=this._renderLeft,i=this._getThumbPosition();t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),t.fillStyle=this.color,this.isVertical?(this._tempMeasure.left=e-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),t.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),t.restore()},e.prototype._updateValueFromPointer=function(t,e){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=t,this._originY=e,(t<this._tempMeasure.left||t>this._tempMeasure.left+this._tempMeasure.width||e<this._tempMeasure.top||e>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0;i=this.isVertical?-(e-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(t-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=t,this._originY=e},e.prototype._onPointerDown=function(e,i,r,n){return this._first=!0,t.prototype._onPointerDown.call(this,e,i,r,n)},e}(L),W=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._thumbLength=.5,i._thumbHeight=1,i._barImageHeight=1,i._tempMeasure=new _(0,0,0,0),i}return n(e,t),Object.defineProperty(e.prototype,"backgroundImage",{get:function(){return this._backgroundBaseImage},set:function(t){var e=this;this._backgroundBaseImage!==t&&(this._backgroundBaseImage=t,this.isVertical?(t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((function(){var i=t._rotate90(1);e._backgroundImage=i,i.isLoaded||i.onImageLoadedObservable.addOnce((function(){e._markAsDirty()})),e._markAsDirty()})),this._backgroundImage=t._rotate90(1),this._markAsDirty()):(this._backgroundImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((function(){e._markAsDirty()})),this._markAsDirty()))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbImage",{get:function(){return this._thumbBaseImage},set:function(t){var e=this;this._thumbBaseImage!==t&&(this._thumbBaseImage=t,this.isVertical?(t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((function(){var i=t._rotate90(-1);e._thumbImage=i,i.isLoaded||i.onImageLoadedObservable.addOnce((function(){e._markAsDirty()})),e._markAsDirty()})),this._thumbImage=t._rotate90(-1),this._markAsDirty()):(this._thumbImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((function(){e._markAsDirty()})),this._markAsDirty()))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(t){this._thumbLength!==t&&(this._thumbLength=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(t){this._thumbLength!==t&&(this._thumbHeight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(t){this._barImageHeight!==t&&(this._barImageHeight=t,this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"ImageScrollBar"},e.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},e.prototype._draw=function(t){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");var e=this._getThumbPosition(),i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,r,n,o),this.isVertical?(this._tempMeasure.copyFromFloats(i+n*(1-this._barImageHeight)*.5,this._currentMeasure.top,n*this._barImageHeight,o),this._tempMeasure.height+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,r+o*(1-this._barImageHeight)*.5,n,o*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)),this._backgroundImage._draw(t)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+e,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+e,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(t),t.restore()},e.prototype._updateValueFromPointer=function(t,e){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(t,e,this._transformedPosition),t=this._transformedPosition.x,e=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=t,this._originY=e,(t<this._tempMeasure.left||t>this._tempMeasure.left+this._tempMeasure.width||e<this._tempMeasure.top||e>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(e-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(t-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0;i=this.isVertical?-(e-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(t-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=t,this._originY=e},e.prototype._onPointerDown=function(e,i,r,n){return this._first=!0,t.prototype._onPointerDown.call(this,e,i,r,n)},e}(L),G=function(t){function e(e,i){var r=t.call(this,e)||this;return r._barSize=20,r._pointerIsOver=!1,r._wheelPrecision=.05,r._thumbLength=.5,r._thumbHeight=1,r._barImageHeight=1,r._forceHorizontalBar=!1,r._forceVerticalBar=!1,r._useImageBar=i||!1,r.onDirtyObservable.add((function(){r._horizontalBarSpace.color=r.color,r._verticalBarSpace.color=r.color,r._dragSpace.color=r.color})),r.onPointerEnterObservable.add((function(){r._pointerIsOver=!0})),r.onPointerOutObservable.add((function(){r._pointerIsOver=!1})),r._grid=new P,r._useImageBar?(r._horizontalBar=new W,r._verticalBar=new W):(r._horizontalBar=new z,r._verticalBar=new z),r._window=new F("scrollViewer_window"),r._window.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r._window.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,r._grid.addColumnDefinition(1),r._grid.addColumnDefinition(0,!0),r._grid.addRowDefinition(1),r._grid.addRowDefinition(0,!0),t.prototype.addControl.call(r,r._grid),r._grid.addControl(r._window,0,0),r._verticalBarSpace=new y,r._verticalBarSpace.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r._verticalBarSpace.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,r._verticalBarSpace.thickness=1,r._grid.addControl(r._verticalBarSpace,0,1),r._addBar(r._verticalBar,r._verticalBarSpace,!0,Math.PI),r._horizontalBarSpace=new y,r._horizontalBarSpace.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r._horizontalBarSpace.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,r._horizontalBarSpace.thickness=1,r._grid.addControl(r._horizontalBarSpace,1,0),r._addBar(r._horizontalBar,r._horizontalBarSpace,!1,0),r._dragSpace=new y,r._dragSpace.thickness=1,r._grid.addControl(r._dragSpace,1,1),r._useImageBar||(r.barColor="grey",r.barBackground="transparent"),r}return n(e,t),Object.defineProperty(e.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!0,configurable:!0}),e.prototype.addControl=function(t){return t?(this._window.addControl(t),this):this},e.prototype.removeControl=function(t){return this._window.removeControl(t),this},Object.defineProperty(e.prototype,"children",{get:function(){return this._window.children},enumerable:!0,configurable:!0}),e.prototype._flagDescendantsAsMatrixDirty=function(){for(var t=0,e=this._children;t<e.length;t++){e[t]._markMatrixAsDirty()}},Object.defineProperty(e.prototype,"freezeControls",{get:function(){return this._window.freezeControls},set:function(t){this._window.freezeControls=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forceHorizontalBar",{get:function(){return this._forceHorizontalBar},set:function(t){this._grid.setRowDefinition(1,t?this._barSize:0,!0),this._horizontalBar.isVisible=t,this._forceHorizontalBar=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forceVerticalBar",{get:function(){return this._forceVerticalBar},set:function(t){this._grid.setColumnDefinition(1,t?this._barSize:0,!0),this._verticalBar.isVisible=t,this._forceVerticalBar=t},enumerable:!0,configurable:!0}),e.prototype.resetWindow=function(){this._window.width="100%",this._window.height="100%"},e.prototype._getTypeName=function(){return"ScrollViewer"},e.prototype._buildClientSizes=function(){this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight},e.prototype._additionalProcessing=function(e,i){t.prototype._additionalProcessing.call(this,e,i),this._buildClientSizes()},e.prototype._postMeasure=function(){t.prototype._postMeasure.call(this),this._updateScroller()},Object.defineProperty(e.prototype,"wheelPrecision",{get:function(){return this._wheelPrecision},set:function(t){this._wheelPrecision!==t&&(t<0&&(t=0),t>1&&(t=1),this._wheelPrecision=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scrollBackground",{get:function(){return this._horizontalBarSpace.background},set:function(t){this._horizontalBarSpace.background!==t&&(this._horizontalBarSpace.background=t,this._verticalBarSpace.background=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barColor",{get:function(){return this._barColor},set:function(t){this._barColor!==t&&(this._barColor=t,this._horizontalBar.color=t,this._verticalBar.color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbImage",{get:function(){return this._barImage},set:function(t){if(this._barImage!==t){this._barImage=t;var e=this._horizontalBar,i=this._verticalBar;e.thumbImage=t,i.thumbImage=t}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barSize",{get:function(){return this._barSize},set:function(t){this._barSize!==t&&(this._barSize=t,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(t){if(this._thumbLength!==t){t<=0&&(t=.1),t>1&&(t=1),this._thumbLength=t;var e=this._horizontalBar,i=this._verticalBar;e.thumbLength=t,i.thumbLength=t,this._markAsDirty()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(t){if(this._thumbHeight!==t){t<=0&&(t=.1),t>1&&(t=1),this._thumbHeight=t;var e=this._horizontalBar,i=this._verticalBar;e.thumbHeight=t,i.thumbHeight=t,this._markAsDirty()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(t){if(this._barImageHeight!==t){t<=0&&(t=.1),t>1&&(t=1),this._barImageHeight=t;var e=this._horizontalBar,i=this._verticalBar;e.barImageHeight=t,i.barImageHeight=t,this._markAsDirty()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barBackground",{get:function(){return this._barBackground},set:function(t){if(this._barBackground!==t){this._barBackground=t;var e=this._horizontalBar,i=this._verticalBar;e.background=t,i.background=t,this._dragSpace.background=t}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"barImage",{get:function(){return this._barBackgroundImage},set:function(t){this._barBackgroundImage,this._barBackgroundImage=t;var e=this._horizontalBar,i=this._verticalBar;e.backgroundImage=t,i.backgroundImage=t},enumerable:!0,configurable:!0}),e.prototype._setWindowPosition=function(){var t=this._window._currentMeasure.width,e=this._window._currentMeasure.height,i=this._clientWidth-t,r=this._clientHeight-e,n=this._horizontalBar.value*i+"px",o=this._verticalBar.value*r+"px";n!==this._window.left&&(this._window.left=n,this.freezeControls||(this._rebuildLayout=!0)),o!==this._window.top&&(this._window.top=o,this.freezeControls||(this._rebuildLayout=!0))},e.prototype._updateScroller=function(){var t=this._window._currentMeasure.width,e=this._window._currentMeasure.height;this._horizontalBar.isVisible&&t<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(t>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&e<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(e>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes(),this._horizontalBar.thumbWidth=.9*this._thumbLength*this._clientWidth+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*this._clientHeight+"px"},e.prototype._link=function(e){t.prototype._link.call(this,e),this._attachWheel()},e.prototype._addBar=function(t,e,i,r){var n=this;t.paddingLeft=0,t.width="100%",t.height="100%",t.barOffset=0,t.value=0,t.maximum=1,t.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_CENTER,t.verticalAlignment=g.VERTICAL_ALIGNMENT_CENTER,t.isVertical=i,t.rotation=r,t.isVisible=!1,e.addControl(t),t.onValueChangedObservable.add((function(t){n._setWindowPosition()}))},e.prototype._attachWheel=function(){var t=this;if(this._host&&!this._onPointerObserver){var e=this._host.getScene();this._onPointerObserver=e.onPointerObservable.add((function(e,i){t._pointerIsOver&&e.type===a.PointerEventTypes.POINTERWHEEL&&(1==t._verticalBar.isVisible&&(e.event.deltaY<0&&t._verticalBar.value>0?t._verticalBar.value-=t._wheelPrecision:e.event.deltaY>0&&t._verticalBar.value<t._verticalBar.maximum&&(t._verticalBar.value+=t._wheelPrecision)),1==t._horizontalBar.isVisible&&(e.event.deltaX<0&&t._horizontalBar.value<t._horizontalBar.maximum?t._horizontalBar.value+=t._wheelPrecision:e.event.deltaX>0&&t._horizontalBar.value>0&&(t._horizontalBar.value-=t._wheelPrecision)))}))}},e.prototype._renderHighlightSpecific=function(e){this.isHighlighted&&(t.prototype._renderHighlightSpecific.call(this,e),this._grid._renderHighlightSpecific(e),e.restore())},e.prototype.dispose=function(){var e=this._host.getScene();e&&this._onPointerObserver&&(e.onPointerObservable.remove(this._onPointerObserver),this._onPointerObserver=null),t.prototype.dispose.call(this)},e}(y);a._TypeStore.RegisteredTypes["BABYLON.GUI.ScrollViewer"]=G;var U=function(){},X=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onKeyPressObservable=new a.Observable,e.defaultButtonWidth="40px",e.defaultButtonHeight="40px",e.defaultButtonPaddingLeft="2px",e.defaultButtonPaddingRight="2px",e.defaultButtonPaddingTop="2px",e.defaultButtonPaddingBottom="2px",e.defaultButtonColor="#DDD",e.defaultButtonBackground="#070707",e.shiftButtonColor="#7799FF",e.selectedShiftThickness=1,e.shiftState=0,e._currentlyConnectedInputText=null,e._connectedInputTexts=[],e._onKeyPressObserver=null,e}return n(e,t),e.prototype._getTypeName=function(){return"VirtualKeyboard"},e.prototype._createKey=function(t,e){var i=this,r=w.CreateSimpleButton(t,t);return r.width=e&&e.width?e.width:this.defaultButtonWidth,r.height=e&&e.height?e.height:this.defaultButtonHeight,r.color=e&&e.color?e.color:this.defaultButtonColor,r.background=e&&e.background?e.background:this.defaultButtonBackground,r.paddingLeft=e&&e.paddingLeft?e.paddingLeft:this.defaultButtonPaddingLeft,r.paddingRight=e&&e.paddingRight?e.paddingRight:this.defaultButtonPaddingRight,r.paddingTop=e&&e.paddingTop?e.paddingTop:this.defaultButtonPaddingTop,r.paddingBottom=e&&e.paddingBottom?e.paddingBottom:this.defaultButtonPaddingBottom,r.thickness=0,r.isFocusInvisible=!0,r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY,r.onPointerUpObservable.add((function(){i.onKeyPressObservable.notifyObservers(t)})),r},e.prototype.addKeysRow=function(t,e){var i=new C;i.isVertical=!1,i.isFocusInvisible=!0;for(var r=null,n=0;n<t.length;n++){var o=null;e&&e.length===t.length&&(o=e[n]);var s=this._createKey(t[n],o);(!r||s.heightInPixels>r.heightInPixels)&&(r=s),i.addControl(s)}i.height=r?r.height:this.defaultButtonHeight,this.addControl(i)},e.prototype.applyShiftState=function(t){if(this.children)for(var e=0;e<this.children.length;e++){var i=this.children[e];if(i&&i.children)for(var r=i,n=0;n<r.children.length;n++){var o=r.children[n];if(o&&o.children[0]){var s=o.children[0];"⇧"===s.text&&(o.color=t?this.shiftButtonColor:this.defaultButtonColor,o.thickness=t>1?this.selectedShiftThickness:0),s.text=t>0?s.text.toUpperCase():s.text.toLowerCase()}}}},Object.defineProperty(e.prototype,"connectedInputText",{get:function(){return this._currentlyConnectedInputText},enumerable:!0,configurable:!0}),e.prototype.connect=function(t){var e=this;if(!this._connectedInputTexts.some((function(e){return e.input===t}))){null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add((function(t){if(e._currentlyConnectedInputText){switch(e._currentlyConnectedInputText._host.focusedControl=e._currentlyConnectedInputText,t){case"⇧":return e.shiftState++,e.shiftState>2&&(e.shiftState=0),void e.applyShiftState(e.shiftState);case"←":return void e._currentlyConnectedInputText.processKey(8);case"↵":return void e._currentlyConnectedInputText.processKey(13)}e._currentlyConnectedInputText.processKey(-1,e.shiftState?t.toUpperCase():t),1===e.shiftState&&(e.shiftState=0,e.applyShiftState(e.shiftState))}}))),this.isVisible=!1,this._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=this;var i=t.onFocusObservable.add((function(){e._currentlyConnectedInputText=t,t._connectedVirtualKeyboard=e,e.isVisible=!0})),r=t.onBlurObservable.add((function(){t._connectedVirtualKeyboard=null,e._currentlyConnectedInputText=null,e.isVisible=!1}));this._connectedInputTexts.push({input:t,onBlurObserver:r,onFocusObserver:i})}},e.prototype.disconnect=function(t){var e=this;if(t){var i=this._connectedInputTexts.filter((function(e){return e.input===t}));1===i.length&&(this._removeConnectedInputObservables(i[0]),this._connectedInputTexts=this._connectedInputTexts.filter((function(e){return e.input!==t})),this._currentlyConnectedInputText===t&&(this._currentlyConnectedInputText=null))}else this._connectedInputTexts.forEach((function(t){e._removeConnectedInputObservables(t)})),this._connectedInputTexts=[];0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)},e.prototype._removeConnectedInputObservables=function(t){t.input._connectedVirtualKeyboard=null,t.input.onFocusObservable.remove(t.onFocusObserver),t.input.onBlurObservable.remove(t.onBlurObserver)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.disconnect()},e.CreateDefaultLayout=function(t){var i=new e(t);return i.addKeysRow(["1","2","3","4","5","6","7","8","9","0","←"]),i.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),i.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'","↵"]),i.addKeysRow(["⇧","z","x","c","v","b","n","m",",",".","/"]),i.addKeysRow([" "],[{width:"200px"}]),i},e}(C);a._TypeStore.RegisteredTypes["BABYLON.GUI.VirtualKeyboard"]=X;var Y=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._cellWidth=20,i._cellHeight=20,i._minorLineTickness=1,i._minorLineColor="DarkGray",i._majorLineTickness=2,i._majorLineColor="White",i._majorLineFrequency=5,i._background="Black",i._displayMajorLines=!0,i._displayMinorLines=!0,i}return n(e,t),Object.defineProperty(e.prototype,"displayMinorLines",{get:function(){return this._displayMinorLines},set:function(t){this._displayMinorLines!==t&&(this._displayMinorLines=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayMajorLines",{get:function(){return this._displayMajorLines},set:function(t){this._displayMajorLines!==t&&(this._displayMajorLines=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(t){this._cellWidth=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(t){this._cellHeight=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minorLineTickness",{get:function(){return this._minorLineTickness},set:function(t){this._minorLineTickness=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minorLineColor",{get:function(){return this._minorLineColor},set:function(t){this._minorLineColor=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"majorLineTickness",{get:function(){return this._majorLineTickness},set:function(t){this._majorLineTickness=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"majorLineColor",{get:function(){return this._majorLineColor},set:function(t){this._majorLineColor=t,this._markAsDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"majorLineFrequency",{get:function(){return this._majorLineFrequency},set:function(t){this._majorLineFrequency=t,this._markAsDirty()},enumerable:!0,configurable:!0}),e.prototype._draw=function(t,e){if(t.save(),this._applyStates(t),this._isEnabled){this._background&&(t.fillStyle=this._background,t.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));var i=this._currentMeasure.width/this._cellWidth,r=this._currentMeasure.height/this._cellHeight,n=this._currentMeasure.left+this._currentMeasure.width/2,o=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){t.strokeStyle=this._minorLineColor,t.lineWidth=this._minorLineTickness;for(var s=-i/2;s<i/2;s++){var a=n+s*this.cellWidth;t.beginPath(),t.moveTo(a,this._currentMeasure.top),t.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(var h=-r/2;h<r/2;h++){var u=o+h*this.cellHeight;t.beginPath(),t.moveTo(this._currentMeasure.left,u),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,u),t.stroke()}}if(this._displayMajorLines){t.strokeStyle=this._majorLineColor,t.lineWidth=this._majorLineTickness;for(s=-i/2+this._majorLineFrequency;s<i/2;s+=this._majorLineFrequency){a=n+s*this.cellWidth;t.beginPath(),t.moveTo(a,this._currentMeasure.top),t.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),t.stroke()}for(h=-r/2+this._majorLineFrequency;h<r/2;h+=this._majorLineFrequency){u=o+h*this.cellHeight;t.moveTo(this._currentMeasure.left,u),t.lineTo(this._currentMeasure.left+this._currentMeasure.width,u),t.closePath(),t.stroke()}}}t.restore()},e.prototype._getTypeName=function(){return"DisplayGrid"},e}(g);a._TypeStore.RegisteredTypes["BABYLON.GUI.DisplayGrid"]=Y;var q=function(t){function e(e){var i=t.call(this,e)||this;return i.name=e,i._tempMeasure=new _(0,0,0,0),i}return n(e,t),Object.defineProperty(e.prototype,"displayThumb",{get:function(){return this._displayThumb&&null!=this.thumbImage},set:function(t){this._displayThumb!==t&&(this._displayThumb=t,this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundImage",{get:function(){return this._backgroundImage},set:function(t){var e=this;this._backgroundImage!==t&&(this._backgroundImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((function(){return e._markAsDirty()})),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueBarImage",{get:function(){return this._valueBarImage},set:function(t){var e=this;this._valueBarImage!==t&&(this._valueBarImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((function(){return e._markAsDirty()})),this._markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbImage",{get:function(){return this._thumbImage},set:function(t){var e=this;this._thumbImage!==t&&(this._thumbImage=t,t&&!t.isLoaded&&t.onImageLoadedObservable.addOnce((function(){return e._markAsDirty()})),this._markAsDirty())},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"ImageBasedSlider"},e.prototype._draw=function(t,e){t.save(),this._applyStates(t),this._prepareRenderingData("rectangle");var i=this._getThumbPosition(),r=this._renderLeft,n=this._renderTop,o=this._renderWidth,s=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(r,n,o,s),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(t)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(r,n+i,o,s-i+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(r,n+i,o,s-i):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(r,n,i+this._effectiveThumbThickness/2,s):this._tempMeasure.copyFromFloats(r,n,i,s),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(t)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(r-this._effectiveBarOffset,this._currentMeasure.top+i,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+i,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(t)),t.restore()},e}(L);a._TypeStore.RegisteredTypes["BABYLON.GUI.ImageBasedSlider"]=q;g.AddHeader=function(t,e,i,r){var n=new C("panel"),o=!r||r.isHorizontal,s=!r||r.controlFirst;n.isVertical=!o;var a=new v("header");return a.text=e,a.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,o?a.width=i:a.height=i,s?(n.addControl(t),n.addControl(a),a.paddingLeft="5px"):(n.addControl(a),n.addControl(t),a.paddingRight="5px"),a.shadowBlur=t.shadowBlur,a.shadowColor=t.shadowColor,a.shadowOffsetX=t.shadowOffsetX,a.shadowOffsetY=t.shadowOffsetY,n};var K=function(){function t(t){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new h(18,h.UNITMODE_PIXEL,!1),this.onChangedObservable=new a.Observable,this._host=t}return Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(t){this._fontSize.toString(this._host)!==t&&this._fontSize.fromString(t)&&this.onChangedObservable.notifyObservers(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.onChangedObservable.notifyObservers(this))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.onChangedObservable.clear()},t}(),Z=function(t){function e(e,i,r,n,o,s){void 0===i&&(i=0),void 0===r&&(r=0),void 0===o&&(o=!1),void 0===s&&(s=a.Texture.NEAREST_SAMPLINGMODE);var h=t.call(this,e,{width:i,height:r},n,o,s,a.Constants.TEXTUREFORMAT_RGBA)||this;return h._isDirty=!1,h._rootContainer=new m("root"),h._lastControlOver={},h._lastControlDown={},h._capturingControl={},h._linkedControls=new Array,h._isFullscreen=!1,h._fullscreenViewport=new a.Viewport(0,0,1,1),h._idealWidth=0,h._idealHeight=0,h._useSmallestIdeal=!1,h._renderAtIdealSize=!1,h._blockNextFocusCheck=!1,h._renderScale=1,h._cursorChanged=!1,h._clipboardData="",h.onClipboardObservable=new a.Observable,h.onControlPickedObservable=new a.Observable,h.onBeginLayoutObservable=new a.Observable,h.onEndLayoutObservable=new a.Observable,h.onBeginRenderObservable=new a.Observable,h.onEndRenderObservable=new a.Observable,h.premulAlpha=!1,h._useInvalidateRectOptimization=!0,h._invalidatedRectangle=null,h._clearMeasure=new _(0,0,0,0),h.onClipboardCopy=function(t){var e=t,i=new a.ClipboardInfo(a.ClipboardEventTypes.COPY,e);h.onClipboardObservable.notifyObservers(i),e.preventDefault()},h.onClipboardCut=function(t){var e=t,i=new a.ClipboardInfo(a.ClipboardEventTypes.CUT,e);h.onClipboardObservable.notifyObservers(i),e.preventDefault()},h.onClipboardPaste=function(t){var e=t,i=new a.ClipboardInfo(a.ClipboardEventTypes.PASTE,e);h.onClipboardObservable.notifyObservers(i),e.preventDefault()},(n=h.getScene())&&h._texture?(h._rootElement=n.getEngine().getInputElement(),h._renderObserver=n.onBeforeCameraRenderObservable.add((function(t){return h._checkUpdate(t)})),h._preKeyboardObserver=n.onPreKeyboardObservable.add((function(t){h._focusedControl&&(t.type===a.KeyboardEventTypes.KEYDOWN&&h._focusedControl.processKeyboard(t.event),t.skipOnPointerObservable=!0)})),h._rootContainer._link(h),h.hasAlpha=!0,i&&r||(h._resizeObserver=n.getEngine().onResizeObservable.add((function(){return h._onResize()})),h._onResize()),h._texture.isReady=!0,h):h}return n(e,t),Object.defineProperty(e.prototype,"renderScale",{get:function(){return this._renderScale},set:function(t){t!==this._renderScale&&(this._renderScale=t,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(t){this._background!==t&&(this._background=t,this.markAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idealWidth",{get:function(){return this._idealWidth},set:function(t){this._idealWidth!==t&&(this._idealWidth=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idealHeight",{get:function(){return this._idealHeight},set:function(t){this._idealHeight!==t&&(this._idealHeight=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useSmallestIdeal",{get:function(){return this._useSmallestIdeal},set:function(t){this._useSmallestIdeal!==t&&(this._useSmallestIdeal=t,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderAtIdealSize",{get:function(){return this._renderAtIdealSize},set:function(t){this._renderAtIdealSize!==t&&(this._renderAtIdealSize=t,this._onResize())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layerToDispose},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),e.prototype.getChildren=function(){return[this._rootContainer]},e.prototype.getDescendants=function(t,e){return this._rootContainer.getDescendants(t,e)},Object.defineProperty(e.prototype,"focusedControl",{get:function(){return this._focusedControl},set:function(t){this._focusedControl!=t&&(this._focusedControl&&this._focusedControl.onBlur(),t&&t.onFocus(),this._focusedControl=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isForeground",{get:function(){return!this.layer||!this.layer.isBackground},set:function(t){this.layer&&this.layer.isBackground!==!t&&(this.layer.isBackground=!t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clipboardData",{get:function(){return this._clipboardData},set:function(t){this._clipboardData=t},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"AdvancedDynamicTexture"},e.prototype.executeOnAllControls=function(t,e){e||(e=this._rootContainer),t(e);for(var i=0,r=e.children;i<r.length;i++){var n=r[i];n.children?this.executeOnAllControls(t,n):t(n)}},Object.defineProperty(e.prototype,"useInvalidateRectOptimization",{get:function(){return this._useInvalidateRectOptimization},set:function(t){this._useInvalidateRectOptimization=t},enumerable:!0,configurable:!0}),e.prototype.invalidateRect=function(t,e,i,r){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){var n=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),o=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,r));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,t)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,e)),this._invalidatedRectangle.width=n-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=o-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new _(t,e,i-t+1,r-e+1)},e.prototype.markAsDirty=function(){this._isDirty=!0},e.prototype.createStyle=function(){return new K(this)},e.prototype.addControl=function(t){return this._rootContainer.addControl(t),this},e.prototype.removeControl=function(t){return this._rootContainer.removeControl(t),this},e.prototype.dispose=function(){var e=this.getScene();e&&(this._rootElement=null,e.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&e.getEngine().onResizeObservable.remove(this._resizeObserver),this._pointerMoveObserver&&e.onPrePointerObservable.remove(this._pointerMoveObserver),this._pointerObserver&&e.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&e.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&e.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),t.prototype.dispose.call(this))},e.prototype._onResize=function(){var t=this.getScene();if(t){var e=t.getEngine(),i=this.getSize(),r=e.getRenderWidth()*this._renderScale,n=e.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(n=n*this._idealWidth/r,r=this._idealWidth):this._idealHeight&&(r=r*this._idealHeight/n,n=this._idealHeight)),i.width===r&&i.height===n||(this.scaleTo(r,n),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,i.width-1,i.height-1)}},e.prototype._getGlobalViewport=function(t){var e=t.getEngine();return this._fullscreenViewport.toGlobal(e.getRenderWidth(),e.getRenderHeight())},e.prototype.getProjectedPosition=function(t,e){var i=this.getScene();if(!i)return a.Vector2.Zero();var r=this._getGlobalViewport(i),n=a.Vector3.Project(t,e,i.getTransformMatrix(),r);return n.scaleInPlace(this.renderScale),new a.Vector2(n.x,n.y)},e.prototype._checkUpdate=function(t){if(!this._layerToDispose||0!=(t.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){var e=this.getScene();if(!e)return;for(var i=this._getGlobalViewport(e),r=0,n=this._linkedControls;r<n.length;r++){var o=n[r];if(o.isVisible){var s=o._linkedMesh;if(s&&!s.isDisposed()){var h=s.getBoundingInfo?s.getBoundingInfo().boundingSphere.center:a.Vector3.ZeroReadOnly,u=a.Vector3.Project(h,s.getWorldMatrix(),e.getTransformMatrix(),i);u.z<0||u.z>1?o.notRenderable=!0:(o.notRenderable=!1,u.scaleInPlace(this.renderScale),o._moveToProjectedPosition(u))}else a.Tools.SetImmediate((function(){o.linkWithMesh(null)}))}}}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(),this.update(!0,this.premulAlpha))}},e.prototype._render=function(){var t=this.getSize(),e=t.width,i=t.height,r=this.getContext();r.font="18px Arial",r.strokeStyle="white",this.onBeginLayoutObservable.notifyObservers(this);var n=new _(0,0,e,i);g.numLayoutCalls=0,this._rootContainer._layout(n,r),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,e,i),r.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(r.save(),r.fillStyle=this._background,r.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),r.restore()),this.onBeginRenderObservable.notifyObservers(this),g.numRenderCalls=0,this._rootContainer._render(r,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null},e.prototype._changeCursor=function(t){this._rootElement&&(this._rootElement.style.cursor=t,this._cursorChanged=!0)},e.prototype._registerLastControlDown=function(t,e){this._lastControlDown[e]=t,this.onControlPickedObservable.notifyObservers(t)},e.prototype._doPicking=function(t,e,i,r,n){var o=this.getScene();if(o){var s=o.getEngine(),h=this.getSize();if(this._isFullscreen){var u=(o.cameraToUseForPointers||o.activeCamera).viewport;t*=h.width/(s.getRenderWidth()*u.width),e*=h.height/(s.getRenderHeight()*u.height)}this._capturingControl[r]?this._capturingControl[r]._processObservables(i,t,e,r,n):(this._cursorChanged=!1,this._rootContainer._processPicking(t,e,i,r,n)||(this._changeCursor(""),i===a.PointerEventTypes.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r]),delete this._lastControlOver[r])),this._cursorChanged||this._changeCursor(""),this._manageFocus())}},e.prototype._cleanControlAfterRemovalFromList=function(t,e){for(var i in t){if(t.hasOwnProperty(i))t[i]===e&&delete t[i]}},e.prototype._cleanControlAfterRemoval=function(t){this._cleanControlAfterRemovalFromList(this._lastControlDown,t),this._cleanControlAfterRemovalFromList(this._lastControlOver,t)},e.prototype.attach=function(){var t=this,e=this.getScene();if(e){var i=new a.Viewport(0,0,0,0);this._pointerMoveObserver=e.onPrePointerObservable.add((function(r,n){if(!e.isPointerCaptured(r.event.pointerId)&&(r.type===a.PointerEventTypes.POINTERMOVE||r.type===a.PointerEventTypes.POINTERUP||r.type===a.PointerEventTypes.POINTERDOWN)&&e){var o=e.cameraToUseForPointers||e.activeCamera,s=e.getEngine();o?o.viewport.toGlobalToRef(s.getRenderWidth(),s.getRenderHeight(),i):(i.x=0,i.y=0,i.width=s.getRenderWidth(),i.height=s.getRenderHeight());var h=e.pointerX/s.getHardwareScalingLevel()-i.x,u=e.pointerY/s.getHardwareScalingLevel()-(s.getRenderHeight()-i.y-i.height);t._shouldBlockPointer=!1,t._doPicking(h,u,r.type,r.event.pointerId||0,r.event.button),t._shouldBlockPointer&&(r.skipOnPointerObservable=t._shouldBlockPointer)}})),this._attachToOnPointerOut(e)}},e.prototype.registerClipboardEvents=function(){self.addEventListener("copy",this.onClipboardCopy,!1),self.addEventListener("cut",this.onClipboardCut,!1),self.addEventListener("paste",this.onClipboardPaste,!1)},e.prototype.unRegisterClipboardEvents=function(){self.removeEventListener("copy",this.onClipboardCopy),self.removeEventListener("cut",this.onClipboardCut),self.removeEventListener("paste",this.onClipboardPaste)},e.prototype.attachToMesh=function(t,e){var i=this;void 0===e&&(e=!0);var r=this.getScene();r&&(this._pointerObserver=r.onPointerObservable.add((function(e,r){if(e.type===a.PointerEventTypes.POINTERMOVE||e.type===a.PointerEventTypes.POINTERUP||e.type===a.PointerEventTypes.POINTERDOWN){var n=e.event.pointerId||0;if(e.pickInfo&&e.pickInfo.hit&&e.pickInfo.pickedMesh===t){var o=e.pickInfo.getTextureCoordinates();if(o){var s=i.getSize();i._doPicking(o.x*s.width,(1-o.y)*s.height,e.type,n,e.event.button)}}else if(e.type===a.PointerEventTypes.POINTERUP){if(i._lastControlDown[n]&&i._lastControlDown[n]._forcePointerUp(n),delete i._lastControlDown[n],i.focusedControl){var h=i.focusedControl.keepsFocusWith(),u=!0;if(h)for(var l=0,c=h;l<c.length;l++){var f=c[l];if(i!==f._host){var _=f._host;if(_._lastControlOver[n]&&_._lastControlOver[n].isAscendant(f)){u=!1;break}}}u&&(i.focusedControl=null)}}else e.type===a.PointerEventTypes.POINTERMOVE&&(i._lastControlOver[n]&&i._lastControlOver[n]._onPointerOut(i._lastControlOver[n],!0),delete i._lastControlOver[n])}})),t.enablePointerMoveEvents=e,this._attachToOnPointerOut(r))},e.prototype.moveFocusToControl=function(t){this.focusedControl=t,this._lastPickedControl=t,this._blockNextFocusCheck=!0},e.prototype._manageFocus=function(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}},e.prototype._attachToOnPointerOut=function(t){var e=this;this._canvasPointerOutObserver=t.getEngine().onCanvasPointerOutObservable.add((function(t){e._lastControlOver[t.pointerId]&&e._lastControlOver[t.pointerId]._onPointerOut(e._lastControlOver[t.pointerId]),delete e._lastControlOver[t.pointerId],e._lastControlDown[t.pointerId]&&e._lastControlDown[t.pointerId]!==e._capturingControl[t.pointerId]&&(e._lastControlDown[t.pointerId]._forcePointerUp(),delete e._lastControlDown[t.pointerId])}))},e.CreateForMesh=function(t,i,r,n,o){void 0===i&&(i=1024),void 0===r&&(r=1024),void 0===n&&(n=!0),void 0===o&&(o=!1);var s=new e(t.name+" AdvancedDynamicTexture",i,r,t.getScene(),!0,a.Texture.TRILINEAR_SAMPLINGMODE),h=new a.StandardMaterial("AdvancedDynamicTextureMaterial",t.getScene());return h.backFaceCulling=!1,h.diffuseColor=a.Color3.Black(),h.specularColor=a.Color3.Black(),o?(h.diffuseTexture=s,h.emissiveTexture=s,s.hasAlpha=!0):(h.emissiveTexture=s,h.opacityTexture=s),t.material=h,s.attachToMesh(t,n),s},e.CreateFullscreenUI=function(t,i,r,n){void 0===i&&(i=!0),void 0===r&&(r=null),void 0===n&&(n=a.Texture.BILINEAR_SAMPLINGMODE);var o=new e(t,0,0,r,!1,n),s=new a.Layer(t+"_layer",null,r,!i);return s.texture=o,o._layerToDispose=s,o._isFullscreen=!0,o.attach(),o},e}(a.DynamicTexture),$=function(){function t(t){this.texture=t,this._captureRenderTime=!1,this._renderTime=new a.PerfCounter,this._captureLayoutTime=!1,this._layoutTime=new a.PerfCounter,this._onBeginRenderObserver=null,this._onEndRenderObserver=null,this._onBeginLayoutObserver=null,this._onEndLayoutObserver=null}return Object.defineProperty(t.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layoutTimeCounter",{get:function(){return this._layoutTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(t){var e=this;t!==this._captureRenderTime&&(this._captureRenderTime=t,t?(this._onBeginRenderObserver=this.texture.onBeginRenderObservable.add((function(){e._renderTime.beginMonitoring()})),this._onEndRenderObserver=this.texture.onEndRenderObservable.add((function(){e._renderTime.endMonitoring(!0)}))):(this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureLayoutTime",{get:function(){return this._captureLayoutTime},set:function(t){var e=this;t!==this._captureLayoutTime&&(this._captureLayoutTime=t,t?(this._onBeginLayoutObserver=this.texture.onBeginLayoutObservable.add((function(){e._layoutTime.beginMonitoring()})),this._onEndLayoutObserver=this.texture.onEndLayoutObservable.add((function(){e._layoutTime.endMonitoring(!0)}))):(this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null))},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null,this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null,this.texture=null},t}(),J=function(){function t(t){void 0===t&&(t=null),this._nodes={},this._nodeTypes={element:1,attribute:2,text:3},this._isLoaded=!1,this._objectAttributes={textHorizontalAlignment:1,textVerticalAlignment:2,horizontalAlignment:3,verticalAlignment:4,stretch:5},t&&(this._parentClass=t)}return t.prototype._getChainElement=function(t){var e=window;this._parentClass&&(e=this._parentClass);var i=t;i=i.split(".");for(var r=0;r<i.length;r++)e=e[i[r]];return e},t.prototype._getClassAttribute=function(t){var e=t.split(".");return a._TypeStore.GetClass("BABYLON.GUI."+e[0])[e[1]]},t.prototype._createGuiElement=function(t,e,i){void 0===i&&(i=!0);try{var r=new(a._TypeStore.GetClass("BABYLON.GUI."+t.nodeName));e&&i&&e.addControl(r);for(var n=0;n<t.attributes.length;n++)if(!t.attributes[n].name.toLowerCase().includes("datasource"))if(t.attributes[n].name.toLowerCase().includes("observable")){var o=this._getChainElement(t.attributes[n].value);r[t.attributes[n].name].add(o)}else if("linkWithMesh"==t.attributes[n].name)this._parentClass?r.linkWithMesh(this._parentClass[t.attributes[n].value]):r.linkWithMesh(window[t.attributes[n].value]);else if(t.attributes[n].value.startsWith("{{")&&t.attributes[n].value.endsWith("}}")){o=this._getChainElement(t.attributes[n].value.substring(2,t.attributes[n].value.length-2));r[t.attributes[n].name]=o}else this._objectAttributes[t.attributes[n].name]?r[t.attributes[n].name]=this._getClassAttribute(t.attributes[n].value):"true"==t.attributes[n].value||"false"==t.attributes[n].value?r[t.attributes[n].name]="true"==t.attributes[n].value:r[t.attributes[n].name]=isNaN(Number(t.attributes[n].value))?t.attributes[n].value:Number(t.attributes[n].value);if(!t.attributes.getNamedItem("id"))return this._nodes[t.nodeName+Object.keys(this._nodes).length+"_gen"]=r,r;var s=t.attributes.getNamedItem("id").value;if(s.startsWith("{{")&&s.endsWith("}}")&&(s=this._getChainElement(s.substring(2,s.length-2))),this._nodes[s])throw"XmlLoader Exception : Duplicate ID, every element should have an unique ID attribute";return this._nodes[s]=r,r}catch(e){throw"XmlLoader Exception : Error parsing Control "+t.nodeName+","+e+"."}},t.prototype._parseGrid=function(t,e,i){for(var r,n,o,s,a,h=t.children,u=!1,l=-1,c=-1,f=0,_=0;_<h.length;_++)if(h[_].nodeType==this._nodeTypes.element){if("Row"!=h[_].nodeName)throw"XmlLoader Exception : Expecting Row node, received "+h[_].nodeName;if(l+=1,o=h[_].children,!h[_].attributes.getNamedItem("height"))throw"XmlLoader Exception : Height must be defined for grid rows";n=Number(h[_].attributes.getNamedItem("height").nodeValue),u=!!h[_].attributes.getNamedItem("isPixel")&&JSON.parse(h[_].attributes.getNamedItem("isPixel").nodeValue),e.addRowDefinition(n,u);for(var d=0;d<o.length;d++)if(o[d].nodeType==this._nodeTypes.element){if("Column"!=o[d].nodeName)throw"XmlLoader Exception : Expecting Column node, received "+o[d].nodeName;if(c+=1,l>0&&c>f)throw"XmlLoader Exception : In the Grid element, the number of columns is defined in the first row, do not add more columns in the subsequent rows.";if(0==l){if(!o[d].attributes.getNamedItem("width"))throw"XmlLoader Exception : Width must be defined for all the grid columns in the first row";r=Number(o[d].attributes.getNamedItem("width").nodeValue),u=!!o[d].attributes.getNamedItem("isPixel")&&JSON.parse(o[d].attributes.getNamedItem("isPixel").nodeValue),e.addColumnDefinition(r,u)}s=o[d].children;for(var p=0;p<s.length;p++)s[p].nodeType==this._nodeTypes.element&&(a=this._createGuiElement(s[p],e,!1),e.addControl(a,l,c),s[p].firstChild&&this._parseXml(s[p].firstChild,a))}0==l&&(f=c),c=-1}t.nextSibling&&this._parseXml(t.nextSibling,i)},t.prototype._parseElement=function(t,e,i){t.firstChild&&this._parseXml(t.firstChild,e),t.nextSibling&&this._parseXml(t.nextSibling,i)},t.prototype._prepareSourceElement=function(t,e,i,r,n){this._parentClass?this._parentClass[i]=r[n]:window[i]=r[n],t.firstChild&&this._parseXml(t.firstChild,e,!0)},t.prototype._parseElementsFromSource=function(t,e,i){var r=t.attributes.getNamedItem("dataSource").value;if(!r.includes(" in "))throw"XmlLoader Exception : Malformed XML, Data Source must include an in";var n=!0,o=r.split(" in ");if(o.length<2)throw"XmlLoader Exception : Malformed XML, Data Source must an iterator and a source";var s=o[1];if(s.startsWith("{")&&s.endsWith("}")&&(n=!1),(!n||s.startsWith("[")&&s.endsWith("]"))&&(s=s.substring(1,s.length-1)),s=this._parentClass?this._parentClass[s]:window[s],n)for(var a=0;a<s.length;a++)this._prepareSourceElement(t,e,o[0],s,a);else for(var a in s)this._prepareSourceElement(t,e,o[0],s,a);t.nextSibling&&this._parseXml(t.nextSibling,i)},t.prototype._parseXml=function(t,e,i){if(void 0===i&&(i=!1),t.nodeType==this._nodeTypes.element){i&&t.setAttribute("id",e.id+(e._children.length+1));var r=this._createGuiElement(t,e);"Grid"==t.nodeName?this._parseGrid(t,r,e):t.attributes.getNamedItem("dataSource")?this._parseElementsFromSource(t,r,e):this._parseElement(t,r,e)}else t.nextSibling&&this._parseXml(t.nextSibling,e,i)},t.prototype.isLoaded=function(){return this._isLoaded},t.prototype.getNodeById=function(t){return this._nodes[t]},t.prototype.getNodes=function(){return this._nodes},t.prototype.loadLayout=function(t,e,i){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){if(!r.responseXML)throw"XmlLoader Exception : XML file is malformed or corrupted.";var t=r.responseXML.documentElement;this._parseXml(t.firstChild,e),this._isLoaded=!0,i&&i()}}.bind(this),r.open("GET",t,!0),r.send()},t}(),Q="RENDERING_2D_TEXTURE",tt=1.75,et=2,it=(new a.Color4(1,1,1,1),20),rt=i(1);function nt(t){return t+"-"+Math.floor(1e4*Math.random()).toString(32)}var ot=function(t,e){return void 0===t&&(t=Object(rt.random)(100)),void 0===e&&(e={}),o({humanKey:nt("node"),childType:"PhysicalNode",indexInsideContainer:0,id:t,members:[]},e)},st=function(t,e){void 0===t&&(t=Object(rt.random)(1e3)),void 0===e&&(e={});var i=e.room||"room1";return o({room:i,id:t,humanKey:nt("rack"),height:42,width:19,depth:34,angle:0,inverted:!1,xCoordinate:0,yCoordinate:0,positions:[]},e)},at=function(t,e){return void 0===t&&(t=ot),void 0===e&&(e=10),Array.from({length:e},(function(e,i){return t(i)}))},ht=function(t,e,i){var r=void 0===i?{}:i,n=r.devicesPerPosition,o=void 0===n?1:n,s=r.height,a=void 0===s?1:s;return t.positions=Object(rt.map)(e,(function(t,i){var r="number"==typeof o?i%Math.round(e.length/o):i;return{device:t,height:a,position:r>0?r*a:r}})),t},ut=function(t,e){void 0===t&&(t=Object(rt.random)(100));var i=void 0===e?{}:e,r=i.racks,n=void 0===r?2:r,o=i.racksPerRow,s=void 0===o?2:o,a=i.devicesPerRack,h=void 0===a?20:a,u=i.devicesPerPosition,l=void 0===u?2:u,c=i.rackHeight,f=void 0===c?50:c,_=i.deviceHeight,d=void 0===_?1:_,p=i.deviceFactory,g=void 0===p?ot:p,m=i.rackFactory,b=void 0===m?st:m;return at((function(e){return ht(b(e,{height:f,room:"room-"+t,xCoordinate:e%s,yCoordinate:Math.floor(e/s)}),at(g,h),{devicesPerPosition:l,height:d})}),n)};function lt(t,e){var i=3,r=Math.ceil(e/3)||3,n="H";if(n){n="|"===t[0]?"V":"H";var o=t.substring(1).split(",");i=o[0]?+o[0]:i,r=o[1]?+o[1]:r}return{cols:i,rows:r,layout:n,slots:i*r}}function ct(t,e){var i=w.CreateSimpleButton(t,e);return i.pointerEnterAnimation=function(){},i.pointerOutAnimation=function(){},i.pointerUpAnimation=function(){},i.pointerDownAnimation=function(){},i}function ft(t){return t*it}function _t(t){return t.members?t.members.sort((function(t,e){return t.name=t.humanKey||t.$fkRight.humanKey,t.indexInsideContainer-e.indexInsideContainer})):[]}function dt(t){return{name:t.humanKey,type:t.childType,indexInsideContainer:t.indexInsideContainer,id:t.id,powerStatus:t.powerStatus,members:_t(t),parentSlot:t.parentSlot||0}}function pt(t){var e=dt(t);return e.layout=lt(t.layout,t.members.length),e.depth=30,e.positions=function(t){for(var e=lt(t.layout,t.members.length),i=e.cols,r=e.rows,n=[],o=0;o<r;o+=1){n[o]=[];for(var s=0;s<i;s+=1)n[o][s]={humanKey:"EmptySlot",childType:"EmptySlot",indexInsideContainer:0,entity:{},$members:[],parentSlot:0}}var a=[];Object(rt.forEach)(t.members,(function(t){var e=Math.floor(t.indexInsideContainer/i),r=t.indexInsideContainer%i,o=n[e]?n[e][r]:null;o&&"EmptySlot"===o.childType?n[e][r]=t:a.push(t)}));var h=Object(rt.flatMap)(n,(function(t,e){return Object(rt.reduce)(t,(function(t,i,r){return"EmptySlot"===i.childType&&t.push({x:e,y:r}),t}),[])}));return Object(rt.forEach)(a.sort((function(t,e){return t.indexInsideContainer-e.indexInsideContainer})),(function(t){var e=h.shift();e&&(n[e.x][e.y]=t)})),Object(rt.map)(n,(function(e,i){return{devices:Object(rt.map)(e,(function(t,e){return t.parentSlot=e,dt(t)})),id:Date.now(),name:t.humanKey,height:1,parentSlot:i,slotSize:tt}}))}(t),e}var gt=function(t,e){var i=t.height,r=t.position,n=e[r];if(!n){n={height:i,parentSlot:r,devices:[],isChassis:"Chassis"===t.device.childType&&t.device.members.length>0,slotSize:tt};for(var o=0;o<t.height;o+=1)if(e[r+o])return null;for(o=0;o<i;o+=1)e[r+o]=n}return n.height!==i?null:n};function mt(t){var e=[],i=Object(rt.reduce)(t.positions,(function(t,i){var r=gt(i,e);if(r)if(r.isChassis)r.devices.push(pt(i.device)),t[r.parentSlot]=r;else{var n=dt(i.device);r.devices.push(n),t[r.parentSlot]=r}return t}),{}),r=Object.values(i);return Object(rt.forEach)(r,(function(t){t.isChassis||(Object(rt.forEach)(t.devices,(function(t,e){t.parentSlot=e})),t.devices.sort((function(t,e){return t.indexInsideContainer-e.indexInsideContainer})))})),r}function bt(t,e){var i=Object.values(Object(rt.reduce)(t,(function(t,i,r){var n=function(t){return{id:t.id,name:t.humanKey,slots:t.height,width:t.width,height:t.height*tt,room:t.room,depth:t.depth,angle:t.angle,inverted:t.inverted,xCoordinate:t.xCoordinate,yCoordinate:t.yCoordinate,parentPosition:{x:0,y:0,z:0,col:0,row:0},positions:mt(t)}}(i);return t[i.room]?(t[i.room].racks.push(n),t[i.room].cols=Math.max(t[i.room].cols,n.xCoordinate),t[i.room].rows=Math.max(t[i.room].rows,n.yCoordinate),t[i.room].info.maxRackWidth=Math.max(t[i.room].info.maxRackWidth,n.width),t[i.room].info.maxRackDepth=Math.max(t[i.room].info.maxRackDepth,n.depth),t[i.room].info.maxRackHeight=Math.max(t[i.room].info.maxRackHeight,n.height)):t[i.room]={id:r,cols:Math.max(0,n.xCoordinate),rows:Math.max(0,n.yCoordinate),name:i.room,width:2*e.roomPadding,depth:2*e.roomPadding,height:e.roomHeight,racks:[n],info:{maxRackWidth:3,maxRackDepth:34,maxRackHeight:49}},t}),{}));return Object(rt.forEach)(i,(function(t){t.rows+=1,t.cols+=1;var i=Array.from({length:t.rows},(function(i,r){var n=0,o=e.roomPadding,s=Array.from({length:t.cols},(function(i,s){var a=t.racks.find((function(t){return t.xCoordinate===s&&t.yCoordinate===r}));return a&&(a.parentPosition.x=o,a.parentPosition.col=a.xCoordinate,a.parentPosition.row=a.yCoordinate,o+=([90,270].includes(a.angle)?a.depth:a.width)+e.racksSpacingX,a.parentPosition.z=e.roomPadding+r*(a.depth+e.racksSpacingY),n+=([90,270].includes(a.angle)?a.depth:a.width)+e.racksSpacingX),a})).filter(Boolean);return t.depth+=t.info.maxRackDepth+e.racksSpacingY,t.height+=t.info.maxRackHeight+e.racksSpacingY,t.width=Math.max(n,t.width),s}));t.racks=i.flat(),t.width<e.minRoomWidth&&(t.width=e.minRoomWidth),t.depth<e.minRoomDepth&&(t.depth=e.minRoomDepth)})),i}var yt=10,vt="#424242",Ot="#757575",wt="#e0e0e0",Ct="#bdbdbd",xt=!0;function Tt(t){var e=t.id,i=t.depth,r=t.width,n=t.rooms,o=new G("plan-"+e+"-scroll");o.width=1,o.height=1;var s=new y("plan-"+e);return o.addControl(s),xt&&(s.horizontalAlignment=0,s.verticalAlignment=0),s.background="",s.thickness=0,s.widthInPixels=ft(r),s.heightInPixels=ft(i),Object(rt.forEach)(n,(function(t,e){var i=function(t){var e=t.id,i=t.info,r=t.cols,n=t.racks,o=new C("room-"+e);o.isVertical=!1,o.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,o.background="",o.widthInPixels=(ft(i.maxRackWidth)+yt)*r,o.height=1;for(var s=0;s<r;s+=1){var a=new C("room-"+e+"-col-"+s);a.background="",a.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,a.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,a.isVertical=!0,a.height=1,a.widthInPixels=ft(i.maxRackWidth)+yt,o.addControl(a)}return i.maxRackWidth+=et,Object(rt.forEach)(n,(function(t){var i=function(t){var e=t.id,i=t.slots,r=t.height,n=t.positions,o=t.width,s=t.name,a=et,h=ft(o+a),u=new y("rack-"+e);u.horizontalAlignment=y.HORIZONTAL_ALIGNMENT_LEFT,u.verticalAlignment=y.VERTICAL_ALIGNMENT_TOP,u.heightInPixels=ft(r+a)+yt,u.widthInPixels=h,u.color=vt,u.thickness=2,u.paddingBottomInPixels=yt;var l=new C("rack-"+e+"-container");l.isVertical=!0,l.height=1,l.widthInPixels=h,u.addControl(l);var c=ct("rack-"+e+"-header",s);c.background=vt,c.color="white",c.thickness=0,c.textBlock.fontSize=ft(.9),c.heightInPixels=ft(a),c.width=1,c.textBlock.zIndex=2;var f=new y("rack-"+e+"-status");f.height=1,f.width=1,f.thickness=0,f.zIndex=1,f.alpha=.6,c.addControl(f),l.addControl(c);var _=new C("rack-"+e+"-slots");_.width=1,_.heightInPixels=ft(a)*i,_.isVertical=!1,l.addControl(_);var d=new C("rack-"+e+"-slot-numbers");d.background=wt,d.widthInPixels=ft(a),d.height=1,d.isVertical=!0,_.addControl(d);for(var p=1;p<=i;p+=1){var g=ct("rack-"+e+"-pos-"+p,""+p);g.heightInPixels=ft(a),g.width=1,g.background=wt,g.thickness=.5,g.color=Ct,g.textBlock.fontSize=ft(.7),g.textBlock.color="black",d.addControl(g)}d.useBitmapCache=!0;var m=new C("rack-"+e+"-positions");m.background=Ot,m.widthInPixels=h-d.widthInPixels,m.height=1,m.isVertical=!0,_.addControl(m),m.useBitmapCache=!0;var b=Object(rt.keyBy)(n,"parentSlot"),v=0;for(;v<=i;)if(b[v]){var O=b[v];O.width=o;var w=Pt(O);w.heightInPixels=ft(O.height)*a,m.addControl(w),v+=O.height}else{var x=Pt();x.heightInPixels=ft(1)*a,x.background="#757575",m.addControl(x),v+=1}return[u,m,f]}(t)[0],r=t.parentPosition;o.getChildByName("room-"+e+"-col-"+r.col).addControl(i)})),o}(t),r=t.parentPosition;i.topInPixels=ft(r.y)+50,i.leftInPixels=ft(r.x),s.addControl(i)})),o}function Pt(t){var e=new C("rack-position-"+(t?t.id:Date.now()));if(e.isVertical=!1,e.background=wt,e.shadowOffsetY=-2,e.shadowColor=Ct,e.width=1,t){var i=t.devices,r=t.width,n=t.height,o=t.depth,s=i.length;Object(rt.forEach)(i,(function(t){t.width=s>0?r/s:r,t.height=n,t.depth=o;var i=function(t){var e=t.id,i=t.type,r=new y("device-"+e);if(r.heightInPixels=ft(et),r.useBitmapCache=!0,r.shadowOffsetY=2,r.shadowOffsetX=2,r.paddingBottomInPixels=2,r.thickness=0,r.shadowColor=Ct,r.background=wt,r.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r.verticalAlignment=g.VERTICAL_ALIGNMENT_TOP,r.useBitmapCache=!0,"EmptySlot"===i)return[r,null];var n=new O("device-"+i+"-icon","/textures/devices/"+i+".png");n.width=.1,n.height=1,n.paddingBottomInPixels=2,n.paddingLeftInPixels=2,n.paddingRightInPixels=2,n.paddingTopInPixels=2,n.zIndex=2,n.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(n);var o=new v("device-"+e+"-name",t.name);o.width=.9,o.height=1,o.fontSize=ft(.9),o.zIndex=2,o.textHorizontalAlignment=g.HORIZONTAL_ALIGNMENT_LEFT,o.horizontalAlignment=g.HORIZONTAL_ALIGNMENT_RIGHT,r.addControl(o);var s=new y("device-"+e+"-status");return s.width=1,s.height=1,s.zIndex=1,s.thickness=0,s.background=wt,s.alpha=.6,r.addControl(s),[r,s]}(t)[0];i.widthInPixels=ft(r)/s,e.addControl(i)}))}return e}var Mt=!0,kt=!1,It=function(){function t(t){var e=Z.CreateFullscreenUI(Q,!1,t);if(e.renderScale=1.5,e.isForeground=!1,window.adt=e,kt){var i=new G("scroll");i.width=1,i.height=1;var r=new y("r1");r.horizontalAlignment=0,r.verticalAlignment=0,r.background="green",r.thickness=0,r.widthInPixels=1e3,r.heightInPixels=500,r.left=10,r.top=10,i.addControl(r);var n=new y("r2");n.horizontalAlignment=0,n.verticalAlignment=0,n.background="red",n.thickness=0,n.widthInPixels=1800,n.heightInPixels=500,n.left=1734,n.top=10,i.addControl(n),e.addControl(i),i.forceHorizontalBar=!0,i.freezeControls=!0,console.log("num=",this._countChildren(i.children)),window.sv=i}else{var o={roomPadding:5,racksSpacingX:10,racksSpacingY:80,minRoomWidth:100,minRoomDepth:100,planPadding:10,roomSpacingX:50,roomHeight:100,planHeight:0},s=function(t,e,i){var r={name:t,rooms:e},n=10,o=0,s=10,a=0;return Object(rt.forEach)(r.rooms,(function(t,e){n=Math.max(n,t.width),o+=t.width,s=Math.max(s,t.depth),t.parentPosition={col:e,row:0,x:i.planPadding+e*i.planPadding+a,y:0,z:i.planPadding},a+=t.width})),r.width=2*i.planPadding+o+i.planPadding*(r.rooms.length-1),r.depth=2*i.planPadding+s,r.height=i.planHeight,r}("plan001",bt(function(t){var e=void 0===t?{}:t,i=e.rooms,r=void 0===i?1:i,n=e.racksPerRoom,o=void 0===n?10:n,s=e.racksPerRow,a=void 0===s?2:s,h=e.devicesPerRack,u=void 0===h?20:h,l=e.devicesPerPosition,c=void 0===l?2:l,f=e.rackHeight,_=void 0===f?50:f,d=e.deviceHeight,p=void 0===d?1:d,g=e.deviceFactory,m=void 0===g?ot:g,b=e.rackFactory,y=void 0===b?st:b;return Object(rt.flatten)(at((function(t){return ut(t,{racksPerRow:a,deviceFactory:m,devicesPerPosition:c,devicesPerRack:u,rackHeight:_,deviceHeight:p,rackFactory:y,racks:o})}),r))}({rooms:Mt?10:2,racksPerRoom:Mt?100:10,devicesPerRack:30,devicesPerPosition:1,rackHeight:49,racksPerRow:3,deviceHeight:1}),o),o),a=Tt(s);e.addControl(a),a.thickness=0,a.forceHorizontalBar=!0,a.forceVerticalBar=!0,a.freezeControls=!0,console.log("num=",this._countChildren(a.children)),window.sv=a,console.log(s)}}return t.prototype._countChildren=function(t){for(var e=0,i=0,r=t;i<r.length;i++){var n=r[i];e++,n instanceof m&&(e+=this._countChildren(n.children))}return e},t}();a._TypeStore.RegisteredTypes["BABYLON.GUI.MyTest"]=It;var At=function(t){function e(e,i){void 0===i&&(i=0);var r=t.call(this,e.x,e.y,e.z)||this;return r.buttonIndex=i,r}return n(e,t),e}(a.Vector3),St=function(){function t(t){this.name=t,this._downCount=0,this._enterCount=-1,this._downPointerIds={},this._isVisible=!0,this.onPointerMoveObservable=new a.Observable,this.onPointerOutObservable=new a.Observable,this.onPointerDownObservable=new a.Observable,this.onPointerUpObservable=new a.Observable,this.onPointerClickObservable=new a.Observable,this.onPointerEnterObservable=new a.Observable,this._behaviors=new Array}return Object.defineProperty(t.prototype,"position",{get:function(){return this._node?this._node.position:a.Vector3.Zero()},set:function(t){this._node&&(this._node.position=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._node?this._node.scaling:new a.Vector3(1,1,1)},set:function(t){this._node&&(this._node.scaling=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!0,configurable:!0}),t.prototype.addBehavior=function(t){var e=this;if(-1!==this._behaviors.indexOf(t))return this;t.init();var i=this._host.scene;return i.isLoading?i.onDataLoadedObservable.addOnce((function(){t.attach(e)})):t.attach(this),this._behaviors.push(t),this},t.prototype.removeBehavior=function(t){var e=this._behaviors.indexOf(t);return-1===e?this:(this._behaviors[e].detach(),this._behaviors.splice(e,1),this)},t.prototype.getBehaviorByName=function(t){for(var e=0,i=this._behaviors;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},Object.defineProperty(t.prototype,"isVisible",{get:function(){return this._isVisible},set:function(t){if(this._isVisible!==t){this._isVisible=t;var e=this.mesh;e&&e.setEnabled(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return this._getTypeName()},t.prototype._getTypeName=function(){return"Control3D"},Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mesh",{get:function(){return this._node instanceof a.AbstractMesh?this._node:null},enumerable:!0,configurable:!0}),t.prototype.linkToTransformNode=function(t){return this._node&&(this._node.parent=t),this},t.prototype._prepareNode=function(t){if(!this._node){if(this._node=this._createNode(t),!this.node)return;this._node.metadata=this,this._node.position=this.position,this._node.scaling=this.scaling;var e=this.mesh;e&&(e.isPickable=!0,this._affectMaterial(e))}},t.prototype._createNode=function(t){return null},t.prototype._affectMaterial=function(t){t.material=null},t.prototype._onPointerMove=function(t,e){this.onPointerMoveObservable.notifyObservers(e,-1,t,this)},t.prototype._onPointerEnter=function(t){return!(this._enterCount>0)&&(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,t,this),this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},t.prototype._onPointerOut=function(t){this._enterCount=0,this.onPointerOutObservable.notifyObservers(this,-1,t,this),this.pointerOutAnimation&&this.pointerOutAnimation()},t.prototype._onPointerDown=function(t,e,i,r){return 0!==this._downCount?(this._downCount++,!1):(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new At(e,r),-1,t,this),this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},t.prototype._onPointerUp=function(t,e,i,r,n){this._downCount--,delete this._downPointerIds[i],this._downCount<0?this._downCount=0:0==this._downCount&&(n&&(this._enterCount>0||-1===this._enterCount)&&this.onPointerClickObservable.notifyObservers(new At(e,r),-1,t,this),this.onPointerUpObservable.notifyObservers(new At(e,r),-1,t,this),this.pointerUpAnimation&&this.pointerUpAnimation())},t.prototype.forcePointerUp=function(t){if(void 0===t&&(t=null),null!==t)this._onPointerUp(this,a.Vector3.Zero(),t,0,!0);else{for(var e in this._downPointerIds)this._onPointerUp(this,a.Vector3.Zero(),+e,0,!0);this._downCount>0&&(this._downCount=1,this._onPointerUp(this,a.Vector3.Zero(),0,0,!0))}},t.prototype._processObservables=function(t,e,i,r){if(t===a.PointerEventTypes.POINTERMOVE){this._onPointerMove(this,e);var n=this._host._lastControlOver[i];return n&&n!==this&&n._onPointerOut(this),n!==this&&this._onPointerEnter(this),this._host._lastControlOver[i]=this,!0}return t===a.PointerEventTypes.POINTERDOWN?(this._onPointerDown(this,e,i,r),this._host._lastControlDown[i]=this,this._host._lastPickedControl=this,!0):t===a.PointerEventTypes.POINTERUP&&(this._host._lastControlDown[i]&&this._host._lastControlDown[i]._onPointerUp(this,e,i,r,!0),delete this._host._lastControlDown[i],!0)},t.prototype._disposeNode=function(){this._node&&(this._node.dispose(),this._node=null)},t.prototype.dispose=function(){this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._disposeNode();for(var t=0,e=this._behaviors;t<e.length;t++){e[t].detach()}},t}(),Et=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype._getTypeName=function(){return"AbstractButton3D"},e.prototype._createNode=function(t){return new a.TransformNode("button"+this.name)},e}(St),Rt=function(t){function e(e){var i=t.call(this,e)||this;return i._contentResolution=512,i._contentScaleRatio=2,i.pointerEnterAnimation=function(){i.mesh&&(i._currentMaterial.emissiveColor=a.Color3.Red())},i.pointerOutAnimation=function(){i._currentMaterial.emissiveColor=a.Color3.Black()},i.pointerDownAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(.95)},i.pointerUpAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(1/.95)},i}return n(e,t),Object.defineProperty(e.prototype,"contentResolution",{get:function(){return this._contentResolution},set:function(t){this._contentResolution!==t&&(this._contentResolution=t,this._resetContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentScaleRatio",{get:function(){return this._contentScaleRatio},set:function(t){this._contentScaleRatio!==t&&(this._contentScaleRatio=t,this._resetContent())},enumerable:!0,configurable:!0}),e.prototype._disposeFacadeTexture=function(){this._facadeTexture&&(this._facadeTexture.dispose(),this._facadeTexture=null)},e.prototype._resetContent=function(){this._disposeFacadeTexture(),this.content=this._content},Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t,this._host&&this._host.utilityLayer&&(this._facadeTexture?this._facadeTexture.rootContainer.clearControls():(this._facadeTexture=new Z("Facade",this._contentResolution,this._contentResolution,this._host.utilityLayer.utilityLayerScene,!0,a.Texture.TRILINEAR_SAMPLINGMODE),this._facadeTexture.rootContainer.scaleX=this._contentScaleRatio,this._facadeTexture.rootContainer.scaleY=this._contentScaleRatio,this._facadeTexture.premulAlpha=!0),this._facadeTexture.addControl(t),this._applyFacade(this._facadeTexture))},enumerable:!0,configurable:!0}),e.prototype._applyFacade=function(t){this._currentMaterial.emissiveTexture=t},e.prototype._getTypeName=function(){return"Button3D"},e.prototype._createNode=function(t){for(var e=new Array(6),i=0;i<6;i++)e[i]=new a.Vector4(0,0,0,0);return e[1]=new a.Vector4(0,0,1,1),a.BoxBuilder.CreateBox(this.name+"_rootMesh",{width:1,height:1,depth:.08,faceUV:e},t)},e.prototype._affectMaterial=function(t){var e=new a.StandardMaterial(this.name+"Material",t.getScene());e.specularColor=a.Color3.Black(),t.material=e,this._currentMaterial=e,this._resetContent()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._disposeFacadeTexture(),this._currentMaterial&&this._currentMaterial.dispose()},e}(Et),Lt=function(t){function e(e){var i=t.call(this,e)||this;return i._blockLayout=!1,i._children=new Array,i}return n(e,t),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blockLayout",{get:function(){return this._blockLayout},set:function(t){this._blockLayout!==t&&(this._blockLayout=t,this._blockLayout||this._arrangeChildren())},enumerable:!0,configurable:!0}),e.prototype.updateLayout=function(){return this._arrangeChildren(),this},e.prototype.containsControl=function(t){return-1!==this._children.indexOf(t)},e.prototype.addControl=function(t){return-1!==this._children.indexOf(t)?this:(t.parent=this,t._host=this._host,this._children.push(t),this._host.utilityLayer&&(t._prepareNode(this._host.utilityLayer.utilityLayerScene),t.node&&(t.node.parent=this.node),this.blockLayout||this._arrangeChildren()),this)},e.prototype._arrangeChildren=function(){},e.prototype._createNode=function(t){return new a.TransformNode("ContainerNode",t)},e.prototype.removeControl=function(t){var e=this._children.indexOf(t);return-1!==e&&(this._children.splice(e,1),t.parent=null,t._disposeNode()),this},e.prototype._getTypeName=function(){return"Container3D"},e.prototype.dispose=function(){for(var e=0,i=this._children;e<i.length;e++){i[e].dispose()}this._children=[],t.prototype.dispose.call(this)},e.UNSET_ORIENTATION=0,e.FACEORIGIN_ORIENTATION=1,e.FACEORIGINREVERSED_ORIENTATION=2,e.FACEFORWARD_ORIENTATION=3,e.FACEFORWARDREVERSED_ORIENTATION=4,e}(St),Dt=function(t){function e(){var e=t.call(this)||this;return e._columns=10,e._rows=0,e._rowThenColum=!0,e._orientation=Lt.FACEORIGIN_ORIENTATION,e.margin=0,e}return n(e,t),Object.defineProperty(e.prototype,"orientation",{get:function(){return this._orientation},set:function(t){var e=this;this._orientation!==t&&(this._orientation=t,a.Tools.SetImmediate((function(){e._arrangeChildren()})))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},set:function(t){var e=this;this._columns!==t&&(this._columns=t,this._rowThenColum=!0,a.Tools.SetImmediate((function(){e._arrangeChildren()})))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},set:function(t){var e=this;this._rows!==t&&(this._rows=t,this._rowThenColum=!1,a.Tools.SetImmediate((function(){e._arrangeChildren()})))},enumerable:!0,configurable:!0}),e.prototype._arrangeChildren=function(){this._cellWidth=0,this._cellHeight=0;for(var t=0,e=0,i=0,r=a.Matrix.Invert(this.node.computeWorldMatrix(!0)),n=0,o=this._children;n<o.length;n++){if((b=o[n]).mesh){i++,b.mesh.computeWorldMatrix(!0);var s=b.mesh.getHierarchyBoundingVectors(),h=a.TmpVectors.Vector3[0],u=a.TmpVectors.Vector3[1];s.max.subtractToRef(s.min,u),u.scaleInPlace(.5),a.Vector3.TransformNormalToRef(u,r,h),this._cellWidth=Math.max(this._cellWidth,2*h.x),this._cellHeight=Math.max(this._cellHeight,2*h.y)}}this._cellWidth+=2*this.margin,this._cellHeight+=2*this.margin,this._rowThenColum?(e=this._columns,t=Math.ceil(i/this._columns)):(t=this._rows,e=Math.ceil(i/this._rows));var l=.5*e*this._cellWidth,c=.5*t*this._cellHeight,f=[],_=0;if(this._rowThenColum)for(var d=0;d<t;d++)for(var p=0;p<e&&(f.push(new a.Vector3(p*this._cellWidth-l+this._cellWidth/2,d*this._cellHeight-c+this._cellHeight/2,0)),!(++_>i));p++);else for(p=0;p<e;p++)for(d=0;d<t&&(f.push(new a.Vector3(p*this._cellWidth-l+this._cellWidth/2,d*this._cellHeight-c+this._cellHeight/2,0)),!(++_>i));d++);_=0;for(var g=0,m=this._children;g<m.length;g++){var b;(b=m[g]).mesh&&(this._mapGridNode(b,f[_]),_++)}this._finalProcessing()},e.prototype._finalProcessing=function(){},e}(Lt),Nt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._radius=5,e}return n(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){var e=this;this._radius!==t&&(this._radius=t,a.Tools.SetImmediate((function(){e._arrangeChildren()})))},enumerable:!0,configurable:!0}),e.prototype._mapGridNode=function(t,e){var i=t.mesh;if(i){var r=this._cylindricalMapping(e);switch(t.position=r,this.orientation){case Lt.FACEORIGIN_ORIENTATION:i.lookAt(new a.Vector3(2*r.x,r.y,2*r.z));break;case Lt.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new a.Vector3(-r.x,r.y,-r.z));break;case Lt.FACEFORWARD_ORIENTATION:break;case Lt.FACEFORWARDREVERSED_ORIENTATION:i.rotate(a.Axis.Y,Math.PI,a.Space.LOCAL)}}},e.prototype._cylindricalMapping=function(t){var e=new a.Vector3(0,t.y,this._radius),i=t.x/this._radius;return a.Matrix.RotationYawPitchRollToRef(i,0,0,a.TmpVectors.Matrix[0]),a.Vector3.TransformNormal(e,a.TmpVectors.Matrix[0])},e}(Dt),Bt="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 world;\nuniform mat4 viewProjection;\nvarying vec2 vUV;\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float borderWidth;\nuniform vec3 scaleFactor;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\n#endif\nvoid main(void) {\nvUV=uv;\n#ifdef BORDER\nvec3 scale=scaleFactor;\nfloat minScale=min(min(scale.x,scale.y),scale.z);\nfloat maxScale=max(max(scale.x,scale.y),scale.z);\nfloat minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);\nfloat areaYZ=scale.y*scale.z;\nfloat areaXZ=scale.x*scale.z;\nfloat areaXY=scale.x*scale.y;\nfloat scaledBorderWidth=borderWidth;\nif (abs(normal.x) == 1.0)\n{\nscale.x=scale.y;\nscale.y=scale.z;\nif (areaYZ>areaXZ && areaYZ>areaXY)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse if (abs(normal.y) == 1.0)\n{\nscale.x=scale.z;\nif (areaXZ>areaXY && areaXZ>areaYZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse\n{\nif (areaXY>areaYZ && areaXY>areaXZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nfloat scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);\nif (scale.x>scale.y)\n{\nscaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);\nscaleInfo.y=1.0-scaledBorderWidth;\n}\nelse\n{\nscaleInfo.x=1.0-scaledBorderWidth;\nscaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);\n}\n#endif\nvec4 worldPos=world*vec4(position,1.0);\n#ifdef HOVERLIGHT\nworldPosition=worldPos.xyz;\n#endif\ngl_Position=viewProjection*worldPos;\n}\n";a.Effect.ShadersStore.fluentVertexShader=Bt;var Vt="precision highp float;\nvarying vec2 vUV;\nuniform vec4 albedoColor;\n#ifdef INNERGLOW\nuniform vec4 innerGlowColor;\n#endif\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float edgeSmoothingValue;\nuniform float borderMinValue;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\nuniform vec3 hoverPosition;\nuniform vec4 hoverColor;\nuniform float hoverRadius;\n#endif\n#ifdef TEXTURE\nuniform sampler2D albedoSampler;\n#endif\nvoid main(void) {\nvec3 albedo=albedoColor.rgb;\nfloat alpha=albedoColor.a;\n#ifdef TEXTURE\nalbedo=texture2D(albedoSampler,vUV).rgb;\n#endif\n#ifdef HOVERLIGHT\nfloat pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;\nalbedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);\n#else\nfloat pointToHover=1.0;\n#endif\n#ifdef BORDER\nfloat borderPower=10.0;\nfloat inverseBorderPower=1.0/borderPower;\nvec3 borderColor=albedo*borderPower;\nvec2 distanceToEdge;\ndistanceToEdge.x=abs(vUV.x-0.5)*2.0;\ndistanceToEdge.y=abs(vUV.y-0.5)*2.0;\nfloat borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),\nsmoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));\nborderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover);\nalbedo+=borderColor;\nalpha=max(alpha,borderValue);\n#endif\n#ifdef INNERGLOW\n\nvec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);\nuvGlow=uvGlow*uvGlow;\nuvGlow=uvGlow*uvGlow;\nalbedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y);\n#endif\ngl_FragColor=vec4(albedo,alpha);\n}";a.Effect.ShadersStore.fluentPixelShader=Vt;var Ht=function(t){function e(){var e=t.call(this)||this;return e.INNERGLOW=!1,e.BORDER=!1,e.HOVERLIGHT=!1,e.TEXTURE=!1,e.rebuild(),e}return n(e,t),e}(a.MaterialDefines),jt=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.innerGlowColorIntensity=.5,r.innerGlowColor=new a.Color3(1,1,1),r.alpha=1,r.albedoColor=new a.Color3(.3,.35,.4),r.renderBorders=!1,r.borderWidth=.5,r.edgeSmoothingValue=.02,r.borderMinValue=.1,r.renderHoverLight=!1,r.hoverRadius=1,r.hoverColor=new a.Color4(.3,.3,.3,1),r.hoverPosition=a.Vector3.Zero(),r}return n(e,t),e.prototype.needAlphaBlending=function(){return 1!==this.alpha},e.prototype.needAlphaTesting=function(){return!1},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.isReadyForSubMesh=function(t,e,i){if(this.isFrozen&&e.effect&&e.effect._wasPreviouslyReady)return!0;e._materialDefines||(e._materialDefines=new Ht);var r=this.getScene(),n=e._materialDefines;if(!this.checkReadyOnEveryCall&&e.effect&&n._renderId===r.getRenderId())return!0;if(n._areTexturesDirty)if(n.INNERGLOW=this.innerGlowColorIntensity>0,n.BORDER=this.renderBorders,n.HOVERLIGHT=this.renderHoverLight,this._albedoTexture){if(!this._albedoTexture.isReadyOrNotBlocking())return!1;n.TEXTURE=!0}else n.TEXTURE=!1;var o=r.getEngine();if(n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=[a.VertexBuffer.PositionKind];s.push(a.VertexBuffer.NormalKind),s.push(a.VertexBuffer.UVKind);var h=["world","viewProjection","innerGlowColor","albedoColor","borderWidth","edgeSmoothingValue","scaleFactor","borderMinValue","hoverColor","hoverPosition","hoverRadius"],u=["albedoSampler"],l=new Array;a.MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:h,uniformBuffersNames:l,samplers:u,defines:n,maxSimultaneousLights:4});var c=n.toString();e.setEffect(r.getEngine().createEffect("fluent",{attributes:s,uniformsNames:h,uniformBuffersNames:l,samplers:u,defines:c,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o))}return!(!e.effect||!e.effect.isReady())&&(n._renderId=r.getRenderId(),e.effect._wasPreviouslyReady=!0,!0)},e.prototype.bindForSubMesh=function(t,e,i){var r=this.getScene(),n=i._materialDefines;if(n){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(t),this._activeEffect.setMatrix("viewProjection",r.getTransformMatrix()),this._mustRebind(r,o)&&(this._activeEffect.setColor4("albedoColor",this.albedoColor,this.alpha),n.INNERGLOW&&this._activeEffect.setColor4("innerGlowColor",this.innerGlowColor,this.innerGlowColorIntensity),n.BORDER&&(this._activeEffect.setFloat("borderWidth",this.borderWidth),this._activeEffect.setFloat("edgeSmoothingValue",this.edgeSmoothingValue),this._activeEffect.setFloat("borderMinValue",this.borderMinValue),e.getBoundingInfo().boundingBox.extendSize.multiplyToRef(e.scaling,a.TmpVectors.Vector3[0]),this._activeEffect.setVector3("scaleFactor",a.TmpVectors.Vector3[0])),n.HOVERLIGHT&&(this._activeEffect.setDirectColor4("hoverColor",this.hoverColor),this._activeEffect.setFloat("hoverRadius",this.hoverRadius),this._activeEffect.setVector3("hoverPosition",this.hoverPosition)),n.TEXTURE&&this._activeEffect.setTexture("albedoSampler",this._albedoTexture)),this._afterBind(e,this._activeEffect))}},e.prototype.getActiveTextures=function(){return t.prototype.getActiveTextures.call(this)},e.prototype.hasTexture=function(e){return!!t.prototype.hasTexture.call(this,e)},e.prototype.dispose=function(e){t.prototype.dispose.call(this,e)},e.prototype.clone=function(t){var i=this;return a.SerializationHelper.Clone((function(){return new e(t,i.getScene())}),this)},e.prototype.serialize=function(){var t=a.SerializationHelper.Serialize(this);return t.customType="BABYLON.GUI.FluentMaterial",t},e.prototype.getClassName=function(){return"FluentMaterial"},e.Parse=function(t,i,r){return a.SerializationHelper.Parse((function(){return new e(t.name,i)}),t,i,r)},s([Object(a.serialize)(),Object(a.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"innerGlowColorIntensity",void 0),s([Object(a.serializeAsColor3)()],e.prototype,"innerGlowColor",void 0),s([Object(a.serialize)()],e.prototype,"alpha",void 0),s([Object(a.serializeAsColor3)()],e.prototype,"albedoColor",void 0),s([Object(a.serialize)(),Object(a.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"renderBorders",void 0),s([Object(a.serialize)()],e.prototype,"borderWidth",void 0),s([Object(a.serialize)()],e.prototype,"edgeSmoothingValue",void 0),s([Object(a.serialize)()],e.prototype,"borderMinValue",void 0),s([Object(a.serialize)(),Object(a.expandToProperty)("_markAllSubMeshesAsTexturesDirty")],e.prototype,"renderHoverLight",void 0),s([Object(a.serialize)()],e.prototype,"hoverRadius",void 0),s([Object(a.serializeAsColor4)()],e.prototype,"hoverColor",void 0),s([Object(a.serializeAsVector3)()],e.prototype,"hoverPosition",void 0),s([Object(a.serializeAsTexture)("albedoTexture")],e.prototype,"_albedoTexture",void 0),s([Object(a.expandToProperty)("_markAllSubMeshesAsTexturesAndMiscDirty")],e.prototype,"albedoTexture",void 0),e}(a.PushMaterial);a._TypeStore.RegisteredTypes["BABYLON.GUI.FluentMaterial"]=jt;var Ft=function(t){function e(e,i){void 0===i&&(i=!0);var r=t.call(this,e)||this;return r._shareMaterials=!0,r._shareMaterials=i,r.pointerEnterAnimation=function(){r.mesh&&r._frontPlate.setEnabled(!0)},r.pointerOutAnimation=function(){r.mesh&&r._frontPlate.setEnabled(!1)},r}return n(e,t),e.prototype._disposeTooltip=function(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)},Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._backPlate.renderingGroupId},set:function(t){this._backPlate.renderingGroupId=t,this._textPlate.renderingGroupId=t,this._frontPlate.renderingGroupId=t,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tooltipText",{get:function(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null},set:function(t){var e=this;if(t){if(!this._tooltipFade){this._tooltipMesh=a.PlaneBuilder.CreatePlane("",{size:1},this._backPlate._scene);var i=a.PlaneBuilder.CreatePlane("",{size:1,sideOrientation:a.Mesh.DOUBLESIDE},this._backPlate._scene),r=new a.StandardMaterial("",this._backPlate._scene);r.diffuseColor=a.Color3.FromHexString("#212121"),i.material=r,i.isPickable=!1,this._tooltipMesh.addChild(i),i.position.z=.05,this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position.y=.7,this._tooltipMesh.position.z=-.15,this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=Z.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new v,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new a.FadeInOutBehavior,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add((function(){e._tooltipFade&&e._tooltipFade.fadeIn(!0)})),this._tooltipOutObserver=this.onPointerOutObservable.add((function(){e._tooltipFade&&e._tooltipFade.fadeIn(!1)}))}this._tooltipTextBlock&&(this._tooltipTextBlock.text=t)}else this._disposeTooltip()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this._rebuildContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(t){this._imageUrl!==t&&(this._imageUrl=t,this._rebuildContent())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backMaterial",{get:function(){return this._backMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontMaterial",{get:function(){return this._frontMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plateMaterial",{get:function(){return this._plateMaterial},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shareMaterials",{get:function(){return this._shareMaterials},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(){return"HolographicButton"},e.prototype._rebuildContent=function(){this._disposeFacadeTexture();var t=new C;if(t.isVertical=!0,this._imageUrl){var e=new O;e.source=this._imageUrl,e.paddingTop="40px",e.height="180px",e.width="100px",e.paddingBottom="40px",t.addControl(e)}if(this._text){var i=new v;i.text=this._text,i.color="white",i.height="30px",i.fontSize=24,t.addControl(i)}this._frontPlate&&(this.content=t)},e.prototype._createNode=function(e){return this._backPlate=a.BoxBuilder.CreateBox(this.name+"BackMesh",{width:1,height:1,depth:.08},e),this._frontPlate=a.BoxBuilder.CreateBox(this.name+"FrontMesh",{width:1,height:1,depth:.08},e),this._frontPlate.parent=this._backPlate,this._frontPlate.position.z=-.08,this._frontPlate.isPickable=!1,this._frontPlate.setEnabled(!1),this._textPlate=t.prototype._createNode.call(this,e),this._textPlate.parent=this._backPlate,this._textPlate.position.z=-.08,this._textPlate.isPickable=!1,this._backPlate},e.prototype._applyFacade=function(t){this._plateMaterial.emissiveTexture=t,this._plateMaterial.opacityTexture=t},e.prototype._createBackMaterial=function(t){var e=this;this._backMaterial=new jt(this.name+"Back Material",t.getScene()),this._backMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add((function(t){t?(e._backMaterial.hoverPosition=t,e._backMaterial.hoverColor.a=1):e._backMaterial.hoverColor.a=0}))},e.prototype._createFrontMaterial=function(t){this._frontMaterial=new jt(this.name+"Front Material",t.getScene()),this._frontMaterial.innerGlowColorIntensity=0,this._frontMaterial.alpha=.5,this._frontMaterial.renderBorders=!0},e.prototype._createPlateMaterial=function(t){this._plateMaterial=new a.StandardMaterial(this.name+"Plate Material",t.getScene()),this._plateMaterial.specularColor=a.Color3.Black()},e.prototype._affectMaterial=function(t){this._shareMaterials?(this._host._sharedMaterials.backFluentMaterial?this._backMaterial=this._host._sharedMaterials.backFluentMaterial:(this._createBackMaterial(t),this._host._sharedMaterials.backFluentMaterial=this._backMaterial),this._host._sharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._sharedMaterials.frontFluentMaterial:(this._createFrontMaterial(t),this._host._sharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(t),this._createFrontMaterial(t)),this._createPlateMaterial(t),this._backPlate.material=this._backMaterial,this._frontPlate.material=this._frontMaterial,this._textPlate.material=this._plateMaterial,this._rebuildContent()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._disposeTooltip(),this.shareMaterials||(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))},e}(Rt),zt=function(t){function e(e,i){var r=t.call(this,i)||this;return r._currentMesh=e,r.pointerEnterAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(1.1)},r.pointerOutAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(1/1.1)},r.pointerDownAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(.95)},r.pointerUpAnimation=function(){r.mesh&&r.mesh.scaling.scaleInPlace(1/.95)},r}return n(e,t),e.prototype._getTypeName=function(){return"MeshButton3D"},e.prototype._createNode=function(t){var e=this;return this._currentMesh.getChildMeshes().forEach((function(t){t.metadata=e})),this._currentMesh},e.prototype._affectMaterial=function(t){},e}(Rt),Wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._mapGridNode=function(t,e){var i=t.mesh;if(i){t.position=e.clone();var r=a.TmpVectors.Vector3[0];switch(r.copyFrom(e),this.orientation){case Lt.FACEORIGIN_ORIENTATION:case Lt.FACEFORWARD_ORIENTATION:r.addInPlace(new a.Vector3(0,0,1)),i.lookAt(r);break;case Lt.FACEFORWARDREVERSED_ORIENTATION:case Lt.FACEORIGINREVERSED_ORIENTATION:r.addInPlace(new a.Vector3(0,0,-1)),i.lookAt(r)}}},e}(Dt),Gt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._iteration=100,e}return n(e,t),Object.defineProperty(e.prototype,"iteration",{get:function(){return this._iteration},set:function(t){var e=this;this._iteration!==t&&(this._iteration=t,a.Tools.SetImmediate((function(){e._arrangeChildren()})))},enumerable:!0,configurable:!0}),e.prototype._mapGridNode=function(t,e){var i=t.mesh,r=this._scatterMapping(e);if(i){switch(this.orientation){case Lt.FACEORIGIN_ORIENTATION:case Lt.FACEFORWARD_ORIENTATION:i.lookAt(new a.Vector3(0,0,1));break;case Lt.FACEFORWARDREVERSED_ORIENTATION:case Lt.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new a.Vector3(0,0,-1))}t.position=r}},e.prototype._scatterMapping=function(t){return t.x=(1-2*Math.random())*this._cellWidth,t.y=(1-2*Math.random())*this._cellHeight,t},e.prototype._finalProcessing=function(){for(var t=[],e=0,i=this._children;e<i.length;e++){var r=i[e];r.mesh&&t.push(r.mesh)}for(var n=0;n<this._iteration;n++){t.sort((function(t,e){var i=t.position.lengthSquared(),r=e.position.lengthSquared();return i<r?1:i>r?-1:0}));for(var o=Math.pow(this.margin,2),s=Math.max(this._cellWidth,this._cellHeight),h=a.TmpVectors.Vector2[0],u=a.TmpVectors.Vector3[0],l=0;l<t.length-1;l++)for(var c=l+1;c<t.length;c++)if(l!=c){t[c].position.subtractToRef(t[l].position,u),h.x=u.x,h.y=u.y;var f=s,_=h.lengthSquared()-o;(_-=Math.min(_,o))<Math.pow(f,2)&&(h.normalize(),u.scaleInPlace(.5*(f-Math.sqrt(_))),t[c].position.addInPlace(u),t[l].position.subtractInPlace(u))}}},e}(Dt),Ut=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._radius=5,e}return n(e,t),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(t){var e=this;this._radius!==t&&(this._radius=t,a.Tools.SetImmediate((function(){e._arrangeChildren()})))},enumerable:!0,configurable:!0}),e.prototype._mapGridNode=function(t,e){var i=t.mesh;if(i){var r=this._sphericalMapping(e);switch(t.position=r,this.orientation){case Lt.FACEORIGIN_ORIENTATION:i.lookAt(new a.Vector3(2*r.x,2*r.y,2*r.z));break;case Lt.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new a.Vector3(-r.x,-r.y,-r.z));break;case Lt.FACEFORWARD_ORIENTATION:break;case Lt.FACEFORWARDREVERSED_ORIENTATION:i.rotate(a.Axis.Y,Math.PI,a.Space.LOCAL)}}},e.prototype._sphericalMapping=function(t){var e=new a.Vector3(0,0,this._radius),i=t.y/this._radius,r=-t.x/this._radius;return a.Matrix.RotationYawPitchRollToRef(r,i,0,a.TmpVectors.Matrix[0]),a.Vector3.TransformNormal(e,a.TmpVectors.Matrix[0])},e}(Dt),Xt=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i._isVertical=!1,i.margin=.1,i._isVertical=e,i}return n(e,t),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this._isVertical},set:function(t){var e=this;this._isVertical!==t&&(this._isVertical=t,a.Tools.SetImmediate((function(){e._arrangeChildren()})))},enumerable:!0,configurable:!0}),e.prototype._arrangeChildren=function(){for(var t,e=0,i=0,r=0,n=[],o=a.Matrix.Invert(this.node.computeWorldMatrix(!0)),s=0,h=this._children;s<h.length;s++){if((d=h[s]).mesh){r++,d.mesh.computeWorldMatrix(!0),d.mesh.getWorldMatrix().multiplyToRef(o,a.TmpVectors.Matrix[0]);var u=d.mesh.getBoundingInfo().boundingBox,l=a.Vector3.TransformNormal(u.extendSize,a.TmpVectors.Matrix[0]);n.push(l),this._isVertical?i+=l.y:e+=l.x}}this._isVertical?i+=(r-1)*this.margin/2:e+=(r-1)*this.margin/2,t=this._isVertical?-i:-e;for(var c=0,f=0,_=this._children;f<_.length;f++){var d;if((d=_[f]).mesh){r--;l=n[c++];this._isVertical?(d.position.y=t+l.y,d.position.x=0,t+=2*l.y):(d.position.x=t+l.x,d.position.y=0,t+=2*l.x),t+=r>0?this.margin:0}}},e}(Lt),Yt=function(){function t(t){var e=this;this._lastControlOver={},this._lastControlDown={},this.onPickedPointChangedObservable=new a.Observable,this._sharedMaterials={},this._scene=t||a.EngineStore.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add((function(){e._sceneDisposeObserver=null,e._utilityLayer=null,e.dispose()})),this._utilityLayer=new a.UtilityLayerRenderer(this._scene),this._utilityLayer.onlyCheckPointerDownEvents=!1,this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.mainSceneTrackerPredicate=function(t){return t&&t.metadata&&t.metadata._node},this._rootContainer=new Lt("RootContainer"),this._rootContainer._host=this;var i=this._utilityLayer.utilityLayerScene;this._pointerOutObserver=this._utilityLayer.onPointerOutObservable.add((function(t){e._handlePointerOut(t,!0)})),this._pointerObserver=i.onPointerObservable.add((function(t,i){e._doPicking(t)})),this._utilityLayer.utilityLayerScene.autoClear=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,new a.HemisphericLight("hemi",a.Vector3.Up(),this._utilityLayer.utilityLayerScene)}return Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!0,configurable:!0}),t.prototype._handlePointerOut=function(t,e){var i=this._lastControlOver[t];i&&(i._onPointerOut(i),delete this._lastControlOver[t]),e&&this._lastControlDown[t]&&(this._lastControlDown[t].forcePointerUp(),delete this._lastControlDown[t]),this.onPickedPointChangedObservable.notifyObservers(null)},t.prototype._doPicking=function(t){if(!this._utilityLayer||!this._utilityLayer.shouldRender||!this._utilityLayer.utilityLayerScene.activeCamera)return!1;var e=t.event,i=e.pointerId||0,r=e.button,n=t.pickInfo;if(!n||!n.hit)return this._handlePointerOut(i,t.type===a.PointerEventTypes.POINTERUP),!1;var o=n.pickedMesh.metadata;return n.pickedPoint&&this.onPickedPointChangedObservable.notifyObservers(n.pickedPoint),o._processObservables(t.type,n.pickedPoint,i,r)||t.type===a.PointerEventTypes.POINTERMOVE&&(this._lastControlOver[i]&&this._lastControlOver[i]._onPointerOut(this._lastControlOver[i]),delete this._lastControlOver[i]),t.type===a.PointerEventTypes.POINTERUP&&(this._lastControlDown[e.pointerId]&&(this._lastControlDown[e.pointerId].forcePointerUp(),delete this._lastControlDown[e.pointerId]),"touch"===e.pointerType&&this._handlePointerOut(i,!1)),!0},Object.defineProperty(t.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!0,configurable:!0}),t.prototype.containsControl=function(t){return this._rootContainer.containsControl(t)},t.prototype.addControl=function(t){return this._rootContainer.addControl(t),this},t.prototype.removeControl=function(t){return this._rootContainer.removeControl(t),this},t.prototype.dispose=function(){for(var t in this._rootContainer.dispose(),this._sharedMaterials)this._sharedMaterials.hasOwnProperty(t)&&this._sharedMaterials[t].dispose();this._sharedMaterials={},this._pointerOutObserver&&this._utilityLayer&&(this._utilityLayer.onPointerOutObservable.remove(this._pointerOutObserver),this._pointerOutObserver=null),this.onPickedPointChangedObservable.clear();var e=this._utilityLayer?this._utilityLayer.utilityLayerScene:null;e&&this._pointerObserver&&(e.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=null),this._scene&&this._sceneDisposeObserver&&(this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null),this._utilityLayer&&this._utilityLayer.dispose()},t}();i.d(e,"AdvancedDynamicTexture",(function(){return Z})),i.d(e,"AdvancedDynamicTextureInstrumentation",(function(){return $})),i.d(e,"Vector2WithInfo",(function(){return d})),i.d(e,"Matrix2D",(function(){return p})),i.d(e,"Measure",(function(){return _})),i.d(e,"MultiLinePoint",(function(){return S})),i.d(e,"Style",(function(){return K})),i.d(e,"ValueAndUnit",(function(){return h})),i.d(e,"XmlLoader",(function(){return J})),i.d(e,"MyTest",(function(){return It})),i.d(e,"Button",(function(){return w})),i.d(e,"Checkbox",(function(){return x})),i.d(e,"ColorPicker",(function(){return M})),i.d(e,"Container",(function(){return m})),i.d(e,"Control",(function(){return g})),i.d(e,"Ellipse",(function(){return k})),i.d(e,"Grid",(function(){return P})),i.d(e,"Image",(function(){return O})),i.d(e,"InputText",(function(){return T})),i.d(e,"InputPassword",(function(){return I})),i.d(e,"Line",(function(){return A})),i.d(e,"MultiLine",(function(){return E})),i.d(e,"RadioButton",(function(){return R})),i.d(e,"StackPanel",(function(){return C})),i.d(e,"SelectorGroup",(function(){return N})),i.d(e,"CheckboxGroup",(function(){return B})),i.d(e,"RadioGroup",(function(){return V})),i.d(e,"SliderGroup",(function(){return H})),i.d(e,"SelectionPanel",(function(){return j})),i.d(e,"ScrollViewer",(function(){return G})),i.d(e,"TextWrapping",(function(){return b})),i.d(e,"TextBlock",(function(){return v})),i.d(e,"KeyPropertySet",(function(){return U})),i.d(e,"VirtualKeyboard",(function(){return X})),i.d(e,"Rectangle",(function(){return y})),i.d(e,"DisplayGrid",(function(){return Y})),i.d(e,"BaseSlider",(function(){return L})),i.d(e,"Slider",(function(){return D})),i.d(e,"ImageBasedSlider",(function(){return q})),i.d(e,"ScrollBar",(function(){return z})),i.d(e,"ImageScrollBar",(function(){return W})),i.d(e,"name",(function(){return"Statics"})),i.d(e,"GUI3DManager",(function(){return Yt})),i.d(e,"Vector3WithInfo",(function(){return At})),i.d(e,"AbstractButton3D",(function(){return Et})),i.d(e,"Button3D",(function(){return Rt})),i.d(e,"Container3D",(function(){return Lt})),i.d(e,"Control3D",(function(){return St})),i.d(e,"CylinderPanel",(function(){return Nt})),i.d(e,"HolographicButton",(function(){return Ft})),i.d(e,"MeshButton3D",(function(){return zt})),i.d(e,"PlanePanel",(function(){return Wt})),i.d(e,"ScatterPanel",(function(){return Gt})),i.d(e,"SpherePanel",(function(){return Ut})),i.d(e,"StackPanel3D",(function(){return Xt})),i.d(e,"VolumeBasedPanel",(function(){return Dt})),i.d(e,"FluentMaterialDefines",(function(){return Ht})),i.d(e,"FluentMaterial",(function(){return jt}))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";i.r(e),function(t){var r=i(2);i.d(e,"AdvancedDynamicTexture",(function(){return r.AdvancedDynamicTexture})),i.d(e,"AdvancedDynamicTextureInstrumentation",(function(){return r.AdvancedDynamicTextureInstrumentation})),i.d(e,"Vector2WithInfo",(function(){return r.Vector2WithInfo})),i.d(e,"Matrix2D",(function(){return r.Matrix2D})),i.d(e,"Measure",(function(){return r.Measure})),i.d(e,"MultiLinePoint",(function(){return r.MultiLinePoint})),i.d(e,"Style",(function(){return r.Style})),i.d(e,"ValueAndUnit",(function(){return r.ValueAndUnit})),i.d(e,"XmlLoader",(function(){return r.XmlLoader})),i.d(e,"MyTest",(function(){return r.MyTest})),i.d(e,"GUI3DManager",(function(){return r.GUI3DManager})),i.d(e,"Vector3WithInfo",(function(){return r.Vector3WithInfo})),i.d(e,"Button",(function(){return r.Button})),i.d(e,"Checkbox",(function(){return r.Checkbox})),i.d(e,"ColorPicker",(function(){return r.ColorPicker})),i.d(e,"Container",(function(){return r.Container})),i.d(e,"Control",(function(){return r.Control})),i.d(e,"Ellipse",(function(){return r.Ellipse})),i.d(e,"Grid",(function(){return r.Grid})),i.d(e,"Image",(function(){return r.Image})),i.d(e,"InputText",(function(){return r.InputText})),i.d(e,"InputPassword",(function(){return r.InputPassword})),i.d(e,"Line",(function(){return r.Line})),i.d(e,"MultiLine",(function(){return r.MultiLine})),i.d(e,"RadioButton",(function(){return r.RadioButton})),i.d(e,"StackPanel",(function(){return r.StackPanel})),i.d(e,"SelectorGroup",(function(){return r.SelectorGroup})),i.d(e,"CheckboxGroup",(function(){return r.CheckboxGroup})),i.d(e,"RadioGroup",(function(){return r.RadioGroup})),i.d(e,"SliderGroup",(function(){return r.SliderGroup})),i.d(e,"SelectionPanel",(function(){return r.SelectionPanel})),i.d(e,"ScrollViewer",(function(){return r.ScrollViewer})),i.d(e,"TextWrapping",(function(){return r.TextWrapping})),i.d(e,"TextBlock",(function(){return r.TextBlock})),i.d(e,"KeyPropertySet",(function(){return r.KeyPropertySet})),i.d(e,"VirtualKeyboard",(function(){return r.VirtualKeyboard})),i.d(e,"Rectangle",(function(){return r.Rectangle})),i.d(e,"DisplayGrid",(function(){return r.DisplayGrid})),i.d(e,"BaseSlider",(function(){return r.BaseSlider})),i.d(e,"Slider",(function(){return r.Slider})),i.d(e,"ImageBasedSlider",(function(){return r.ImageBasedSlider})),i.d(e,"ScrollBar",(function(){return r.ScrollBar})),i.d(e,"ImageScrollBar",(function(){return r.ImageScrollBar})),i.d(e,"name",(function(){return r.name})),i.d(e,"AbstractButton3D",(function(){return r.AbstractButton3D})),i.d(e,"Button3D",(function(){return r.Button3D})),i.d(e,"Container3D",(function(){return r.Container3D})),i.d(e,"Control3D",(function(){return r.Control3D})),i.d(e,"CylinderPanel",(function(){return r.CylinderPanel})),i.d(e,"HolographicButton",(function(){return r.HolographicButton})),i.d(e,"MeshButton3D",(function(){return r.MeshButton3D})),i.d(e,"PlanePanel",(function(){return r.PlanePanel})),i.d(e,"ScatterPanel",(function(){return r.ScatterPanel})),i.d(e,"SpherePanel",(function(){return r.SpherePanel})),i.d(e,"StackPanel3D",(function(){return r.StackPanel3D})),i.d(e,"VolumeBasedPanel",(function(){return r.VolumeBasedPanel})),i.d(e,"FluentMaterialDefines",(function(){return r.FluentMaterialDefines})),i.d(e,"FluentMaterial",(function(){return r.FluentMaterial}));var n=void 0!==t?t:"undefined"!=typeof window?window:void 0;void 0!==n&&(n.BABYLON=n.BABYLON||{},n.BABYLON.GUI=r)}.call(this,i(3))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}}])}));
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ "./node_modules/webpack/buildin/global.js")))

/***/ }),

/***/ "./node_modules/fast-memoize/src/index.js":
/*!************************************************!*\
  !*** ./node_modules/fast-memoize/src/index.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

//
// Main
//

function memoize (fn, options) {
  var cache = options && options.cache
    ? options.cache
    : cacheDefault

  var serializer = options && options.serializer
    ? options.serializer
    : serializerDefault

  var strategy = options && options.strategy
    ? options.strategy
    : strategyDefault

  return strategy(fn, {
    cache: cache,
    serializer: serializer
  })
}

//
// Strategy
//

function isPrimitive (value) {
  return value == null || typeof value === 'number' || typeof value === 'boolean' // || typeof value === "string" 'unsafe' primitive for our needs
}

function monadic (fn, cache, serializer, arg) {
  var cacheKey = isPrimitive(arg) ? arg : serializer(arg)

  var computedValue = cache.get(cacheKey)
  if (typeof computedValue === 'undefined') {
    computedValue = fn.call(this, arg)
    cache.set(cacheKey, computedValue)
  }

  return computedValue
}

function variadic (fn, cache, serializer) {
  var args = Array.prototype.slice.call(arguments, 3)
  var cacheKey = serializer(args)

  var computedValue = cache.get(cacheKey)
  if (typeof computedValue === 'undefined') {
    computedValue = fn.apply(this, args)
    cache.set(cacheKey, computedValue)
  }

  return computedValue
}

function assemble (fn, context, strategy, cache, serialize) {
  return strategy.bind(
    context,
    fn,
    cache,
    serialize
  )
}

function strategyDefault (fn, options) {
  var strategy = fn.length === 1 ? monadic : variadic

  return assemble(
    fn,
    this,
    strategy,
    options.cache.create(),
    options.serializer
  )
}

function strategyVariadic (fn, options) {
  var strategy = variadic

  return assemble(
    fn,
    this,
    strategy,
    options.cache.create(),
    options.serializer
  )
}

function strategyMonadic (fn, options) {
  var strategy = monadic

  return assemble(
    fn,
    this,
    strategy,
    options.cache.create(),
    options.serializer
  )
}

//
// Serializer
//

function serializerDefault () {
  return JSON.stringify(arguments)
}

//
// Cache
//

function ObjectWithoutPrototypeCache () {
  this.cache = Object.create(null)
}

ObjectWithoutPrototypeCache.prototype.has = function (key) {
  return (key in this.cache)
}

ObjectWithoutPrototypeCache.prototype.get = function (key) {
  return this.cache[key]
}

ObjectWithoutPrototypeCache.prototype.set = function (key, value) {
  this.cache[key] = value
}

var cacheDefault = {
  create: function create () {
    return new ObjectWithoutPrototypeCache()
  }
}

//
// API
//

module.exports = memoize
module.exports.strategies = {
  variadic: strategyVariadic,
  monadic: strategyMonadic
}


/***/ }),

/***/ "./node_modules/lodash/lodash.js":
/*!***************************************!*\
  !*** ./node_modules/lodash/lodash.js ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(global, module) {var __WEBPACK_AMD_DEFINE_RESULT__;/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
;(function() {

  /** Used as a safe reference for `undefined` in pre-ES5 environments. */
  var undefined;

  /** Used as the semantic version number. */
  var VERSION = '4.17.15';

  /** Used as the size to enable large array optimizations. */
  var LARGE_ARRAY_SIZE = 200;

  /** Error message constants. */
  var CORE_ERROR_TEXT = 'Unsupported core-js use. Try https://npms.io/search?q=ponyfill.',
      FUNC_ERROR_TEXT = 'Expected a function';

  /** Used to stand-in for `undefined` hash values. */
  var HASH_UNDEFINED = '__lodash_hash_undefined__';

  /** Used as the maximum memoize cache size. */
  var MAX_MEMOIZE_SIZE = 500;

  /** Used as the internal argument placeholder. */
  var PLACEHOLDER = '__lodash_placeholder__';

  /** Used to compose bitmasks for cloning. */
  var CLONE_DEEP_FLAG = 1,
      CLONE_FLAT_FLAG = 2,
      CLONE_SYMBOLS_FLAG = 4;

  /** Used to compose bitmasks for value comparisons. */
  var COMPARE_PARTIAL_FLAG = 1,
      COMPARE_UNORDERED_FLAG = 2;

  /** Used to compose bitmasks for function metadata. */
  var WRAP_BIND_FLAG = 1,
      WRAP_BIND_KEY_FLAG = 2,
      WRAP_CURRY_BOUND_FLAG = 4,
      WRAP_CURRY_FLAG = 8,
      WRAP_CURRY_RIGHT_FLAG = 16,
      WRAP_PARTIAL_FLAG = 32,
      WRAP_PARTIAL_RIGHT_FLAG = 64,
      WRAP_ARY_FLAG = 128,
      WRAP_REARG_FLAG = 256,
      WRAP_FLIP_FLAG = 512;

  /** Used as default options for `_.truncate`. */
  var DEFAULT_TRUNC_LENGTH = 30,
      DEFAULT_TRUNC_OMISSION = '...';

  /** Used to detect hot functions by number of calls within a span of milliseconds. */
  var HOT_COUNT = 800,
      HOT_SPAN = 16;

  /** Used to indicate the type of lazy iteratees. */
  var LAZY_FILTER_FLAG = 1,
      LAZY_MAP_FLAG = 2,
      LAZY_WHILE_FLAG = 3;

  /** Used as references for various `Number` constants. */
  var INFINITY = 1 / 0,
      MAX_SAFE_INTEGER = 9007199254740991,
      MAX_INTEGER = 1.7976931348623157e+308,
      NAN = 0 / 0;

  /** Used as references for the maximum length and index of an array. */
  var MAX_ARRAY_LENGTH = 4294967295,
      MAX_ARRAY_INDEX = MAX_ARRAY_LENGTH - 1,
      HALF_MAX_ARRAY_LENGTH = MAX_ARRAY_LENGTH >>> 1;

  /** Used to associate wrap methods with their bit flags. */
  var wrapFlags = [
    ['ary', WRAP_ARY_FLAG],
    ['bind', WRAP_BIND_FLAG],
    ['bindKey', WRAP_BIND_KEY_FLAG],
    ['curry', WRAP_CURRY_FLAG],
    ['curryRight', WRAP_CURRY_RIGHT_FLAG],
    ['flip', WRAP_FLIP_FLAG],
    ['partial', WRAP_PARTIAL_FLAG],
    ['partialRight', WRAP_PARTIAL_RIGHT_FLAG],
    ['rearg', WRAP_REARG_FLAG]
  ];

  /** `Object#toString` result references. */
  var argsTag = '[object Arguments]',
      arrayTag = '[object Array]',
      asyncTag = '[object AsyncFunction]',
      boolTag = '[object Boolean]',
      dateTag = '[object Date]',
      domExcTag = '[object DOMException]',
      errorTag = '[object Error]',
      funcTag = '[object Function]',
      genTag = '[object GeneratorFunction]',
      mapTag = '[object Map]',
      numberTag = '[object Number]',
      nullTag = '[object Null]',
      objectTag = '[object Object]',
      promiseTag = '[object Promise]',
      proxyTag = '[object Proxy]',
      regexpTag = '[object RegExp]',
      setTag = '[object Set]',
      stringTag = '[object String]',
      symbolTag = '[object Symbol]',
      undefinedTag = '[object Undefined]',
      weakMapTag = '[object WeakMap]',
      weakSetTag = '[object WeakSet]';

  var arrayBufferTag = '[object ArrayBuffer]',
      dataViewTag = '[object DataView]',
      float32Tag = '[object Float32Array]',
      float64Tag = '[object Float64Array]',
      int8Tag = '[object Int8Array]',
      int16Tag = '[object Int16Array]',
      int32Tag = '[object Int32Array]',
      uint8Tag = '[object Uint8Array]',
      uint8ClampedTag = '[object Uint8ClampedArray]',
      uint16Tag = '[object Uint16Array]',
      uint32Tag = '[object Uint32Array]';

  /** Used to match empty string literals in compiled template source. */
  var reEmptyStringLeading = /\b__p \+= '';/g,
      reEmptyStringMiddle = /\b(__p \+=) '' \+/g,
      reEmptyStringTrailing = /(__e\(.*?\)|\b__t\)) \+\n'';/g;

  /** Used to match HTML entities and HTML characters. */
  var reEscapedHtml = /&(?:amp|lt|gt|quot|#39);/g,
      reUnescapedHtml = /[&<>"']/g,
      reHasEscapedHtml = RegExp(reEscapedHtml.source),
      reHasUnescapedHtml = RegExp(reUnescapedHtml.source);

  /** Used to match template delimiters. */
  var reEscape = /<%-([\s\S]+?)%>/g,
      reEvaluate = /<%([\s\S]+?)%>/g,
      reInterpolate = /<%=([\s\S]+?)%>/g;

  /** Used to match property names within property paths. */
  var reIsDeepProp = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,
      reIsPlainProp = /^\w*$/,
      rePropName = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;

  /**
   * Used to match `RegExp`
   * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).
   */
  var reRegExpChar = /[\\^$.*+?()[\]{}|]/g,
      reHasRegExpChar = RegExp(reRegExpChar.source);

  /** Used to match leading and trailing whitespace. */
  var reTrim = /^\s+|\s+$/g,
      reTrimStart = /^\s+/,
      reTrimEnd = /\s+$/;

  /** Used to match wrap detail comments. */
  var reWrapComment = /\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,
      reWrapDetails = /\{\n\/\* \[wrapped with (.+)\] \*/,
      reSplitDetails = /,? & /;

  /** Used to match words composed of alphanumeric characters. */
  var reAsciiWord = /[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;

  /** Used to match backslashes in property paths. */
  var reEscapeChar = /\\(\\)?/g;

  /**
   * Used to match
   * [ES template delimiters](http://ecma-international.org/ecma-262/7.0/#sec-template-literal-lexical-components).
   */
  var reEsTemplate = /\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;

  /** Used to match `RegExp` flags from their coerced string values. */
  var reFlags = /\w*$/;

  /** Used to detect bad signed hexadecimal string values. */
  var reIsBadHex = /^[-+]0x[0-9a-f]+$/i;

  /** Used to detect binary string values. */
  var reIsBinary = /^0b[01]+$/i;

  /** Used to detect host constructors (Safari). */
  var reIsHostCtor = /^\[object .+?Constructor\]$/;

  /** Used to detect octal string values. */
  var reIsOctal = /^0o[0-7]+$/i;

  /** Used to detect unsigned integer values. */
  var reIsUint = /^(?:0|[1-9]\d*)$/;

  /** Used to match Latin Unicode letters (excluding mathematical operators). */
  var reLatin = /[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;

  /** Used to ensure capturing order of template delimiters. */
  var reNoMatch = /($^)/;

  /** Used to match unescaped characters in compiled string literals. */
  var reUnescapedString = /['\n\r\u2028\u2029\\]/g;

  /** Used to compose unicode character classes. */
  var rsAstralRange = '\\ud800-\\udfff',
      rsComboMarksRange = '\\u0300-\\u036f',
      reComboHalfMarksRange = '\\ufe20-\\ufe2f',
      rsComboSymbolsRange = '\\u20d0-\\u20ff',
      rsComboRange = rsComboMarksRange + reComboHalfMarksRange + rsComboSymbolsRange,
      rsDingbatRange = '\\u2700-\\u27bf',
      rsLowerRange = 'a-z\\xdf-\\xf6\\xf8-\\xff',
      rsMathOpRange = '\\xac\\xb1\\xd7\\xf7',
      rsNonCharRange = '\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf',
      rsPunctuationRange = '\\u2000-\\u206f',
      rsSpaceRange = ' \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000',
      rsUpperRange = 'A-Z\\xc0-\\xd6\\xd8-\\xde',
      rsVarRange = '\\ufe0e\\ufe0f',
      rsBreakRange = rsMathOpRange + rsNonCharRange + rsPunctuationRange + rsSpaceRange;

  /** Used to compose unicode capture groups. */
  var rsApos = "['\u2019]",
      rsAstral = '[' + rsAstralRange + ']',
      rsBreak = '[' + rsBreakRange + ']',
      rsCombo = '[' + rsComboRange + ']',
      rsDigits = '\\d+',
      rsDingbat = '[' + rsDingbatRange + ']',
      rsLower = '[' + rsLowerRange + ']',
      rsMisc = '[^' + rsAstralRange + rsBreakRange + rsDigits + rsDingbatRange + rsLowerRange + rsUpperRange + ']',
      rsFitz = '\\ud83c[\\udffb-\\udfff]',
      rsModifier = '(?:' + rsCombo + '|' + rsFitz + ')',
      rsNonAstral = '[^' + rsAstralRange + ']',
      rsRegional = '(?:\\ud83c[\\udde6-\\uddff]){2}',
      rsSurrPair = '[\\ud800-\\udbff][\\udc00-\\udfff]',
      rsUpper = '[' + rsUpperRange + ']',
      rsZWJ = '\\u200d';

  /** Used to compose unicode regexes. */
  var rsMiscLower = '(?:' + rsLower + '|' + rsMisc + ')',
      rsMiscUpper = '(?:' + rsUpper + '|' + rsMisc + ')',
      rsOptContrLower = '(?:' + rsApos + '(?:d|ll|m|re|s|t|ve))?',
      rsOptContrUpper = '(?:' + rsApos + '(?:D|LL|M|RE|S|T|VE))?',
      reOptMod = rsModifier + '?',
      rsOptVar = '[' + rsVarRange + ']?',
      rsOptJoin = '(?:' + rsZWJ + '(?:' + [rsNonAstral, rsRegional, rsSurrPair].join('|') + ')' + rsOptVar + reOptMod + ')*',
      rsOrdLower = '\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])',
      rsOrdUpper = '\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])',
      rsSeq = rsOptVar + reOptMod + rsOptJoin,
      rsEmoji = '(?:' + [rsDingbat, rsRegional, rsSurrPair].join('|') + ')' + rsSeq,
      rsSymbol = '(?:' + [rsNonAstral + rsCombo + '?', rsCombo, rsRegional, rsSurrPair, rsAstral].join('|') + ')';

  /** Used to match apostrophes. */
  var reApos = RegExp(rsApos, 'g');

  /**
   * Used to match [combining diacritical marks](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks) and
   * [combining diacritical marks for symbols](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks_for_Symbols).
   */
  var reComboMark = RegExp(rsCombo, 'g');

  /** Used to match [string symbols](https://mathiasbynens.be/notes/javascript-unicode). */
  var reUnicode = RegExp(rsFitz + '(?=' + rsFitz + ')|' + rsSymbol + rsSeq, 'g');

  /** Used to match complex or compound words. */
  var reUnicodeWord = RegExp([
    rsUpper + '?' + rsLower + '+' + rsOptContrLower + '(?=' + [rsBreak, rsUpper, '$'].join('|') + ')',
    rsMiscUpper + '+' + rsOptContrUpper + '(?=' + [rsBreak, rsUpper + rsMiscLower, '$'].join('|') + ')',
    rsUpper + '?' + rsMiscLower + '+' + rsOptContrLower,
    rsUpper + '+' + rsOptContrUpper,
    rsOrdUpper,
    rsOrdLower,
    rsDigits,
    rsEmoji
  ].join('|'), 'g');

  /** Used to detect strings with [zero-width joiners or code points from the astral planes](http://eev.ee/blog/2015/09/12/dark-corners-of-unicode/). */
  var reHasUnicode = RegExp('[' + rsZWJ + rsAstralRange  + rsComboRange + rsVarRange + ']');

  /** Used to detect strings that need a more robust regexp to match words. */
  var reHasUnicodeWord = /[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;

  /** Used to assign default `context` object properties. */
  var contextProps = [
    'Array', 'Buffer', 'DataView', 'Date', 'Error', 'Float32Array', 'Float64Array',
    'Function', 'Int8Array', 'Int16Array', 'Int32Array', 'Map', 'Math', 'Object',
    'Promise', 'RegExp', 'Set', 'String', 'Symbol', 'TypeError', 'Uint8Array',
    'Uint8ClampedArray', 'Uint16Array', 'Uint32Array', 'WeakMap',
    '_', 'clearTimeout', 'isFinite', 'parseInt', 'setTimeout'
  ];

  /** Used to make template sourceURLs easier to identify. */
  var templateCounter = -1;

  /** Used to identify `toStringTag` values of typed arrays. */
  var typedArrayTags = {};
  typedArrayTags[float32Tag] = typedArrayTags[float64Tag] =
  typedArrayTags[int8Tag] = typedArrayTags[int16Tag] =
  typedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =
  typedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =
  typedArrayTags[uint32Tag] = true;
  typedArrayTags[argsTag] = typedArrayTags[arrayTag] =
  typedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =
  typedArrayTags[dataViewTag] = typedArrayTags[dateTag] =
  typedArrayTags[errorTag] = typedArrayTags[funcTag] =
  typedArrayTags[mapTag] = typedArrayTags[numberTag] =
  typedArrayTags[objectTag] = typedArrayTags[regexpTag] =
  typedArrayTags[setTag] = typedArrayTags[stringTag] =
  typedArrayTags[weakMapTag] = false;

  /** Used to identify `toStringTag` values supported by `_.clone`. */
  var cloneableTags = {};
  cloneableTags[argsTag] = cloneableTags[arrayTag] =
  cloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =
  cloneableTags[boolTag] = cloneableTags[dateTag] =
  cloneableTags[float32Tag] = cloneableTags[float64Tag] =
  cloneableTags[int8Tag] = cloneableTags[int16Tag] =
  cloneableTags[int32Tag] = cloneableTags[mapTag] =
  cloneableTags[numberTag] = cloneableTags[objectTag] =
  cloneableTags[regexpTag] = cloneableTags[setTag] =
  cloneableTags[stringTag] = cloneableTags[symbolTag] =
  cloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =
  cloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;
  cloneableTags[errorTag] = cloneableTags[funcTag] =
  cloneableTags[weakMapTag] = false;

  /** Used to map Latin Unicode letters to basic Latin letters. */
  var deburredLetters = {
    // Latin-1 Supplement block.
    '\xc0': 'A',  '\xc1': 'A', '\xc2': 'A', '\xc3': 'A', '\xc4': 'A', '\xc5': 'A',
    '\xe0': 'a',  '\xe1': 'a', '\xe2': 'a', '\xe3': 'a', '\xe4': 'a', '\xe5': 'a',
    '\xc7': 'C',  '\xe7': 'c',
    '\xd0': 'D',  '\xf0': 'd',
    '\xc8': 'E',  '\xc9': 'E', '\xca': 'E', '\xcb': 'E',
    '\xe8': 'e',  '\xe9': 'e', '\xea': 'e', '\xeb': 'e',
    '\xcc': 'I',  '\xcd': 'I', '\xce': 'I', '\xcf': 'I',
    '\xec': 'i',  '\xed': 'i', '\xee': 'i', '\xef': 'i',
    '\xd1': 'N',  '\xf1': 'n',
    '\xd2': 'O',  '\xd3': 'O', '\xd4': 'O', '\xd5': 'O', '\xd6': 'O', '\xd8': 'O',
    '\xf2': 'o',  '\xf3': 'o', '\xf4': 'o', '\xf5': 'o', '\xf6': 'o', '\xf8': 'o',
    '\xd9': 'U',  '\xda': 'U', '\xdb': 'U', '\xdc': 'U',
    '\xf9': 'u',  '\xfa': 'u', '\xfb': 'u', '\xfc': 'u',
    '\xdd': 'Y',  '\xfd': 'y', '\xff': 'y',
    '\xc6': 'Ae', '\xe6': 'ae',
    '\xde': 'Th', '\xfe': 'th',
    '\xdf': 'ss',
    // Latin Extended-A block.
    '\u0100': 'A',  '\u0102': 'A', '\u0104': 'A',
    '\u0101': 'a',  '\u0103': 'a', '\u0105': 'a',
    '\u0106': 'C',  '\u0108': 'C', '\u010a': 'C', '\u010c': 'C',
    '\u0107': 'c',  '\u0109': 'c', '\u010b': 'c', '\u010d': 'c',
    '\u010e': 'D',  '\u0110': 'D', '\u010f': 'd', '\u0111': 'd',
    '\u0112': 'E',  '\u0114': 'E', '\u0116': 'E', '\u0118': 'E', '\u011a': 'E',
    '\u0113': 'e',  '\u0115': 'e', '\u0117': 'e', '\u0119': 'e', '\u011b': 'e',
    '\u011c': 'G',  '\u011e': 'G', '\u0120': 'G', '\u0122': 'G',
    '\u011d': 'g',  '\u011f': 'g', '\u0121': 'g', '\u0123': 'g',
    '\u0124': 'H',  '\u0126': 'H', '\u0125': 'h', '\u0127': 'h',
    '\u0128': 'I',  '\u012a': 'I', '\u012c': 'I', '\u012e': 'I', '\u0130': 'I',
    '\u0129': 'i',  '\u012b': 'i', '\u012d': 'i', '\u012f': 'i', '\u0131': 'i',
    '\u0134': 'J',  '\u0135': 'j',
    '\u0136': 'K',  '\u0137': 'k', '\u0138': 'k',
    '\u0139': 'L',  '\u013b': 'L', '\u013d': 'L', '\u013f': 'L', '\u0141': 'L',
    '\u013a': 'l',  '\u013c': 'l', '\u013e': 'l', '\u0140': 'l', '\u0142': 'l',
    '\u0143': 'N',  '\u0145': 'N', '\u0147': 'N', '\u014a': 'N',
    '\u0144': 'n',  '\u0146': 'n', '\u0148': 'n', '\u014b': 'n',
    '\u014c': 'O',  '\u014e': 'O', '\u0150': 'O',
    '\u014d': 'o',  '\u014f': 'o', '\u0151': 'o',
    '\u0154': 'R',  '\u0156': 'R', '\u0158': 'R',
    '\u0155': 'r',  '\u0157': 'r', '\u0159': 'r',
    '\u015a': 'S',  '\u015c': 'S', '\u015e': 'S', '\u0160': 'S',
    '\u015b': 's',  '\u015d': 's', '\u015f': 's', '\u0161': 's',
    '\u0162': 'T',  '\u0164': 'T', '\u0166': 'T',
    '\u0163': 't',  '\u0165': 't', '\u0167': 't',
    '\u0168': 'U',  '\u016a': 'U', '\u016c': 'U', '\u016e': 'U', '\u0170': 'U', '\u0172': 'U',
    '\u0169': 'u',  '\u016b': 'u', '\u016d': 'u', '\u016f': 'u', '\u0171': 'u', '\u0173': 'u',
    '\u0174': 'W',  '\u0175': 'w',
    '\u0176': 'Y',  '\u0177': 'y', '\u0178': 'Y',
    '\u0179': 'Z',  '\u017b': 'Z', '\u017d': 'Z',
    '\u017a': 'z',  '\u017c': 'z', '\u017e': 'z',
    '\u0132': 'IJ', '\u0133': 'ij',
    '\u0152': 'Oe', '\u0153': 'oe',
    '\u0149': "'n", '\u017f': 's'
  };

  /** Used to map characters to HTML entities. */
  var htmlEscapes = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  };

  /** Used to map HTML entities to characters. */
  var htmlUnescapes = {
    '&amp;': '&',
    '&lt;': '<',
    '&gt;': '>',
    '&quot;': '"',
    '&#39;': "'"
  };

  /** Used to escape characters for inclusion in compiled string literals. */
  var stringEscapes = {
    '\\': '\\',
    "'": "'",
    '\n': 'n',
    '\r': 'r',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  /** Built-in method references without a dependency on `root`. */
  var freeParseFloat = parseFloat,
      freeParseInt = parseInt;

  /** Detect free variable `global` from Node.js. */
  var freeGlobal = typeof global == 'object' && global && global.Object === Object && global;

  /** Detect free variable `self`. */
  var freeSelf = typeof self == 'object' && self && self.Object === Object && self;

  /** Used as a reference to the global object. */
  var root = freeGlobal || freeSelf || Function('return this')();

  /** Detect free variable `exports`. */
  var freeExports =  true && exports && !exports.nodeType && exports;

  /** Detect free variable `module`. */
  var freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;

  /** Detect the popular CommonJS extension `module.exports`. */
  var moduleExports = freeModule && freeModule.exports === freeExports;

  /** Detect free variable `process` from Node.js. */
  var freeProcess = moduleExports && freeGlobal.process;

  /** Used to access faster Node.js helpers. */
  var nodeUtil = (function() {
    try {
      // Use `util.types` for Node.js 10+.
      var types = freeModule && freeModule.require && freeModule.require('util').types;

      if (types) {
        return types;
      }

      // Legacy `process.binding('util')` for Node.js < 10.
      return freeProcess && freeProcess.binding && freeProcess.binding('util');
    } catch (e) {}
  }());

  /* Node.js helper references. */
  var nodeIsArrayBuffer = nodeUtil && nodeUtil.isArrayBuffer,
      nodeIsDate = nodeUtil && nodeUtil.isDate,
      nodeIsMap = nodeUtil && nodeUtil.isMap,
      nodeIsRegExp = nodeUtil && nodeUtil.isRegExp,
      nodeIsSet = nodeUtil && nodeUtil.isSet,
      nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;

  /*--------------------------------------------------------------------------*/

  /**
   * A faster alternative to `Function#apply`, this function invokes `func`
   * with the `this` binding of `thisArg` and the arguments of `args`.
   *
   * @private
   * @param {Function} func The function to invoke.
   * @param {*} thisArg The `this` binding of `func`.
   * @param {Array} args The arguments to invoke `func` with.
   * @returns {*} Returns the result of `func`.
   */
  function apply(func, thisArg, args) {
    switch (args.length) {
      case 0: return func.call(thisArg);
      case 1: return func.call(thisArg, args[0]);
      case 2: return func.call(thisArg, args[0], args[1]);
      case 3: return func.call(thisArg, args[0], args[1], args[2]);
    }
    return func.apply(thisArg, args);
  }

  /**
   * A specialized version of `baseAggregator` for arrays.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} setter The function to set `accumulator` values.
   * @param {Function} iteratee The iteratee to transform keys.
   * @param {Object} accumulator The initial aggregated object.
   * @returns {Function} Returns `accumulator`.
   */
  function arrayAggregator(array, setter, iteratee, accumulator) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      var value = array[index];
      setter(accumulator, value, iteratee(value), array);
    }
    return accumulator;
  }

  /**
   * A specialized version of `_.forEach` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns `array`.
   */
  function arrayEach(array, iteratee) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (iteratee(array[index], index, array) === false) {
        break;
      }
    }
    return array;
  }

  /**
   * A specialized version of `_.forEachRight` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns `array`.
   */
  function arrayEachRight(array, iteratee) {
    var length = array == null ? 0 : array.length;

    while (length--) {
      if (iteratee(array[length], length, array) === false) {
        break;
      }
    }
    return array;
  }

  /**
   * A specialized version of `_.every` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {boolean} Returns `true` if all elements pass the predicate check,
   *  else `false`.
   */
  function arrayEvery(array, predicate) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (!predicate(array[index], index, array)) {
        return false;
      }
    }
    return true;
  }

  /**
   * A specialized version of `_.filter` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {Array} Returns the new filtered array.
   */
  function arrayFilter(array, predicate) {
    var index = -1,
        length = array == null ? 0 : array.length,
        resIndex = 0,
        result = [];

    while (++index < length) {
      var value = array[index];
      if (predicate(value, index, array)) {
        result[resIndex++] = value;
      }
    }
    return result;
  }

  /**
   * A specialized version of `_.includes` for arrays without support for
   * specifying an index to search from.
   *
   * @private
   * @param {Array} [array] The array to inspect.
   * @param {*} target The value to search for.
   * @returns {boolean} Returns `true` if `target` is found, else `false`.
   */
  function arrayIncludes(array, value) {
    var length = array == null ? 0 : array.length;
    return !!length && baseIndexOf(array, value, 0) > -1;
  }

  /**
   * This function is like `arrayIncludes` except that it accepts a comparator.
   *
   * @private
   * @param {Array} [array] The array to inspect.
   * @param {*} target The value to search for.
   * @param {Function} comparator The comparator invoked per element.
   * @returns {boolean} Returns `true` if `target` is found, else `false`.
   */
  function arrayIncludesWith(array, value, comparator) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (comparator(value, array[index])) {
        return true;
      }
    }
    return false;
  }

  /**
   * A specialized version of `_.map` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the new mapped array.
   */
  function arrayMap(array, iteratee) {
    var index = -1,
        length = array == null ? 0 : array.length,
        result = Array(length);

    while (++index < length) {
      result[index] = iteratee(array[index], index, array);
    }
    return result;
  }

  /**
   * Appends the elements of `values` to `array`.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {Array} values The values to append.
   * @returns {Array} Returns `array`.
   */
  function arrayPush(array, values) {
    var index = -1,
        length = values.length,
        offset = array.length;

    while (++index < length) {
      array[offset + index] = values[index];
    }
    return array;
  }

  /**
   * A specialized version of `_.reduce` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} [accumulator] The initial value.
   * @param {boolean} [initAccum] Specify using the first element of `array` as
   *  the initial value.
   * @returns {*} Returns the accumulated value.
   */
  function arrayReduce(array, iteratee, accumulator, initAccum) {
    var index = -1,
        length = array == null ? 0 : array.length;

    if (initAccum && length) {
      accumulator = array[++index];
    }
    while (++index < length) {
      accumulator = iteratee(accumulator, array[index], index, array);
    }
    return accumulator;
  }

  /**
   * A specialized version of `_.reduceRight` for arrays without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} [accumulator] The initial value.
   * @param {boolean} [initAccum] Specify using the last element of `array` as
   *  the initial value.
   * @returns {*} Returns the accumulated value.
   */
  function arrayReduceRight(array, iteratee, accumulator, initAccum) {
    var length = array == null ? 0 : array.length;
    if (initAccum && length) {
      accumulator = array[--length];
    }
    while (length--) {
      accumulator = iteratee(accumulator, array[length], length, array);
    }
    return accumulator;
  }

  /**
   * A specialized version of `_.some` for arrays without support for iteratee
   * shorthands.
   *
   * @private
   * @param {Array} [array] The array to iterate over.
   * @param {Function} predicate The function invoked per iteration.
   * @returns {boolean} Returns `true` if any element passes the predicate check,
   *  else `false`.
   */
  function arraySome(array, predicate) {
    var index = -1,
        length = array == null ? 0 : array.length;

    while (++index < length) {
      if (predicate(array[index], index, array)) {
        return true;
      }
    }
    return false;
  }

  /**
   * Gets the size of an ASCII `string`.
   *
   * @private
   * @param {string} string The string inspect.
   * @returns {number} Returns the string size.
   */
  var asciiSize = baseProperty('length');

  /**
   * Converts an ASCII `string` to an array.
   *
   * @private
   * @param {string} string The string to convert.
   * @returns {Array} Returns the converted array.
   */
  function asciiToArray(string) {
    return string.split('');
  }

  /**
   * Splits an ASCII `string` into an array of its words.
   *
   * @private
   * @param {string} The string to inspect.
   * @returns {Array} Returns the words of `string`.
   */
  function asciiWords(string) {
    return string.match(reAsciiWord) || [];
  }

  /**
   * The base implementation of methods like `_.findKey` and `_.findLastKey`,
   * without support for iteratee shorthands, which iterates over `collection`
   * using `eachFunc`.
   *
   * @private
   * @param {Array|Object} collection The collection to inspect.
   * @param {Function} predicate The function invoked per iteration.
   * @param {Function} eachFunc The function to iterate over `collection`.
   * @returns {*} Returns the found element or its key, else `undefined`.
   */
  function baseFindKey(collection, predicate, eachFunc) {
    var result;
    eachFunc(collection, function(value, key, collection) {
      if (predicate(value, key, collection)) {
        result = key;
        return false;
      }
    });
    return result;
  }

  /**
   * The base implementation of `_.findIndex` and `_.findLastIndex` without
   * support for iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {Function} predicate The function invoked per iteration.
   * @param {number} fromIndex The index to search from.
   * @param {boolean} [fromRight] Specify iterating from right to left.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function baseFindIndex(array, predicate, fromIndex, fromRight) {
    var length = array.length,
        index = fromIndex + (fromRight ? 1 : -1);

    while ((fromRight ? index-- : ++index < length)) {
      if (predicate(array[index], index, array)) {
        return index;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `_.indexOf` without `fromIndex` bounds checks.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function baseIndexOf(array, value, fromIndex) {
    return value === value
      ? strictIndexOf(array, value, fromIndex)
      : baseFindIndex(array, baseIsNaN, fromIndex);
  }

  /**
   * This function is like `baseIndexOf` except that it accepts a comparator.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @param {Function} comparator The comparator invoked per element.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function baseIndexOfWith(array, value, fromIndex, comparator) {
    var index = fromIndex - 1,
        length = array.length;

    while (++index < length) {
      if (comparator(array[index], value)) {
        return index;
      }
    }
    return -1;
  }

  /**
   * The base implementation of `_.isNaN` without support for number objects.
   *
   * @private
   * @param {*} value The value to check.
   * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.
   */
  function baseIsNaN(value) {
    return value !== value;
  }

  /**
   * The base implementation of `_.mean` and `_.meanBy` without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {number} Returns the mean.
   */
  function baseMean(array, iteratee) {
    var length = array == null ? 0 : array.length;
    return length ? (baseSum(array, iteratee) / length) : NAN;
  }

  /**
   * The base implementation of `_.property` without support for deep paths.
   *
   * @private
   * @param {string} key The key of the property to get.
   * @returns {Function} Returns the new accessor function.
   */
  function baseProperty(key) {
    return function(object) {
      return object == null ? undefined : object[key];
    };
  }

  /**
   * The base implementation of `_.propertyOf` without support for deep paths.
   *
   * @private
   * @param {Object} object The object to query.
   * @returns {Function} Returns the new accessor function.
   */
  function basePropertyOf(object) {
    return function(key) {
      return object == null ? undefined : object[key];
    };
  }

  /**
   * The base implementation of `_.reduce` and `_.reduceRight`, without support
   * for iteratee shorthands, which iterates over `collection` using `eachFunc`.
   *
   * @private
   * @param {Array|Object} collection The collection to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @param {*} accumulator The initial value.
   * @param {boolean} initAccum Specify using the first or last element of
   *  `collection` as the initial value.
   * @param {Function} eachFunc The function to iterate over `collection`.
   * @returns {*} Returns the accumulated value.
   */
  function baseReduce(collection, iteratee, accumulator, initAccum, eachFunc) {
    eachFunc(collection, function(value, index, collection) {
      accumulator = initAccum
        ? (initAccum = false, value)
        : iteratee(accumulator, value, index, collection);
    });
    return accumulator;
  }

  /**
   * The base implementation of `_.sortBy` which uses `comparer` to define the
   * sort order of `array` and replaces criteria objects with their corresponding
   * values.
   *
   * @private
   * @param {Array} array The array to sort.
   * @param {Function} comparer The function to define sort order.
   * @returns {Array} Returns `array`.
   */
  function baseSortBy(array, comparer) {
    var length = array.length;

    array.sort(comparer);
    while (length--) {
      array[length] = array[length].value;
    }
    return array;
  }

  /**
   * The base implementation of `_.sum` and `_.sumBy` without support for
   * iteratee shorthands.
   *
   * @private
   * @param {Array} array The array to iterate over.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {number} Returns the sum.
   */
  function baseSum(array, iteratee) {
    var result,
        index = -1,
        length = array.length;

    while (++index < length) {
      var current = iteratee(array[index]);
      if (current !== undefined) {
        result = result === undefined ? current : (result + current);
      }
    }
    return result;
  }

  /**
   * The base implementation of `_.times` without support for iteratee shorthands
   * or max array length checks.
   *
   * @private
   * @param {number} n The number of times to invoke `iteratee`.
   * @param {Function} iteratee The function invoked per iteration.
   * @returns {Array} Returns the array of results.
   */
  function baseTimes(n, iteratee) {
    var index = -1,
        result = Array(n);

    while (++index < n) {
      result[index] = iteratee(index);
    }
    return result;
  }

  /**
   * The base implementation of `_.toPairs` and `_.toPairsIn` which creates an array
   * of key-value pairs for `object` corresponding to the property names of `props`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Array} props The property names to get values for.
   * @returns {Object} Returns the key-value pairs.
   */
  function baseToPairs(object, props) {
    return arrayMap(props, function(key) {
      return [key, object[key]];
    });
  }

  /**
   * The base implementation of `_.unary` without support for storing metadata.
   *
   * @private
   * @param {Function} func The function to cap arguments for.
   * @returns {Function} Returns the new capped function.
   */
  function baseUnary(func) {
    return function(value) {
      return func(value);
    };
  }

  /**
   * The base implementation of `_.values` and `_.valuesIn` which creates an
   * array of `object` property values corresponding to the property names
   * of `props`.
   *
   * @private
   * @param {Object} object The object to query.
   * @param {Array} props The property names to get values for.
   * @returns {Object} Returns the array of property values.
   */
  function baseValues(object, props) {
    return arrayMap(props, function(key) {
      return object[key];
    });
  }

  /**
   * Checks if a `cache` value for `key` exists.
   *
   * @private
   * @param {Object} cache The cache to query.
   * @param {string} key The key of the entry to check.
   * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
   */
  function cacheHas(cache, key) {
    return cache.has(key);
  }

  /**
   * Used by `_.trim` and `_.trimStart` to get the index of the first string symbol
   * that is not found in the character symbols.
   *
   * @private
   * @param {Array} strSymbols The string symbols to inspect.
   * @param {Array} chrSymbols The character symbols to find.
   * @returns {number} Returns the index of the first unmatched string symbol.
   */
  function charsStartIndex(strSymbols, chrSymbols) {
    var index = -1,
        length = strSymbols.length;

    while (++index < length && baseIndexOf(chrSymbols, strSymbols[index], 0) > -1) {}
    return index;
  }

  /**
   * Used by `_.trim` and `_.trimEnd` to get the index of the last string symbol
   * that is not found in the character symbols.
   *
   * @private
   * @param {Array} strSymbols The string symbols to inspect.
   * @param {Array} chrSymbols The character symbols to find.
   * @returns {number} Returns the index of the last unmatched string symbol.
   */
  function charsEndIndex(strSymbols, chrSymbols) {
    var index = strSymbols.length;

    while (index-- && baseIndexOf(chrSymbols, strSymbols[index], 0) > -1) {}
    return index;
  }

  /**
   * Gets the number of `placeholder` occurrences in `array`.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} placeholder The placeholder to search for.
   * @returns {number} Returns the placeholder count.
   */
  function countHolders(array, placeholder) {
    var length = array.length,
        result = 0;

    while (length--) {
      if (array[length] === placeholder) {
        ++result;
      }
    }
    return result;
  }

  /**
   * Used by `_.deburr` to convert Latin-1 Supplement and Latin Extended-A
   * letters to basic Latin letters.
   *
   * @private
   * @param {string} letter The matched letter to deburr.
   * @returns {string} Returns the deburred letter.
   */
  var deburrLetter = basePropertyOf(deburredLetters);

  /**
   * Used by `_.escape` to convert characters to HTML entities.
   *
   * @private
   * @param {string} chr The matched character to escape.
   * @returns {string} Returns the escaped character.
   */
  var escapeHtmlChar = basePropertyOf(htmlEscapes);

  /**
   * Used by `_.template` to escape characters for inclusion in compiled string literals.
   *
   * @private
   * @param {string} chr The matched character to escape.
   * @returns {string} Returns the escaped character.
   */
  function escapeStringChar(chr) {
    return '\\' + stringEscapes[chr];
  }

  /**
   * Gets the value at `key` of `object`.
   *
   * @private
   * @param {Object} [object] The object to query.
   * @param {string} key The key of the property to get.
   * @returns {*} Returns the property value.
   */
  function getValue(object, key) {
    return object == null ? undefined : object[key];
  }

  /**
   * Checks if `string` contains Unicode symbols.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {boolean} Returns `true` if a symbol is found, else `false`.
   */
  function hasUnicode(string) {
    return reHasUnicode.test(string);
  }

  /**
   * Checks if `string` contains a word composed of Unicode symbols.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {boolean} Returns `true` if a word is found, else `false`.
   */
  function hasUnicodeWord(string) {
    return reHasUnicodeWord.test(string);
  }

  /**
   * Converts `iterator` to an array.
   *
   * @private
   * @param {Object} iterator The iterator to convert.
   * @returns {Array} Returns the converted array.
   */
  function iteratorToArray(iterator) {
    var data,
        result = [];

    while (!(data = iterator.next()).done) {
      result.push(data.value);
    }
    return result;
  }

  /**
   * Converts `map` to its key-value pairs.
   *
   * @private
   * @param {Object} map The map to convert.
   * @returns {Array} Returns the key-value pairs.
   */
  function mapToArray(map) {
    var index = -1,
        result = Array(map.size);

    map.forEach(function(value, key) {
      result[++index] = [key, value];
    });
    return result;
  }

  /**
   * Creates a unary function that invokes `func` with its argument transformed.
   *
   * @private
   * @param {Function} func The function to wrap.
   * @param {Function} transform The argument transform.
   * @returns {Function} Returns the new function.
   */
  function overArg(func, transform) {
    return function(arg) {
      return func(transform(arg));
    };
  }

  /**
   * Replaces all `placeholder` elements in `array` with an internal placeholder
   * and returns an array of their indexes.
   *
   * @private
   * @param {Array} array The array to modify.
   * @param {*} placeholder The placeholder to replace.
   * @returns {Array} Returns the new array of placeholder indexes.
   */
  function replaceHolders(array, placeholder) {
    var index = -1,
        length = array.length,
        resIndex = 0,
        result = [];

    while (++index < length) {
      var value = array[index];
      if (value === placeholder || value === PLACEHOLDER) {
        array[index] = PLACEHOLDER;
        result[resIndex++] = index;
      }
    }
    return result;
  }

  /**
   * Converts `set` to an array of its values.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the values.
   */
  function setToArray(set) {
    var index = -1,
        result = Array(set.size);

    set.forEach(function(value) {
      result[++index] = value;
    });
    return result;
  }

  /**
   * Converts `set` to its value-value pairs.
   *
   * @private
   * @param {Object} set The set to convert.
   * @returns {Array} Returns the value-value pairs.
   */
  function setToPairs(set) {
    var index = -1,
        result = Array(set.size);

    set.forEach(function(value) {
      result[++index] = [value, value];
    });
    return result;
  }

  /**
   * A specialized version of `_.indexOf` which performs strict equality
   * comparisons of values, i.e. `===`.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function strictIndexOf(array, value, fromIndex) {
    var index = fromIndex - 1,
        length = array.length;

    while (++index < length) {
      if (array[index] === value) {
        return index;
      }
    }
    return -1;
  }

  /**
   * A specialized version of `_.lastIndexOf` which performs strict equality
   * comparisons of values, i.e. `===`.
   *
   * @private
   * @param {Array} array The array to inspect.
   * @param {*} value The value to search for.
   * @param {number} fromIndex The index to search from.
   * @returns {number} Returns the index of the matched value, else `-1`.
   */
  function strictLastIndexOf(array, value, fromIndex) {
    var index = fromIndex + 1;
    while (index--) {
      if (array[index] === value) {
        return index;
      }
    }
    return index;
  }

  /**
   * Gets the number of symbols in `string`.
   *
   * @private
   * @param {string} string The string to inspect.
   * @returns {number} Returns the string size.
   */
  function stringSize(string) {
    return hasUnicode(string)
      ? unicodeSize(string)
      : asciiSize(string);
  }

  /**
   * Converts `string` to an array.
   *
   * @private
   * @param {string} string The string to convert.
   * @returns {Array} Returns the converted array.
   */
  function stringToArray(string) {
    return hasUnicode(string)
      ? unicodeToArray(string)
      : asciiToArray(string);
  }

  /**
   * Used by `_.unescape` to convert HTML entities to characters.
   *
   * @private
   * @param {string} chr The matched character to unescape.
   * @returns {string} Returns the unescaped character.
   */
  var unescapeHtmlChar = basePropertyOf(htmlUnescapes);

  /**
   * Gets the size of a Unicode `string`.
   *
   * @private
   * @param {string} string The string inspect.
   * @returns {number} Returns the string size.
   */
  function unicodeSize(string) {
    var result = reUnicode.lastIndex = 0;
    while (reUnicode.test(string)) {
      ++result;
    }
    return result;
  }

  /**
   * Converts a Unicode `string` to an array.
   *
   * @private
   * @param {string} string The string to convert.
   * @returns {Array} Returns the converted array.
   */
  function unicodeToArray(string) {
    return string.match(reUnicode) || [];
  }

  /**
   * Splits a Unicode `string` into an array of its words.
   *
   * @private
   * @param {string} The string to inspect.
   * @returns {Array} Returns the words of `string`.
   */
  function unicodeWords(string) {
    return string.match(reUnicodeWord) || [];
  }

  /*--------------------------------------------------------------------------*/

  /**
   * Create a new pristine `lodash` function using the `context` object.
   *
   * @static
   * @memberOf _
   * @since 1.1.0
   * @category Util
   * @param {Object} [context=root] The context object.
   * @returns {Function} Returns a new `lodash` function.
   * @example
   *
   * _.mixin({ 'foo': _.constant('foo') });
   *
   * var lodash = _.runInContext();
   * lodash.mixin({ 'bar': lodash.constant('bar') });
   *
   * _.isFunction(_.foo);
   * // => true
   * _.isFunction(_.bar);
   * // => false
   *
   * lodash.isFunction(lodash.foo);
   * // => false
   * lodash.isFunction(lodash.bar);
   * // => true
   *
   * // Create a suped-up `defer` in Node.js.
   * var defer = _.runInContext({ 'setTimeout': setImmediate }).defer;
   */
  var runInContext = (function runInContext(context) {
    context = context == null ? root : _.defaults(root.Object(), context, _.pick(root, contextProps));

    /** Built-in constructor references. */
    var Array = context.Array,
        Date = context.Date,
        Error = context.Error,
        Function = context.Function,
        Math = context.Math,
        Object = context.Object,
        RegExp = context.RegExp,
        String = context.String,
        TypeError = context.TypeError;

    /** Used for built-in method references. */
    var arrayProto = Array.prototype,
        funcProto = Function.prototype,
        objectProto = Object.prototype;

    /** Used to detect overreaching core-js shims. */
    var coreJsData = context['__core-js_shared__'];

    /** Used to resolve the decompiled source of functions. */
    var funcToString = funcProto.toString;

    /** Used to check objects for own properties. */
    var hasOwnProperty = objectProto.hasOwnProperty;

    /** Used to generate unique IDs. */
    var idCounter = 0;

    /** Used to detect methods masquerading as native. */
    var maskSrcKey = (function() {
      var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');
      return uid ? ('Symbol(src)_1.' + uid) : '';
    }());

    /**
     * Used to resolve the
     * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)
     * of values.
     */
    var nativeObjectToString = objectProto.toString;

    /** Used to infer the `Object` constructor. */
    var objectCtorString = funcToString.call(Object);

    /** Used to restore the original `_` reference in `_.noConflict`. */
    var oldDash = root._;

    /** Used to detect if a method is native. */
    var reIsNative = RegExp('^' +
      funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\$&')
      .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, '$1.*?') + '$'
    );

    /** Built-in value references. */
    var Buffer = moduleExports ? context.Buffer : undefined,
        Symbol = context.Symbol,
        Uint8Array = context.Uint8Array,
        allocUnsafe = Buffer ? Buffer.allocUnsafe : undefined,
        getPrototype = overArg(Object.getPrototypeOf, Object),
        objectCreate = Object.create,
        propertyIsEnumerable = objectProto.propertyIsEnumerable,
        splice = arrayProto.splice,
        spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined,
        symIterator = Symbol ? Symbol.iterator : undefined,
        symToStringTag = Symbol ? Symbol.toStringTag : undefined;

    var defineProperty = (function() {
      try {
        var func = getNative(Object, 'defineProperty');
        func({}, '', {});
        return func;
      } catch (e) {}
    }());

    /** Mocked built-ins. */
    var ctxClearTimeout = context.clearTimeout !== root.clearTimeout && context.clearTimeout,
        ctxNow = Date && Date.now !== root.Date.now && Date.now,
        ctxSetTimeout = context.setTimeout !== root.setTimeout && context.setTimeout;

    /* Built-in method references for those with the same name as other `lodash` methods. */
    var nativeCeil = Math.ceil,
        nativeFloor = Math.floor,
        nativeGetSymbols = Object.getOwnPropertySymbols,
        nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined,
        nativeIsFinite = context.isFinite,
        nativeJoin = arrayProto.join,
        nativeKeys = overArg(Object.keys, Object),
        nativeMax = Math.max,
        nativeMin = Math.min,
        nativeNow = Date.now,
        nativeParseInt = context.parseInt,
        nativeRandom = Math.random,
        nativeReverse = arrayProto.reverse;

    /* Built-in method references that are verified to be native. */
    var DataView = getNative(context, 'DataView'),
        Map = getNative(context, 'Map'),
        Promise = getNative(context, 'Promise'),
        Set = getNative(context, 'Set'),
        WeakMap = getNative(context, 'WeakMap'),
        nativeCreate = getNative(Object, 'create');

    /** Used to store function metadata. */
    var metaMap = WeakMap && new WeakMap;

    /** Used to lookup unminified function names. */
    var realNames = {};

    /** Used to detect maps, sets, and weakmaps. */
    var dataViewCtorString = toSource(DataView),
        mapCtorString = toSource(Map),
        promiseCtorString = toSource(Promise),
        setCtorString = toSource(Set),
        weakMapCtorString = toSource(WeakMap);

    /** Used to convert symbols to primitives and strings. */
    var symbolProto = Symbol ? Symbol.prototype : undefined,
        symbolValueOf = symbolProto ? symbolProto.valueOf : undefined,
        symbolToString = symbolProto ? symbolProto.toString : undefined;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` object which wraps `value` to enable implicit method
     * chain sequences. Methods that operate on and return arrays, collections,
     * and functions can be chained together. Methods that retrieve a single value
     * or may return a primitive value will automatically end the chain sequence
     * and return the unwrapped value. Otherwise, the value must be unwrapped
     * with `_#value`.
     *
     * Explicit chain sequences, which must be unwrapped with `_#value`, may be
     * enabled using `_.chain`.
     *
     * The execution of chained methods is lazy, that is, it's deferred until
     * `_#value` is implicitly or explicitly called.
     *
     * Lazy evaluation allows several methods to support shortcut fusion.
     * Shortcut fusion is an optimization to merge iteratee calls; this avoids
     * the creation of intermediate arrays and can greatly reduce the number of
     * iteratee executions. Sections of a chain sequence qualify for shortcut
     * fusion if the section is applied to an array and iteratees accept only
     * one argument. The heuristic for whether a section qualifies for shortcut
     * fusion is subject to change.
     *
     * Chaining is supported in custom builds as long as the `_#value` method is
     * directly or indirectly included in the build.
     *
     * In addition to lodash methods, wrappers have `Array` and `String` methods.
     *
     * The wrapper `Array` methods are:
     * `concat`, `join`, `pop`, `push`, `shift`, `sort`, `splice`, and `unshift`
     *
     * The wrapper `String` methods are:
     * `replace` and `split`
     *
     * The wrapper methods that support shortcut fusion are:
     * `at`, `compact`, `drop`, `dropRight`, `dropWhile`, `filter`, `find`,
     * `findLast`, `head`, `initial`, `last`, `map`, `reject`, `reverse`, `slice`,
     * `tail`, `take`, `takeRight`, `takeRightWhile`, `takeWhile`, and `toArray`
     *
     * The chainable wrapper methods are:
     * `after`, `ary`, `assign`, `assignIn`, `assignInWith`, `assignWith`, `at`,
     * `before`, `bind`, `bindAll`, `bindKey`, `castArray`, `chain`, `chunk`,
     * `commit`, `compact`, `concat`, `conforms`, `constant`, `countBy`, `create`,
     * `curry`, `debounce`, `defaults`, `defaultsDeep`, `defer`, `delay`,
     * `difference`, `differenceBy`, `differenceWith`, `drop`, `dropRight`,
     * `dropRightWhile`, `dropWhile`, `extend`, `extendWith`, `fill`, `filter`,
     * `flatMap`, `flatMapDeep`, `flatMapDepth`, `flatten`, `flattenDeep`,
     * `flattenDepth`, `flip`, `flow`, `flowRight`, `fromPairs`, `functions`,
     * `functionsIn`, `groupBy`, `initial`, `intersection`, `intersectionBy`,
     * `intersectionWith`, `invert`, `invertBy`, `invokeMap`, `iteratee`, `keyBy`,
     * `keys`, `keysIn`, `map`, `mapKeys`, `mapValues`, `matches`, `matchesProperty`,
     * `memoize`, `merge`, `mergeWith`, `method`, `methodOf`, `mixin`, `negate`,
     * `nthArg`, `omit`, `omitBy`, `once`, `orderBy`, `over`, `overArgs`,
     * `overEvery`, `overSome`, `partial`, `partialRight`, `partition`, `pick`,
     * `pickBy`, `plant`, `property`, `propertyOf`, `pull`, `pullAll`, `pullAllBy`,
     * `pullAllWith`, `pullAt`, `push`, `range`, `rangeRight`, `rearg`, `reject`,
     * `remove`, `rest`, `reverse`, `sampleSize`, `set`, `setWith`, `shuffle`,
     * `slice`, `sort`, `sortBy`, `splice`, `spread`, `tail`, `take`, `takeRight`,
     * `takeRightWhile`, `takeWhile`, `tap`, `throttle`, `thru`, `toArray`,
     * `toPairs`, `toPairsIn`, `toPath`, `toPlainObject`, `transform`, `unary`,
     * `union`, `unionBy`, `unionWith`, `uniq`, `uniqBy`, `uniqWith`, `unset`,
     * `unshift`, `unzip`, `unzipWith`, `update`, `updateWith`, `values`,
     * `valuesIn`, `without`, `wrap`, `xor`, `xorBy`, `xorWith`, `zip`,
     * `zipObject`, `zipObjectDeep`, and `zipWith`
     *
     * The wrapper methods that are **not** chainable by default are:
     * `add`, `attempt`, `camelCase`, `capitalize`, `ceil`, `clamp`, `clone`,
     * `cloneDeep`, `cloneDeepWith`, `cloneWith`, `conformsTo`, `deburr`,
     * `defaultTo`, `divide`, `each`, `eachRight`, `endsWith`, `eq`, `escape`,
     * `escapeRegExp`, `every`, `find`, `findIndex`, `findKey`, `findLast`,
     * `findLastIndex`, `findLastKey`, `first`, `floor`, `forEach`, `forEachRight`,
     * `forIn`, `forInRight`, `forOwn`, `forOwnRight`, `get`, `gt`, `gte`, `has`,
     * `hasIn`, `head`, `identity`, `includes`, `indexOf`, `inRange`, `invoke`,
     * `isArguments`, `isArray`, `isArrayBuffer`, `isArrayLike`, `isArrayLikeObject`,
     * `isBoolean`, `isBuffer`, `isDate`, `isElement`, `isEmpty`, `isEqual`,
     * `isEqualWith`, `isError`, `isFinite`, `isFunction`, `isInteger`, `isLength`,
     * `isMap`, `isMatch`, `isMatchWith`, `isNaN`, `isNative`, `isNil`, `isNull`,
     * `isNumber`, `isObject`, `isObjectLike`, `isPlainObject`, `isRegExp`,
     * `isSafeInteger`, `isSet`, `isString`, `isUndefined`, `isTypedArray`,
     * `isWeakMap`, `isWeakSet`, `join`, `kebabCase`, `last`, `lastIndexOf`,
     * `lowerCase`, `lowerFirst`, `lt`, `lte`, `max`, `maxBy`, `mean`, `meanBy`,
     * `min`, `minBy`, `multiply`, `noConflict`, `noop`, `now`, `nth`, `pad`,
     * `padEnd`, `padStart`, `parseInt`, `pop`, `random`, `reduce`, `reduceRight`,
     * `repeat`, `result`, `round`, `runInContext`, `sample`, `shift`, `size`,
     * `snakeCase`, `some`, `sortedIndex`, `sortedIndexBy`, `sortedLastIndex`,
     * `sortedLastIndexBy`, `startCase`, `startsWith`, `stubArray`, `stubFalse`,
     * `stubObject`, `stubString`, `stubTrue`, `subtract`, `sum`, `sumBy`,
     * `template`, `times`, `toFinite`, `toInteger`, `toJSON`, `toLength`,
     * `toLower`, `toNumber`, `toSafeInteger`, `toString`, `toUpper`, `trim`,
     * `trimEnd`, `trimStart`, `truncate`, `unescape`, `uniqueId`, `upperCase`,
     * `upperFirst`, `value`, and `words`
     *
     * @name _
     * @constructor
     * @category Seq
     * @param {*} value The value to wrap in a `lodash` instance.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var wrapped = _([1, 2, 3]);
     *
     * // Returns an unwrapped value.
     * wrapped.reduce(_.add);
     * // => 6
     *
     * // Returns a wrapped value.
     * var squares = wrapped.map(square);
     *
     * _.isArray(squares);
     * // => false
     *
     * _.isArray(squares.value());
     * // => true
     */
    function lodash(value) {
      if (isObjectLike(value) && !isArray(value) && !(value instanceof LazyWrapper)) {
        if (value instanceof LodashWrapper) {
          return value;
        }
        if (hasOwnProperty.call(value, '__wrapped__')) {
          return wrapperClone(value);
        }
      }
      return new LodashWrapper(value);
    }

    /**
     * The base implementation of `_.create` without support for assigning
     * properties to the created object.
     *
     * @private
     * @param {Object} proto The object to inherit from.
     * @returns {Object} Returns the new object.
     */
    var baseCreate = (function() {
      function object() {}
      return function(proto) {
        if (!isObject(proto)) {
          return {};
        }
        if (objectCreate) {
          return objectCreate(proto);
        }
        object.prototype = proto;
        var result = new object;
        object.prototype = undefined;
        return result;
      };
    }());

    /**
     * The function whose prototype chain sequence wrappers inherit from.
     *
     * @private
     */
    function baseLodash() {
      // No operation performed.
    }

    /**
     * The base constructor for creating `lodash` wrapper objects.
     *
     * @private
     * @param {*} value The value to wrap.
     * @param {boolean} [chainAll] Enable explicit method chain sequences.
     */
    function LodashWrapper(value, chainAll) {
      this.__wrapped__ = value;
      this.__actions__ = [];
      this.__chain__ = !!chainAll;
      this.__index__ = 0;
      this.__values__ = undefined;
    }

    /**
     * By default, the template delimiters used by lodash are like those in
     * embedded Ruby (ERB) as well as ES2015 template strings. Change the
     * following template settings to use alternative delimiters.
     *
     * @static
     * @memberOf _
     * @type {Object}
     */
    lodash.templateSettings = {

      /**
       * Used to detect `data` property values to be HTML-escaped.
       *
       * @memberOf _.templateSettings
       * @type {RegExp}
       */
      'escape': reEscape,

      /**
       * Used to detect code to be evaluated.
       *
       * @memberOf _.templateSettings
       * @type {RegExp}
       */
      'evaluate': reEvaluate,

      /**
       * Used to detect `data` property values to inject.
       *
       * @memberOf _.templateSettings
       * @type {RegExp}
       */
      'interpolate': reInterpolate,

      /**
       * Used to reference the data object in the template text.
       *
       * @memberOf _.templateSettings
       * @type {string}
       */
      'variable': '',

      /**
       * Used to import variables into the compiled template.
       *
       * @memberOf _.templateSettings
       * @type {Object}
       */
      'imports': {

        /**
         * A reference to the `lodash` function.
         *
         * @memberOf _.templateSettings.imports
         * @type {Function}
         */
        '_': lodash
      }
    };

    // Ensure wrappers are instances of `baseLodash`.
    lodash.prototype = baseLodash.prototype;
    lodash.prototype.constructor = lodash;

    LodashWrapper.prototype = baseCreate(baseLodash.prototype);
    LodashWrapper.prototype.constructor = LodashWrapper;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a lazy wrapper object which wraps `value` to enable lazy evaluation.
     *
     * @private
     * @constructor
     * @param {*} value The value to wrap.
     */
    function LazyWrapper(value) {
      this.__wrapped__ = value;
      this.__actions__ = [];
      this.__dir__ = 1;
      this.__filtered__ = false;
      this.__iteratees__ = [];
      this.__takeCount__ = MAX_ARRAY_LENGTH;
      this.__views__ = [];
    }

    /**
     * Creates a clone of the lazy wrapper object.
     *
     * @private
     * @name clone
     * @memberOf LazyWrapper
     * @returns {Object} Returns the cloned `LazyWrapper` object.
     */
    function lazyClone() {
      var result = new LazyWrapper(this.__wrapped__);
      result.__actions__ = copyArray(this.__actions__);
      result.__dir__ = this.__dir__;
      result.__filtered__ = this.__filtered__;
      result.__iteratees__ = copyArray(this.__iteratees__);
      result.__takeCount__ = this.__takeCount__;
      result.__views__ = copyArray(this.__views__);
      return result;
    }

    /**
     * Reverses the direction of lazy iteration.
     *
     * @private
     * @name reverse
     * @memberOf LazyWrapper
     * @returns {Object} Returns the new reversed `LazyWrapper` object.
     */
    function lazyReverse() {
      if (this.__filtered__) {
        var result = new LazyWrapper(this);
        result.__dir__ = -1;
        result.__filtered__ = true;
      } else {
        result = this.clone();
        result.__dir__ *= -1;
      }
      return result;
    }

    /**
     * Extracts the unwrapped value from its lazy wrapper.
     *
     * @private
     * @name value
     * @memberOf LazyWrapper
     * @returns {*} Returns the unwrapped value.
     */
    function lazyValue() {
      var array = this.__wrapped__.value(),
          dir = this.__dir__,
          isArr = isArray(array),
          isRight = dir < 0,
          arrLength = isArr ? array.length : 0,
          view = getView(0, arrLength, this.__views__),
          start = view.start,
          end = view.end,
          length = end - start,
          index = isRight ? end : (start - 1),
          iteratees = this.__iteratees__,
          iterLength = iteratees.length,
          resIndex = 0,
          takeCount = nativeMin(length, this.__takeCount__);

      if (!isArr || (!isRight && arrLength == length && takeCount == length)) {
        return baseWrapperValue(array, this.__actions__);
      }
      var result = [];

      outer:
      while (length-- && resIndex < takeCount) {
        index += dir;

        var iterIndex = -1,
            value = array[index];

        while (++iterIndex < iterLength) {
          var data = iteratees[iterIndex],
              iteratee = data.iteratee,
              type = data.type,
              computed = iteratee(value);

          if (type == LAZY_MAP_FLAG) {
            value = computed;
          } else if (!computed) {
            if (type == LAZY_FILTER_FLAG) {
              continue outer;
            } else {
              break outer;
            }
          }
        }
        result[resIndex++] = value;
      }
      return result;
    }

    // Ensure `LazyWrapper` is an instance of `baseLodash`.
    LazyWrapper.prototype = baseCreate(baseLodash.prototype);
    LazyWrapper.prototype.constructor = LazyWrapper;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a hash object.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function Hash(entries) {
      var index = -1,
          length = entries == null ? 0 : entries.length;

      this.clear();
      while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
      }
    }

    /**
     * Removes all key-value entries from the hash.
     *
     * @private
     * @name clear
     * @memberOf Hash
     */
    function hashClear() {
      this.__data__ = nativeCreate ? nativeCreate(null) : {};
      this.size = 0;
    }

    /**
     * Removes `key` and its value from the hash.
     *
     * @private
     * @name delete
     * @memberOf Hash
     * @param {Object} hash The hash to modify.
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function hashDelete(key) {
      var result = this.has(key) && delete this.__data__[key];
      this.size -= result ? 1 : 0;
      return result;
    }

    /**
     * Gets the hash value for `key`.
     *
     * @private
     * @name get
     * @memberOf Hash
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function hashGet(key) {
      var data = this.__data__;
      if (nativeCreate) {
        var result = data[key];
        return result === HASH_UNDEFINED ? undefined : result;
      }
      return hasOwnProperty.call(data, key) ? data[key] : undefined;
    }

    /**
     * Checks if a hash value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf Hash
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function hashHas(key) {
      var data = this.__data__;
      return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);
    }

    /**
     * Sets the hash `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf Hash
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the hash instance.
     */
    function hashSet(key, value) {
      var data = this.__data__;
      this.size += this.has(key) ? 0 : 1;
      data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;
      return this;
    }

    // Add methods to `Hash`.
    Hash.prototype.clear = hashClear;
    Hash.prototype['delete'] = hashDelete;
    Hash.prototype.get = hashGet;
    Hash.prototype.has = hashHas;
    Hash.prototype.set = hashSet;

    /*------------------------------------------------------------------------*/

    /**
     * Creates an list cache object.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function ListCache(entries) {
      var index = -1,
          length = entries == null ? 0 : entries.length;

      this.clear();
      while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
      }
    }

    /**
     * Removes all key-value entries from the list cache.
     *
     * @private
     * @name clear
     * @memberOf ListCache
     */
    function listCacheClear() {
      this.__data__ = [];
      this.size = 0;
    }

    /**
     * Removes `key` and its value from the list cache.
     *
     * @private
     * @name delete
     * @memberOf ListCache
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function listCacheDelete(key) {
      var data = this.__data__,
          index = assocIndexOf(data, key);

      if (index < 0) {
        return false;
      }
      var lastIndex = data.length - 1;
      if (index == lastIndex) {
        data.pop();
      } else {
        splice.call(data, index, 1);
      }
      --this.size;
      return true;
    }

    /**
     * Gets the list cache value for `key`.
     *
     * @private
     * @name get
     * @memberOf ListCache
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function listCacheGet(key) {
      var data = this.__data__,
          index = assocIndexOf(data, key);

      return index < 0 ? undefined : data[index][1];
    }

    /**
     * Checks if a list cache value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf ListCache
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function listCacheHas(key) {
      return assocIndexOf(this.__data__, key) > -1;
    }

    /**
     * Sets the list cache `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf ListCache
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the list cache instance.
     */
    function listCacheSet(key, value) {
      var data = this.__data__,
          index = assocIndexOf(data, key);

      if (index < 0) {
        ++this.size;
        data.push([key, value]);
      } else {
        data[index][1] = value;
      }
      return this;
    }

    // Add methods to `ListCache`.
    ListCache.prototype.clear = listCacheClear;
    ListCache.prototype['delete'] = listCacheDelete;
    ListCache.prototype.get = listCacheGet;
    ListCache.prototype.has = listCacheHas;
    ListCache.prototype.set = listCacheSet;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a map cache object to store key-value pairs.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function MapCache(entries) {
      var index = -1,
          length = entries == null ? 0 : entries.length;

      this.clear();
      while (++index < length) {
        var entry = entries[index];
        this.set(entry[0], entry[1]);
      }
    }

    /**
     * Removes all key-value entries from the map.
     *
     * @private
     * @name clear
     * @memberOf MapCache
     */
    function mapCacheClear() {
      this.size = 0;
      this.__data__ = {
        'hash': new Hash,
        'map': new (Map || ListCache),
        'string': new Hash
      };
    }

    /**
     * Removes `key` and its value from the map.
     *
     * @private
     * @name delete
     * @memberOf MapCache
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function mapCacheDelete(key) {
      var result = getMapData(this, key)['delete'](key);
      this.size -= result ? 1 : 0;
      return result;
    }

    /**
     * Gets the map value for `key`.
     *
     * @private
     * @name get
     * @memberOf MapCache
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function mapCacheGet(key) {
      return getMapData(this, key).get(key);
    }

    /**
     * Checks if a map value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf MapCache
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function mapCacheHas(key) {
      return getMapData(this, key).has(key);
    }

    /**
     * Sets the map `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf MapCache
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the map cache instance.
     */
    function mapCacheSet(key, value) {
      var data = getMapData(this, key),
          size = data.size;

      data.set(key, value);
      this.size += data.size == size ? 0 : 1;
      return this;
    }

    // Add methods to `MapCache`.
    MapCache.prototype.clear = mapCacheClear;
    MapCache.prototype['delete'] = mapCacheDelete;
    MapCache.prototype.get = mapCacheGet;
    MapCache.prototype.has = mapCacheHas;
    MapCache.prototype.set = mapCacheSet;

    /*------------------------------------------------------------------------*/

    /**
     *
     * Creates an array cache object to store unique values.
     *
     * @private
     * @constructor
     * @param {Array} [values] The values to cache.
     */
    function SetCache(values) {
      var index = -1,
          length = values == null ? 0 : values.length;

      this.__data__ = new MapCache;
      while (++index < length) {
        this.add(values[index]);
      }
    }

    /**
     * Adds `value` to the array cache.
     *
     * @private
     * @name add
     * @memberOf SetCache
     * @alias push
     * @param {*} value The value to cache.
     * @returns {Object} Returns the cache instance.
     */
    function setCacheAdd(value) {
      this.__data__.set(value, HASH_UNDEFINED);
      return this;
    }

    /**
     * Checks if `value` is in the array cache.
     *
     * @private
     * @name has
     * @memberOf SetCache
     * @param {*} value The value to search for.
     * @returns {number} Returns `true` if `value` is found, else `false`.
     */
    function setCacheHas(value) {
      return this.__data__.has(value);
    }

    // Add methods to `SetCache`.
    SetCache.prototype.add = SetCache.prototype.push = setCacheAdd;
    SetCache.prototype.has = setCacheHas;

    /*------------------------------------------------------------------------*/

    /**
     * Creates a stack cache object to store key-value pairs.
     *
     * @private
     * @constructor
     * @param {Array} [entries] The key-value pairs to cache.
     */
    function Stack(entries) {
      var data = this.__data__ = new ListCache(entries);
      this.size = data.size;
    }

    /**
     * Removes all key-value entries from the stack.
     *
     * @private
     * @name clear
     * @memberOf Stack
     */
    function stackClear() {
      this.__data__ = new ListCache;
      this.size = 0;
    }

    /**
     * Removes `key` and its value from the stack.
     *
     * @private
     * @name delete
     * @memberOf Stack
     * @param {string} key The key of the value to remove.
     * @returns {boolean} Returns `true` if the entry was removed, else `false`.
     */
    function stackDelete(key) {
      var data = this.__data__,
          result = data['delete'](key);

      this.size = data.size;
      return result;
    }

    /**
     * Gets the stack value for `key`.
     *
     * @private
     * @name get
     * @memberOf Stack
     * @param {string} key The key of the value to get.
     * @returns {*} Returns the entry value.
     */
    function stackGet(key) {
      return this.__data__.get(key);
    }

    /**
     * Checks if a stack value for `key` exists.
     *
     * @private
     * @name has
     * @memberOf Stack
     * @param {string} key The key of the entry to check.
     * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.
     */
    function stackHas(key) {
      return this.__data__.has(key);
    }

    /**
     * Sets the stack `key` to `value`.
     *
     * @private
     * @name set
     * @memberOf Stack
     * @param {string} key The key of the value to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns the stack cache instance.
     */
    function stackSet(key, value) {
      var data = this.__data__;
      if (data instanceof ListCache) {
        var pairs = data.__data__;
        if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {
          pairs.push([key, value]);
          this.size = ++data.size;
          return this;
        }
        data = this.__data__ = new MapCache(pairs);
      }
      data.set(key, value);
      this.size = data.size;
      return this;
    }

    // Add methods to `Stack`.
    Stack.prototype.clear = stackClear;
    Stack.prototype['delete'] = stackDelete;
    Stack.prototype.get = stackGet;
    Stack.prototype.has = stackHas;
    Stack.prototype.set = stackSet;

    /*------------------------------------------------------------------------*/

    /**
     * Creates an array of the enumerable property names of the array-like `value`.
     *
     * @private
     * @param {*} value The value to query.
     * @param {boolean} inherited Specify returning inherited property names.
     * @returns {Array} Returns the array of property names.
     */
    function arrayLikeKeys(value, inherited) {
      var isArr = isArray(value),
          isArg = !isArr && isArguments(value),
          isBuff = !isArr && !isArg && isBuffer(value),
          isType = !isArr && !isArg && !isBuff && isTypedArray(value),
          skipIndexes = isArr || isArg || isBuff || isType,
          result = skipIndexes ? baseTimes(value.length, String) : [],
          length = result.length;

      for (var key in value) {
        if ((inherited || hasOwnProperty.call(value, key)) &&
            !(skipIndexes && (
               // Safari 9 has enumerable `arguments.length` in strict mode.
               key == 'length' ||
               // Node.js 0.10 has enumerable non-index properties on buffers.
               (isBuff && (key == 'offset' || key == 'parent')) ||
               // PhantomJS 2 has enumerable non-index properties on typed arrays.
               (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||
               // Skip index properties.
               isIndex(key, length)
            ))) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * A specialized version of `_.sample` for arrays.
     *
     * @private
     * @param {Array} array The array to sample.
     * @returns {*} Returns the random element.
     */
    function arraySample(array) {
      var length = array.length;
      return length ? array[baseRandom(0, length - 1)] : undefined;
    }

    /**
     * A specialized version of `_.sampleSize` for arrays.
     *
     * @private
     * @param {Array} array The array to sample.
     * @param {number} n The number of elements to sample.
     * @returns {Array} Returns the random elements.
     */
    function arraySampleSize(array, n) {
      return shuffleSelf(copyArray(array), baseClamp(n, 0, array.length));
    }

    /**
     * A specialized version of `_.shuffle` for arrays.
     *
     * @private
     * @param {Array} array The array to shuffle.
     * @returns {Array} Returns the new shuffled array.
     */
    function arrayShuffle(array) {
      return shuffleSelf(copyArray(array));
    }

    /**
     * This function is like `assignValue` except that it doesn't assign
     * `undefined` values.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {string} key The key of the property to assign.
     * @param {*} value The value to assign.
     */
    function assignMergeValue(object, key, value) {
      if ((value !== undefined && !eq(object[key], value)) ||
          (value === undefined && !(key in object))) {
        baseAssignValue(object, key, value);
      }
    }

    /**
     * Assigns `value` to `key` of `object` if the existing value is not equivalent
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {string} key The key of the property to assign.
     * @param {*} value The value to assign.
     */
    function assignValue(object, key, value) {
      var objValue = object[key];
      if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||
          (value === undefined && !(key in object))) {
        baseAssignValue(object, key, value);
      }
    }

    /**
     * Gets the index at which the `key` is found in `array` of key-value pairs.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {*} key The key to search for.
     * @returns {number} Returns the index of the matched value, else `-1`.
     */
    function assocIndexOf(array, key) {
      var length = array.length;
      while (length--) {
        if (eq(array[length][0], key)) {
          return length;
        }
      }
      return -1;
    }

    /**
     * Aggregates elements of `collection` on `accumulator` with keys transformed
     * by `iteratee` and values set by `setter`.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} setter The function to set `accumulator` values.
     * @param {Function} iteratee The iteratee to transform keys.
     * @param {Object} accumulator The initial aggregated object.
     * @returns {Function} Returns `accumulator`.
     */
    function baseAggregator(collection, setter, iteratee, accumulator) {
      baseEach(collection, function(value, key, collection) {
        setter(accumulator, value, iteratee(value), collection);
      });
      return accumulator;
    }

    /**
     * The base implementation of `_.assign` without support for multiple sources
     * or `customizer` functions.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @returns {Object} Returns `object`.
     */
    function baseAssign(object, source) {
      return object && copyObject(source, keys(source), object);
    }

    /**
     * The base implementation of `_.assignIn` without support for multiple sources
     * or `customizer` functions.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @returns {Object} Returns `object`.
     */
    function baseAssignIn(object, source) {
      return object && copyObject(source, keysIn(source), object);
    }

    /**
     * The base implementation of `assignValue` and `assignMergeValue` without
     * value checks.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {string} key The key of the property to assign.
     * @param {*} value The value to assign.
     */
    function baseAssignValue(object, key, value) {
      if (key == '__proto__' && defineProperty) {
        defineProperty(object, key, {
          'configurable': true,
          'enumerable': true,
          'value': value,
          'writable': true
        });
      } else {
        object[key] = value;
      }
    }

    /**
     * The base implementation of `_.at` without support for individual paths.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {string[]} paths The property paths to pick.
     * @returns {Array} Returns the picked elements.
     */
    function baseAt(object, paths) {
      var index = -1,
          length = paths.length,
          result = Array(length),
          skip = object == null;

      while (++index < length) {
        result[index] = skip ? undefined : get(object, paths[index]);
      }
      return result;
    }

    /**
     * The base implementation of `_.clamp` which doesn't coerce arguments.
     *
     * @private
     * @param {number} number The number to clamp.
     * @param {number} [lower] The lower bound.
     * @param {number} upper The upper bound.
     * @returns {number} Returns the clamped number.
     */
    function baseClamp(number, lower, upper) {
      if (number === number) {
        if (upper !== undefined) {
          number = number <= upper ? number : upper;
        }
        if (lower !== undefined) {
          number = number >= lower ? number : lower;
        }
      }
      return number;
    }

    /**
     * The base implementation of `_.clone` and `_.cloneDeep` which tracks
     * traversed objects.
     *
     * @private
     * @param {*} value The value to clone.
     * @param {boolean} bitmask The bitmask flags.
     *  1 - Deep clone
     *  2 - Flatten inherited properties
     *  4 - Clone symbols
     * @param {Function} [customizer] The function to customize cloning.
     * @param {string} [key] The key of `value`.
     * @param {Object} [object] The parent object of `value`.
     * @param {Object} [stack] Tracks traversed objects and their clone counterparts.
     * @returns {*} Returns the cloned value.
     */
    function baseClone(value, bitmask, customizer, key, object, stack) {
      var result,
          isDeep = bitmask & CLONE_DEEP_FLAG,
          isFlat = bitmask & CLONE_FLAT_FLAG,
          isFull = bitmask & CLONE_SYMBOLS_FLAG;

      if (customizer) {
        result = object ? customizer(value, key, object, stack) : customizer(value);
      }
      if (result !== undefined) {
        return result;
      }
      if (!isObject(value)) {
        return value;
      }
      var isArr = isArray(value);
      if (isArr) {
        result = initCloneArray(value);
        if (!isDeep) {
          return copyArray(value, result);
        }
      } else {
        var tag = getTag(value),
            isFunc = tag == funcTag || tag == genTag;

        if (isBuffer(value)) {
          return cloneBuffer(value, isDeep);
        }
        if (tag == objectTag || tag == argsTag || (isFunc && !object)) {
          result = (isFlat || isFunc) ? {} : initCloneObject(value);
          if (!isDeep) {
            return isFlat
              ? copySymbolsIn(value, baseAssignIn(result, value))
              : copySymbols(value, baseAssign(result, value));
          }
        } else {
          if (!cloneableTags[tag]) {
            return object ? value : {};
          }
          result = initCloneByTag(value, tag, isDeep);
        }
      }
      // Check for circular references and return its corresponding clone.
      stack || (stack = new Stack);
      var stacked = stack.get(value);
      if (stacked) {
        return stacked;
      }
      stack.set(value, result);

      if (isSet(value)) {
        value.forEach(function(subValue) {
          result.add(baseClone(subValue, bitmask, customizer, subValue, value, stack));
        });
      } else if (isMap(value)) {
        value.forEach(function(subValue, key) {
          result.set(key, baseClone(subValue, bitmask, customizer, key, value, stack));
        });
      }

      var keysFunc = isFull
        ? (isFlat ? getAllKeysIn : getAllKeys)
        : (isFlat ? keysIn : keys);

      var props = isArr ? undefined : keysFunc(value);
      arrayEach(props || value, function(subValue, key) {
        if (props) {
          key = subValue;
          subValue = value[key];
        }
        // Recursively populate clone (susceptible to call stack limits).
        assignValue(result, key, baseClone(subValue, bitmask, customizer, key, value, stack));
      });
      return result;
    }

    /**
     * The base implementation of `_.conforms` which doesn't clone `source`.
     *
     * @private
     * @param {Object} source The object of property predicates to conform to.
     * @returns {Function} Returns the new spec function.
     */
    function baseConforms(source) {
      var props = keys(source);
      return function(object) {
        return baseConformsTo(object, source, props);
      };
    }

    /**
     * The base implementation of `_.conformsTo` which accepts `props` to check.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property predicates to conform to.
     * @returns {boolean} Returns `true` if `object` conforms, else `false`.
     */
    function baseConformsTo(object, source, props) {
      var length = props.length;
      if (object == null) {
        return !length;
      }
      object = Object(object);
      while (length--) {
        var key = props[length],
            predicate = source[key],
            value = object[key];

        if ((value === undefined && !(key in object)) || !predicate(value)) {
          return false;
        }
      }
      return true;
    }

    /**
     * The base implementation of `_.delay` and `_.defer` which accepts `args`
     * to provide to `func`.
     *
     * @private
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @param {Array} args The arguments to provide to `func`.
     * @returns {number|Object} Returns the timer id or timeout object.
     */
    function baseDelay(func, wait, args) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      return setTimeout(function() { func.apply(undefined, args); }, wait);
    }

    /**
     * The base implementation of methods like `_.difference` without support
     * for excluding multiple arrays or iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Array} values The values to exclude.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     */
    function baseDifference(array, values, iteratee, comparator) {
      var index = -1,
          includes = arrayIncludes,
          isCommon = true,
          length = array.length,
          result = [],
          valuesLength = values.length;

      if (!length) {
        return result;
      }
      if (iteratee) {
        values = arrayMap(values, baseUnary(iteratee));
      }
      if (comparator) {
        includes = arrayIncludesWith;
        isCommon = false;
      }
      else if (values.length >= LARGE_ARRAY_SIZE) {
        includes = cacheHas;
        isCommon = false;
        values = new SetCache(values);
      }
      outer:
      while (++index < length) {
        var value = array[index],
            computed = iteratee == null ? value : iteratee(value);

        value = (comparator || value !== 0) ? value : 0;
        if (isCommon && computed === computed) {
          var valuesIndex = valuesLength;
          while (valuesIndex--) {
            if (values[valuesIndex] === computed) {
              continue outer;
            }
          }
          result.push(value);
        }
        else if (!includes(values, computed, comparator)) {
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.forEach` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     */
    var baseEach = createBaseEach(baseForOwn);

    /**
     * The base implementation of `_.forEachRight` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     */
    var baseEachRight = createBaseEach(baseForOwnRight, true);

    /**
     * The base implementation of `_.every` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if all elements pass the predicate check,
     *  else `false`
     */
    function baseEvery(collection, predicate) {
      var result = true;
      baseEach(collection, function(value, index, collection) {
        result = !!predicate(value, index, collection);
        return result;
      });
      return result;
    }

    /**
     * The base implementation of methods like `_.max` and `_.min` which accepts a
     * `comparator` to determine the extremum value.
     *
     * @private
     * @param {Array} array The array to iterate over.
     * @param {Function} iteratee The iteratee invoked per iteration.
     * @param {Function} comparator The comparator used to compare values.
     * @returns {*} Returns the extremum value.
     */
    function baseExtremum(array, iteratee, comparator) {
      var index = -1,
          length = array.length;

      while (++index < length) {
        var value = array[index],
            current = iteratee(value);

        if (current != null && (computed === undefined
              ? (current === current && !isSymbol(current))
              : comparator(current, computed)
            )) {
          var computed = current,
              result = value;
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.fill` without an iteratee call guard.
     *
     * @private
     * @param {Array} array The array to fill.
     * @param {*} value The value to fill `array` with.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns `array`.
     */
    function baseFill(array, value, start, end) {
      var length = array.length;

      start = toInteger(start);
      if (start < 0) {
        start = -start > length ? 0 : (length + start);
      }
      end = (end === undefined || end > length) ? length : toInteger(end);
      if (end < 0) {
        end += length;
      }
      end = start > end ? 0 : toLength(end);
      while (start < end) {
        array[start++] = value;
      }
      return array;
    }

    /**
     * The base implementation of `_.filter` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     */
    function baseFilter(collection, predicate) {
      var result = [];
      baseEach(collection, function(value, index, collection) {
        if (predicate(value, index, collection)) {
          result.push(value);
        }
      });
      return result;
    }

    /**
     * The base implementation of `_.flatten` with support for restricting flattening.
     *
     * @private
     * @param {Array} array The array to flatten.
     * @param {number} depth The maximum recursion depth.
     * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.
     * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.
     * @param {Array} [result=[]] The initial result value.
     * @returns {Array} Returns the new flattened array.
     */
    function baseFlatten(array, depth, predicate, isStrict, result) {
      var index = -1,
          length = array.length;

      predicate || (predicate = isFlattenable);
      result || (result = []);

      while (++index < length) {
        var value = array[index];
        if (depth > 0 && predicate(value)) {
          if (depth > 1) {
            // Recursively flatten arrays (susceptible to call stack limits).
            baseFlatten(value, depth - 1, predicate, isStrict, result);
          } else {
            arrayPush(result, value);
          }
        } else if (!isStrict) {
          result[result.length] = value;
        }
      }
      return result;
    }

    /**
     * The base implementation of `baseForOwn` which iterates over `object`
     * properties returned by `keysFunc` and invokes `iteratee` for each property.
     * Iteratee functions may exit iteration early by explicitly returning `false`.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @returns {Object} Returns `object`.
     */
    var baseFor = createBaseFor();

    /**
     * This function is like `baseFor` except that it iterates over properties
     * in the opposite order.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @returns {Object} Returns `object`.
     */
    var baseForRight = createBaseFor(true);

    /**
     * The base implementation of `_.forOwn` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Object} Returns `object`.
     */
    function baseForOwn(object, iteratee) {
      return object && baseFor(object, iteratee, keys);
    }

    /**
     * The base implementation of `_.forOwnRight` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Object} Returns `object`.
     */
    function baseForOwnRight(object, iteratee) {
      return object && baseForRight(object, iteratee, keys);
    }

    /**
     * The base implementation of `_.functions` which creates an array of
     * `object` function property names filtered from `props`.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Array} props The property names to filter.
     * @returns {Array} Returns the function names.
     */
    function baseFunctions(object, props) {
      return arrayFilter(props, function(key) {
        return isFunction(object[key]);
      });
    }

    /**
     * The base implementation of `_.get` without support for default values.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the property to get.
     * @returns {*} Returns the resolved value.
     */
    function baseGet(object, path) {
      path = castPath(path, object);

      var index = 0,
          length = path.length;

      while (object != null && index < length) {
        object = object[toKey(path[index++])];
      }
      return (index && index == length) ? object : undefined;
    }

    /**
     * The base implementation of `getAllKeys` and `getAllKeysIn` which uses
     * `keysFunc` and `symbolsFunc` to get the enumerable property names and
     * symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Function} keysFunc The function to get the keys of `object`.
     * @param {Function} symbolsFunc The function to get the symbols of `object`.
     * @returns {Array} Returns the array of property names and symbols.
     */
    function baseGetAllKeys(object, keysFunc, symbolsFunc) {
      var result = keysFunc(object);
      return isArray(object) ? result : arrayPush(result, symbolsFunc(object));
    }

    /**
     * The base implementation of `getTag` without fallbacks for buggy environments.
     *
     * @private
     * @param {*} value The value to query.
     * @returns {string} Returns the `toStringTag`.
     */
    function baseGetTag(value) {
      if (value == null) {
        return value === undefined ? undefinedTag : nullTag;
      }
      return (symToStringTag && symToStringTag in Object(value))
        ? getRawTag(value)
        : objectToString(value);
    }

    /**
     * The base implementation of `_.gt` which doesn't coerce arguments.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is greater than `other`,
     *  else `false`.
     */
    function baseGt(value, other) {
      return value > other;
    }

    /**
     * The base implementation of `_.has` without support for deep paths.
     *
     * @private
     * @param {Object} [object] The object to query.
     * @param {Array|string} key The key to check.
     * @returns {boolean} Returns `true` if `key` exists, else `false`.
     */
    function baseHas(object, key) {
      return object != null && hasOwnProperty.call(object, key);
    }

    /**
     * The base implementation of `_.hasIn` without support for deep paths.
     *
     * @private
     * @param {Object} [object] The object to query.
     * @param {Array|string} key The key to check.
     * @returns {boolean} Returns `true` if `key` exists, else `false`.
     */
    function baseHasIn(object, key) {
      return object != null && key in Object(object);
    }

    /**
     * The base implementation of `_.inRange` which doesn't coerce arguments.
     *
     * @private
     * @param {number} number The number to check.
     * @param {number} start The start of the range.
     * @param {number} end The end of the range.
     * @returns {boolean} Returns `true` if `number` is in the range, else `false`.
     */
    function baseInRange(number, start, end) {
      return number >= nativeMin(start, end) && number < nativeMax(start, end);
    }

    /**
     * The base implementation of methods like `_.intersection`, without support
     * for iteratee shorthands, that accepts an array of arrays to inspect.
     *
     * @private
     * @param {Array} arrays The arrays to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of shared values.
     */
    function baseIntersection(arrays, iteratee, comparator) {
      var includes = comparator ? arrayIncludesWith : arrayIncludes,
          length = arrays[0].length,
          othLength = arrays.length,
          othIndex = othLength,
          caches = Array(othLength),
          maxLength = Infinity,
          result = [];

      while (othIndex--) {
        var array = arrays[othIndex];
        if (othIndex && iteratee) {
          array = arrayMap(array, baseUnary(iteratee));
        }
        maxLength = nativeMin(array.length, maxLength);
        caches[othIndex] = !comparator && (iteratee || (length >= 120 && array.length >= 120))
          ? new SetCache(othIndex && array)
          : undefined;
      }
      array = arrays[0];

      var index = -1,
          seen = caches[0];

      outer:
      while (++index < length && result.length < maxLength) {
        var value = array[index],
            computed = iteratee ? iteratee(value) : value;

        value = (comparator || value !== 0) ? value : 0;
        if (!(seen
              ? cacheHas(seen, computed)
              : includes(result, computed, comparator)
            )) {
          othIndex = othLength;
          while (--othIndex) {
            var cache = caches[othIndex];
            if (!(cache
                  ? cacheHas(cache, computed)
                  : includes(arrays[othIndex], computed, comparator))
                ) {
              continue outer;
            }
          }
          if (seen) {
            seen.push(computed);
          }
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.invert` and `_.invertBy` which inverts
     * `object` with values transformed by `iteratee` and set by `setter`.
     *
     * @private
     * @param {Object} object The object to iterate over.
     * @param {Function} setter The function to set `accumulator` values.
     * @param {Function} iteratee The iteratee to transform values.
     * @param {Object} accumulator The initial inverted object.
     * @returns {Function} Returns `accumulator`.
     */
    function baseInverter(object, setter, iteratee, accumulator) {
      baseForOwn(object, function(value, key, object) {
        setter(accumulator, iteratee(value), key, object);
      });
      return accumulator;
    }

    /**
     * The base implementation of `_.invoke` without support for individual
     * method arguments.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the method to invoke.
     * @param {Array} args The arguments to invoke the method with.
     * @returns {*} Returns the result of the invoked method.
     */
    function baseInvoke(object, path, args) {
      path = castPath(path, object);
      object = parent(object, path);
      var func = object == null ? object : object[toKey(last(path))];
      return func == null ? undefined : apply(func, object, args);
    }

    /**
     * The base implementation of `_.isArguments`.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an `arguments` object,
     */
    function baseIsArguments(value) {
      return isObjectLike(value) && baseGetTag(value) == argsTag;
    }

    /**
     * The base implementation of `_.isArrayBuffer` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.
     */
    function baseIsArrayBuffer(value) {
      return isObjectLike(value) && baseGetTag(value) == arrayBufferTag;
    }

    /**
     * The base implementation of `_.isDate` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a date object, else `false`.
     */
    function baseIsDate(value) {
      return isObjectLike(value) && baseGetTag(value) == dateTag;
    }

    /**
     * The base implementation of `_.isEqual` which supports partial comparisons
     * and tracks traversed objects.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @param {boolean} bitmask The bitmask flags.
     *  1 - Unordered comparison
     *  2 - Partial comparison
     * @param {Function} [customizer] The function to customize comparisons.
     * @param {Object} [stack] Tracks traversed `value` and `other` objects.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     */
    function baseIsEqual(value, other, bitmask, customizer, stack) {
      if (value === other) {
        return true;
      }
      if (value == null || other == null || (!isObjectLike(value) && !isObjectLike(other))) {
        return value !== value && other !== other;
      }
      return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);
    }

    /**
     * A specialized version of `baseIsEqual` for arrays and objects which performs
     * deep comparisons and tracks traversed objects enabling objects with circular
     * references to be compared.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} [stack] Tracks traversed `object` and `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {
      var objIsArr = isArray(object),
          othIsArr = isArray(other),
          objTag = objIsArr ? arrayTag : getTag(object),
          othTag = othIsArr ? arrayTag : getTag(other);

      objTag = objTag == argsTag ? objectTag : objTag;
      othTag = othTag == argsTag ? objectTag : othTag;

      var objIsObj = objTag == objectTag,
          othIsObj = othTag == objectTag,
          isSameTag = objTag == othTag;

      if (isSameTag && isBuffer(object)) {
        if (!isBuffer(other)) {
          return false;
        }
        objIsArr = true;
        objIsObj = false;
      }
      if (isSameTag && !objIsObj) {
        stack || (stack = new Stack);
        return (objIsArr || isTypedArray(object))
          ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)
          : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);
      }
      if (!(bitmask & COMPARE_PARTIAL_FLAG)) {
        var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),
            othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');

        if (objIsWrapped || othIsWrapped) {
          var objUnwrapped = objIsWrapped ? object.value() : object,
              othUnwrapped = othIsWrapped ? other.value() : other;

          stack || (stack = new Stack);
          return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);
        }
      }
      if (!isSameTag) {
        return false;
      }
      stack || (stack = new Stack);
      return equalObjects(object, other, bitmask, customizer, equalFunc, stack);
    }

    /**
     * The base implementation of `_.isMap` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a map, else `false`.
     */
    function baseIsMap(value) {
      return isObjectLike(value) && getTag(value) == mapTag;
    }

    /**
     * The base implementation of `_.isMatch` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property values to match.
     * @param {Array} matchData The property names, values, and compare flags to match.
     * @param {Function} [customizer] The function to customize comparisons.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     */
    function baseIsMatch(object, source, matchData, customizer) {
      var index = matchData.length,
          length = index,
          noCustomizer = !customizer;

      if (object == null) {
        return !length;
      }
      object = Object(object);
      while (index--) {
        var data = matchData[index];
        if ((noCustomizer && data[2])
              ? data[1] !== object[data[0]]
              : !(data[0] in object)
            ) {
          return false;
        }
      }
      while (++index < length) {
        data = matchData[index];
        var key = data[0],
            objValue = object[key],
            srcValue = data[1];

        if (noCustomizer && data[2]) {
          if (objValue === undefined && !(key in object)) {
            return false;
          }
        } else {
          var stack = new Stack;
          if (customizer) {
            var result = customizer(objValue, srcValue, key, object, source, stack);
          }
          if (!(result === undefined
                ? baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG, customizer, stack)
                : result
              )) {
            return false;
          }
        }
      }
      return true;
    }

    /**
     * The base implementation of `_.isNative` without bad shim checks.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a native function,
     *  else `false`.
     */
    function baseIsNative(value) {
      if (!isObject(value) || isMasked(value)) {
        return false;
      }
      var pattern = isFunction(value) ? reIsNative : reIsHostCtor;
      return pattern.test(toSource(value));
    }

    /**
     * The base implementation of `_.isRegExp` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a regexp, else `false`.
     */
    function baseIsRegExp(value) {
      return isObjectLike(value) && baseGetTag(value) == regexpTag;
    }

    /**
     * The base implementation of `_.isSet` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a set, else `false`.
     */
    function baseIsSet(value) {
      return isObjectLike(value) && getTag(value) == setTag;
    }

    /**
     * The base implementation of `_.isTypedArray` without Node.js optimizations.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
     */
    function baseIsTypedArray(value) {
      return isObjectLike(value) &&
        isLength(value.length) && !!typedArrayTags[baseGetTag(value)];
    }

    /**
     * The base implementation of `_.iteratee`.
     *
     * @private
     * @param {*} [value=_.identity] The value to convert to an iteratee.
     * @returns {Function} Returns the iteratee.
     */
    function baseIteratee(value) {
      // Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.
      // See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.
      if (typeof value == 'function') {
        return value;
      }
      if (value == null) {
        return identity;
      }
      if (typeof value == 'object') {
        return isArray(value)
          ? baseMatchesProperty(value[0], value[1])
          : baseMatches(value);
      }
      return property(value);
    }

    /**
     * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     */
    function baseKeys(object) {
      if (!isPrototype(object)) {
        return nativeKeys(object);
      }
      var result = [];
      for (var key in Object(object)) {
        if (hasOwnProperty.call(object, key) && key != 'constructor') {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     */
    function baseKeysIn(object) {
      if (!isObject(object)) {
        return nativeKeysIn(object);
      }
      var isProto = isPrototype(object),
          result = [];

      for (var key in object) {
        if (!(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.lt` which doesn't coerce arguments.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is less than `other`,
     *  else `false`.
     */
    function baseLt(value, other) {
      return value < other;
    }

    /**
     * The base implementation of `_.map` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} iteratee The function invoked per iteration.
     * @returns {Array} Returns the new mapped array.
     */
    function baseMap(collection, iteratee) {
      var index = -1,
          result = isArrayLike(collection) ? Array(collection.length) : [];

      baseEach(collection, function(value, key, collection) {
        result[++index] = iteratee(value, key, collection);
      });
      return result;
    }

    /**
     * The base implementation of `_.matches` which doesn't clone `source`.
     *
     * @private
     * @param {Object} source The object of property values to match.
     * @returns {Function} Returns the new spec function.
     */
    function baseMatches(source) {
      var matchData = getMatchData(source);
      if (matchData.length == 1 && matchData[0][2]) {
        return matchesStrictComparable(matchData[0][0], matchData[0][1]);
      }
      return function(object) {
        return object === source || baseIsMatch(object, source, matchData);
      };
    }

    /**
     * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.
     *
     * @private
     * @param {string} path The path of the property to get.
     * @param {*} srcValue The value to match.
     * @returns {Function} Returns the new spec function.
     */
    function baseMatchesProperty(path, srcValue) {
      if (isKey(path) && isStrictComparable(srcValue)) {
        return matchesStrictComparable(toKey(path), srcValue);
      }
      return function(object) {
        var objValue = get(object, path);
        return (objValue === undefined && objValue === srcValue)
          ? hasIn(object, path)
          : baseIsEqual(srcValue, objValue, COMPARE_PARTIAL_FLAG | COMPARE_UNORDERED_FLAG);
      };
    }

    /**
     * The base implementation of `_.merge` without support for multiple sources.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {number} srcIndex The index of `source`.
     * @param {Function} [customizer] The function to customize merged values.
     * @param {Object} [stack] Tracks traversed source values and their merged
     *  counterparts.
     */
    function baseMerge(object, source, srcIndex, customizer, stack) {
      if (object === source) {
        return;
      }
      baseFor(source, function(srcValue, key) {
        stack || (stack = new Stack);
        if (isObject(srcValue)) {
          baseMergeDeep(object, source, key, srcIndex, baseMerge, customizer, stack);
        }
        else {
          var newValue = customizer
            ? customizer(safeGet(object, key), srcValue, (key + ''), object, source, stack)
            : undefined;

          if (newValue === undefined) {
            newValue = srcValue;
          }
          assignMergeValue(object, key, newValue);
        }
      }, keysIn);
    }

    /**
     * A specialized version of `baseMerge` for arrays and objects which performs
     * deep merges and tracks traversed objects enabling objects with circular
     * references to be merged.
     *
     * @private
     * @param {Object} object The destination object.
     * @param {Object} source The source object.
     * @param {string} key The key of the value to merge.
     * @param {number} srcIndex The index of `source`.
     * @param {Function} mergeFunc The function to merge values.
     * @param {Function} [customizer] The function to customize assigned values.
     * @param {Object} [stack] Tracks traversed source values and their merged
     *  counterparts.
     */
    function baseMergeDeep(object, source, key, srcIndex, mergeFunc, customizer, stack) {
      var objValue = safeGet(object, key),
          srcValue = safeGet(source, key),
          stacked = stack.get(srcValue);

      if (stacked) {
        assignMergeValue(object, key, stacked);
        return;
      }
      var newValue = customizer
        ? customizer(objValue, srcValue, (key + ''), object, source, stack)
        : undefined;

      var isCommon = newValue === undefined;

      if (isCommon) {
        var isArr = isArray(srcValue),
            isBuff = !isArr && isBuffer(srcValue),
            isTyped = !isArr && !isBuff && isTypedArray(srcValue);

        newValue = srcValue;
        if (isArr || isBuff || isTyped) {
          if (isArray(objValue)) {
            newValue = objValue;
          }
          else if (isArrayLikeObject(objValue)) {
            newValue = copyArray(objValue);
          }
          else if (isBuff) {
            isCommon = false;
            newValue = cloneBuffer(srcValue, true);
          }
          else if (isTyped) {
            isCommon = false;
            newValue = cloneTypedArray(srcValue, true);
          }
          else {
            newValue = [];
          }
        }
        else if (isPlainObject(srcValue) || isArguments(srcValue)) {
          newValue = objValue;
          if (isArguments(objValue)) {
            newValue = toPlainObject(objValue);
          }
          else if (!isObject(objValue) || isFunction(objValue)) {
            newValue = initCloneObject(srcValue);
          }
        }
        else {
          isCommon = false;
        }
      }
      if (isCommon) {
        // Recursively merge objects and arrays (susceptible to call stack limits).
        stack.set(srcValue, newValue);
        mergeFunc(newValue, srcValue, srcIndex, customizer, stack);
        stack['delete'](srcValue);
      }
      assignMergeValue(object, key, newValue);
    }

    /**
     * The base implementation of `_.nth` which doesn't coerce arguments.
     *
     * @private
     * @param {Array} array The array to query.
     * @param {number} n The index of the element to return.
     * @returns {*} Returns the nth element of `array`.
     */
    function baseNth(array, n) {
      var length = array.length;
      if (!length) {
        return;
      }
      n += n < 0 ? length : 0;
      return isIndex(n, length) ? array[n] : undefined;
    }

    /**
     * The base implementation of `_.orderBy` without param guards.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function[]|Object[]|string[]} iteratees The iteratees to sort by.
     * @param {string[]} orders The sort orders of `iteratees`.
     * @returns {Array} Returns the new sorted array.
     */
    function baseOrderBy(collection, iteratees, orders) {
      var index = -1;
      iteratees = arrayMap(iteratees.length ? iteratees : [identity], baseUnary(getIteratee()));

      var result = baseMap(collection, function(value, key, collection) {
        var criteria = arrayMap(iteratees, function(iteratee) {
          return iteratee(value);
        });
        return { 'criteria': criteria, 'index': ++index, 'value': value };
      });

      return baseSortBy(result, function(object, other) {
        return compareMultiple(object, other, orders);
      });
    }

    /**
     * The base implementation of `_.pick` without support for individual
     * property identifiers.
     *
     * @private
     * @param {Object} object The source object.
     * @param {string[]} paths The property paths to pick.
     * @returns {Object} Returns the new object.
     */
    function basePick(object, paths) {
      return basePickBy(object, paths, function(value, path) {
        return hasIn(object, path);
      });
    }

    /**
     * The base implementation of  `_.pickBy` without support for iteratee shorthands.
     *
     * @private
     * @param {Object} object The source object.
     * @param {string[]} paths The property paths to pick.
     * @param {Function} predicate The function invoked per property.
     * @returns {Object} Returns the new object.
     */
    function basePickBy(object, paths, predicate) {
      var index = -1,
          length = paths.length,
          result = {};

      while (++index < length) {
        var path = paths[index],
            value = baseGet(object, path);

        if (predicate(value, path)) {
          baseSet(result, castPath(path, object), value);
        }
      }
      return result;
    }

    /**
     * A specialized version of `baseProperty` which supports deep paths.
     *
     * @private
     * @param {Array|string} path The path of the property to get.
     * @returns {Function} Returns the new accessor function.
     */
    function basePropertyDeep(path) {
      return function(object) {
        return baseGet(object, path);
      };
    }

    /**
     * The base implementation of `_.pullAllBy` without support for iteratee
     * shorthands.
     *
     * @private
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns `array`.
     */
    function basePullAll(array, values, iteratee, comparator) {
      var indexOf = comparator ? baseIndexOfWith : baseIndexOf,
          index = -1,
          length = values.length,
          seen = array;

      if (array === values) {
        values = copyArray(values);
      }
      if (iteratee) {
        seen = arrayMap(array, baseUnary(iteratee));
      }
      while (++index < length) {
        var fromIndex = 0,
            value = values[index],
            computed = iteratee ? iteratee(value) : value;

        while ((fromIndex = indexOf(seen, computed, fromIndex, comparator)) > -1) {
          if (seen !== array) {
            splice.call(seen, fromIndex, 1);
          }
          splice.call(array, fromIndex, 1);
        }
      }
      return array;
    }

    /**
     * The base implementation of `_.pullAt` without support for individual
     * indexes or capturing the removed elements.
     *
     * @private
     * @param {Array} array The array to modify.
     * @param {number[]} indexes The indexes of elements to remove.
     * @returns {Array} Returns `array`.
     */
    function basePullAt(array, indexes) {
      var length = array ? indexes.length : 0,
          lastIndex = length - 1;

      while (length--) {
        var index = indexes[length];
        if (length == lastIndex || index !== previous) {
          var previous = index;
          if (isIndex(index)) {
            splice.call(array, index, 1);
          } else {
            baseUnset(array, index);
          }
        }
      }
      return array;
    }

    /**
     * The base implementation of `_.random` without support for returning
     * floating-point numbers.
     *
     * @private
     * @param {number} lower The lower bound.
     * @param {number} upper The upper bound.
     * @returns {number} Returns the random number.
     */
    function baseRandom(lower, upper) {
      return lower + nativeFloor(nativeRandom() * (upper - lower + 1));
    }

    /**
     * The base implementation of `_.range` and `_.rangeRight` which doesn't
     * coerce arguments.
     *
     * @private
     * @param {number} start The start of the range.
     * @param {number} end The end of the range.
     * @param {number} step The value to increment or decrement by.
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Array} Returns the range of numbers.
     */
    function baseRange(start, end, step, fromRight) {
      var index = -1,
          length = nativeMax(nativeCeil((end - start) / (step || 1)), 0),
          result = Array(length);

      while (length--) {
        result[fromRight ? length : ++index] = start;
        start += step;
      }
      return result;
    }

    /**
     * The base implementation of `_.repeat` which doesn't coerce arguments.
     *
     * @private
     * @param {string} string The string to repeat.
     * @param {number} n The number of times to repeat the string.
     * @returns {string} Returns the repeated string.
     */
    function baseRepeat(string, n) {
      var result = '';
      if (!string || n < 1 || n > MAX_SAFE_INTEGER) {
        return result;
      }
      // Leverage the exponentiation by squaring algorithm for a faster repeat.
      // See https://en.wikipedia.org/wiki/Exponentiation_by_squaring for more details.
      do {
        if (n % 2) {
          result += string;
        }
        n = nativeFloor(n / 2);
        if (n) {
          string += string;
        }
      } while (n);

      return result;
    }

    /**
     * The base implementation of `_.rest` which doesn't validate or coerce arguments.
     *
     * @private
     * @param {Function} func The function to apply a rest parameter to.
     * @param {number} [start=func.length-1] The start position of the rest parameter.
     * @returns {Function} Returns the new function.
     */
    function baseRest(func, start) {
      return setToString(overRest(func, start, identity), func + '');
    }

    /**
     * The base implementation of `_.sample`.
     *
     * @private
     * @param {Array|Object} collection The collection to sample.
     * @returns {*} Returns the random element.
     */
    function baseSample(collection) {
      return arraySample(values(collection));
    }

    /**
     * The base implementation of `_.sampleSize` without param guards.
     *
     * @private
     * @param {Array|Object} collection The collection to sample.
     * @param {number} n The number of elements to sample.
     * @returns {Array} Returns the random elements.
     */
    function baseSampleSize(collection, n) {
      var array = values(collection);
      return shuffleSelf(array, baseClamp(n, 0, array.length));
    }

    /**
     * The base implementation of `_.set`.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {*} value The value to set.
     * @param {Function} [customizer] The function to customize path creation.
     * @returns {Object} Returns `object`.
     */
    function baseSet(object, path, value, customizer) {
      if (!isObject(object)) {
        return object;
      }
      path = castPath(path, object);

      var index = -1,
          length = path.length,
          lastIndex = length - 1,
          nested = object;

      while (nested != null && ++index < length) {
        var key = toKey(path[index]),
            newValue = value;

        if (index != lastIndex) {
          var objValue = nested[key];
          newValue = customizer ? customizer(objValue, key, nested) : undefined;
          if (newValue === undefined) {
            newValue = isObject(objValue)
              ? objValue
              : (isIndex(path[index + 1]) ? [] : {});
          }
        }
        assignValue(nested, key, newValue);
        nested = nested[key];
      }
      return object;
    }

    /**
     * The base implementation of `setData` without support for hot loop shorting.
     *
     * @private
     * @param {Function} func The function to associate metadata with.
     * @param {*} data The metadata.
     * @returns {Function} Returns `func`.
     */
    var baseSetData = !metaMap ? identity : function(func, data) {
      metaMap.set(func, data);
      return func;
    };

    /**
     * The base implementation of `setToString` without support for hot loop shorting.
     *
     * @private
     * @param {Function} func The function to modify.
     * @param {Function} string The `toString` result.
     * @returns {Function} Returns `func`.
     */
    var baseSetToString = !defineProperty ? identity : function(func, string) {
      return defineProperty(func, 'toString', {
        'configurable': true,
        'enumerable': false,
        'value': constant(string),
        'writable': true
      });
    };

    /**
     * The base implementation of `_.shuffle`.
     *
     * @private
     * @param {Array|Object} collection The collection to shuffle.
     * @returns {Array} Returns the new shuffled array.
     */
    function baseShuffle(collection) {
      return shuffleSelf(values(collection));
    }

    /**
     * The base implementation of `_.slice` without an iteratee call guard.
     *
     * @private
     * @param {Array} array The array to slice.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the slice of `array`.
     */
    function baseSlice(array, start, end) {
      var index = -1,
          length = array.length;

      if (start < 0) {
        start = -start > length ? 0 : (length + start);
      }
      end = end > length ? length : end;
      if (end < 0) {
        end += length;
      }
      length = start > end ? 0 : ((end - start) >>> 0);
      start >>>= 0;

      var result = Array(length);
      while (++index < length) {
        result[index] = array[index + start];
      }
      return result;
    }

    /**
     * The base implementation of `_.some` without support for iteratee shorthands.
     *
     * @private
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} predicate The function invoked per iteration.
     * @returns {boolean} Returns `true` if any element passes the predicate check,
     *  else `false`.
     */
    function baseSome(collection, predicate) {
      var result;

      baseEach(collection, function(value, index, collection) {
        result = predicate(value, index, collection);
        return !result;
      });
      return !!result;
    }

    /**
     * The base implementation of `_.sortedIndex` and `_.sortedLastIndex` which
     * performs a binary search of `array` to determine the index at which `value`
     * should be inserted into `array` in order to maintain its sort order.
     *
     * @private
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {boolean} [retHighest] Specify returning the highest qualified index.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     */
    function baseSortedIndex(array, value, retHighest) {
      var low = 0,
          high = array == null ? low : array.length;

      if (typeof value == 'number' && value === value && high <= HALF_MAX_ARRAY_LENGTH) {
        while (low < high) {
          var mid = (low + high) >>> 1,
              computed = array[mid];

          if (computed !== null && !isSymbol(computed) &&
              (retHighest ? (computed <= value) : (computed < value))) {
            low = mid + 1;
          } else {
            high = mid;
          }
        }
        return high;
      }
      return baseSortedIndexBy(array, value, identity, retHighest);
    }

    /**
     * The base implementation of `_.sortedIndexBy` and `_.sortedLastIndexBy`
     * which invokes `iteratee` for `value` and each element of `array` to compute
     * their sort ranking. The iteratee is invoked with one argument; (value).
     *
     * @private
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function} iteratee The iteratee invoked per element.
     * @param {boolean} [retHighest] Specify returning the highest qualified index.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     */
    function baseSortedIndexBy(array, value, iteratee, retHighest) {
      value = iteratee(value);

      var low = 0,
          high = array == null ? 0 : array.length,
          valIsNaN = value !== value,
          valIsNull = value === null,
          valIsSymbol = isSymbol(value),
          valIsUndefined = value === undefined;

      while (low < high) {
        var mid = nativeFloor((low + high) / 2),
            computed = iteratee(array[mid]),
            othIsDefined = computed !== undefined,
            othIsNull = computed === null,
            othIsReflexive = computed === computed,
            othIsSymbol = isSymbol(computed);

        if (valIsNaN) {
          var setLow = retHighest || othIsReflexive;
        } else if (valIsUndefined) {
          setLow = othIsReflexive && (retHighest || othIsDefined);
        } else if (valIsNull) {
          setLow = othIsReflexive && othIsDefined && (retHighest || !othIsNull);
        } else if (valIsSymbol) {
          setLow = othIsReflexive && othIsDefined && !othIsNull && (retHighest || !othIsSymbol);
        } else if (othIsNull || othIsSymbol) {
          setLow = false;
        } else {
          setLow = retHighest ? (computed <= value) : (computed < value);
        }
        if (setLow) {
          low = mid + 1;
        } else {
          high = mid;
        }
      }
      return nativeMin(high, MAX_ARRAY_INDEX);
    }

    /**
     * The base implementation of `_.sortedUniq` and `_.sortedUniqBy` without
     * support for iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     */
    function baseSortedUniq(array, iteratee) {
      var index = -1,
          length = array.length,
          resIndex = 0,
          result = [];

      while (++index < length) {
        var value = array[index],
            computed = iteratee ? iteratee(value) : value;

        if (!index || !eq(computed, seen)) {
          var seen = computed;
          result[resIndex++] = value === 0 ? 0 : value;
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.toNumber` which doesn't ensure correct
     * conversions of binary, hexadecimal, or octal string values.
     *
     * @private
     * @param {*} value The value to process.
     * @returns {number} Returns the number.
     */
    function baseToNumber(value) {
      if (typeof value == 'number') {
        return value;
      }
      if (isSymbol(value)) {
        return NAN;
      }
      return +value;
    }

    /**
     * The base implementation of `_.toString` which doesn't convert nullish
     * values to empty strings.
     *
     * @private
     * @param {*} value The value to process.
     * @returns {string} Returns the string.
     */
    function baseToString(value) {
      // Exit early for strings to avoid a performance hit in some environments.
      if (typeof value == 'string') {
        return value;
      }
      if (isArray(value)) {
        // Recursively convert values (susceptible to call stack limits).
        return arrayMap(value, baseToString) + '';
      }
      if (isSymbol(value)) {
        return symbolToString ? symbolToString.call(value) : '';
      }
      var result = (value + '');
      return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;
    }

    /**
     * The base implementation of `_.uniqBy` without support for iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     */
    function baseUniq(array, iteratee, comparator) {
      var index = -1,
          includes = arrayIncludes,
          length = array.length,
          isCommon = true,
          result = [],
          seen = result;

      if (comparator) {
        isCommon = false;
        includes = arrayIncludesWith;
      }
      else if (length >= LARGE_ARRAY_SIZE) {
        var set = iteratee ? null : createSet(array);
        if (set) {
          return setToArray(set);
        }
        isCommon = false;
        includes = cacheHas;
        seen = new SetCache;
      }
      else {
        seen = iteratee ? [] : result;
      }
      outer:
      while (++index < length) {
        var value = array[index],
            computed = iteratee ? iteratee(value) : value;

        value = (comparator || value !== 0) ? value : 0;
        if (isCommon && computed === computed) {
          var seenIndex = seen.length;
          while (seenIndex--) {
            if (seen[seenIndex] === computed) {
              continue outer;
            }
          }
          if (iteratee) {
            seen.push(computed);
          }
          result.push(value);
        }
        else if (!includes(seen, computed, comparator)) {
          if (seen !== result) {
            seen.push(computed);
          }
          result.push(value);
        }
      }
      return result;
    }

    /**
     * The base implementation of `_.unset`.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {Array|string} path The property path to unset.
     * @returns {boolean} Returns `true` if the property is deleted, else `false`.
     */
    function baseUnset(object, path) {
      path = castPath(path, object);
      object = parent(object, path);
      return object == null || delete object[toKey(last(path))];
    }

    /**
     * The base implementation of `_.update`.
     *
     * @private
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to update.
     * @param {Function} updater The function to produce the updated value.
     * @param {Function} [customizer] The function to customize path creation.
     * @returns {Object} Returns `object`.
     */
    function baseUpdate(object, path, updater, customizer) {
      return baseSet(object, path, updater(baseGet(object, path)), customizer);
    }

    /**
     * The base implementation of methods like `_.dropWhile` and `_.takeWhile`
     * without support for iteratee shorthands.
     *
     * @private
     * @param {Array} array The array to query.
     * @param {Function} predicate The function invoked per iteration.
     * @param {boolean} [isDrop] Specify dropping elements instead of taking them.
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Array} Returns the slice of `array`.
     */
    function baseWhile(array, predicate, isDrop, fromRight) {
      var length = array.length,
          index = fromRight ? length : -1;

      while ((fromRight ? index-- : ++index < length) &&
        predicate(array[index], index, array)) {}

      return isDrop
        ? baseSlice(array, (fromRight ? 0 : index), (fromRight ? index + 1 : length))
        : baseSlice(array, (fromRight ? index + 1 : 0), (fromRight ? length : index));
    }

    /**
     * The base implementation of `wrapperValue` which returns the result of
     * performing a sequence of actions on the unwrapped `value`, where each
     * successive action is supplied the return value of the previous.
     *
     * @private
     * @param {*} value The unwrapped value.
     * @param {Array} actions Actions to perform to resolve the unwrapped value.
     * @returns {*} Returns the resolved value.
     */
    function baseWrapperValue(value, actions) {
      var result = value;
      if (result instanceof LazyWrapper) {
        result = result.value();
      }
      return arrayReduce(actions, function(result, action) {
        return action.func.apply(action.thisArg, arrayPush([result], action.args));
      }, result);
    }

    /**
     * The base implementation of methods like `_.xor`, without support for
     * iteratee shorthands, that accepts an array of arrays to inspect.
     *
     * @private
     * @param {Array} arrays The arrays to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of values.
     */
    function baseXor(arrays, iteratee, comparator) {
      var length = arrays.length;
      if (length < 2) {
        return length ? baseUniq(arrays[0]) : [];
      }
      var index = -1,
          result = Array(length);

      while (++index < length) {
        var array = arrays[index],
            othIndex = -1;

        while (++othIndex < length) {
          if (othIndex != index) {
            result[index] = baseDifference(result[index] || array, arrays[othIndex], iteratee, comparator);
          }
        }
      }
      return baseUniq(baseFlatten(result, 1), iteratee, comparator);
    }

    /**
     * This base implementation of `_.zipObject` which assigns values using `assignFunc`.
     *
     * @private
     * @param {Array} props The property identifiers.
     * @param {Array} values The property values.
     * @param {Function} assignFunc The function to assign values.
     * @returns {Object} Returns the new object.
     */
    function baseZipObject(props, values, assignFunc) {
      var index = -1,
          length = props.length,
          valsLength = values.length,
          result = {};

      while (++index < length) {
        var value = index < valsLength ? values[index] : undefined;
        assignFunc(result, props[index], value);
      }
      return result;
    }

    /**
     * Casts `value` to an empty array if it's not an array like object.
     *
     * @private
     * @param {*} value The value to inspect.
     * @returns {Array|Object} Returns the cast array-like object.
     */
    function castArrayLikeObject(value) {
      return isArrayLikeObject(value) ? value : [];
    }

    /**
     * Casts `value` to `identity` if it's not a function.
     *
     * @private
     * @param {*} value The value to inspect.
     * @returns {Function} Returns cast function.
     */
    function castFunction(value) {
      return typeof value == 'function' ? value : identity;
    }

    /**
     * Casts `value` to a path array if it's not one.
     *
     * @private
     * @param {*} value The value to inspect.
     * @param {Object} [object] The object to query keys on.
     * @returns {Array} Returns the cast property path array.
     */
    function castPath(value, object) {
      if (isArray(value)) {
        return value;
      }
      return isKey(value, object) ? [value] : stringToPath(toString(value));
    }

    /**
     * A `baseRest` alias which can be replaced with `identity` by module
     * replacement plugins.
     *
     * @private
     * @type {Function}
     * @param {Function} func The function to apply a rest parameter to.
     * @returns {Function} Returns the new function.
     */
    var castRest = baseRest;

    /**
     * Casts `array` to a slice if it's needed.
     *
     * @private
     * @param {Array} array The array to inspect.
     * @param {number} start The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the cast slice.
     */
    function castSlice(array, start, end) {
      var length = array.length;
      end = end === undefined ? length : end;
      return (!start && end >= length) ? array : baseSlice(array, start, end);
    }

    /**
     * A simple wrapper around the global [`clearTimeout`](https://mdn.io/clearTimeout).
     *
     * @private
     * @param {number|Object} id The timer id or timeout object of the timer to clear.
     */
    var clearTimeout = ctxClearTimeout || function(id) {
      return root.clearTimeout(id);
    };

    /**
     * Creates a clone of  `buffer`.
     *
     * @private
     * @param {Buffer} buffer The buffer to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Buffer} Returns the cloned buffer.
     */
    function cloneBuffer(buffer, isDeep) {
      if (isDeep) {
        return buffer.slice();
      }
      var length = buffer.length,
          result = allocUnsafe ? allocUnsafe(length) : new buffer.constructor(length);

      buffer.copy(result);
      return result;
    }

    /**
     * Creates a clone of `arrayBuffer`.
     *
     * @private
     * @param {ArrayBuffer} arrayBuffer The array buffer to clone.
     * @returns {ArrayBuffer} Returns the cloned array buffer.
     */
    function cloneArrayBuffer(arrayBuffer) {
      var result = new arrayBuffer.constructor(arrayBuffer.byteLength);
      new Uint8Array(result).set(new Uint8Array(arrayBuffer));
      return result;
    }

    /**
     * Creates a clone of `dataView`.
     *
     * @private
     * @param {Object} dataView The data view to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the cloned data view.
     */
    function cloneDataView(dataView, isDeep) {
      var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;
      return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);
    }

    /**
     * Creates a clone of `regexp`.
     *
     * @private
     * @param {Object} regexp The regexp to clone.
     * @returns {Object} Returns the cloned regexp.
     */
    function cloneRegExp(regexp) {
      var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));
      result.lastIndex = regexp.lastIndex;
      return result;
    }

    /**
     * Creates a clone of the `symbol` object.
     *
     * @private
     * @param {Object} symbol The symbol object to clone.
     * @returns {Object} Returns the cloned symbol object.
     */
    function cloneSymbol(symbol) {
      return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};
    }

    /**
     * Creates a clone of `typedArray`.
     *
     * @private
     * @param {Object} typedArray The typed array to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the cloned typed array.
     */
    function cloneTypedArray(typedArray, isDeep) {
      var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;
      return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);
    }

    /**
     * Compares values to sort them in ascending order.
     *
     * @private
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {number} Returns the sort order indicator for `value`.
     */
    function compareAscending(value, other) {
      if (value !== other) {
        var valIsDefined = value !== undefined,
            valIsNull = value === null,
            valIsReflexive = value === value,
            valIsSymbol = isSymbol(value);

        var othIsDefined = other !== undefined,
            othIsNull = other === null,
            othIsReflexive = other === other,
            othIsSymbol = isSymbol(other);

        if ((!othIsNull && !othIsSymbol && !valIsSymbol && value > other) ||
            (valIsSymbol && othIsDefined && othIsReflexive && !othIsNull && !othIsSymbol) ||
            (valIsNull && othIsDefined && othIsReflexive) ||
            (!valIsDefined && othIsReflexive) ||
            !valIsReflexive) {
          return 1;
        }
        if ((!valIsNull && !valIsSymbol && !othIsSymbol && value < other) ||
            (othIsSymbol && valIsDefined && valIsReflexive && !valIsNull && !valIsSymbol) ||
            (othIsNull && valIsDefined && valIsReflexive) ||
            (!othIsDefined && valIsReflexive) ||
            !othIsReflexive) {
          return -1;
        }
      }
      return 0;
    }

    /**
     * Used by `_.orderBy` to compare multiple properties of a value to another
     * and stable sort them.
     *
     * If `orders` is unspecified, all values are sorted in ascending order. Otherwise,
     * specify an order of "desc" for descending or "asc" for ascending sort order
     * of corresponding values.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {boolean[]|string[]} orders The order to sort by for each property.
     * @returns {number} Returns the sort order indicator for `object`.
     */
    function compareMultiple(object, other, orders) {
      var index = -1,
          objCriteria = object.criteria,
          othCriteria = other.criteria,
          length = objCriteria.length,
          ordersLength = orders.length;

      while (++index < length) {
        var result = compareAscending(objCriteria[index], othCriteria[index]);
        if (result) {
          if (index >= ordersLength) {
            return result;
          }
          var order = orders[index];
          return result * (order == 'desc' ? -1 : 1);
        }
      }
      // Fixes an `Array#sort` bug in the JS engine embedded in Adobe applications
      // that causes it, under certain circumstances, to provide the same value for
      // `object` and `other`. See https://github.com/jashkenas/underscore/pull/1247
      // for more details.
      //
      // This also ensures a stable sort in V8 and other engines.
      // See https://bugs.chromium.org/p/v8/issues/detail?id=90 for more details.
      return object.index - other.index;
    }

    /**
     * Creates an array that is the composition of partially applied arguments,
     * placeholders, and provided arguments into a single array of arguments.
     *
     * @private
     * @param {Array} args The provided arguments.
     * @param {Array} partials The arguments to prepend to those provided.
     * @param {Array} holders The `partials` placeholder indexes.
     * @params {boolean} [isCurried] Specify composing for a curried function.
     * @returns {Array} Returns the new array of composed arguments.
     */
    function composeArgs(args, partials, holders, isCurried) {
      var argsIndex = -1,
          argsLength = args.length,
          holdersLength = holders.length,
          leftIndex = -1,
          leftLength = partials.length,
          rangeLength = nativeMax(argsLength - holdersLength, 0),
          result = Array(leftLength + rangeLength),
          isUncurried = !isCurried;

      while (++leftIndex < leftLength) {
        result[leftIndex] = partials[leftIndex];
      }
      while (++argsIndex < holdersLength) {
        if (isUncurried || argsIndex < argsLength) {
          result[holders[argsIndex]] = args[argsIndex];
        }
      }
      while (rangeLength--) {
        result[leftIndex++] = args[argsIndex++];
      }
      return result;
    }

    /**
     * This function is like `composeArgs` except that the arguments composition
     * is tailored for `_.partialRight`.
     *
     * @private
     * @param {Array} args The provided arguments.
     * @param {Array} partials The arguments to append to those provided.
     * @param {Array} holders The `partials` placeholder indexes.
     * @params {boolean} [isCurried] Specify composing for a curried function.
     * @returns {Array} Returns the new array of composed arguments.
     */
    function composeArgsRight(args, partials, holders, isCurried) {
      var argsIndex = -1,
          argsLength = args.length,
          holdersIndex = -1,
          holdersLength = holders.length,
          rightIndex = -1,
          rightLength = partials.length,
          rangeLength = nativeMax(argsLength - holdersLength, 0),
          result = Array(rangeLength + rightLength),
          isUncurried = !isCurried;

      while (++argsIndex < rangeLength) {
        result[argsIndex] = args[argsIndex];
      }
      var offset = argsIndex;
      while (++rightIndex < rightLength) {
        result[offset + rightIndex] = partials[rightIndex];
      }
      while (++holdersIndex < holdersLength) {
        if (isUncurried || argsIndex < argsLength) {
          result[offset + holders[holdersIndex]] = args[argsIndex++];
        }
      }
      return result;
    }

    /**
     * Copies the values of `source` to `array`.
     *
     * @private
     * @param {Array} source The array to copy values from.
     * @param {Array} [array=[]] The array to copy values to.
     * @returns {Array} Returns `array`.
     */
    function copyArray(source, array) {
      var index = -1,
          length = source.length;

      array || (array = Array(length));
      while (++index < length) {
        array[index] = source[index];
      }
      return array;
    }

    /**
     * Copies properties of `source` to `object`.
     *
     * @private
     * @param {Object} source The object to copy properties from.
     * @param {Array} props The property identifiers to copy.
     * @param {Object} [object={}] The object to copy properties to.
     * @param {Function} [customizer] The function to customize copied values.
     * @returns {Object} Returns `object`.
     */
    function copyObject(source, props, object, customizer) {
      var isNew = !object;
      object || (object = {});

      var index = -1,
          length = props.length;

      while (++index < length) {
        var key = props[index];

        var newValue = customizer
          ? customizer(object[key], source[key], key, object, source)
          : undefined;

        if (newValue === undefined) {
          newValue = source[key];
        }
        if (isNew) {
          baseAssignValue(object, key, newValue);
        } else {
          assignValue(object, key, newValue);
        }
      }
      return object;
    }

    /**
     * Copies own symbols of `source` to `object`.
     *
     * @private
     * @param {Object} source The object to copy symbols from.
     * @param {Object} [object={}] The object to copy symbols to.
     * @returns {Object} Returns `object`.
     */
    function copySymbols(source, object) {
      return copyObject(source, getSymbols(source), object);
    }

    /**
     * Copies own and inherited symbols of `source` to `object`.
     *
     * @private
     * @param {Object} source The object to copy symbols from.
     * @param {Object} [object={}] The object to copy symbols to.
     * @returns {Object} Returns `object`.
     */
    function copySymbolsIn(source, object) {
      return copyObject(source, getSymbolsIn(source), object);
    }

    /**
     * Creates a function like `_.groupBy`.
     *
     * @private
     * @param {Function} setter The function to set accumulator values.
     * @param {Function} [initializer] The accumulator object initializer.
     * @returns {Function} Returns the new aggregator function.
     */
    function createAggregator(setter, initializer) {
      return function(collection, iteratee) {
        var func = isArray(collection) ? arrayAggregator : baseAggregator,
            accumulator = initializer ? initializer() : {};

        return func(collection, setter, getIteratee(iteratee, 2), accumulator);
      };
    }

    /**
     * Creates a function like `_.assign`.
     *
     * @private
     * @param {Function} assigner The function to assign values.
     * @returns {Function} Returns the new assigner function.
     */
    function createAssigner(assigner) {
      return baseRest(function(object, sources) {
        var index = -1,
            length = sources.length,
            customizer = length > 1 ? sources[length - 1] : undefined,
            guard = length > 2 ? sources[2] : undefined;

        customizer = (assigner.length > 3 && typeof customizer == 'function')
          ? (length--, customizer)
          : undefined;

        if (guard && isIterateeCall(sources[0], sources[1], guard)) {
          customizer = length < 3 ? undefined : customizer;
          length = 1;
        }
        object = Object(object);
        while (++index < length) {
          var source = sources[index];
          if (source) {
            assigner(object, source, index, customizer);
          }
        }
        return object;
      });
    }

    /**
     * Creates a `baseEach` or `baseEachRight` function.
     *
     * @private
     * @param {Function} eachFunc The function to iterate over a collection.
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new base function.
     */
    function createBaseEach(eachFunc, fromRight) {
      return function(collection, iteratee) {
        if (collection == null) {
          return collection;
        }
        if (!isArrayLike(collection)) {
          return eachFunc(collection, iteratee);
        }
        var length = collection.length,
            index = fromRight ? length : -1,
            iterable = Object(collection);

        while ((fromRight ? index-- : ++index < length)) {
          if (iteratee(iterable[index], index, iterable) === false) {
            break;
          }
        }
        return collection;
      };
    }

    /**
     * Creates a base function for methods like `_.forIn` and `_.forOwn`.
     *
     * @private
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new base function.
     */
    function createBaseFor(fromRight) {
      return function(object, iteratee, keysFunc) {
        var index = -1,
            iterable = Object(object),
            props = keysFunc(object),
            length = props.length;

        while (length--) {
          var key = props[fromRight ? length : ++index];
          if (iteratee(iterable[key], key, iterable) === false) {
            break;
          }
        }
        return object;
      };
    }

    /**
     * Creates a function that wraps `func` to invoke it with the optional `this`
     * binding of `thisArg`.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createBind(func, bitmask, thisArg) {
      var isBind = bitmask & WRAP_BIND_FLAG,
          Ctor = createCtor(func);

      function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }
      return wrapper;
    }

    /**
     * Creates a function like `_.lowerFirst`.
     *
     * @private
     * @param {string} methodName The name of the `String` case method to use.
     * @returns {Function} Returns the new case function.
     */
    function createCaseFirst(methodName) {
      return function(string) {
        string = toString(string);

        var strSymbols = hasUnicode(string)
          ? stringToArray(string)
          : undefined;

        var chr = strSymbols
          ? strSymbols[0]
          : string.charAt(0);

        var trailing = strSymbols
          ? castSlice(strSymbols, 1).join('')
          : string.slice(1);

        return chr[methodName]() + trailing;
      };
    }

    /**
     * Creates a function like `_.camelCase`.
     *
     * @private
     * @param {Function} callback The function to combine each word.
     * @returns {Function} Returns the new compounder function.
     */
    function createCompounder(callback) {
      return function(string) {
        return arrayReduce(words(deburr(string).replace(reApos, '')), callback, '');
      };
    }

    /**
     * Creates a function that produces an instance of `Ctor` regardless of
     * whether it was invoked as part of a `new` expression or by `call` or `apply`.
     *
     * @private
     * @param {Function} Ctor The constructor to wrap.
     * @returns {Function} Returns the new wrapped function.
     */
    function createCtor(Ctor) {
      return function() {
        // Use a `switch` statement to work with class constructors. See
        // http://ecma-international.org/ecma-262/7.0/#sec-ecmascript-function-objects-call-thisargument-argumentslist
        // for more details.
        var args = arguments;
        switch (args.length) {
          case 0: return new Ctor;
          case 1: return new Ctor(args[0]);
          case 2: return new Ctor(args[0], args[1]);
          case 3: return new Ctor(args[0], args[1], args[2]);
          case 4: return new Ctor(args[0], args[1], args[2], args[3]);
          case 5: return new Ctor(args[0], args[1], args[2], args[3], args[4]);
          case 6: return new Ctor(args[0], args[1], args[2], args[3], args[4], args[5]);
          case 7: return new Ctor(args[0], args[1], args[2], args[3], args[4], args[5], args[6]);
        }
        var thisBinding = baseCreate(Ctor.prototype),
            result = Ctor.apply(thisBinding, args);

        // Mimic the constructor's `return` behavior.
        // See https://es5.github.io/#x13.2.2 for more details.
        return isObject(result) ? result : thisBinding;
      };
    }

    /**
     * Creates a function that wraps `func` to enable currying.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {number} arity The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createCurry(func, bitmask, arity) {
      var Ctor = createCtor(func);

      function wrapper() {
        var length = arguments.length,
            args = Array(length),
            index = length,
            placeholder = getHolder(wrapper);

        while (index--) {
          args[index] = arguments[index];
        }
        var holders = (length < 3 && args[0] !== placeholder && args[length - 1] !== placeholder)
          ? []
          : replaceHolders(args, placeholder);

        length -= holders.length;
        if (length < arity) {
          return createRecurry(
            func, bitmask, createHybrid, wrapper.placeholder, undefined,
            args, holders, undefined, undefined, arity - length);
        }
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return apply(fn, this, args);
      }
      return wrapper;
    }

    /**
     * Creates a `_.find` or `_.findLast` function.
     *
     * @private
     * @param {Function} findIndexFunc The function to find the collection index.
     * @returns {Function} Returns the new find function.
     */
    function createFind(findIndexFunc) {
      return function(collection, predicate, fromIndex) {
        var iterable = Object(collection);
        if (!isArrayLike(collection)) {
          var iteratee = getIteratee(predicate, 3);
          collection = keys(collection);
          predicate = function(key) { return iteratee(iterable[key], key, iterable); };
        }
        var index = findIndexFunc(collection, predicate, fromIndex);
        return index > -1 ? iterable[iteratee ? collection[index] : index] : undefined;
      };
    }

    /**
     * Creates a `_.flow` or `_.flowRight` function.
     *
     * @private
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new flow function.
     */
    function createFlow(fromRight) {
      return flatRest(function(funcs) {
        var length = funcs.length,
            index = length,
            prereq = LodashWrapper.prototype.thru;

        if (fromRight) {
          funcs.reverse();
        }
        while (index--) {
          var func = funcs[index];
          if (typeof func != 'function') {
            throw new TypeError(FUNC_ERROR_TEXT);
          }
          if (prereq && !wrapper && getFuncName(func) == 'wrapper') {
            var wrapper = new LodashWrapper([], true);
          }
        }
        index = wrapper ? index : length;
        while (++index < length) {
          func = funcs[index];

          var funcName = getFuncName(func),
              data = funcName == 'wrapper' ? getData(func) : undefined;

          if (data && isLaziable(data[0]) &&
                data[1] == (WRAP_ARY_FLAG | WRAP_CURRY_FLAG | WRAP_PARTIAL_FLAG | WRAP_REARG_FLAG) &&
                !data[4].length && data[9] == 1
              ) {
            wrapper = wrapper[getFuncName(data[0])].apply(wrapper, data[3]);
          } else {
            wrapper = (func.length == 1 && isLaziable(func))
              ? wrapper[funcName]()
              : wrapper.thru(func);
          }
        }
        return function() {
          var args = arguments,
              value = args[0];

          if (wrapper && args.length == 1 && isArray(value)) {
            return wrapper.plant(value).value();
          }
          var index = 0,
              result = length ? funcs[index].apply(this, args) : value;

          while (++index < length) {
            result = funcs[index].call(this, result);
          }
          return result;
        };
      });
    }

    /**
     * Creates a function that wraps `func` to invoke it with optional `this`
     * binding of `thisArg`, partial application, and currying.
     *
     * @private
     * @param {Function|string} func The function or method name to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to prepend to those provided to
     *  the new function.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [partialsRight] The arguments to append to those provided
     *  to the new function.
     * @param {Array} [holdersRight] The `partialsRight` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createHybrid(func, bitmask, thisArg, partials, holders, partialsRight, holdersRight, argPos, ary, arity) {
      var isAry = bitmask & WRAP_ARY_FLAG,
          isBind = bitmask & WRAP_BIND_FLAG,
          isBindKey = bitmask & WRAP_BIND_KEY_FLAG,
          isCurried = bitmask & (WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG),
          isFlip = bitmask & WRAP_FLIP_FLAG,
          Ctor = isBindKey ? undefined : createCtor(func);

      function wrapper() {
        var length = arguments.length,
            args = Array(length),
            index = length;

        while (index--) {
          args[index] = arguments[index];
        }
        if (isCurried) {
          var placeholder = getHolder(wrapper),
              holdersCount = countHolders(args, placeholder);
        }
        if (partials) {
          args = composeArgs(args, partials, holders, isCurried);
        }
        if (partialsRight) {
          args = composeArgsRight(args, partialsRight, holdersRight, isCurried);
        }
        length -= holdersCount;
        if (isCurried && length < arity) {
          var newHolders = replaceHolders(args, placeholder);
          return createRecurry(
            func, bitmask, createHybrid, wrapper.placeholder, thisArg,
            args, newHolders, argPos, ary, arity - length
          );
        }
        var thisBinding = isBind ? thisArg : this,
            fn = isBindKey ? thisBinding[func] : func;

        length = args.length;
        if (argPos) {
          args = reorder(args, argPos);
        } else if (isFlip && length > 1) {
          args.reverse();
        }
        if (isAry && ary < length) {
          args.length = ary;
        }
        if (this && this !== root && this instanceof wrapper) {
          fn = Ctor || createCtor(fn);
        }
        return fn.apply(thisBinding, args);
      }
      return wrapper;
    }

    /**
     * Creates a function like `_.invertBy`.
     *
     * @private
     * @param {Function} setter The function to set accumulator values.
     * @param {Function} toIteratee The function to resolve iteratees.
     * @returns {Function} Returns the new inverter function.
     */
    function createInverter(setter, toIteratee) {
      return function(object, iteratee) {
        return baseInverter(object, setter, toIteratee(iteratee), {});
      };
    }

    /**
     * Creates a function that performs a mathematical operation on two values.
     *
     * @private
     * @param {Function} operator The function to perform the operation.
     * @param {number} [defaultValue] The value used for `undefined` arguments.
     * @returns {Function} Returns the new mathematical operation function.
     */
    function createMathOperation(operator, defaultValue) {
      return function(value, other) {
        var result;
        if (value === undefined && other === undefined) {
          return defaultValue;
        }
        if (value !== undefined) {
          result = value;
        }
        if (other !== undefined) {
          if (result === undefined) {
            return other;
          }
          if (typeof value == 'string' || typeof other == 'string') {
            value = baseToString(value);
            other = baseToString(other);
          } else {
            value = baseToNumber(value);
            other = baseToNumber(other);
          }
          result = operator(value, other);
        }
        return result;
      };
    }

    /**
     * Creates a function like `_.over`.
     *
     * @private
     * @param {Function} arrayFunc The function to iterate over iteratees.
     * @returns {Function} Returns the new over function.
     */
    function createOver(arrayFunc) {
      return flatRest(function(iteratees) {
        iteratees = arrayMap(iteratees, baseUnary(getIteratee()));
        return baseRest(function(args) {
          var thisArg = this;
          return arrayFunc(iteratees, function(iteratee) {
            return apply(iteratee, thisArg, args);
          });
        });
      });
    }

    /**
     * Creates the padding for `string` based on `length`. The `chars` string
     * is truncated if the number of characters exceeds `length`.
     *
     * @private
     * @param {number} length The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padding for `string`.
     */
    function createPadding(length, chars) {
      chars = chars === undefined ? ' ' : baseToString(chars);

      var charsLength = chars.length;
      if (charsLength < 2) {
        return charsLength ? baseRepeat(chars, length) : chars;
      }
      var result = baseRepeat(chars, nativeCeil(length / stringSize(chars)));
      return hasUnicode(chars)
        ? castSlice(stringToArray(result), 0, length).join('')
        : result.slice(0, length);
    }

    /**
     * Creates a function that wraps `func` to invoke it with the `this` binding
     * of `thisArg` and `partials` prepended to the arguments it receives.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {*} thisArg The `this` binding of `func`.
     * @param {Array} partials The arguments to prepend to those provided to
     *  the new function.
     * @returns {Function} Returns the new wrapped function.
     */
    function createPartial(func, bitmask, thisArg, partials) {
      var isBind = bitmask & WRAP_BIND_FLAG,
          Ctor = createCtor(func);

      function wrapper() {
        var argsIndex = -1,
            argsLength = arguments.length,
            leftIndex = -1,
            leftLength = partials.length,
            args = Array(leftLength + argsLength),
            fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;

        while (++leftIndex < leftLength) {
          args[leftIndex] = partials[leftIndex];
        }
        while (argsLength--) {
          args[leftIndex++] = arguments[++argsIndex];
        }
        return apply(fn, isBind ? thisArg : this, args);
      }
      return wrapper;
    }

    /**
     * Creates a `_.range` or `_.rangeRight` function.
     *
     * @private
     * @param {boolean} [fromRight] Specify iterating from right to left.
     * @returns {Function} Returns the new range function.
     */
    function createRange(fromRight) {
      return function(start, end, step) {
        if (step && typeof step != 'number' && isIterateeCall(start, end, step)) {
          end = step = undefined;
        }
        // Ensure the sign of `-0` is preserved.
        start = toFinite(start);
        if (end === undefined) {
          end = start;
          start = 0;
        } else {
          end = toFinite(end);
        }
        step = step === undefined ? (start < end ? 1 : -1) : toFinite(step);
        return baseRange(start, end, step, fromRight);
      };
    }

    /**
     * Creates a function that performs a relational operation on two values.
     *
     * @private
     * @param {Function} operator The function to perform the operation.
     * @returns {Function} Returns the new relational operation function.
     */
    function createRelationalOperation(operator) {
      return function(value, other) {
        if (!(typeof value == 'string' && typeof other == 'string')) {
          value = toNumber(value);
          other = toNumber(other);
        }
        return operator(value, other);
      };
    }

    /**
     * Creates a function that wraps `func` to continue currying.
     *
     * @private
     * @param {Function} func The function to wrap.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @param {Function} wrapFunc The function to create the `func` wrapper.
     * @param {*} placeholder The placeholder value.
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to prepend to those provided to
     *  the new function.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createRecurry(func, bitmask, wrapFunc, placeholder, thisArg, partials, holders, argPos, ary, arity) {
      var isCurry = bitmask & WRAP_CURRY_FLAG,
          newHolders = isCurry ? holders : undefined,
          newHoldersRight = isCurry ? undefined : holders,
          newPartials = isCurry ? partials : undefined,
          newPartialsRight = isCurry ? undefined : partials;

      bitmask |= (isCurry ? WRAP_PARTIAL_FLAG : WRAP_PARTIAL_RIGHT_FLAG);
      bitmask &= ~(isCurry ? WRAP_PARTIAL_RIGHT_FLAG : WRAP_PARTIAL_FLAG);

      if (!(bitmask & WRAP_CURRY_BOUND_FLAG)) {
        bitmask &= ~(WRAP_BIND_FLAG | WRAP_BIND_KEY_FLAG);
      }
      var newData = [
        func, bitmask, thisArg, newPartials, newHolders, newPartialsRight,
        newHoldersRight, argPos, ary, arity
      ];

      var result = wrapFunc.apply(undefined, newData);
      if (isLaziable(func)) {
        setData(result, newData);
      }
      result.placeholder = placeholder;
      return setWrapToString(result, func, bitmask);
    }

    /**
     * Creates a function like `_.round`.
     *
     * @private
     * @param {string} methodName The name of the `Math` method to use when rounding.
     * @returns {Function} Returns the new round function.
     */
    function createRound(methodName) {
      var func = Math[methodName];
      return function(number, precision) {
        number = toNumber(number);
        precision = precision == null ? 0 : nativeMin(toInteger(precision), 292);
        if (precision && nativeIsFinite(number)) {
          // Shift with exponential notation to avoid floating-point issues.
          // See [MDN](https://mdn.io/round#Examples) for more details.
          var pair = (toString(number) + 'e').split('e'),
              value = func(pair[0] + 'e' + (+pair[1] + precision));

          pair = (toString(value) + 'e').split('e');
          return +(pair[0] + 'e' + (+pair[1] - precision));
        }
        return func(number);
      };
    }

    /**
     * Creates a set object of `values`.
     *
     * @private
     * @param {Array} values The values to add to the set.
     * @returns {Object} Returns the new set.
     */
    var createSet = !(Set && (1 / setToArray(new Set([,-0]))[1]) == INFINITY) ? noop : function(values) {
      return new Set(values);
    };

    /**
     * Creates a `_.toPairs` or `_.toPairsIn` function.
     *
     * @private
     * @param {Function} keysFunc The function to get the keys of a given object.
     * @returns {Function} Returns the new pairs function.
     */
    function createToPairs(keysFunc) {
      return function(object) {
        var tag = getTag(object);
        if (tag == mapTag) {
          return mapToArray(object);
        }
        if (tag == setTag) {
          return setToPairs(object);
        }
        return baseToPairs(object, keysFunc(object));
      };
    }

    /**
     * Creates a function that either curries or invokes `func` with optional
     * `this` binding and partially applied arguments.
     *
     * @private
     * @param {Function|string} func The function or method name to wrap.
     * @param {number} bitmask The bitmask flags.
     *    1 - `_.bind`
     *    2 - `_.bindKey`
     *    4 - `_.curry` or `_.curryRight` of a bound function
     *    8 - `_.curry`
     *   16 - `_.curryRight`
     *   32 - `_.partial`
     *   64 - `_.partialRight`
     *  128 - `_.rearg`
     *  256 - `_.ary`
     *  512 - `_.flip`
     * @param {*} [thisArg] The `this` binding of `func`.
     * @param {Array} [partials] The arguments to be partially applied.
     * @param {Array} [holders] The `partials` placeholder indexes.
     * @param {Array} [argPos] The argument positions of the new function.
     * @param {number} [ary] The arity cap of `func`.
     * @param {number} [arity] The arity of `func`.
     * @returns {Function} Returns the new wrapped function.
     */
    function createWrap(func, bitmask, thisArg, partials, holders, argPos, ary, arity) {
      var isBindKey = bitmask & WRAP_BIND_KEY_FLAG;
      if (!isBindKey && typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      var length = partials ? partials.length : 0;
      if (!length) {
        bitmask &= ~(WRAP_PARTIAL_FLAG | WRAP_PARTIAL_RIGHT_FLAG);
        partials = holders = undefined;
      }
      ary = ary === undefined ? ary : nativeMax(toInteger(ary), 0);
      arity = arity === undefined ? arity : toInteger(arity);
      length -= holders ? holders.length : 0;

      if (bitmask & WRAP_PARTIAL_RIGHT_FLAG) {
        var partialsRight = partials,
            holdersRight = holders;

        partials = holders = undefined;
      }
      var data = isBindKey ? undefined : getData(func);

      var newData = [
        func, bitmask, thisArg, partials, holders, partialsRight, holdersRight,
        argPos, ary, arity
      ];

      if (data) {
        mergeData(newData, data);
      }
      func = newData[0];
      bitmask = newData[1];
      thisArg = newData[2];
      partials = newData[3];
      holders = newData[4];
      arity = newData[9] = newData[9] === undefined
        ? (isBindKey ? 0 : func.length)
        : nativeMax(newData[9] - length, 0);

      if (!arity && bitmask & (WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG)) {
        bitmask &= ~(WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG);
      }
      if (!bitmask || bitmask == WRAP_BIND_FLAG) {
        var result = createBind(func, bitmask, thisArg);
      } else if (bitmask == WRAP_CURRY_FLAG || bitmask == WRAP_CURRY_RIGHT_FLAG) {
        result = createCurry(func, bitmask, arity);
      } else if ((bitmask == WRAP_PARTIAL_FLAG || bitmask == (WRAP_BIND_FLAG | WRAP_PARTIAL_FLAG)) && !holders.length) {
        result = createPartial(func, bitmask, thisArg, partials);
      } else {
        result = createHybrid.apply(undefined, newData);
      }
      var setter = data ? baseSetData : setData;
      return setWrapToString(setter(result, newData), func, bitmask);
    }

    /**
     * Used by `_.defaults` to customize its `_.assignIn` use to assign properties
     * of source objects to the destination object for all destination properties
     * that resolve to `undefined`.
     *
     * @private
     * @param {*} objValue The destination value.
     * @param {*} srcValue The source value.
     * @param {string} key The key of the property to assign.
     * @param {Object} object The parent object of `objValue`.
     * @returns {*} Returns the value to assign.
     */
    function customDefaultsAssignIn(objValue, srcValue, key, object) {
      if (objValue === undefined ||
          (eq(objValue, objectProto[key]) && !hasOwnProperty.call(object, key))) {
        return srcValue;
      }
      return objValue;
    }

    /**
     * Used by `_.defaultsDeep` to customize its `_.merge` use to merge source
     * objects into destination objects that are passed thru.
     *
     * @private
     * @param {*} objValue The destination value.
     * @param {*} srcValue The source value.
     * @param {string} key The key of the property to merge.
     * @param {Object} object The parent object of `objValue`.
     * @param {Object} source The parent object of `srcValue`.
     * @param {Object} [stack] Tracks traversed source values and their merged
     *  counterparts.
     * @returns {*} Returns the value to assign.
     */
    function customDefaultsMerge(objValue, srcValue, key, object, source, stack) {
      if (isObject(objValue) && isObject(srcValue)) {
        // Recursively merge objects and arrays (susceptible to call stack limits).
        stack.set(srcValue, objValue);
        baseMerge(objValue, srcValue, undefined, customDefaultsMerge, stack);
        stack['delete'](srcValue);
      }
      return objValue;
    }

    /**
     * Used by `_.omit` to customize its `_.cloneDeep` use to only clone plain
     * objects.
     *
     * @private
     * @param {*} value The value to inspect.
     * @param {string} key The key of the property to inspect.
     * @returns {*} Returns the uncloned value or `undefined` to defer cloning to `_.cloneDeep`.
     */
    function customOmitClone(value) {
      return isPlainObject(value) ? undefined : value;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for arrays with support for
     * partial deep comparisons.
     *
     * @private
     * @param {Array} array The array to compare.
     * @param {Array} other The other array to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} stack Tracks traversed `array` and `other` objects.
     * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.
     */
    function equalArrays(array, other, bitmask, customizer, equalFunc, stack) {
      var isPartial = bitmask & COMPARE_PARTIAL_FLAG,
          arrLength = array.length,
          othLength = other.length;

      if (arrLength != othLength && !(isPartial && othLength > arrLength)) {
        return false;
      }
      // Assume cyclic values are equal.
      var stacked = stack.get(array);
      if (stacked && stack.get(other)) {
        return stacked == other;
      }
      var index = -1,
          result = true,
          seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;

      stack.set(array, other);
      stack.set(other, array);

      // Ignore non-index properties.
      while (++index < arrLength) {
        var arrValue = array[index],
            othValue = other[index];

        if (customizer) {
          var compared = isPartial
            ? customizer(othValue, arrValue, index, other, array, stack)
            : customizer(arrValue, othValue, index, array, other, stack);
        }
        if (compared !== undefined) {
          if (compared) {
            continue;
          }
          result = false;
          break;
        }
        // Recursively compare arrays (susceptible to call stack limits).
        if (seen) {
          if (!arraySome(other, function(othValue, othIndex) {
                if (!cacheHas(seen, othIndex) &&
                    (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {
                  return seen.push(othIndex);
                }
              })) {
            result = false;
            break;
          }
        } else if (!(
              arrValue === othValue ||
                equalFunc(arrValue, othValue, bitmask, customizer, stack)
            )) {
          result = false;
          break;
        }
      }
      stack['delete'](array);
      stack['delete'](other);
      return result;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for comparing objects of
     * the same `toStringTag`.
     *
     * **Note:** This function only supports comparing values with tags of
     * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {string} tag The `toStringTag` of the objects to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} stack Tracks traversed `object` and `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {
      switch (tag) {
        case dataViewTag:
          if ((object.byteLength != other.byteLength) ||
              (object.byteOffset != other.byteOffset)) {
            return false;
          }
          object = object.buffer;
          other = other.buffer;

        case arrayBufferTag:
          if ((object.byteLength != other.byteLength) ||
              !equalFunc(new Uint8Array(object), new Uint8Array(other))) {
            return false;
          }
          return true;

        case boolTag:
        case dateTag:
        case numberTag:
          // Coerce booleans to `1` or `0` and dates to milliseconds.
          // Invalid dates are coerced to `NaN`.
          return eq(+object, +other);

        case errorTag:
          return object.name == other.name && object.message == other.message;

        case regexpTag:
        case stringTag:
          // Coerce regexes to strings and treat strings, primitives and objects,
          // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring
          // for more details.
          return object == (other + '');

        case mapTag:
          var convert = mapToArray;

        case setTag:
          var isPartial = bitmask & COMPARE_PARTIAL_FLAG;
          convert || (convert = setToArray);

          if (object.size != other.size && !isPartial) {
            return false;
          }
          // Assume cyclic values are equal.
          var stacked = stack.get(object);
          if (stacked) {
            return stacked == other;
          }
          bitmask |= COMPARE_UNORDERED_FLAG;

          // Recursively compare objects (susceptible to call stack limits).
          stack.set(object, other);
          var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);
          stack['delete'](object);
          return result;

        case symbolTag:
          if (symbolValueOf) {
            return symbolValueOf.call(object) == symbolValueOf.call(other);
          }
      }
      return false;
    }

    /**
     * A specialized version of `baseIsEqualDeep` for objects with support for
     * partial deep comparisons.
     *
     * @private
     * @param {Object} object The object to compare.
     * @param {Object} other The other object to compare.
     * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.
     * @param {Function} customizer The function to customize comparisons.
     * @param {Function} equalFunc The function to determine equivalents of values.
     * @param {Object} stack Tracks traversed `object` and `other` objects.
     * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.
     */
    function equalObjects(object, other, bitmask, customizer, equalFunc, stack) {
      var isPartial = bitmask & COMPARE_PARTIAL_FLAG,
          objProps = getAllKeys(object),
          objLength = objProps.length,
          othProps = getAllKeys(other),
          othLength = othProps.length;

      if (objLength != othLength && !isPartial) {
        return false;
      }
      var index = objLength;
      while (index--) {
        var key = objProps[index];
        if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {
          return false;
        }
      }
      // Assume cyclic values are equal.
      var stacked = stack.get(object);
      if (stacked && stack.get(other)) {
        return stacked == other;
      }
      var result = true;
      stack.set(object, other);
      stack.set(other, object);

      var skipCtor = isPartial;
      while (++index < objLength) {
        key = objProps[index];
        var objValue = object[key],
            othValue = other[key];

        if (customizer) {
          var compared = isPartial
            ? customizer(othValue, objValue, key, other, object, stack)
            : customizer(objValue, othValue, key, object, other, stack);
        }
        // Recursively compare objects (susceptible to call stack limits).
        if (!(compared === undefined
              ? (objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack))
              : compared
            )) {
          result = false;
          break;
        }
        skipCtor || (skipCtor = key == 'constructor');
      }
      if (result && !skipCtor) {
        var objCtor = object.constructor,
            othCtor = other.constructor;

        // Non `Object` object instances with different constructors are not equal.
        if (objCtor != othCtor &&
            ('constructor' in object && 'constructor' in other) &&
            !(typeof objCtor == 'function' && objCtor instanceof objCtor &&
              typeof othCtor == 'function' && othCtor instanceof othCtor)) {
          result = false;
        }
      }
      stack['delete'](object);
      stack['delete'](other);
      return result;
    }

    /**
     * A specialized version of `baseRest` which flattens the rest array.
     *
     * @private
     * @param {Function} func The function to apply a rest parameter to.
     * @returns {Function} Returns the new function.
     */
    function flatRest(func) {
      return setToString(overRest(func, undefined, flatten), func + '');
    }

    /**
     * Creates an array of own enumerable property names and symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names and symbols.
     */
    function getAllKeys(object) {
      return baseGetAllKeys(object, keys, getSymbols);
    }

    /**
     * Creates an array of own and inherited enumerable property names and
     * symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names and symbols.
     */
    function getAllKeysIn(object) {
      return baseGetAllKeys(object, keysIn, getSymbolsIn);
    }

    /**
     * Gets metadata for `func`.
     *
     * @private
     * @param {Function} func The function to query.
     * @returns {*} Returns the metadata for `func`.
     */
    var getData = !metaMap ? noop : function(func) {
      return metaMap.get(func);
    };

    /**
     * Gets the name of `func`.
     *
     * @private
     * @param {Function} func The function to query.
     * @returns {string} Returns the function name.
     */
    function getFuncName(func) {
      var result = (func.name + ''),
          array = realNames[result],
          length = hasOwnProperty.call(realNames, result) ? array.length : 0;

      while (length--) {
        var data = array[length],
            otherFunc = data.func;
        if (otherFunc == null || otherFunc == func) {
          return data.name;
        }
      }
      return result;
    }

    /**
     * Gets the argument placeholder value for `func`.
     *
     * @private
     * @param {Function} func The function to inspect.
     * @returns {*} Returns the placeholder value.
     */
    function getHolder(func) {
      var object = hasOwnProperty.call(lodash, 'placeholder') ? lodash : func;
      return object.placeholder;
    }

    /**
     * Gets the appropriate "iteratee" function. If `_.iteratee` is customized,
     * this function returns the custom method, otherwise it returns `baseIteratee`.
     * If arguments are provided, the chosen function is invoked with them and
     * its result is returned.
     *
     * @private
     * @param {*} [value] The value to convert to an iteratee.
     * @param {number} [arity] The arity of the created iteratee.
     * @returns {Function} Returns the chosen function or its result.
     */
    function getIteratee() {
      var result = lodash.iteratee || iteratee;
      result = result === iteratee ? baseIteratee : result;
      return arguments.length ? result(arguments[0], arguments[1]) : result;
    }

    /**
     * Gets the data for `map`.
     *
     * @private
     * @param {Object} map The map to query.
     * @param {string} key The reference key.
     * @returns {*} Returns the map data.
     */
    function getMapData(map, key) {
      var data = map.__data__;
      return isKeyable(key)
        ? data[typeof key == 'string' ? 'string' : 'hash']
        : data.map;
    }

    /**
     * Gets the property names, values, and compare flags of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the match data of `object`.
     */
    function getMatchData(object) {
      var result = keys(object),
          length = result.length;

      while (length--) {
        var key = result[length],
            value = object[key];

        result[length] = [key, value, isStrictComparable(value)];
      }
      return result;
    }

    /**
     * Gets the native function at `key` of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {string} key The key of the method to get.
     * @returns {*} Returns the function if it's native, else `undefined`.
     */
    function getNative(object, key) {
      var value = getValue(object, key);
      return baseIsNative(value) ? value : undefined;
    }

    /**
     * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.
     *
     * @private
     * @param {*} value The value to query.
     * @returns {string} Returns the raw `toStringTag`.
     */
    function getRawTag(value) {
      var isOwn = hasOwnProperty.call(value, symToStringTag),
          tag = value[symToStringTag];

      try {
        value[symToStringTag] = undefined;
        var unmasked = true;
      } catch (e) {}

      var result = nativeObjectToString.call(value);
      if (unmasked) {
        if (isOwn) {
          value[symToStringTag] = tag;
        } else {
          delete value[symToStringTag];
        }
      }
      return result;
    }

    /**
     * Creates an array of the own enumerable symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of symbols.
     */
    var getSymbols = !nativeGetSymbols ? stubArray : function(object) {
      if (object == null) {
        return [];
      }
      object = Object(object);
      return arrayFilter(nativeGetSymbols(object), function(symbol) {
        return propertyIsEnumerable.call(object, symbol);
      });
    };

    /**
     * Creates an array of the own and inherited enumerable symbols of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of symbols.
     */
    var getSymbolsIn = !nativeGetSymbols ? stubArray : function(object) {
      var result = [];
      while (object) {
        arrayPush(result, getSymbols(object));
        object = getPrototype(object);
      }
      return result;
    };

    /**
     * Gets the `toStringTag` of `value`.
     *
     * @private
     * @param {*} value The value to query.
     * @returns {string} Returns the `toStringTag`.
     */
    var getTag = baseGetTag;

    // Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.
    if ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||
        (Map && getTag(new Map) != mapTag) ||
        (Promise && getTag(Promise.resolve()) != promiseTag) ||
        (Set && getTag(new Set) != setTag) ||
        (WeakMap && getTag(new WeakMap) != weakMapTag)) {
      getTag = function(value) {
        var result = baseGetTag(value),
            Ctor = result == objectTag ? value.constructor : undefined,
            ctorString = Ctor ? toSource(Ctor) : '';

        if (ctorString) {
          switch (ctorString) {
            case dataViewCtorString: return dataViewTag;
            case mapCtorString: return mapTag;
            case promiseCtorString: return promiseTag;
            case setCtorString: return setTag;
            case weakMapCtorString: return weakMapTag;
          }
        }
        return result;
      };
    }

    /**
     * Gets the view, applying any `transforms` to the `start` and `end` positions.
     *
     * @private
     * @param {number} start The start of the view.
     * @param {number} end The end of the view.
     * @param {Array} transforms The transformations to apply to the view.
     * @returns {Object} Returns an object containing the `start` and `end`
     *  positions of the view.
     */
    function getView(start, end, transforms) {
      var index = -1,
          length = transforms.length;

      while (++index < length) {
        var data = transforms[index],
            size = data.size;

        switch (data.type) {
          case 'drop':      start += size; break;
          case 'dropRight': end -= size; break;
          case 'take':      end = nativeMin(end, start + size); break;
          case 'takeRight': start = nativeMax(start, end - size); break;
        }
      }
      return { 'start': start, 'end': end };
    }

    /**
     * Extracts wrapper details from the `source` body comment.
     *
     * @private
     * @param {string} source The source to inspect.
     * @returns {Array} Returns the wrapper details.
     */
    function getWrapDetails(source) {
      var match = source.match(reWrapDetails);
      return match ? match[1].split(reSplitDetails) : [];
    }

    /**
     * Checks if `path` exists on `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array|string} path The path to check.
     * @param {Function} hasFunc The function to check properties.
     * @returns {boolean} Returns `true` if `path` exists, else `false`.
     */
    function hasPath(object, path, hasFunc) {
      path = castPath(path, object);

      var index = -1,
          length = path.length,
          result = false;

      while (++index < length) {
        var key = toKey(path[index]);
        if (!(result = object != null && hasFunc(object, key))) {
          break;
        }
        object = object[key];
      }
      if (result || ++index != length) {
        return result;
      }
      length = object == null ? 0 : object.length;
      return !!length && isLength(length) && isIndex(key, length) &&
        (isArray(object) || isArguments(object));
    }

    /**
     * Initializes an array clone.
     *
     * @private
     * @param {Array} array The array to clone.
     * @returns {Array} Returns the initialized clone.
     */
    function initCloneArray(array) {
      var length = array.length,
          result = new array.constructor(length);

      // Add properties assigned by `RegExp#exec`.
      if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {
        result.index = array.index;
        result.input = array.input;
      }
      return result;
    }

    /**
     * Initializes an object clone.
     *
     * @private
     * @param {Object} object The object to clone.
     * @returns {Object} Returns the initialized clone.
     */
    function initCloneObject(object) {
      return (typeof object.constructor == 'function' && !isPrototype(object))
        ? baseCreate(getPrototype(object))
        : {};
    }

    /**
     * Initializes an object clone based on its `toStringTag`.
     *
     * **Note:** This function only supports cloning values with tags of
     * `Boolean`, `Date`, `Error`, `Map`, `Number`, `RegExp`, `Set`, or `String`.
     *
     * @private
     * @param {Object} object The object to clone.
     * @param {string} tag The `toStringTag` of the object to clone.
     * @param {boolean} [isDeep] Specify a deep clone.
     * @returns {Object} Returns the initialized clone.
     */
    function initCloneByTag(object, tag, isDeep) {
      var Ctor = object.constructor;
      switch (tag) {
        case arrayBufferTag:
          return cloneArrayBuffer(object);

        case boolTag:
        case dateTag:
          return new Ctor(+object);

        case dataViewTag:
          return cloneDataView(object, isDeep);

        case float32Tag: case float64Tag:
        case int8Tag: case int16Tag: case int32Tag:
        case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:
          return cloneTypedArray(object, isDeep);

        case mapTag:
          return new Ctor;

        case numberTag:
        case stringTag:
          return new Ctor(object);

        case regexpTag:
          return cloneRegExp(object);

        case setTag:
          return new Ctor;

        case symbolTag:
          return cloneSymbol(object);
      }
    }

    /**
     * Inserts wrapper `details` in a comment at the top of the `source` body.
     *
     * @private
     * @param {string} source The source to modify.
     * @returns {Array} details The details to insert.
     * @returns {string} Returns the modified source.
     */
    function insertWrapDetails(source, details) {
      var length = details.length;
      if (!length) {
        return source;
      }
      var lastIndex = length - 1;
      details[lastIndex] = (length > 1 ? '& ' : '') + details[lastIndex];
      details = details.join(length > 2 ? ', ' : ' ');
      return source.replace(reWrapComment, '{\n/* [wrapped with ' + details + '] */\n');
    }

    /**
     * Checks if `value` is a flattenable `arguments` object or array.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.
     */
    function isFlattenable(value) {
      return isArray(value) || isArguments(value) ||
        !!(spreadableSymbol && value && value[spreadableSymbol]);
    }

    /**
     * Checks if `value` is a valid array-like index.
     *
     * @private
     * @param {*} value The value to check.
     * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.
     * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.
     */
    function isIndex(value, length) {
      var type = typeof value;
      length = length == null ? MAX_SAFE_INTEGER : length;

      return !!length &&
        (type == 'number' ||
          (type != 'symbol' && reIsUint.test(value))) &&
            (value > -1 && value % 1 == 0 && value < length);
    }

    /**
     * Checks if the given arguments are from an iteratee call.
     *
     * @private
     * @param {*} value The potential iteratee value argument.
     * @param {*} index The potential iteratee index or key argument.
     * @param {*} object The potential iteratee object argument.
     * @returns {boolean} Returns `true` if the arguments are from an iteratee call,
     *  else `false`.
     */
    function isIterateeCall(value, index, object) {
      if (!isObject(object)) {
        return false;
      }
      var type = typeof index;
      if (type == 'number'
            ? (isArrayLike(object) && isIndex(index, object.length))
            : (type == 'string' && index in object)
          ) {
        return eq(object[index], value);
      }
      return false;
    }

    /**
     * Checks if `value` is a property name and not a property path.
     *
     * @private
     * @param {*} value The value to check.
     * @param {Object} [object] The object to query keys on.
     * @returns {boolean} Returns `true` if `value` is a property name, else `false`.
     */
    function isKey(value, object) {
      if (isArray(value)) {
        return false;
      }
      var type = typeof value;
      if (type == 'number' || type == 'symbol' || type == 'boolean' ||
          value == null || isSymbol(value)) {
        return true;
      }
      return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||
        (object != null && value in Object(object));
    }

    /**
     * Checks if `value` is suitable for use as unique object key.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is suitable, else `false`.
     */
    function isKeyable(value) {
      var type = typeof value;
      return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')
        ? (value !== '__proto__')
        : (value === null);
    }

    /**
     * Checks if `func` has a lazy counterpart.
     *
     * @private
     * @param {Function} func The function to check.
     * @returns {boolean} Returns `true` if `func` has a lazy counterpart,
     *  else `false`.
     */
    function isLaziable(func) {
      var funcName = getFuncName(func),
          other = lodash[funcName];

      if (typeof other != 'function' || !(funcName in LazyWrapper.prototype)) {
        return false;
      }
      if (func === other) {
        return true;
      }
      var data = getData(other);
      return !!data && func === data[0];
    }

    /**
     * Checks if `func` has its source masked.
     *
     * @private
     * @param {Function} func The function to check.
     * @returns {boolean} Returns `true` if `func` is masked, else `false`.
     */
    function isMasked(func) {
      return !!maskSrcKey && (maskSrcKey in func);
    }

    /**
     * Checks if `func` is capable of being masked.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `func` is maskable, else `false`.
     */
    var isMaskable = coreJsData ? isFunction : stubFalse;

    /**
     * Checks if `value` is likely a prototype object.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.
     */
    function isPrototype(value) {
      var Ctor = value && value.constructor,
          proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;

      return value === proto;
    }

    /**
     * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.
     *
     * @private
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` if suitable for strict
     *  equality comparisons, else `false`.
     */
    function isStrictComparable(value) {
      return value === value && !isObject(value);
    }

    /**
     * A specialized version of `matchesProperty` for source values suitable
     * for strict equality comparisons, i.e. `===`.
     *
     * @private
     * @param {string} key The key of the property to get.
     * @param {*} srcValue The value to match.
     * @returns {Function} Returns the new spec function.
     */
    function matchesStrictComparable(key, srcValue) {
      return function(object) {
        if (object == null) {
          return false;
        }
        return object[key] === srcValue &&
          (srcValue !== undefined || (key in Object(object)));
      };
    }

    /**
     * A specialized version of `_.memoize` which clears the memoized function's
     * cache when it exceeds `MAX_MEMOIZE_SIZE`.
     *
     * @private
     * @param {Function} func The function to have its output memoized.
     * @returns {Function} Returns the new memoized function.
     */
    function memoizeCapped(func) {
      var result = memoize(func, function(key) {
        if (cache.size === MAX_MEMOIZE_SIZE) {
          cache.clear();
        }
        return key;
      });

      var cache = result.cache;
      return result;
    }

    /**
     * Merges the function metadata of `source` into `data`.
     *
     * Merging metadata reduces the number of wrappers used to invoke a function.
     * This is possible because methods like `_.bind`, `_.curry`, and `_.partial`
     * may be applied regardless of execution order. Methods like `_.ary` and
     * `_.rearg` modify function arguments, making the order in which they are
     * executed important, preventing the merging of metadata. However, we make
     * an exception for a safe combined case where curried functions have `_.ary`
     * and or `_.rearg` applied.
     *
     * @private
     * @param {Array} data The destination metadata.
     * @param {Array} source The source metadata.
     * @returns {Array} Returns `data`.
     */
    function mergeData(data, source) {
      var bitmask = data[1],
          srcBitmask = source[1],
          newBitmask = bitmask | srcBitmask,
          isCommon = newBitmask < (WRAP_BIND_FLAG | WRAP_BIND_KEY_FLAG | WRAP_ARY_FLAG);

      var isCombo =
        ((srcBitmask == WRAP_ARY_FLAG) && (bitmask == WRAP_CURRY_FLAG)) ||
        ((srcBitmask == WRAP_ARY_FLAG) && (bitmask == WRAP_REARG_FLAG) && (data[7].length <= source[8])) ||
        ((srcBitmask == (WRAP_ARY_FLAG | WRAP_REARG_FLAG)) && (source[7].length <= source[8]) && (bitmask == WRAP_CURRY_FLAG));

      // Exit early if metadata can't be merged.
      if (!(isCommon || isCombo)) {
        return data;
      }
      // Use source `thisArg` if available.
      if (srcBitmask & WRAP_BIND_FLAG) {
        data[2] = source[2];
        // Set when currying a bound function.
        newBitmask |= bitmask & WRAP_BIND_FLAG ? 0 : WRAP_CURRY_BOUND_FLAG;
      }
      // Compose partial arguments.
      var value = source[3];
      if (value) {
        var partials = data[3];
        data[3] = partials ? composeArgs(partials, value, source[4]) : value;
        data[4] = partials ? replaceHolders(data[3], PLACEHOLDER) : source[4];
      }
      // Compose partial right arguments.
      value = source[5];
      if (value) {
        partials = data[5];
        data[5] = partials ? composeArgsRight(partials, value, source[6]) : value;
        data[6] = partials ? replaceHolders(data[5], PLACEHOLDER) : source[6];
      }
      // Use source `argPos` if available.
      value = source[7];
      if (value) {
        data[7] = value;
      }
      // Use source `ary` if it's smaller.
      if (srcBitmask & WRAP_ARY_FLAG) {
        data[8] = data[8] == null ? source[8] : nativeMin(data[8], source[8]);
      }
      // Use source `arity` if one is not provided.
      if (data[9] == null) {
        data[9] = source[9];
      }
      // Use source `func` and merge bitmasks.
      data[0] = source[0];
      data[1] = newBitmask;

      return data;
    }

    /**
     * This function is like
     * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
     * except that it includes inherited enumerable properties.
     *
     * @private
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     */
    function nativeKeysIn(object) {
      var result = [];
      if (object != null) {
        for (var key in Object(object)) {
          result.push(key);
        }
      }
      return result;
    }

    /**
     * Converts `value` to a string using `Object.prototype.toString`.
     *
     * @private
     * @param {*} value The value to convert.
     * @returns {string} Returns the converted string.
     */
    function objectToString(value) {
      return nativeObjectToString.call(value);
    }

    /**
     * A specialized version of `baseRest` which transforms the rest array.
     *
     * @private
     * @param {Function} func The function to apply a rest parameter to.
     * @param {number} [start=func.length-1] The start position of the rest parameter.
     * @param {Function} transform The rest array transform.
     * @returns {Function} Returns the new function.
     */
    function overRest(func, start, transform) {
      start = nativeMax(start === undefined ? (func.length - 1) : start, 0);
      return function() {
        var args = arguments,
            index = -1,
            length = nativeMax(args.length - start, 0),
            array = Array(length);

        while (++index < length) {
          array[index] = args[start + index];
        }
        index = -1;
        var otherArgs = Array(start + 1);
        while (++index < start) {
          otherArgs[index] = args[index];
        }
        otherArgs[start] = transform(array);
        return apply(func, this, otherArgs);
      };
    }

    /**
     * Gets the parent value at `path` of `object`.
     *
     * @private
     * @param {Object} object The object to query.
     * @param {Array} path The path to get the parent value of.
     * @returns {*} Returns the parent value.
     */
    function parent(object, path) {
      return path.length < 2 ? object : baseGet(object, baseSlice(path, 0, -1));
    }

    /**
     * Reorder `array` according to the specified indexes where the element at
     * the first index is assigned as the first element, the element at
     * the second index is assigned as the second element, and so on.
     *
     * @private
     * @param {Array} array The array to reorder.
     * @param {Array} indexes The arranged array indexes.
     * @returns {Array} Returns `array`.
     */
    function reorder(array, indexes) {
      var arrLength = array.length,
          length = nativeMin(indexes.length, arrLength),
          oldArray = copyArray(array);

      while (length--) {
        var index = indexes[length];
        array[length] = isIndex(index, arrLength) ? oldArray[index] : undefined;
      }
      return array;
    }

    /**
     * Gets the value at `key`, unless `key` is "__proto__" or "constructor".
     *
     * @private
     * @param {Object} object The object to query.
     * @param {string} key The key of the property to get.
     * @returns {*} Returns the property value.
     */
    function safeGet(object, key) {
      if (key === 'constructor' && typeof object[key] === 'function') {
        return;
      }

      if (key == '__proto__') {
        return;
      }

      return object[key];
    }

    /**
     * Sets metadata for `func`.
     *
     * **Note:** If this function becomes hot, i.e. is invoked a lot in a short
     * period of time, it will trip its breaker and transition to an identity
     * function to avoid garbage collection pauses in V8. See
     * [V8 issue 2070](https://bugs.chromium.org/p/v8/issues/detail?id=2070)
     * for more details.
     *
     * @private
     * @param {Function} func The function to associate metadata with.
     * @param {*} data The metadata.
     * @returns {Function} Returns `func`.
     */
    var setData = shortOut(baseSetData);

    /**
     * A simple wrapper around the global [`setTimeout`](https://mdn.io/setTimeout).
     *
     * @private
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @returns {number|Object} Returns the timer id or timeout object.
     */
    var setTimeout = ctxSetTimeout || function(func, wait) {
      return root.setTimeout(func, wait);
    };

    /**
     * Sets the `toString` method of `func` to return `string`.
     *
     * @private
     * @param {Function} func The function to modify.
     * @param {Function} string The `toString` result.
     * @returns {Function} Returns `func`.
     */
    var setToString = shortOut(baseSetToString);

    /**
     * Sets the `toString` method of `wrapper` to mimic the source of `reference`
     * with wrapper details in a comment at the top of the source body.
     *
     * @private
     * @param {Function} wrapper The function to modify.
     * @param {Function} reference The reference function.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @returns {Function} Returns `wrapper`.
     */
    function setWrapToString(wrapper, reference, bitmask) {
      var source = (reference + '');
      return setToString(wrapper, insertWrapDetails(source, updateWrapDetails(getWrapDetails(source), bitmask)));
    }

    /**
     * Creates a function that'll short out and invoke `identity` instead
     * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`
     * milliseconds.
     *
     * @private
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new shortable function.
     */
    function shortOut(func) {
      var count = 0,
          lastCalled = 0;

      return function() {
        var stamp = nativeNow(),
            remaining = HOT_SPAN - (stamp - lastCalled);

        lastCalled = stamp;
        if (remaining > 0) {
          if (++count >= HOT_COUNT) {
            return arguments[0];
          }
        } else {
          count = 0;
        }
        return func.apply(undefined, arguments);
      };
    }

    /**
     * A specialized version of `_.shuffle` which mutates and sets the size of `array`.
     *
     * @private
     * @param {Array} array The array to shuffle.
     * @param {number} [size=array.length] The size of `array`.
     * @returns {Array} Returns `array`.
     */
    function shuffleSelf(array, size) {
      var index = -1,
          length = array.length,
          lastIndex = length - 1;

      size = size === undefined ? length : size;
      while (++index < size) {
        var rand = baseRandom(index, lastIndex),
            value = array[rand];

        array[rand] = array[index];
        array[index] = value;
      }
      array.length = size;
      return array;
    }

    /**
     * Converts `string` to a property path array.
     *
     * @private
     * @param {string} string The string to convert.
     * @returns {Array} Returns the property path array.
     */
    var stringToPath = memoizeCapped(function(string) {
      var result = [];
      if (string.charCodeAt(0) === 46 /* . */) {
        result.push('');
      }
      string.replace(rePropName, function(match, number, quote, subString) {
        result.push(quote ? subString.replace(reEscapeChar, '$1') : (number || match));
      });
      return result;
    });

    /**
     * Converts `value` to a string key if it's not a string or symbol.
     *
     * @private
     * @param {*} value The value to inspect.
     * @returns {string|symbol} Returns the key.
     */
    function toKey(value) {
      if (typeof value == 'string' || isSymbol(value)) {
        return value;
      }
      var result = (value + '');
      return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;
    }

    /**
     * Converts `func` to its source code.
     *
     * @private
     * @param {Function} func The function to convert.
     * @returns {string} Returns the source code.
     */
    function toSource(func) {
      if (func != null) {
        try {
          return funcToString.call(func);
        } catch (e) {}
        try {
          return (func + '');
        } catch (e) {}
      }
      return '';
    }

    /**
     * Updates wrapper `details` based on `bitmask` flags.
     *
     * @private
     * @returns {Array} details The details to modify.
     * @param {number} bitmask The bitmask flags. See `createWrap` for more details.
     * @returns {Array} Returns `details`.
     */
    function updateWrapDetails(details, bitmask) {
      arrayEach(wrapFlags, function(pair) {
        var value = '_.' + pair[0];
        if ((bitmask & pair[1]) && !arrayIncludes(details, value)) {
          details.push(value);
        }
      });
      return details.sort();
    }

    /**
     * Creates a clone of `wrapper`.
     *
     * @private
     * @param {Object} wrapper The wrapper to clone.
     * @returns {Object} Returns the cloned wrapper.
     */
    function wrapperClone(wrapper) {
      if (wrapper instanceof LazyWrapper) {
        return wrapper.clone();
      }
      var result = new LodashWrapper(wrapper.__wrapped__, wrapper.__chain__);
      result.__actions__ = copyArray(wrapper.__actions__);
      result.__index__  = wrapper.__index__;
      result.__values__ = wrapper.__values__;
      return result;
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates an array of elements split into groups the length of `size`.
     * If `array` can't be split evenly, the final chunk will be the remaining
     * elements.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to process.
     * @param {number} [size=1] The length of each chunk
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the new array of chunks.
     * @example
     *
     * _.chunk(['a', 'b', 'c', 'd'], 2);
     * // => [['a', 'b'], ['c', 'd']]
     *
     * _.chunk(['a', 'b', 'c', 'd'], 3);
     * // => [['a', 'b', 'c'], ['d']]
     */
    function chunk(array, size, guard) {
      if ((guard ? isIterateeCall(array, size, guard) : size === undefined)) {
        size = 1;
      } else {
        size = nativeMax(toInteger(size), 0);
      }
      var length = array == null ? 0 : array.length;
      if (!length || size < 1) {
        return [];
      }
      var index = 0,
          resIndex = 0,
          result = Array(nativeCeil(length / size));

      while (index < length) {
        result[resIndex++] = baseSlice(array, index, (index += size));
      }
      return result;
    }

    /**
     * Creates an array with all falsey values removed. The values `false`, `null`,
     * `0`, `""`, `undefined`, and `NaN` are falsey.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to compact.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.compact([0, 1, false, 2, '', 3]);
     * // => [1, 2, 3]
     */
    function compact(array) {
      var index = -1,
          length = array == null ? 0 : array.length,
          resIndex = 0,
          result = [];

      while (++index < length) {
        var value = array[index];
        if (value) {
          result[resIndex++] = value;
        }
      }
      return result;
    }

    /**
     * Creates a new array concatenating `array` with any additional arrays
     * and/or values.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to concatenate.
     * @param {...*} [values] The values to concatenate.
     * @returns {Array} Returns the new concatenated array.
     * @example
     *
     * var array = [1];
     * var other = _.concat(array, 2, [3], [[4]]);
     *
     * console.log(other);
     * // => [1, 2, 3, [4]]
     *
     * console.log(array);
     * // => [1]
     */
    function concat() {
      var length = arguments.length;
      if (!length) {
        return [];
      }
      var args = Array(length - 1),
          array = arguments[0],
          index = length;

      while (index--) {
        args[index - 1] = arguments[index];
      }
      return arrayPush(isArray(array) ? copyArray(array) : [array], baseFlatten(args, 1));
    }

    /**
     * Creates an array of `array` values not included in the other given arrays
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons. The order and references of result values are
     * determined by the first array.
     *
     * **Note:** Unlike `_.pullAll`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...Array} [values] The values to exclude.
     * @returns {Array} Returns the new array of filtered values.
     * @see _.without, _.xor
     * @example
     *
     * _.difference([2, 1], [2, 3]);
     * // => [1]
     */
    var difference = baseRest(function(array, values) {
      return isArrayLikeObject(array)
        ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true))
        : [];
    });

    /**
     * This method is like `_.difference` except that it accepts `iteratee` which
     * is invoked for each element of `array` and `values` to generate the criterion
     * by which they're compared. The order and references of result values are
     * determined by the first array. The iteratee is invoked with one argument:
     * (value).
     *
     * **Note:** Unlike `_.pullAllBy`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...Array} [values] The values to exclude.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.differenceBy([2.1, 1.2], [2.3, 3.4], Math.floor);
     * // => [1.2]
     *
     * // The `_.property` iteratee shorthand.
     * _.differenceBy([{ 'x': 2 }, { 'x': 1 }], [{ 'x': 1 }], 'x');
     * // => [{ 'x': 2 }]
     */
    var differenceBy = baseRest(function(array, values) {
      var iteratee = last(values);
      if (isArrayLikeObject(iteratee)) {
        iteratee = undefined;
      }
      return isArrayLikeObject(array)
        ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true), getIteratee(iteratee, 2))
        : [];
    });

    /**
     * This method is like `_.difference` except that it accepts `comparator`
     * which is invoked to compare elements of `array` to `values`. The order and
     * references of result values are determined by the first array. The comparator
     * is invoked with two arguments: (arrVal, othVal).
     *
     * **Note:** Unlike `_.pullAllWith`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...Array} [values] The values to exclude.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     *
     * _.differenceWith(objects, [{ 'x': 1, 'y': 2 }], _.isEqual);
     * // => [{ 'x': 2, 'y': 1 }]
     */
    var differenceWith = baseRest(function(array, values) {
      var comparator = last(values);
      if (isArrayLikeObject(comparator)) {
        comparator = undefined;
      }
      return isArrayLikeObject(array)
        ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true), undefined, comparator)
        : [];
    });

    /**
     * Creates a slice of `array` with `n` elements dropped from the beginning.
     *
     * @static
     * @memberOf _
     * @since 0.5.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to drop.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.drop([1, 2, 3]);
     * // => [2, 3]
     *
     * _.drop([1, 2, 3], 2);
     * // => [3]
     *
     * _.drop([1, 2, 3], 5);
     * // => []
     *
     * _.drop([1, 2, 3], 0);
     * // => [1, 2, 3]
     */
    function drop(array, n, guard) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      return baseSlice(array, n < 0 ? 0 : n, length);
    }

    /**
     * Creates a slice of `array` with `n` elements dropped from the end.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to drop.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.dropRight([1, 2, 3]);
     * // => [1, 2]
     *
     * _.dropRight([1, 2, 3], 2);
     * // => [1]
     *
     * _.dropRight([1, 2, 3], 5);
     * // => []
     *
     * _.dropRight([1, 2, 3], 0);
     * // => [1, 2, 3]
     */
    function dropRight(array, n, guard) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      n = length - n;
      return baseSlice(array, 0, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` excluding elements dropped from the end.
     * Elements are dropped until `predicate` returns falsey. The predicate is
     * invoked with three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * _.dropRightWhile(users, function(o) { return !o.active; });
     * // => objects for ['barney']
     *
     * // The `_.matches` iteratee shorthand.
     * _.dropRightWhile(users, { 'user': 'pebbles', 'active': false });
     * // => objects for ['barney', 'fred']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.dropRightWhile(users, ['active', false]);
     * // => objects for ['barney']
     *
     * // The `_.property` iteratee shorthand.
     * _.dropRightWhile(users, 'active');
     * // => objects for ['barney', 'fred', 'pebbles']
     */
    function dropRightWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3), true, true)
        : [];
    }

    /**
     * Creates a slice of `array` excluding elements dropped from the beginning.
     * Elements are dropped until `predicate` returns falsey. The predicate is
     * invoked with three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * _.dropWhile(users, function(o) { return !o.active; });
     * // => objects for ['pebbles']
     *
     * // The `_.matches` iteratee shorthand.
     * _.dropWhile(users, { 'user': 'barney', 'active': false });
     * // => objects for ['fred', 'pebbles']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.dropWhile(users, ['active', false]);
     * // => objects for ['pebbles']
     *
     * // The `_.property` iteratee shorthand.
     * _.dropWhile(users, 'active');
     * // => objects for ['barney', 'fred', 'pebbles']
     */
    function dropWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3), true)
        : [];
    }

    /**
     * Fills elements of `array` with `value` from `start` up to, but not
     * including, `end`.
     *
     * **Note:** This method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 3.2.0
     * @category Array
     * @param {Array} array The array to fill.
     * @param {*} value The value to fill `array` with.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [1, 2, 3];
     *
     * _.fill(array, 'a');
     * console.log(array);
     * // => ['a', 'a', 'a']
     *
     * _.fill(Array(3), 2);
     * // => [2, 2, 2]
     *
     * _.fill([4, 6, 8, 10], '*', 1, 3);
     * // => [4, '*', '*', 10]
     */
    function fill(array, value, start, end) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      if (start && typeof start != 'number' && isIterateeCall(array, value, start)) {
        start = 0;
        end = length;
      }
      return baseFill(array, value, start, end);
    }

    /**
     * This method is like `_.find` except that it returns the index of the first
     * element `predicate` returns truthy for instead of the element itself.
     *
     * @static
     * @memberOf _
     * @since 1.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * _.findIndex(users, function(o) { return o.user == 'barney'; });
     * // => 0
     *
     * // The `_.matches` iteratee shorthand.
     * _.findIndex(users, { 'user': 'fred', 'active': false });
     * // => 1
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findIndex(users, ['active', false]);
     * // => 0
     *
     * // The `_.property` iteratee shorthand.
     * _.findIndex(users, 'active');
     * // => 2
     */
    function findIndex(array, predicate, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = fromIndex == null ? 0 : toInteger(fromIndex);
      if (index < 0) {
        index = nativeMax(length + index, 0);
      }
      return baseFindIndex(array, getIteratee(predicate, 3), index);
    }

    /**
     * This method is like `_.findIndex` except that it iterates over elements
     * of `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=array.length-1] The index to search from.
     * @returns {number} Returns the index of the found element, else `-1`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });
     * // => 2
     *
     * // The `_.matches` iteratee shorthand.
     * _.findLastIndex(users, { 'user': 'barney', 'active': true });
     * // => 0
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findLastIndex(users, ['active', false]);
     * // => 2
     *
     * // The `_.property` iteratee shorthand.
     * _.findLastIndex(users, 'active');
     * // => 0
     */
    function findLastIndex(array, predicate, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = length - 1;
      if (fromIndex !== undefined) {
        index = toInteger(fromIndex);
        index = fromIndex < 0
          ? nativeMax(length + index, 0)
          : nativeMin(index, length - 1);
      }
      return baseFindIndex(array, getIteratee(predicate, 3), index, true);
    }

    /**
     * Flattens `array` a single level deep.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to flatten.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * _.flatten([1, [2, [3, [4]], 5]]);
     * // => [1, 2, [3, [4]], 5]
     */
    function flatten(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseFlatten(array, 1) : [];
    }

    /**
     * Recursively flattens `array`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to flatten.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * _.flattenDeep([1, [2, [3, [4]], 5]]);
     * // => [1, 2, 3, 4, 5]
     */
    function flattenDeep(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseFlatten(array, INFINITY) : [];
    }

    /**
     * Recursively flatten `array` up to `depth` times.
     *
     * @static
     * @memberOf _
     * @since 4.4.0
     * @category Array
     * @param {Array} array The array to flatten.
     * @param {number} [depth=1] The maximum recursion depth.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * var array = [1, [2, [3, [4]], 5]];
     *
     * _.flattenDepth(array, 1);
     * // => [1, 2, [3, [4]], 5]
     *
     * _.flattenDepth(array, 2);
     * // => [1, 2, 3, [4], 5]
     */
    function flattenDepth(array, depth) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      depth = depth === undefined ? 1 : toInteger(depth);
      return baseFlatten(array, depth);
    }

    /**
     * The inverse of `_.toPairs`; this method returns an object composed
     * from key-value `pairs`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} pairs The key-value pairs.
     * @returns {Object} Returns the new object.
     * @example
     *
     * _.fromPairs([['a', 1], ['b', 2]]);
     * // => { 'a': 1, 'b': 2 }
     */
    function fromPairs(pairs) {
      var index = -1,
          length = pairs == null ? 0 : pairs.length,
          result = {};

      while (++index < length) {
        var pair = pairs[index];
        result[pair[0]] = pair[1];
      }
      return result;
    }

    /**
     * Gets the first element of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @alias first
     * @category Array
     * @param {Array} array The array to query.
     * @returns {*} Returns the first element of `array`.
     * @example
     *
     * _.head([1, 2, 3]);
     * // => 1
     *
     * _.head([]);
     * // => undefined
     */
    function head(array) {
      return (array && array.length) ? array[0] : undefined;
    }

    /**
     * Gets the index at which the first occurrence of `value` is found in `array`
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons. If `fromIndex` is negative, it's used as the
     * offset from the end of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.indexOf([1, 2, 1, 2], 2);
     * // => 1
     *
     * // Search from the `fromIndex`.
     * _.indexOf([1, 2, 1, 2], 2, 2);
     * // => 3
     */
    function indexOf(array, value, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = fromIndex == null ? 0 : toInteger(fromIndex);
      if (index < 0) {
        index = nativeMax(length + index, 0);
      }
      return baseIndexOf(array, value, index);
    }

    /**
     * Gets all but the last element of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to query.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.initial([1, 2, 3]);
     * // => [1, 2]
     */
    function initial(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseSlice(array, 0, -1) : [];
    }

    /**
     * Creates an array of unique values that are included in all given arrays
     * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons. The order and references of result values are
     * determined by the first array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of intersecting values.
     * @example
     *
     * _.intersection([2, 1], [2, 3]);
     * // => [2]
     */
    var intersection = baseRest(function(arrays) {
      var mapped = arrayMap(arrays, castArrayLikeObject);
      return (mapped.length && mapped[0] === arrays[0])
        ? baseIntersection(mapped)
        : [];
    });

    /**
     * This method is like `_.intersection` except that it accepts `iteratee`
     * which is invoked for each element of each `arrays` to generate the criterion
     * by which they're compared. The order and references of result values are
     * determined by the first array. The iteratee is invoked with one argument:
     * (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of intersecting values.
     * @example
     *
     * _.intersectionBy([2.1, 1.2], [2.3, 3.4], Math.floor);
     * // => [2.1]
     *
     * // The `_.property` iteratee shorthand.
     * _.intersectionBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }]
     */
    var intersectionBy = baseRest(function(arrays) {
      var iteratee = last(arrays),
          mapped = arrayMap(arrays, castArrayLikeObject);

      if (iteratee === last(mapped)) {
        iteratee = undefined;
      } else {
        mapped.pop();
      }
      return (mapped.length && mapped[0] === arrays[0])
        ? baseIntersection(mapped, getIteratee(iteratee, 2))
        : [];
    });

    /**
     * This method is like `_.intersection` except that it accepts `comparator`
     * which is invoked to compare elements of `arrays`. The order and references
     * of result values are determined by the first array. The comparator is
     * invoked with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of intersecting values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.intersectionWith(objects, others, _.isEqual);
     * // => [{ 'x': 1, 'y': 2 }]
     */
    var intersectionWith = baseRest(function(arrays) {
      var comparator = last(arrays),
          mapped = arrayMap(arrays, castArrayLikeObject);

      comparator = typeof comparator == 'function' ? comparator : undefined;
      if (comparator) {
        mapped.pop();
      }
      return (mapped.length && mapped[0] === arrays[0])
        ? baseIntersection(mapped, undefined, comparator)
        : [];
    });

    /**
     * Converts all elements in `array` into a string separated by `separator`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to convert.
     * @param {string} [separator=','] The element separator.
     * @returns {string} Returns the joined string.
     * @example
     *
     * _.join(['a', 'b', 'c'], '~');
     * // => 'a~b~c'
     */
    function join(array, separator) {
      return array == null ? '' : nativeJoin.call(array, separator);
    }

    /**
     * Gets the last element of `array`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to query.
     * @returns {*} Returns the last element of `array`.
     * @example
     *
     * _.last([1, 2, 3]);
     * // => 3
     */
    function last(array) {
      var length = array == null ? 0 : array.length;
      return length ? array[length - 1] : undefined;
    }

    /**
     * This method is like `_.indexOf` except that it iterates over elements of
     * `array` from right to left.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @param {number} [fromIndex=array.length-1] The index to search from.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.lastIndexOf([1, 2, 1, 2], 2);
     * // => 3
     *
     * // Search from the `fromIndex`.
     * _.lastIndexOf([1, 2, 1, 2], 2, 2);
     * // => 1
     */
    function lastIndexOf(array, value, fromIndex) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return -1;
      }
      var index = length;
      if (fromIndex !== undefined) {
        index = toInteger(fromIndex);
        index = index < 0 ? nativeMax(length + index, 0) : nativeMin(index, length - 1);
      }
      return value === value
        ? strictLastIndexOf(array, value, index)
        : baseFindIndex(array, baseIsNaN, index, true);
    }

    /**
     * Gets the element at index `n` of `array`. If `n` is negative, the nth
     * element from the end is returned.
     *
     * @static
     * @memberOf _
     * @since 4.11.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=0] The index of the element to return.
     * @returns {*} Returns the nth element of `array`.
     * @example
     *
     * var array = ['a', 'b', 'c', 'd'];
     *
     * _.nth(array, 1);
     * // => 'b'
     *
     * _.nth(array, -2);
     * // => 'c';
     */
    function nth(array, n) {
      return (array && array.length) ? baseNth(array, toInteger(n)) : undefined;
    }

    /**
     * Removes all given values from `array` using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * **Note:** Unlike `_.without`, this method mutates `array`. Use `_.remove`
     * to remove elements from an array by predicate.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {...*} [values] The values to remove.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = ['a', 'b', 'c', 'a', 'b', 'c'];
     *
     * _.pull(array, 'a', 'c');
     * console.log(array);
     * // => ['b', 'b']
     */
    var pull = baseRest(pullAll);

    /**
     * This method is like `_.pull` except that it accepts an array of values to remove.
     *
     * **Note:** Unlike `_.difference`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = ['a', 'b', 'c', 'a', 'b', 'c'];
     *
     * _.pullAll(array, ['a', 'c']);
     * console.log(array);
     * // => ['b', 'b']
     */
    function pullAll(array, values) {
      return (array && array.length && values && values.length)
        ? basePullAll(array, values)
        : array;
    }

    /**
     * This method is like `_.pullAll` except that it accepts `iteratee` which is
     * invoked for each element of `array` and `values` to generate the criterion
     * by which they're compared. The iteratee is invoked with one argument: (value).
     *
     * **Note:** Unlike `_.differenceBy`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [{ 'x': 1 }, { 'x': 2 }, { 'x': 3 }, { 'x': 1 }];
     *
     * _.pullAllBy(array, [{ 'x': 1 }, { 'x': 3 }], 'x');
     * console.log(array);
     * // => [{ 'x': 2 }]
     */
    function pullAllBy(array, values, iteratee) {
      return (array && array.length && values && values.length)
        ? basePullAll(array, values, getIteratee(iteratee, 2))
        : array;
    }

    /**
     * This method is like `_.pullAll` except that it accepts `comparator` which
     * is invoked to compare elements of `array` to `values`. The comparator is
     * invoked with two arguments: (arrVal, othVal).
     *
     * **Note:** Unlike `_.differenceWith`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 4.6.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Array} values The values to remove.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [{ 'x': 1, 'y': 2 }, { 'x': 3, 'y': 4 }, { 'x': 5, 'y': 6 }];
     *
     * _.pullAllWith(array, [{ 'x': 3, 'y': 4 }], _.isEqual);
     * console.log(array);
     * // => [{ 'x': 1, 'y': 2 }, { 'x': 5, 'y': 6 }]
     */
    function pullAllWith(array, values, comparator) {
      return (array && array.length && values && values.length)
        ? basePullAll(array, values, undefined, comparator)
        : array;
    }

    /**
     * Removes elements from `array` corresponding to `indexes` and returns an
     * array of removed elements.
     *
     * **Note:** Unlike `_.at`, this method mutates `array`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {...(number|number[])} [indexes] The indexes of elements to remove.
     * @returns {Array} Returns the new array of removed elements.
     * @example
     *
     * var array = ['a', 'b', 'c', 'd'];
     * var pulled = _.pullAt(array, [1, 3]);
     *
     * console.log(array);
     * // => ['a', 'c']
     *
     * console.log(pulled);
     * // => ['b', 'd']
     */
    var pullAt = flatRest(function(array, indexes) {
      var length = array == null ? 0 : array.length,
          result = baseAt(array, indexes);

      basePullAt(array, arrayMap(indexes, function(index) {
        return isIndex(index, length) ? +index : index;
      }).sort(compareAscending));

      return result;
    });

    /**
     * Removes all elements from `array` that `predicate` returns truthy for
     * and returns an array of the removed elements. The predicate is invoked
     * with three arguments: (value, index, array).
     *
     * **Note:** Unlike `_.filter`, this method mutates `array`. Use `_.pull`
     * to pull elements from an array by value.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new array of removed elements.
     * @example
     *
     * var array = [1, 2, 3, 4];
     * var evens = _.remove(array, function(n) {
     *   return n % 2 == 0;
     * });
     *
     * console.log(array);
     * // => [1, 3]
     *
     * console.log(evens);
     * // => [2, 4]
     */
    function remove(array, predicate) {
      var result = [];
      if (!(array && array.length)) {
        return result;
      }
      var index = -1,
          indexes = [],
          length = array.length;

      predicate = getIteratee(predicate, 3);
      while (++index < length) {
        var value = array[index];
        if (predicate(value, index, array)) {
          result.push(value);
          indexes.push(index);
        }
      }
      basePullAt(array, indexes);
      return result;
    }

    /**
     * Reverses `array` so that the first element becomes the last, the second
     * element becomes the second to last, and so on.
     *
     * **Note:** This method mutates `array` and is based on
     * [`Array#reverse`](https://mdn.io/Array/reverse).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to modify.
     * @returns {Array} Returns `array`.
     * @example
     *
     * var array = [1, 2, 3];
     *
     * _.reverse(array);
     * // => [3, 2, 1]
     *
     * console.log(array);
     * // => [3, 2, 1]
     */
    function reverse(array) {
      return array == null ? array : nativeReverse.call(array);
    }

    /**
     * Creates a slice of `array` from `start` up to, but not including, `end`.
     *
     * **Note:** This method is used instead of
     * [`Array#slice`](https://mdn.io/Array/slice) to ensure dense arrays are
     * returned.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to slice.
     * @param {number} [start=0] The start position.
     * @param {number} [end=array.length] The end position.
     * @returns {Array} Returns the slice of `array`.
     */
    function slice(array, start, end) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      if (end && typeof end != 'number' && isIterateeCall(array, start, end)) {
        start = 0;
        end = length;
      }
      else {
        start = start == null ? 0 : toInteger(start);
        end = end === undefined ? length : toInteger(end);
      }
      return baseSlice(array, start, end);
    }

    /**
     * Uses a binary search to determine the lowest index at which `value`
     * should be inserted into `array` in order to maintain its sort order.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * _.sortedIndex([30, 50], 40);
     * // => 1
     */
    function sortedIndex(array, value) {
      return baseSortedIndex(array, value);
    }

    /**
     * This method is like `_.sortedIndex` except that it accepts `iteratee`
     * which is invoked for `value` and each element of `array` to compute their
     * sort ranking. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * var objects = [{ 'x': 4 }, { 'x': 5 }];
     *
     * _.sortedIndexBy(objects, { 'x': 4 }, function(o) { return o.x; });
     * // => 0
     *
     * // The `_.property` iteratee shorthand.
     * _.sortedIndexBy(objects, { 'x': 4 }, 'x');
     * // => 0
     */
    function sortedIndexBy(array, value, iteratee) {
      return baseSortedIndexBy(array, value, getIteratee(iteratee, 2));
    }

    /**
     * This method is like `_.indexOf` except that it performs a binary
     * search on a sorted `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.sortedIndexOf([4, 5, 5, 5, 6], 5);
     * // => 1
     */
    function sortedIndexOf(array, value) {
      var length = array == null ? 0 : array.length;
      if (length) {
        var index = baseSortedIndex(array, value);
        if (index < length && eq(array[index], value)) {
          return index;
        }
      }
      return -1;
    }

    /**
     * This method is like `_.sortedIndex` except that it returns the highest
     * index at which `value` should be inserted into `array` in order to
     * maintain its sort order.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * _.sortedLastIndex([4, 5, 5, 5, 6], 5);
     * // => 4
     */
    function sortedLastIndex(array, value) {
      return baseSortedIndex(array, value, true);
    }

    /**
     * This method is like `_.sortedLastIndex` except that it accepts `iteratee`
     * which is invoked for `value` and each element of `array` to compute their
     * sort ranking. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The sorted array to inspect.
     * @param {*} value The value to evaluate.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the index at which `value` should be inserted
     *  into `array`.
     * @example
     *
     * var objects = [{ 'x': 4 }, { 'x': 5 }];
     *
     * _.sortedLastIndexBy(objects, { 'x': 4 }, function(o) { return o.x; });
     * // => 1
     *
     * // The `_.property` iteratee shorthand.
     * _.sortedLastIndexBy(objects, { 'x': 4 }, 'x');
     * // => 1
     */
    function sortedLastIndexBy(array, value, iteratee) {
      return baseSortedIndexBy(array, value, getIteratee(iteratee, 2), true);
    }

    /**
     * This method is like `_.lastIndexOf` except that it performs a binary
     * search on a sorted `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {*} value The value to search for.
     * @returns {number} Returns the index of the matched value, else `-1`.
     * @example
     *
     * _.sortedLastIndexOf([4, 5, 5, 5, 6], 5);
     * // => 3
     */
    function sortedLastIndexOf(array, value) {
      var length = array == null ? 0 : array.length;
      if (length) {
        var index = baseSortedIndex(array, value, true) - 1;
        if (eq(array[index], value)) {
          return index;
        }
      }
      return -1;
    }

    /**
     * This method is like `_.uniq` except that it's designed and optimized
     * for sorted arrays.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.sortedUniq([1, 1, 2]);
     * // => [1, 2]
     */
    function sortedUniq(array) {
      return (array && array.length)
        ? baseSortedUniq(array)
        : [];
    }

    /**
     * This method is like `_.uniqBy` except that it's designed and optimized
     * for sorted arrays.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee] The iteratee invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.sortedUniqBy([1.1, 1.2, 2.3, 2.4], Math.floor);
     * // => [1.1, 2.3]
     */
    function sortedUniqBy(array, iteratee) {
      return (array && array.length)
        ? baseSortedUniq(array, getIteratee(iteratee, 2))
        : [];
    }

    /**
     * Gets all but the first element of `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.tail([1, 2, 3]);
     * // => [2, 3]
     */
    function tail(array) {
      var length = array == null ? 0 : array.length;
      return length ? baseSlice(array, 1, length) : [];
    }

    /**
     * Creates a slice of `array` with `n` elements taken from the beginning.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to take.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.take([1, 2, 3]);
     * // => [1]
     *
     * _.take([1, 2, 3], 2);
     * // => [1, 2]
     *
     * _.take([1, 2, 3], 5);
     * // => [1, 2, 3]
     *
     * _.take([1, 2, 3], 0);
     * // => []
     */
    function take(array, n, guard) {
      if (!(array && array.length)) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      return baseSlice(array, 0, n < 0 ? 0 : n);
    }

    /**
     * Creates a slice of `array` with `n` elements taken from the end.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {number} [n=1] The number of elements to take.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * _.takeRight([1, 2, 3]);
     * // => [3]
     *
     * _.takeRight([1, 2, 3], 2);
     * // => [2, 3]
     *
     * _.takeRight([1, 2, 3], 5);
     * // => [1, 2, 3]
     *
     * _.takeRight([1, 2, 3], 0);
     * // => []
     */
    function takeRight(array, n, guard) {
      var length = array == null ? 0 : array.length;
      if (!length) {
        return [];
      }
      n = (guard || n === undefined) ? 1 : toInteger(n);
      n = length - n;
      return baseSlice(array, n < 0 ? 0 : n, length);
    }

    /**
     * Creates a slice of `array` with elements taken from the end. Elements are
     * taken until `predicate` returns falsey. The predicate is invoked with
     * three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': true },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': false }
     * ];
     *
     * _.takeRightWhile(users, function(o) { return !o.active; });
     * // => objects for ['fred', 'pebbles']
     *
     * // The `_.matches` iteratee shorthand.
     * _.takeRightWhile(users, { 'user': 'pebbles', 'active': false });
     * // => objects for ['pebbles']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.takeRightWhile(users, ['active', false]);
     * // => objects for ['fred', 'pebbles']
     *
     * // The `_.property` iteratee shorthand.
     * _.takeRightWhile(users, 'active');
     * // => []
     */
    function takeRightWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3), false, true)
        : [];
    }

    /**
     * Creates a slice of `array` with elements taken from the beginning. Elements
     * are taken until `predicate` returns falsey. The predicate is invoked with
     * three arguments: (value, index, array).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Array
     * @param {Array} array The array to query.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the slice of `array`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'active': false },
     *   { 'user': 'fred',    'active': false },
     *   { 'user': 'pebbles', 'active': true }
     * ];
     *
     * _.takeWhile(users, function(o) { return !o.active; });
     * // => objects for ['barney', 'fred']
     *
     * // The `_.matches` iteratee shorthand.
     * _.takeWhile(users, { 'user': 'barney', 'active': false });
     * // => objects for ['barney']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.takeWhile(users, ['active', false]);
     * // => objects for ['barney', 'fred']
     *
     * // The `_.property` iteratee shorthand.
     * _.takeWhile(users, 'active');
     * // => []
     */
    function takeWhile(array, predicate) {
      return (array && array.length)
        ? baseWhile(array, getIteratee(predicate, 3))
        : [];
    }

    /**
     * Creates an array of unique values, in order, from all given arrays using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of combined values.
     * @example
     *
     * _.union([2], [1, 2]);
     * // => [2, 1]
     */
    var union = baseRest(function(arrays) {
      return baseUniq(baseFlatten(arrays, 1, isArrayLikeObject, true));
    });

    /**
     * This method is like `_.union` except that it accepts `iteratee` which is
     * invoked for each element of each `arrays` to generate the criterion by
     * which uniqueness is computed. Result values are chosen from the first
     * array in which the value occurs. The iteratee is invoked with one argument:
     * (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of combined values.
     * @example
     *
     * _.unionBy([2.1], [1.2, 2.3], Math.floor);
     * // => [2.1, 1.2]
     *
     * // The `_.property` iteratee shorthand.
     * _.unionBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }, { 'x': 2 }]
     */
    var unionBy = baseRest(function(arrays) {
      var iteratee = last(arrays);
      if (isArrayLikeObject(iteratee)) {
        iteratee = undefined;
      }
      return baseUniq(baseFlatten(arrays, 1, isArrayLikeObject, true), getIteratee(iteratee, 2));
    });

    /**
     * This method is like `_.union` except that it accepts `comparator` which
     * is invoked to compare elements of `arrays`. Result values are chosen from
     * the first array in which the value occurs. The comparator is invoked
     * with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of combined values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.unionWith(objects, others, _.isEqual);
     * // => [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }, { 'x': 1, 'y': 1 }]
     */
    var unionWith = baseRest(function(arrays) {
      var comparator = last(arrays);
      comparator = typeof comparator == 'function' ? comparator : undefined;
      return baseUniq(baseFlatten(arrays, 1, isArrayLikeObject, true), undefined, comparator);
    });

    /**
     * Creates a duplicate-free version of an array, using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons, in which only the first occurrence of each element
     * is kept. The order of result values is determined by the order they occur
     * in the array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.uniq([2, 1, 2]);
     * // => [2, 1]
     */
    function uniq(array) {
      return (array && array.length) ? baseUniq(array) : [];
    }

    /**
     * This method is like `_.uniq` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the criterion by which
     * uniqueness is computed. The order of result values is determined by the
     * order they occur in the array. The iteratee is invoked with one argument:
     * (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * _.uniqBy([2.1, 1.2, 2.3], Math.floor);
     * // => [2.1, 1.2]
     *
     * // The `_.property` iteratee shorthand.
     * _.uniqBy([{ 'x': 1 }, { 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 1 }, { 'x': 2 }]
     */
    function uniqBy(array, iteratee) {
      return (array && array.length) ? baseUniq(array, getIteratee(iteratee, 2)) : [];
    }

    /**
     * This method is like `_.uniq` except that it accepts `comparator` which
     * is invoked to compare elements of `array`. The order of result values is
     * determined by the order they occur in the array.The comparator is invoked
     * with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new duplicate free array.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.uniqWith(objects, _.isEqual);
     * // => [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }]
     */
    function uniqWith(array, comparator) {
      comparator = typeof comparator == 'function' ? comparator : undefined;
      return (array && array.length) ? baseUniq(array, undefined, comparator) : [];
    }

    /**
     * This method is like `_.zip` except that it accepts an array of grouped
     * elements and creates an array regrouping the elements to their pre-zip
     * configuration.
     *
     * @static
     * @memberOf _
     * @since 1.2.0
     * @category Array
     * @param {Array} array The array of grouped elements to process.
     * @returns {Array} Returns the new array of regrouped elements.
     * @example
     *
     * var zipped = _.zip(['a', 'b'], [1, 2], [true, false]);
     * // => [['a', 1, true], ['b', 2, false]]
     *
     * _.unzip(zipped);
     * // => [['a', 'b'], [1, 2], [true, false]]
     */
    function unzip(array) {
      if (!(array && array.length)) {
        return [];
      }
      var length = 0;
      array = arrayFilter(array, function(group) {
        if (isArrayLikeObject(group)) {
          length = nativeMax(group.length, length);
          return true;
        }
      });
      return baseTimes(length, function(index) {
        return arrayMap(array, baseProperty(index));
      });
    }

    /**
     * This method is like `_.unzip` except that it accepts `iteratee` to specify
     * how regrouped values should be combined. The iteratee is invoked with the
     * elements of each group: (...group).
     *
     * @static
     * @memberOf _
     * @since 3.8.0
     * @category Array
     * @param {Array} array The array of grouped elements to process.
     * @param {Function} [iteratee=_.identity] The function to combine
     *  regrouped values.
     * @returns {Array} Returns the new array of regrouped elements.
     * @example
     *
     * var zipped = _.zip([1, 2], [10, 20], [100, 200]);
     * // => [[1, 10, 100], [2, 20, 200]]
     *
     * _.unzipWith(zipped, _.add);
     * // => [3, 30, 300]
     */
    function unzipWith(array, iteratee) {
      if (!(array && array.length)) {
        return [];
      }
      var result = unzip(array);
      if (iteratee == null) {
        return result;
      }
      return arrayMap(result, function(group) {
        return apply(iteratee, undefined, group);
      });
    }

    /**
     * Creates an array excluding all given values using
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * for equality comparisons.
     *
     * **Note:** Unlike `_.pull`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {Array} array The array to inspect.
     * @param {...*} [values] The values to exclude.
     * @returns {Array} Returns the new array of filtered values.
     * @see _.difference, _.xor
     * @example
     *
     * _.without([2, 1, 2, 3], 1, 2);
     * // => [3]
     */
    var without = baseRest(function(array, values) {
      return isArrayLikeObject(array)
        ? baseDifference(array, values)
        : [];
    });

    /**
     * Creates an array of unique values that is the
     * [symmetric difference](https://en.wikipedia.org/wiki/Symmetric_difference)
     * of the given arrays. The order of result values is determined by the order
     * they occur in the arrays.
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @returns {Array} Returns the new array of filtered values.
     * @see _.difference, _.without
     * @example
     *
     * _.xor([2, 1], [2, 3]);
     * // => [1, 3]
     */
    var xor = baseRest(function(arrays) {
      return baseXor(arrayFilter(arrays, isArrayLikeObject));
    });

    /**
     * This method is like `_.xor` except that it accepts `iteratee` which is
     * invoked for each element of each `arrays` to generate the criterion by
     * which by which they're compared. The order of result values is determined
     * by the order they occur in the arrays. The iteratee is invoked with one
     * argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * _.xorBy([2.1, 1.2], [2.3, 3.4], Math.floor);
     * // => [1.2, 3.4]
     *
     * // The `_.property` iteratee shorthand.
     * _.xorBy([{ 'x': 1 }], [{ 'x': 2 }, { 'x': 1 }], 'x');
     * // => [{ 'x': 2 }]
     */
    var xorBy = baseRest(function(arrays) {
      var iteratee = last(arrays);
      if (isArrayLikeObject(iteratee)) {
        iteratee = undefined;
      }
      return baseXor(arrayFilter(arrays, isArrayLikeObject), getIteratee(iteratee, 2));
    });

    /**
     * This method is like `_.xor` except that it accepts `comparator` which is
     * invoked to compare elements of `arrays`. The order of result values is
     * determined by the order they occur in the arrays. The comparator is invoked
     * with two arguments: (arrVal, othVal).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Array
     * @param {...Array} [arrays] The arrays to inspect.
     * @param {Function} [comparator] The comparator invoked per element.
     * @returns {Array} Returns the new array of filtered values.
     * @example
     *
     * var objects = [{ 'x': 1, 'y': 2 }, { 'x': 2, 'y': 1 }];
     * var others = [{ 'x': 1, 'y': 1 }, { 'x': 1, 'y': 2 }];
     *
     * _.xorWith(objects, others, _.isEqual);
     * // => [{ 'x': 2, 'y': 1 }, { 'x': 1, 'y': 1 }]
     */
    var xorWith = baseRest(function(arrays) {
      var comparator = last(arrays);
      comparator = typeof comparator == 'function' ? comparator : undefined;
      return baseXor(arrayFilter(arrays, isArrayLikeObject), undefined, comparator);
    });

    /**
     * Creates an array of grouped elements, the first of which contains the
     * first elements of the given arrays, the second of which contains the
     * second elements of the given arrays, and so on.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Array
     * @param {...Array} [arrays] The arrays to process.
     * @returns {Array} Returns the new array of grouped elements.
     * @example
     *
     * _.zip(['a', 'b'], [1, 2], [true, false]);
     * // => [['a', 1, true], ['b', 2, false]]
     */
    var zip = baseRest(unzip);

    /**
     * This method is like `_.fromPairs` except that it accepts two arrays,
     * one of property identifiers and one of corresponding values.
     *
     * @static
     * @memberOf _
     * @since 0.4.0
     * @category Array
     * @param {Array} [props=[]] The property identifiers.
     * @param {Array} [values=[]] The property values.
     * @returns {Object} Returns the new object.
     * @example
     *
     * _.zipObject(['a', 'b'], [1, 2]);
     * // => { 'a': 1, 'b': 2 }
     */
    function zipObject(props, values) {
      return baseZipObject(props || [], values || [], assignValue);
    }

    /**
     * This method is like `_.zipObject` except that it supports property paths.
     *
     * @static
     * @memberOf _
     * @since 4.1.0
     * @category Array
     * @param {Array} [props=[]] The property identifiers.
     * @param {Array} [values=[]] The property values.
     * @returns {Object} Returns the new object.
     * @example
     *
     * _.zipObjectDeep(['a.b[0].c', 'a.b[1].d'], [1, 2]);
     * // => { 'a': { 'b': [{ 'c': 1 }, { 'd': 2 }] } }
     */
    function zipObjectDeep(props, values) {
      return baseZipObject(props || [], values || [], baseSet);
    }

    /**
     * This method is like `_.zip` except that it accepts `iteratee` to specify
     * how grouped values should be combined. The iteratee is invoked with the
     * elements of each group: (...group).
     *
     * @static
     * @memberOf _
     * @since 3.8.0
     * @category Array
     * @param {...Array} [arrays] The arrays to process.
     * @param {Function} [iteratee=_.identity] The function to combine
     *  grouped values.
     * @returns {Array} Returns the new array of grouped elements.
     * @example
     *
     * _.zipWith([1, 2], [10, 20], [100, 200], function(a, b, c) {
     *   return a + b + c;
     * });
     * // => [111, 222]
     */
    var zipWith = baseRest(function(arrays) {
      var length = arrays.length,
          iteratee = length > 1 ? arrays[length - 1] : undefined;

      iteratee = typeof iteratee == 'function' ? (arrays.pop(), iteratee) : undefined;
      return unzipWith(arrays, iteratee);
    });

    /*------------------------------------------------------------------------*/

    /**
     * Creates a `lodash` wrapper instance that wraps `value` with explicit method
     * chain sequences enabled. The result of such sequences must be unwrapped
     * with `_#value`.
     *
     * @static
     * @memberOf _
     * @since 1.3.0
     * @category Seq
     * @param {*} value The value to wrap.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36 },
     *   { 'user': 'fred',    'age': 40 },
     *   { 'user': 'pebbles', 'age': 1 }
     * ];
     *
     * var youngest = _
     *   .chain(users)
     *   .sortBy('age')
     *   .map(function(o) {
     *     return o.user + ' is ' + o.age;
     *   })
     *   .head()
     *   .value();
     * // => 'pebbles is 1'
     */
    function chain(value) {
      var result = lodash(value);
      result.__chain__ = true;
      return result;
    }

    /**
     * This method invokes `interceptor` and returns `value`. The interceptor
     * is invoked with one argument; (value). The purpose of this method is to
     * "tap into" a method chain sequence in order to modify intermediate results.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Seq
     * @param {*} value The value to provide to `interceptor`.
     * @param {Function} interceptor The function to invoke.
     * @returns {*} Returns `value`.
     * @example
     *
     * _([1, 2, 3])
     *  .tap(function(array) {
     *    // Mutate input array.
     *    array.pop();
     *  })
     *  .reverse()
     *  .value();
     * // => [2, 1]
     */
    function tap(value, interceptor) {
      interceptor(value);
      return value;
    }

    /**
     * This method is like `_.tap` except that it returns the result of `interceptor`.
     * The purpose of this method is to "pass thru" values replacing intermediate
     * results in a method chain sequence.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Seq
     * @param {*} value The value to provide to `interceptor`.
     * @param {Function} interceptor The function to invoke.
     * @returns {*} Returns the result of `interceptor`.
     * @example
     *
     * _('  abc  ')
     *  .chain()
     *  .trim()
     *  .thru(function(value) {
     *    return [value];
     *  })
     *  .value();
     * // => ['abc']
     */
    function thru(value, interceptor) {
      return interceptor(value);
    }

    /**
     * This method is the wrapper version of `_.at`.
     *
     * @name at
     * @memberOf _
     * @since 1.0.0
     * @category Seq
     * @param {...(string|string[])} [paths] The property paths to pick.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }, 4] };
     *
     * _(object).at(['a[0].b.c', 'a[1]']).value();
     * // => [3, 4]
     */
    var wrapperAt = flatRest(function(paths) {
      var length = paths.length,
          start = length ? paths[0] : 0,
          value = this.__wrapped__,
          interceptor = function(object) { return baseAt(object, paths); };

      if (length > 1 || this.__actions__.length ||
          !(value instanceof LazyWrapper) || !isIndex(start)) {
        return this.thru(interceptor);
      }
      value = value.slice(start, +start + (length ? 1 : 0));
      value.__actions__.push({
        'func': thru,
        'args': [interceptor],
        'thisArg': undefined
      });
      return new LodashWrapper(value, this.__chain__).thru(function(array) {
        if (length && !array.length) {
          array.push(undefined);
        }
        return array;
      });
    });

    /**
     * Creates a `lodash` wrapper instance with explicit method chain sequences enabled.
     *
     * @name chain
     * @memberOf _
     * @since 0.1.0
     * @category Seq
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 }
     * ];
     *
     * // A sequence without explicit chaining.
     * _(users).head();
     * // => { 'user': 'barney', 'age': 36 }
     *
     * // A sequence with explicit chaining.
     * _(users)
     *   .chain()
     *   .head()
     *   .pick('user')
     *   .value();
     * // => { 'user': 'barney' }
     */
    function wrapperChain() {
      return chain(this);
    }

    /**
     * Executes the chain sequence and returns the wrapped result.
     *
     * @name commit
     * @memberOf _
     * @since 3.2.0
     * @category Seq
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var array = [1, 2];
     * var wrapped = _(array).push(3);
     *
     * console.log(array);
     * // => [1, 2]
     *
     * wrapped = wrapped.commit();
     * console.log(array);
     * // => [1, 2, 3]
     *
     * wrapped.last();
     * // => 3
     *
     * console.log(array);
     * // => [1, 2, 3]
     */
    function wrapperCommit() {
      return new LodashWrapper(this.value(), this.__chain__);
    }

    /**
     * Gets the next value on a wrapped object following the
     * [iterator protocol](https://mdn.io/iteration_protocols#iterator).
     *
     * @name next
     * @memberOf _
     * @since 4.0.0
     * @category Seq
     * @returns {Object} Returns the next iterator value.
     * @example
     *
     * var wrapped = _([1, 2]);
     *
     * wrapped.next();
     * // => { 'done': false, 'value': 1 }
     *
     * wrapped.next();
     * // => { 'done': false, 'value': 2 }
     *
     * wrapped.next();
     * // => { 'done': true, 'value': undefined }
     */
    function wrapperNext() {
      if (this.__values__ === undefined) {
        this.__values__ = toArray(this.value());
      }
      var done = this.__index__ >= this.__values__.length,
          value = done ? undefined : this.__values__[this.__index__++];

      return { 'done': done, 'value': value };
    }

    /**
     * Enables the wrapper to be iterable.
     *
     * @name Symbol.iterator
     * @memberOf _
     * @since 4.0.0
     * @category Seq
     * @returns {Object} Returns the wrapper object.
     * @example
     *
     * var wrapped = _([1, 2]);
     *
     * wrapped[Symbol.iterator]() === wrapped;
     * // => true
     *
     * Array.from(wrapped);
     * // => [1, 2]
     */
    function wrapperToIterator() {
      return this;
    }

    /**
     * Creates a clone of the chain sequence planting `value` as the wrapped value.
     *
     * @name plant
     * @memberOf _
     * @since 3.2.0
     * @category Seq
     * @param {*} value The value to plant.
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var wrapped = _([1, 2]).map(square);
     * var other = wrapped.plant([3, 4]);
     *
     * other.value();
     * // => [9, 16]
     *
     * wrapped.value();
     * // => [1, 4]
     */
    function wrapperPlant(value) {
      var result,
          parent = this;

      while (parent instanceof baseLodash) {
        var clone = wrapperClone(parent);
        clone.__index__ = 0;
        clone.__values__ = undefined;
        if (result) {
          previous.__wrapped__ = clone;
        } else {
          result = clone;
        }
        var previous = clone;
        parent = parent.__wrapped__;
      }
      previous.__wrapped__ = value;
      return result;
    }

    /**
     * This method is the wrapper version of `_.reverse`.
     *
     * **Note:** This method mutates the wrapped array.
     *
     * @name reverse
     * @memberOf _
     * @since 0.1.0
     * @category Seq
     * @returns {Object} Returns the new `lodash` wrapper instance.
     * @example
     *
     * var array = [1, 2, 3];
     *
     * _(array).reverse().value()
     * // => [3, 2, 1]
     *
     * console.log(array);
     * // => [3, 2, 1]
     */
    function wrapperReverse() {
      var value = this.__wrapped__;
      if (value instanceof LazyWrapper) {
        var wrapped = value;
        if (this.__actions__.length) {
          wrapped = new LazyWrapper(this);
        }
        wrapped = wrapped.reverse();
        wrapped.__actions__.push({
          'func': thru,
          'args': [reverse],
          'thisArg': undefined
        });
        return new LodashWrapper(wrapped, this.__chain__);
      }
      return this.thru(reverse);
    }

    /**
     * Executes the chain sequence to resolve the unwrapped value.
     *
     * @name value
     * @memberOf _
     * @since 0.1.0
     * @alias toJSON, valueOf
     * @category Seq
     * @returns {*} Returns the resolved unwrapped value.
     * @example
     *
     * _([1, 2, 3]).value();
     * // => [1, 2, 3]
     */
    function wrapperValue() {
      return baseWrapperValue(this.__wrapped__, this.__actions__);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` thru `iteratee`. The corresponding value of
     * each key is the number of times the key was returned by `iteratee`. The
     * iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 0.5.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.countBy([6.1, 4.2, 6.3], Math.floor);
     * // => { '4': 1, '6': 2 }
     *
     * // The `_.property` iteratee shorthand.
     * _.countBy(['one', 'two', 'three'], 'length');
     * // => { '3': 2, '5': 1 }
     */
    var countBy = createAggregator(function(result, value, key) {
      if (hasOwnProperty.call(result, key)) {
        ++result[key];
      } else {
        baseAssignValue(result, key, 1);
      }
    });

    /**
     * Checks if `predicate` returns truthy for **all** elements of `collection`.
     * Iteration is stopped once `predicate` returns falsey. The predicate is
     * invoked with three arguments: (value, index|key, collection).
     *
     * **Note:** This method returns `true` for
     * [empty collections](https://en.wikipedia.org/wiki/Empty_set) because
     * [everything is true](https://en.wikipedia.org/wiki/Vacuous_truth) of
     * elements of empty collections.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {boolean} Returns `true` if all elements pass the predicate check,
     *  else `false`.
     * @example
     *
     * _.every([true, 1, null, 'yes'], Boolean);
     * // => false
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': false },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * // The `_.matches` iteratee shorthand.
     * _.every(users, { 'user': 'barney', 'active': false });
     * // => false
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.every(users, ['active', false]);
     * // => true
     *
     * // The `_.property` iteratee shorthand.
     * _.every(users, 'active');
     * // => false
     */
    function every(collection, predicate, guard) {
      var func = isArray(collection) ? arrayEvery : baseEvery;
      if (guard && isIterateeCall(collection, predicate, guard)) {
        predicate = undefined;
      }
      return func(collection, getIteratee(predicate, 3));
    }

    /**
     * Iterates over elements of `collection`, returning an array of all elements
     * `predicate` returns truthy for. The predicate is invoked with three
     * arguments: (value, index|key, collection).
     *
     * **Note:** Unlike `_.remove`, this method returns a new array.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     * @see _.reject
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': true },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * _.filter(users, function(o) { return !o.active; });
     * // => objects for ['fred']
     *
     * // The `_.matches` iteratee shorthand.
     * _.filter(users, { 'age': 36, 'active': true });
     * // => objects for ['barney']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.filter(users, ['active', false]);
     * // => objects for ['fred']
     *
     * // The `_.property` iteratee shorthand.
     * _.filter(users, 'active');
     * // => objects for ['barney']
     */
    function filter(collection, predicate) {
      var func = isArray(collection) ? arrayFilter : baseFilter;
      return func(collection, getIteratee(predicate, 3));
    }

    /**
     * Iterates over elements of `collection`, returning the first element
     * `predicate` returns truthy for. The predicate is invoked with three
     * arguments: (value, index|key, collection).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=0] The index to search from.
     * @returns {*} Returns the matched element, else `undefined`.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36, 'active': true },
     *   { 'user': 'fred',    'age': 40, 'active': false },
     *   { 'user': 'pebbles', 'age': 1,  'active': true }
     * ];
     *
     * _.find(users, function(o) { return o.age < 40; });
     * // => object for 'barney'
     *
     * // The `_.matches` iteratee shorthand.
     * _.find(users, { 'age': 1, 'active': true });
     * // => object for 'pebbles'
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.find(users, ['active', false]);
     * // => object for 'fred'
     *
     * // The `_.property` iteratee shorthand.
     * _.find(users, 'active');
     * // => object for 'barney'
     */
    var find = createFind(findIndex);

    /**
     * This method is like `_.find` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param {number} [fromIndex=collection.length-1] The index to search from.
     * @returns {*} Returns the matched element, else `undefined`.
     * @example
     *
     * _.findLast([1, 2, 3, 4], function(n) {
     *   return n % 2 == 1;
     * });
     * // => 3
     */
    var findLast = createFind(findLastIndex);

    /**
     * Creates a flattened array of values by running each element in `collection`
     * thru `iteratee` and flattening the mapped results. The iteratee is invoked
     * with three arguments: (value, index|key, collection).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * function duplicate(n) {
     *   return [n, n];
     * }
     *
     * _.flatMap([1, 2], duplicate);
     * // => [1, 1, 2, 2]
     */
    function flatMap(collection, iteratee) {
      return baseFlatten(map(collection, iteratee), 1);
    }

    /**
     * This method is like `_.flatMap` except that it recursively flattens the
     * mapped results.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * function duplicate(n) {
     *   return [[[n, n]]];
     * }
     *
     * _.flatMapDeep([1, 2], duplicate);
     * // => [1, 1, 2, 2]
     */
    function flatMapDeep(collection, iteratee) {
      return baseFlatten(map(collection, iteratee), INFINITY);
    }

    /**
     * This method is like `_.flatMap` except that it recursively flattens the
     * mapped results up to `depth` times.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {number} [depth=1] The maximum recursion depth.
     * @returns {Array} Returns the new flattened array.
     * @example
     *
     * function duplicate(n) {
     *   return [[[n, n]]];
     * }
     *
     * _.flatMapDepth([1, 2], duplicate, 2);
     * // => [[1, 1], [2, 2]]
     */
    function flatMapDepth(collection, iteratee, depth) {
      depth = depth === undefined ? 1 : toInteger(depth);
      return baseFlatten(map(collection, iteratee), depth);
    }

    /**
     * Iterates over elements of `collection` and invokes `iteratee` for each element.
     * The iteratee is invoked with three arguments: (value, index|key, collection).
     * Iteratee functions may exit iteration early by explicitly returning `false`.
     *
     * **Note:** As with other "Collections" methods, objects with a "length"
     * property are iterated like arrays. To avoid this behavior use `_.forIn`
     * or `_.forOwn` for object iteration.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @alias each
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     * @see _.forEachRight
     * @example
     *
     * _.forEach([1, 2], function(value) {
     *   console.log(value);
     * });
     * // => Logs `1` then `2`.
     *
     * _.forEach({ 'a': 1, 'b': 2 }, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'a' then 'b' (iteration order is not guaranteed).
     */
    function forEach(collection, iteratee) {
      var func = isArray(collection) ? arrayEach : baseEach;
      return func(collection, getIteratee(iteratee, 3));
    }

    /**
     * This method is like `_.forEach` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @alias eachRight
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array|Object} Returns `collection`.
     * @see _.forEach
     * @example
     *
     * _.forEachRight([1, 2], function(value) {
     *   console.log(value);
     * });
     * // => Logs `2` then `1`.
     */
    function forEachRight(collection, iteratee) {
      var func = isArray(collection) ? arrayEachRight : baseEachRight;
      return func(collection, getIteratee(iteratee, 3));
    }

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` thru `iteratee`. The order of grouped values
     * is determined by the order they occur in `collection`. The corresponding
     * value of each key is an array of elements responsible for generating the
     * key. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * _.groupBy([6.1, 4.2, 6.3], Math.floor);
     * // => { '4': [4.2], '6': [6.1, 6.3] }
     *
     * // The `_.property` iteratee shorthand.
     * _.groupBy(['one', 'two', 'three'], 'length');
     * // => { '3': ['one', 'two'], '5': ['three'] }
     */
    var groupBy = createAggregator(function(result, value, key) {
      if (hasOwnProperty.call(result, key)) {
        result[key].push(value);
      } else {
        baseAssignValue(result, key, [value]);
      }
    });

    /**
     * Checks if `value` is in `collection`. If `collection` is a string, it's
     * checked for a substring of `value`, otherwise
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * is used for equality comparisons. If `fromIndex` is negative, it's used as
     * the offset from the end of `collection`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object|string} collection The collection to inspect.
     * @param {*} value The value to search for.
     * @param {number} [fromIndex=0] The index to search from.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.reduce`.
     * @returns {boolean} Returns `true` if `value` is found, else `false`.
     * @example
     *
     * _.includes([1, 2, 3], 1);
     * // => true
     *
     * _.includes([1, 2, 3], 1, 2);
     * // => false
     *
     * _.includes({ 'a': 1, 'b': 2 }, 1);
     * // => true
     *
     * _.includes('abcd', 'bc');
     * // => true
     */
    function includes(collection, value, fromIndex, guard) {
      collection = isArrayLike(collection) ? collection : values(collection);
      fromIndex = (fromIndex && !guard) ? toInteger(fromIndex) : 0;

      var length = collection.length;
      if (fromIndex < 0) {
        fromIndex = nativeMax(length + fromIndex, 0);
      }
      return isString(collection)
        ? (fromIndex <= length && collection.indexOf(value, fromIndex) > -1)
        : (!!length && baseIndexOf(collection, value, fromIndex) > -1);
    }

    /**
     * Invokes the method at `path` of each element in `collection`, returning
     * an array of the results of each invoked method. Any additional arguments
     * are provided to each invoked method. If `path` is a function, it's invoked
     * for, and `this` bound to, each element in `collection`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Array|Function|string} path The path of the method to invoke or
     *  the function invoked per iteration.
     * @param {...*} [args] The arguments to invoke each method with.
     * @returns {Array} Returns the array of results.
     * @example
     *
     * _.invokeMap([[5, 1, 7], [3, 2, 1]], 'sort');
     * // => [[1, 5, 7], [1, 2, 3]]
     *
     * _.invokeMap([123, 456], String.prototype.split, '');
     * // => [['1', '2', '3'], ['4', '5', '6']]
     */
    var invokeMap = baseRest(function(collection, path, args) {
      var index = -1,
          isFunc = typeof path == 'function',
          result = isArrayLike(collection) ? Array(collection.length) : [];

      baseEach(collection, function(value) {
        result[++index] = isFunc ? apply(path, value, args) : baseInvoke(value, path, args);
      });
      return result;
    });

    /**
     * Creates an object composed of keys generated from the results of running
     * each element of `collection` thru `iteratee`. The corresponding value of
     * each key is the last element responsible for generating the key. The
     * iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee to transform keys.
     * @returns {Object} Returns the composed aggregate object.
     * @example
     *
     * var array = [
     *   { 'dir': 'left', 'code': 97 },
     *   { 'dir': 'right', 'code': 100 }
     * ];
     *
     * _.keyBy(array, function(o) {
     *   return String.fromCharCode(o.code);
     * });
     * // => { 'a': { 'dir': 'left', 'code': 97 }, 'd': { 'dir': 'right', 'code': 100 } }
     *
     * _.keyBy(array, 'dir');
     * // => { 'left': { 'dir': 'left', 'code': 97 }, 'right': { 'dir': 'right', 'code': 100 } }
     */
    var keyBy = createAggregator(function(result, value, key) {
      baseAssignValue(result, key, value);
    });

    /**
     * Creates an array of values by running each element in `collection` thru
     * `iteratee`. The iteratee is invoked with three arguments:
     * (value, index|key, collection).
     *
     * Many lodash methods are guarded to work as iteratees for methods like
     * `_.every`, `_.filter`, `_.map`, `_.mapValues`, `_.reject`, and `_.some`.
     *
     * The guarded methods are:
     * `ary`, `chunk`, `curry`, `curryRight`, `drop`, `dropRight`, `every`,
     * `fill`, `invert`, `parseInt`, `random`, `range`, `rangeRight`, `repeat`,
     * `sampleSize`, `slice`, `some`, `sortBy`, `split`, `take`, `takeRight`,
     * `template`, `trim`, `trimEnd`, `trimStart`, and `words`
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new mapped array.
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * _.map([4, 8], square);
     * // => [16, 64]
     *
     * _.map({ 'a': 4, 'b': 8 }, square);
     * // => [16, 64] (iteration order is not guaranteed)
     *
     * var users = [
     *   { 'user': 'barney' },
     *   { 'user': 'fred' }
     * ];
     *
     * // The `_.property` iteratee shorthand.
     * _.map(users, 'user');
     * // => ['barney', 'fred']
     */
    function map(collection, iteratee) {
      var func = isArray(collection) ? arrayMap : baseMap;
      return func(collection, getIteratee(iteratee, 3));
    }

    /**
     * This method is like `_.sortBy` except that it allows specifying the sort
     * orders of the iteratees to sort by. If `orders` is unspecified, all values
     * are sorted in ascending order. Otherwise, specify an order of "desc" for
     * descending or "asc" for ascending sort order of corresponding values.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Array[]|Function[]|Object[]|string[]} [iteratees=[_.identity]]
     *  The iteratees to sort by.
     * @param {string[]} [orders] The sort orders of `iteratees`.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.reduce`.
     * @returns {Array} Returns the new sorted array.
     * @example
     *
     * var users = [
     *   { 'user': 'fred',   'age': 48 },
     *   { 'user': 'barney', 'age': 34 },
     *   { 'user': 'fred',   'age': 40 },
     *   { 'user': 'barney', 'age': 36 }
     * ];
     *
     * // Sort by `user` in ascending order and by `age` in descending order.
     * _.orderBy(users, ['user', 'age'], ['asc', 'desc']);
     * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 40]]
     */
    function orderBy(collection, iteratees, orders, guard) {
      if (collection == null) {
        return [];
      }
      if (!isArray(iteratees)) {
        iteratees = iteratees == null ? [] : [iteratees];
      }
      orders = guard ? undefined : orders;
      if (!isArray(orders)) {
        orders = orders == null ? [] : [orders];
      }
      return baseOrderBy(collection, iteratees, orders);
    }

    /**
     * Creates an array of elements split into two groups, the first of which
     * contains elements `predicate` returns truthy for, the second of which
     * contains elements `predicate` returns falsey for. The predicate is
     * invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the array of grouped elements.
     * @example
     *
     * var users = [
     *   { 'user': 'barney',  'age': 36, 'active': false },
     *   { 'user': 'fred',    'age': 40, 'active': true },
     *   { 'user': 'pebbles', 'age': 1,  'active': false }
     * ];
     *
     * _.partition(users, function(o) { return o.active; });
     * // => objects for [['fred'], ['barney', 'pebbles']]
     *
     * // The `_.matches` iteratee shorthand.
     * _.partition(users, { 'age': 1, 'active': false });
     * // => objects for [['pebbles'], ['barney', 'fred']]
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.partition(users, ['active', false]);
     * // => objects for [['barney', 'pebbles'], ['fred']]
     *
     * // The `_.property` iteratee shorthand.
     * _.partition(users, 'active');
     * // => objects for [['fred'], ['barney', 'pebbles']]
     */
    var partition = createAggregator(function(result, value, key) {
      result[key ? 0 : 1].push(value);
    }, function() { return [[], []]; });

    /**
     * Reduces `collection` to a value which is the accumulated result of running
     * each element in `collection` thru `iteratee`, where each successive
     * invocation is supplied the return value of the previous. If `accumulator`
     * is not given, the first element of `collection` is used as the initial
     * value. The iteratee is invoked with four arguments:
     * (accumulator, value, index|key, collection).
     *
     * Many lodash methods are guarded to work as iteratees for methods like
     * `_.reduce`, `_.reduceRight`, and `_.transform`.
     *
     * The guarded methods are:
     * `assign`, `defaults`, `defaultsDeep`, `includes`, `merge`, `orderBy`,
     * and `sortBy`
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @returns {*} Returns the accumulated value.
     * @see _.reduceRight
     * @example
     *
     * _.reduce([1, 2], function(sum, n) {
     *   return sum + n;
     * }, 0);
     * // => 3
     *
     * _.reduce({ 'a': 1, 'b': 2, 'c': 1 }, function(result, value, key) {
     *   (result[value] || (result[value] = [])).push(key);
     *   return result;
     * }, {});
     * // => { '1': ['a', 'c'], '2': ['b'] } (iteration order is not guaranteed)
     */
    function reduce(collection, iteratee, accumulator) {
      var func = isArray(collection) ? arrayReduce : baseReduce,
          initAccum = arguments.length < 3;

      return func(collection, getIteratee(iteratee, 4), accumulator, initAccum, baseEach);
    }

    /**
     * This method is like `_.reduce` except that it iterates over elements of
     * `collection` from right to left.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The initial value.
     * @returns {*} Returns the accumulated value.
     * @see _.reduce
     * @example
     *
     * var array = [[0, 1], [2, 3], [4, 5]];
     *
     * _.reduceRight(array, function(flattened, other) {
     *   return flattened.concat(other);
     * }, []);
     * // => [4, 5, 2, 3, 0, 1]
     */
    function reduceRight(collection, iteratee, accumulator) {
      var func = isArray(collection) ? arrayReduceRight : baseReduce,
          initAccum = arguments.length < 3;

      return func(collection, getIteratee(iteratee, 4), accumulator, initAccum, baseEachRight);
    }

    /**
     * The opposite of `_.filter`; this method returns the elements of `collection`
     * that `predicate` does **not** return truthy for.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the new filtered array.
     * @see _.filter
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': false },
     *   { 'user': 'fred',   'age': 40, 'active': true }
     * ];
     *
     * _.reject(users, function(o) { return !o.active; });
     * // => objects for ['fred']
     *
     * // The `_.matches` iteratee shorthand.
     * _.reject(users, { 'age': 40, 'active': true });
     * // => objects for ['barney']
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.reject(users, ['active', false]);
     * // => objects for ['fred']
     *
     * // The `_.property` iteratee shorthand.
     * _.reject(users, 'active');
     * // => objects for ['barney']
     */
    function reject(collection, predicate) {
      var func = isArray(collection) ? arrayFilter : baseFilter;
      return func(collection, negate(getIteratee(predicate, 3)));
    }

    /**
     * Gets a random element from `collection`.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to sample.
     * @returns {*} Returns the random element.
     * @example
     *
     * _.sample([1, 2, 3, 4]);
     * // => 2
     */
    function sample(collection) {
      var func = isArray(collection) ? arraySample : baseSample;
      return func(collection);
    }

    /**
     * Gets `n` random elements at unique keys from `collection` up to the
     * size of `collection`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Collection
     * @param {Array|Object} collection The collection to sample.
     * @param {number} [n=1] The number of elements to sample.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the random elements.
     * @example
     *
     * _.sampleSize([1, 2, 3], 2);
     * // => [3, 1]
     *
     * _.sampleSize([1, 2, 3], 4);
     * // => [2, 3, 1]
     */
    function sampleSize(collection, n, guard) {
      if ((guard ? isIterateeCall(collection, n, guard) : n === undefined)) {
        n = 1;
      } else {
        n = toInteger(n);
      }
      var func = isArray(collection) ? arraySampleSize : baseSampleSize;
      return func(collection, n);
    }

    /**
     * Creates an array of shuffled values, using a version of the
     * [Fisher-Yates shuffle](https://en.wikipedia.org/wiki/Fisher-Yates_shuffle).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to shuffle.
     * @returns {Array} Returns the new shuffled array.
     * @example
     *
     * _.shuffle([1, 2, 3, 4]);
     * // => [4, 1, 3, 2]
     */
    function shuffle(collection) {
      var func = isArray(collection) ? arrayShuffle : baseShuffle;
      return func(collection);
    }

    /**
     * Gets the size of `collection` by returning its length for array-like
     * values or the number of own enumerable string keyed properties for objects.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object|string} collection The collection to inspect.
     * @returns {number} Returns the collection size.
     * @example
     *
     * _.size([1, 2, 3]);
     * // => 3
     *
     * _.size({ 'a': 1, 'b': 2 });
     * // => 2
     *
     * _.size('pebbles');
     * // => 7
     */
    function size(collection) {
      if (collection == null) {
        return 0;
      }
      if (isArrayLike(collection)) {
        return isString(collection) ? stringSize(collection) : collection.length;
      }
      var tag = getTag(collection);
      if (tag == mapTag || tag == setTag) {
        return collection.size;
      }
      return baseKeys(collection).length;
    }

    /**
     * Checks if `predicate` returns truthy for **any** element of `collection`.
     * Iteration is stopped once `predicate` returns truthy. The predicate is
     * invoked with three arguments: (value, index|key, collection).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {boolean} Returns `true` if any element passes the predicate check,
     *  else `false`.
     * @example
     *
     * _.some([null, 0, 'yes', false], Boolean);
     * // => true
     *
     * var users = [
     *   { 'user': 'barney', 'active': true },
     *   { 'user': 'fred',   'active': false }
     * ];
     *
     * // The `_.matches` iteratee shorthand.
     * _.some(users, { 'user': 'barney', 'active': false });
     * // => false
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.some(users, ['active', false]);
     * // => true
     *
     * // The `_.property` iteratee shorthand.
     * _.some(users, 'active');
     * // => true
     */
    function some(collection, predicate, guard) {
      var func = isArray(collection) ? arraySome : baseSome;
      if (guard && isIterateeCall(collection, predicate, guard)) {
        predicate = undefined;
      }
      return func(collection, getIteratee(predicate, 3));
    }

    /**
     * Creates an array of elements, sorted in ascending order by the results of
     * running each element in a collection thru each iteratee. This method
     * performs a stable sort, that is, it preserves the original sort order of
     * equal elements. The iteratees are invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Collection
     * @param {Array|Object} collection The collection to iterate over.
     * @param {...(Function|Function[])} [iteratees=[_.identity]]
     *  The iteratees to sort by.
     * @returns {Array} Returns the new sorted array.
     * @example
     *
     * var users = [
     *   { 'user': 'fred',   'age': 48 },
     *   { 'user': 'barney', 'age': 36 },
     *   { 'user': 'fred',   'age': 40 },
     *   { 'user': 'barney', 'age': 34 }
     * ];
     *
     * _.sortBy(users, [function(o) { return o.user; }]);
     * // => objects for [['barney', 36], ['barney', 34], ['fred', 48], ['fred', 40]]
     *
     * _.sortBy(users, ['user', 'age']);
     * // => objects for [['barney', 34], ['barney', 36], ['fred', 40], ['fred', 48]]
     */
    var sortBy = baseRest(function(collection, iteratees) {
      if (collection == null) {
        return [];
      }
      var length = iteratees.length;
      if (length > 1 && isIterateeCall(collection, iteratees[0], iteratees[1])) {
        iteratees = [];
      } else if (length > 2 && isIterateeCall(iteratees[0], iteratees[1], iteratees[2])) {
        iteratees = [iteratees[0]];
      }
      return baseOrderBy(collection, baseFlatten(iteratees, 1), []);
    });

    /*------------------------------------------------------------------------*/

    /**
     * Gets the timestamp of the number of milliseconds that have elapsed since
     * the Unix epoch (1 January 1970 00:00:00 UTC).
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Date
     * @returns {number} Returns the timestamp.
     * @example
     *
     * _.defer(function(stamp) {
     *   console.log(_.now() - stamp);
     * }, _.now());
     * // => Logs the number of milliseconds it took for the deferred invocation.
     */
    var now = ctxNow || function() {
      return root.Date.now();
    };

    /*------------------------------------------------------------------------*/

    /**
     * The opposite of `_.before`; this method creates a function that invokes
     * `func` once it's called `n` or more times.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {number} n The number of calls before `func` is invoked.
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var saves = ['profile', 'settings'];
     *
     * var done = _.after(saves.length, function() {
     *   console.log('done saving!');
     * });
     *
     * _.forEach(saves, function(type) {
     *   asyncSave({ 'type': type, 'complete': done });
     * });
     * // => Logs 'done saving!' after the two async saves have completed.
     */
    function after(n, func) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      n = toInteger(n);
      return function() {
        if (--n < 1) {
          return func.apply(this, arguments);
        }
      };
    }

    /**
     * Creates a function that invokes `func`, with up to `n` arguments,
     * ignoring any additional arguments.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} func The function to cap arguments for.
     * @param {number} [n=func.length] The arity cap.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the new capped function.
     * @example
     *
     * _.map(['6', '8', '10'], _.ary(parseInt, 1));
     * // => [6, 8, 10]
     */
    function ary(func, n, guard) {
      n = guard ? undefined : n;
      n = (func && n == null) ? func.length : n;
      return createWrap(func, WRAP_ARY_FLAG, undefined, undefined, undefined, undefined, n);
    }

    /**
     * Creates a function that invokes `func`, with the `this` binding and arguments
     * of the created function, while it's called less than `n` times. Subsequent
     * calls to the created function return the result of the last `func` invocation.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {number} n The number of calls at which `func` is no longer invoked.
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * jQuery(element).on('click', _.before(5, addContactToList));
     * // => Allows adding up to 4 contacts to the list.
     */
    function before(n, func) {
      var result;
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      n = toInteger(n);
      return function() {
        if (--n > 0) {
          result = func.apply(this, arguments);
        }
        if (n <= 1) {
          func = undefined;
        }
        return result;
      };
    }

    /**
     * Creates a function that invokes `func` with the `this` binding of `thisArg`
     * and `partials` prepended to the arguments it receives.
     *
     * The `_.bind.placeholder` value, which defaults to `_` in monolithic builds,
     * may be used as a placeholder for partially applied arguments.
     *
     * **Note:** Unlike native `Function#bind`, this method doesn't set the "length"
     * property of bound functions.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to bind.
     * @param {*} thisArg The `this` binding of `func`.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * function greet(greeting, punctuation) {
     *   return greeting + ' ' + this.user + punctuation;
     * }
     *
     * var object = { 'user': 'fred' };
     *
     * var bound = _.bind(greet, object, 'hi');
     * bound('!');
     * // => 'hi fred!'
     *
     * // Bound with placeholders.
     * var bound = _.bind(greet, object, _, '!');
     * bound('hi');
     * // => 'hi fred!'
     */
    var bind = baseRest(function(func, thisArg, partials) {
      var bitmask = WRAP_BIND_FLAG;
      if (partials.length) {
        var holders = replaceHolders(partials, getHolder(bind));
        bitmask |= WRAP_PARTIAL_FLAG;
      }
      return createWrap(func, bitmask, thisArg, partials, holders);
    });

    /**
     * Creates a function that invokes the method at `object[key]` with `partials`
     * prepended to the arguments it receives.
     *
     * This method differs from `_.bind` by allowing bound functions to reference
     * methods that may be redefined or don't yet exist. See
     * [Peter Michaux's article](http://peter.michaux.ca/articles/lazy-function-definition-pattern)
     * for more details.
     *
     * The `_.bindKey.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * @static
     * @memberOf _
     * @since 0.10.0
     * @category Function
     * @param {Object} object The object to invoke the method on.
     * @param {string} key The key of the method.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new bound function.
     * @example
     *
     * var object = {
     *   'user': 'fred',
     *   'greet': function(greeting, punctuation) {
     *     return greeting + ' ' + this.user + punctuation;
     *   }
     * };
     *
     * var bound = _.bindKey(object, 'greet', 'hi');
     * bound('!');
     * // => 'hi fred!'
     *
     * object.greet = function(greeting, punctuation) {
     *   return greeting + 'ya ' + this.user + punctuation;
     * };
     *
     * bound('!');
     * // => 'hiya fred!'
     *
     * // Bound with placeholders.
     * var bound = _.bindKey(object, 'greet', _, '!');
     * bound('hi');
     * // => 'hiya fred!'
     */
    var bindKey = baseRest(function(object, key, partials) {
      var bitmask = WRAP_BIND_FLAG | WRAP_BIND_KEY_FLAG;
      if (partials.length) {
        var holders = replaceHolders(partials, getHolder(bindKey));
        bitmask |= WRAP_PARTIAL_FLAG;
      }
      return createWrap(key, bitmask, object, partials, holders);
    });

    /**
     * Creates a function that accepts arguments of `func` and either invokes
     * `func` returning its result, if at least `arity` number of arguments have
     * been provided, or returns a function that accepts the remaining `func`
     * arguments, and so on. The arity of `func` may be specified if `func.length`
     * is not sufficient.
     *
     * The `_.curry.placeholder` value, which defaults to `_` in monolithic builds,
     * may be used as a placeholder for provided arguments.
     *
     * **Note:** This method doesn't set the "length" property of curried functions.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Function
     * @param {Function} func The function to curry.
     * @param {number} [arity=func.length] The arity of `func`.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the new curried function.
     * @example
     *
     * var abc = function(a, b, c) {
     *   return [a, b, c];
     * };
     *
     * var curried = _.curry(abc);
     *
     * curried(1)(2)(3);
     * // => [1, 2, 3]
     *
     * curried(1, 2)(3);
     * // => [1, 2, 3]
     *
     * curried(1, 2, 3);
     * // => [1, 2, 3]
     *
     * // Curried with placeholders.
     * curried(1)(_, 3)(2);
     * // => [1, 2, 3]
     */
    function curry(func, arity, guard) {
      arity = guard ? undefined : arity;
      var result = createWrap(func, WRAP_CURRY_FLAG, undefined, undefined, undefined, undefined, undefined, arity);
      result.placeholder = curry.placeholder;
      return result;
    }

    /**
     * This method is like `_.curry` except that arguments are applied to `func`
     * in the manner of `_.partialRight` instead of `_.partial`.
     *
     * The `_.curryRight.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for provided arguments.
     *
     * **Note:** This method doesn't set the "length" property of curried functions.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} func The function to curry.
     * @param {number} [arity=func.length] The arity of `func`.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the new curried function.
     * @example
     *
     * var abc = function(a, b, c) {
     *   return [a, b, c];
     * };
     *
     * var curried = _.curryRight(abc);
     *
     * curried(3)(2)(1);
     * // => [1, 2, 3]
     *
     * curried(2, 3)(1);
     * // => [1, 2, 3]
     *
     * curried(1, 2, 3);
     * // => [1, 2, 3]
     *
     * // Curried with placeholders.
     * curried(3)(1, _)(2);
     * // => [1, 2, 3]
     */
    function curryRight(func, arity, guard) {
      arity = guard ? undefined : arity;
      var result = createWrap(func, WRAP_CURRY_RIGHT_FLAG, undefined, undefined, undefined, undefined, undefined, arity);
      result.placeholder = curryRight.placeholder;
      return result;
    }

    /**
     * Creates a debounced function that delays invoking `func` until after `wait`
     * milliseconds have elapsed since the last time the debounced function was
     * invoked. The debounced function comes with a `cancel` method to cancel
     * delayed `func` invocations and a `flush` method to immediately invoke them.
     * Provide `options` to indicate whether `func` should be invoked on the
     * leading and/or trailing edge of the `wait` timeout. The `func` is invoked
     * with the last arguments provided to the debounced function. Subsequent
     * calls to the debounced function return the result of the last `func`
     * invocation.
     *
     * **Note:** If `leading` and `trailing` options are `true`, `func` is
     * invoked on the trailing edge of the timeout only if the debounced function
     * is invoked more than once during the `wait` timeout.
     *
     * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
     * until to the next tick, similar to `setTimeout` with a timeout of `0`.
     *
     * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
     * for details over the differences between `_.debounce` and `_.throttle`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to debounce.
     * @param {number} [wait=0] The number of milliseconds to delay.
     * @param {Object} [options={}] The options object.
     * @param {boolean} [options.leading=false]
     *  Specify invoking on the leading edge of the timeout.
     * @param {number} [options.maxWait]
     *  The maximum time `func` is allowed to be delayed before it's invoked.
     * @param {boolean} [options.trailing=true]
     *  Specify invoking on the trailing edge of the timeout.
     * @returns {Function} Returns the new debounced function.
     * @example
     *
     * // Avoid costly calculations while the window size is in flux.
     * jQuery(window).on('resize', _.debounce(calculateLayout, 150));
     *
     * // Invoke `sendMail` when clicked, debouncing subsequent calls.
     * jQuery(element).on('click', _.debounce(sendMail, 300, {
     *   'leading': true,
     *   'trailing': false
     * }));
     *
     * // Ensure `batchLog` is invoked once after 1 second of debounced calls.
     * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });
     * var source = new EventSource('/stream');
     * jQuery(source).on('message', debounced);
     *
     * // Cancel the trailing debounced invocation.
     * jQuery(window).on('popstate', debounced.cancel);
     */
    function debounce(func, wait, options) {
      var lastArgs,
          lastThis,
          maxWait,
          result,
          timerId,
          lastCallTime,
          lastInvokeTime = 0,
          leading = false,
          maxing = false,
          trailing = true;

      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      wait = toNumber(wait) || 0;
      if (isObject(options)) {
        leading = !!options.leading;
        maxing = 'maxWait' in options;
        maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;
        trailing = 'trailing' in options ? !!options.trailing : trailing;
      }

      function invokeFunc(time) {
        var args = lastArgs,
            thisArg = lastThis;

        lastArgs = lastThis = undefined;
        lastInvokeTime = time;
        result = func.apply(thisArg, args);
        return result;
      }

      function leadingEdge(time) {
        // Reset any `maxWait` timer.
        lastInvokeTime = time;
        // Start the timer for the trailing edge.
        timerId = setTimeout(timerExpired, wait);
        // Invoke the leading edge.
        return leading ? invokeFunc(time) : result;
      }

      function remainingWait(time) {
        var timeSinceLastCall = time - lastCallTime,
            timeSinceLastInvoke = time - lastInvokeTime,
            timeWaiting = wait - timeSinceLastCall;

        return maxing
          ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)
          : timeWaiting;
      }

      function shouldInvoke(time) {
        var timeSinceLastCall = time - lastCallTime,
            timeSinceLastInvoke = time - lastInvokeTime;

        // Either this is the first call, activity has stopped and we're at the
        // trailing edge, the system time has gone backwards and we're treating
        // it as the trailing edge, or we've hit the `maxWait` limit.
        return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||
          (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));
      }

      function timerExpired() {
        var time = now();
        if (shouldInvoke(time)) {
          return trailingEdge(time);
        }
        // Restart the timer.
        timerId = setTimeout(timerExpired, remainingWait(time));
      }

      function trailingEdge(time) {
        timerId = undefined;

        // Only invoke if we have `lastArgs` which means `func` has been
        // debounced at least once.
        if (trailing && lastArgs) {
          return invokeFunc(time);
        }
        lastArgs = lastThis = undefined;
        return result;
      }

      function cancel() {
        if (timerId !== undefined) {
          clearTimeout(timerId);
        }
        lastInvokeTime = 0;
        lastArgs = lastCallTime = lastThis = timerId = undefined;
      }

      function flush() {
        return timerId === undefined ? result : trailingEdge(now());
      }

      function debounced() {
        var time = now(),
            isInvoking = shouldInvoke(time);

        lastArgs = arguments;
        lastThis = this;
        lastCallTime = time;

        if (isInvoking) {
          if (timerId === undefined) {
            return leadingEdge(lastCallTime);
          }
          if (maxing) {
            // Handle invocations in a tight loop.
            clearTimeout(timerId);
            timerId = setTimeout(timerExpired, wait);
            return invokeFunc(lastCallTime);
          }
        }
        if (timerId === undefined) {
          timerId = setTimeout(timerExpired, wait);
        }
        return result;
      }
      debounced.cancel = cancel;
      debounced.flush = flush;
      return debounced;
    }

    /**
     * Defers invoking the `func` until the current call stack has cleared. Any
     * additional arguments are provided to `func` when it's invoked.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to defer.
     * @param {...*} [args] The arguments to invoke `func` with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.defer(function(text) {
     *   console.log(text);
     * }, 'deferred');
     * // => Logs 'deferred' after one millisecond.
     */
    var defer = baseRest(function(func, args) {
      return baseDelay(func, 1, args);
    });

    /**
     * Invokes `func` after `wait` milliseconds. Any additional arguments are
     * provided to `func` when it's invoked.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to delay.
     * @param {number} wait The number of milliseconds to delay invocation.
     * @param {...*} [args] The arguments to invoke `func` with.
     * @returns {number} Returns the timer id.
     * @example
     *
     * _.delay(function(text) {
     *   console.log(text);
     * }, 1000, 'later');
     * // => Logs 'later' after one second.
     */
    var delay = baseRest(function(func, wait, args) {
      return baseDelay(func, toNumber(wait) || 0, args);
    });

    /**
     * Creates a function that invokes `func` with arguments reversed.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Function
     * @param {Function} func The function to flip arguments for.
     * @returns {Function} Returns the new flipped function.
     * @example
     *
     * var flipped = _.flip(function() {
     *   return _.toArray(arguments);
     * });
     *
     * flipped('a', 'b', 'c', 'd');
     * // => ['d', 'c', 'b', 'a']
     */
    function flip(func) {
      return createWrap(func, WRAP_FLIP_FLAG);
    }

    /**
     * Creates a function that memoizes the result of `func`. If `resolver` is
     * provided, it determines the cache key for storing the result based on the
     * arguments provided to the memoized function. By default, the first argument
     * provided to the memoized function is used as the map cache key. The `func`
     * is invoked with the `this` binding of the memoized function.
     *
     * **Note:** The cache is exposed as the `cache` property on the memoized
     * function. Its creation may be customized by replacing the `_.memoize.Cache`
     * constructor with one whose instances implement the
     * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)
     * method interface of `clear`, `delete`, `get`, `has`, and `set`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to have its output memoized.
     * @param {Function} [resolver] The function to resolve the cache key.
     * @returns {Function} Returns the new memoized function.
     * @example
     *
     * var object = { 'a': 1, 'b': 2 };
     * var other = { 'c': 3, 'd': 4 };
     *
     * var values = _.memoize(_.values);
     * values(object);
     * // => [1, 2]
     *
     * values(other);
     * // => [3, 4]
     *
     * object.a = 2;
     * values(object);
     * // => [1, 2]
     *
     * // Modify the result cache.
     * values.cache.set(object, ['a', 'b']);
     * values(object);
     * // => ['a', 'b']
     *
     * // Replace `_.memoize.Cache`.
     * _.memoize.Cache = WeakMap;
     */
    function memoize(func, resolver) {
      if (typeof func != 'function' || (resolver != null && typeof resolver != 'function')) {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      var memoized = function() {
        var args = arguments,
            key = resolver ? resolver.apply(this, args) : args[0],
            cache = memoized.cache;

        if (cache.has(key)) {
          return cache.get(key);
        }
        var result = func.apply(this, args);
        memoized.cache = cache.set(key, result) || cache;
        return result;
      };
      memoized.cache = new (memoize.Cache || MapCache);
      return memoized;
    }

    // Expose `MapCache`.
    memoize.Cache = MapCache;

    /**
     * Creates a function that negates the result of the predicate `func`. The
     * `func` predicate is invoked with the `this` binding and arguments of the
     * created function.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} predicate The predicate to negate.
     * @returns {Function} Returns the new negated function.
     * @example
     *
     * function isEven(n) {
     *   return n % 2 == 0;
     * }
     *
     * _.filter([1, 2, 3, 4, 5, 6], _.negate(isEven));
     * // => [1, 3, 5]
     */
    function negate(predicate) {
      if (typeof predicate != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      return function() {
        var args = arguments;
        switch (args.length) {
          case 0: return !predicate.call(this);
          case 1: return !predicate.call(this, args[0]);
          case 2: return !predicate.call(this, args[0], args[1]);
          case 3: return !predicate.call(this, args[0], args[1], args[2]);
        }
        return !predicate.apply(this, args);
      };
    }

    /**
     * Creates a function that is restricted to invoking `func` once. Repeat calls
     * to the function return the value of the first invocation. The `func` is
     * invoked with the `this` binding and arguments of the created function.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to restrict.
     * @returns {Function} Returns the new restricted function.
     * @example
     *
     * var initialize = _.once(createApplication);
     * initialize();
     * initialize();
     * // => `createApplication` is invoked once
     */
    function once(func) {
      return before(2, func);
    }

    /**
     * Creates a function that invokes `func` with its arguments transformed.
     *
     * @static
     * @since 4.0.0
     * @memberOf _
     * @category Function
     * @param {Function} func The function to wrap.
     * @param {...(Function|Function[])} [transforms=[_.identity]]
     *  The argument transforms.
     * @returns {Function} Returns the new function.
     * @example
     *
     * function doubled(n) {
     *   return n * 2;
     * }
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var func = _.overArgs(function(x, y) {
     *   return [x, y];
     * }, [square, doubled]);
     *
     * func(9, 3);
     * // => [81, 6]
     *
     * func(10, 5);
     * // => [100, 10]
     */
    var overArgs = castRest(function(func, transforms) {
      transforms = (transforms.length == 1 && isArray(transforms[0]))
        ? arrayMap(transforms[0], baseUnary(getIteratee()))
        : arrayMap(baseFlatten(transforms, 1), baseUnary(getIteratee()));

      var funcsLength = transforms.length;
      return baseRest(function(args) {
        var index = -1,
            length = nativeMin(args.length, funcsLength);

        while (++index < length) {
          args[index] = transforms[index].call(this, args[index]);
        }
        return apply(func, this, args);
      });
    });

    /**
     * Creates a function that invokes `func` with `partials` prepended to the
     * arguments it receives. This method is like `_.bind` except it does **not**
     * alter the `this` binding.
     *
     * The `_.partial.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * **Note:** This method doesn't set the "length" property of partially
     * applied functions.
     *
     * @static
     * @memberOf _
     * @since 0.2.0
     * @category Function
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * function greet(greeting, name) {
     *   return greeting + ' ' + name;
     * }
     *
     * var sayHelloTo = _.partial(greet, 'hello');
     * sayHelloTo('fred');
     * // => 'hello fred'
     *
     * // Partially applied with placeholders.
     * var greetFred = _.partial(greet, _, 'fred');
     * greetFred('hi');
     * // => 'hi fred'
     */
    var partial = baseRest(function(func, partials) {
      var holders = replaceHolders(partials, getHolder(partial));
      return createWrap(func, WRAP_PARTIAL_FLAG, undefined, partials, holders);
    });

    /**
     * This method is like `_.partial` except that partially applied arguments
     * are appended to the arguments it receives.
     *
     * The `_.partialRight.placeholder` value, which defaults to `_` in monolithic
     * builds, may be used as a placeholder for partially applied arguments.
     *
     * **Note:** This method doesn't set the "length" property of partially
     * applied functions.
     *
     * @static
     * @memberOf _
     * @since 1.0.0
     * @category Function
     * @param {Function} func The function to partially apply arguments to.
     * @param {...*} [partials] The arguments to be partially applied.
     * @returns {Function} Returns the new partially applied function.
     * @example
     *
     * function greet(greeting, name) {
     *   return greeting + ' ' + name;
     * }
     *
     * var greetFred = _.partialRight(greet, 'fred');
     * greetFred('hi');
     * // => 'hi fred'
     *
     * // Partially applied with placeholders.
     * var sayHelloTo = _.partialRight(greet, 'hello', _);
     * sayHelloTo('fred');
     * // => 'hello fred'
     */
    var partialRight = baseRest(function(func, partials) {
      var holders = replaceHolders(partials, getHolder(partialRight));
      return createWrap(func, WRAP_PARTIAL_RIGHT_FLAG, undefined, partials, holders);
    });

    /**
     * Creates a function that invokes `func` with arguments arranged according
     * to the specified `indexes` where the argument value at the first index is
     * provided as the first argument, the argument value at the second index is
     * provided as the second argument, and so on.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Function
     * @param {Function} func The function to rearrange arguments for.
     * @param {...(number|number[])} indexes The arranged argument indexes.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var rearged = _.rearg(function(a, b, c) {
     *   return [a, b, c];
     * }, [2, 0, 1]);
     *
     * rearged('b', 'c', 'a')
     * // => ['a', 'b', 'c']
     */
    var rearg = flatRest(function(func, indexes) {
      return createWrap(func, WRAP_REARG_FLAG, undefined, undefined, undefined, indexes);
    });

    /**
     * Creates a function that invokes `func` with the `this` binding of the
     * created function and arguments from `start` and beyond provided as
     * an array.
     *
     * **Note:** This method is based on the
     * [rest parameter](https://mdn.io/rest_parameters).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Function
     * @param {Function} func The function to apply a rest parameter to.
     * @param {number} [start=func.length-1] The start position of the rest parameter.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var say = _.rest(function(what, names) {
     *   return what + ' ' + _.initial(names).join(', ') +
     *     (_.size(names) > 1 ? ', & ' : '') + _.last(names);
     * });
     *
     * say('hello', 'fred', 'barney', 'pebbles');
     * // => 'hello fred, barney, & pebbles'
     */
    function rest(func, start) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      start = start === undefined ? start : toInteger(start);
      return baseRest(func, start);
    }

    /**
     * Creates a function that invokes `func` with the `this` binding of the
     * create function and an array of arguments much like
     * [`Function#apply`](http://www.ecma-international.org/ecma-262/7.0/#sec-function.prototype.apply).
     *
     * **Note:** This method is based on the
     * [spread operator](https://mdn.io/spread_operator).
     *
     * @static
     * @memberOf _
     * @since 3.2.0
     * @category Function
     * @param {Function} func The function to spread arguments over.
     * @param {number} [start=0] The start position of the spread.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var say = _.spread(function(who, what) {
     *   return who + ' says ' + what;
     * });
     *
     * say(['fred', 'hello']);
     * // => 'fred says hello'
     *
     * var numbers = Promise.all([
     *   Promise.resolve(40),
     *   Promise.resolve(36)
     * ]);
     *
     * numbers.then(_.spread(function(x, y) {
     *   return x + y;
     * }));
     * // => a Promise of 76
     */
    function spread(func, start) {
      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      start = start == null ? 0 : nativeMax(toInteger(start), 0);
      return baseRest(function(args) {
        var array = args[start],
            otherArgs = castSlice(args, 0, start);

        if (array) {
          arrayPush(otherArgs, array);
        }
        return apply(func, this, otherArgs);
      });
    }

    /**
     * Creates a throttled function that only invokes `func` at most once per
     * every `wait` milliseconds. The throttled function comes with a `cancel`
     * method to cancel delayed `func` invocations and a `flush` method to
     * immediately invoke them. Provide `options` to indicate whether `func`
     * should be invoked on the leading and/or trailing edge of the `wait`
     * timeout. The `func` is invoked with the last arguments provided to the
     * throttled function. Subsequent calls to the throttled function return the
     * result of the last `func` invocation.
     *
     * **Note:** If `leading` and `trailing` options are `true`, `func` is
     * invoked on the trailing edge of the timeout only if the throttled function
     * is invoked more than once during the `wait` timeout.
     *
     * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred
     * until to the next tick, similar to `setTimeout` with a timeout of `0`.
     *
     * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)
     * for details over the differences between `_.throttle` and `_.debounce`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {Function} func The function to throttle.
     * @param {number} [wait=0] The number of milliseconds to throttle invocations to.
     * @param {Object} [options={}] The options object.
     * @param {boolean} [options.leading=true]
     *  Specify invoking on the leading edge of the timeout.
     * @param {boolean} [options.trailing=true]
     *  Specify invoking on the trailing edge of the timeout.
     * @returns {Function} Returns the new throttled function.
     * @example
     *
     * // Avoid excessively updating the position while scrolling.
     * jQuery(window).on('scroll', _.throttle(updatePosition, 100));
     *
     * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.
     * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });
     * jQuery(element).on('click', throttled);
     *
     * // Cancel the trailing throttled invocation.
     * jQuery(window).on('popstate', throttled.cancel);
     */
    function throttle(func, wait, options) {
      var leading = true,
          trailing = true;

      if (typeof func != 'function') {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      if (isObject(options)) {
        leading = 'leading' in options ? !!options.leading : leading;
        trailing = 'trailing' in options ? !!options.trailing : trailing;
      }
      return debounce(func, wait, {
        'leading': leading,
        'maxWait': wait,
        'trailing': trailing
      });
    }

    /**
     * Creates a function that accepts up to one argument, ignoring any
     * additional arguments.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Function
     * @param {Function} func The function to cap arguments for.
     * @returns {Function} Returns the new capped function.
     * @example
     *
     * _.map(['6', '8', '10'], _.unary(parseInt));
     * // => [6, 8, 10]
     */
    function unary(func) {
      return ary(func, 1);
    }

    /**
     * Creates a function that provides `value` to `wrapper` as its first
     * argument. Any additional arguments provided to the function are appended
     * to those provided to the `wrapper`. The wrapper is invoked with the `this`
     * binding of the created function.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Function
     * @param {*} value The value to wrap.
     * @param {Function} [wrapper=identity] The wrapper function.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var p = _.wrap(_.escape, function(func, text) {
     *   return '<p>' + func(text) + '</p>';
     * });
     *
     * p('fred, barney, & pebbles');
     * // => '<p>fred, barney, &amp; pebbles</p>'
     */
    function wrap(value, wrapper) {
      return partial(castFunction(wrapper), value);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Casts `value` as an array if it's not one.
     *
     * @static
     * @memberOf _
     * @since 4.4.0
     * @category Lang
     * @param {*} value The value to inspect.
     * @returns {Array} Returns the cast array.
     * @example
     *
     * _.castArray(1);
     * // => [1]
     *
     * _.castArray({ 'a': 1 });
     * // => [{ 'a': 1 }]
     *
     * _.castArray('abc');
     * // => ['abc']
     *
     * _.castArray(null);
     * // => [null]
     *
     * _.castArray(undefined);
     * // => [undefined]
     *
     * _.castArray();
     * // => []
     *
     * var array = [1, 2, 3];
     * console.log(_.castArray(array) === array);
     * // => true
     */
    function castArray() {
      if (!arguments.length) {
        return [];
      }
      var value = arguments[0];
      return isArray(value) ? value : [value];
    }

    /**
     * Creates a shallow clone of `value`.
     *
     * **Note:** This method is loosely based on the
     * [structured clone algorithm](https://mdn.io/Structured_clone_algorithm)
     * and supports cloning arrays, array buffers, booleans, date objects, maps,
     * numbers, `Object` objects, regexes, sets, strings, symbols, and typed
     * arrays. The own enumerable properties of `arguments` objects are cloned
     * as plain objects. An empty object is returned for uncloneable values such
     * as error objects, functions, DOM nodes, and WeakMaps.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to clone.
     * @returns {*} Returns the cloned value.
     * @see _.cloneDeep
     * @example
     *
     * var objects = [{ 'a': 1 }, { 'b': 2 }];
     *
     * var shallow = _.clone(objects);
     * console.log(shallow[0] === objects[0]);
     * // => true
     */
    function clone(value) {
      return baseClone(value, CLONE_SYMBOLS_FLAG);
    }

    /**
     * This method is like `_.clone` except that it accepts `customizer` which
     * is invoked to produce the cloned value. If `customizer` returns `undefined`,
     * cloning is handled by the method instead. The `customizer` is invoked with
     * up to four arguments; (value [, index|key, object, stack]).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to clone.
     * @param {Function} [customizer] The function to customize cloning.
     * @returns {*} Returns the cloned value.
     * @see _.cloneDeepWith
     * @example
     *
     * function customizer(value) {
     *   if (_.isElement(value)) {
     *     return value.cloneNode(false);
     *   }
     * }
     *
     * var el = _.cloneWith(document.body, customizer);
     *
     * console.log(el === document.body);
     * // => false
     * console.log(el.nodeName);
     * // => 'BODY'
     * console.log(el.childNodes.length);
     * // => 0
     */
    function cloneWith(value, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return baseClone(value, CLONE_SYMBOLS_FLAG, customizer);
    }

    /**
     * This method is like `_.clone` except that it recursively clones `value`.
     *
     * @static
     * @memberOf _
     * @since 1.0.0
     * @category Lang
     * @param {*} value The value to recursively clone.
     * @returns {*} Returns the deep cloned value.
     * @see _.clone
     * @example
     *
     * var objects = [{ 'a': 1 }, { 'b': 2 }];
     *
     * var deep = _.cloneDeep(objects);
     * console.log(deep[0] === objects[0]);
     * // => false
     */
    function cloneDeep(value) {
      return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG);
    }

    /**
     * This method is like `_.cloneWith` except that it recursively clones `value`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to recursively clone.
     * @param {Function} [customizer] The function to customize cloning.
     * @returns {*} Returns the deep cloned value.
     * @see _.cloneWith
     * @example
     *
     * function customizer(value) {
     *   if (_.isElement(value)) {
     *     return value.cloneNode(true);
     *   }
     * }
     *
     * var el = _.cloneDeepWith(document.body, customizer);
     *
     * console.log(el === document.body);
     * // => false
     * console.log(el.nodeName);
     * // => 'BODY'
     * console.log(el.childNodes.length);
     * // => 20
     */
    function cloneDeepWith(value, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG, customizer);
    }

    /**
     * Checks if `object` conforms to `source` by invoking the predicate
     * properties of `source` with the corresponding property values of `object`.
     *
     * **Note:** This method is equivalent to `_.conforms` when `source` is
     * partially applied.
     *
     * @static
     * @memberOf _
     * @since 4.14.0
     * @category Lang
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property predicates to conform to.
     * @returns {boolean} Returns `true` if `object` conforms, else `false`.
     * @example
     *
     * var object = { 'a': 1, 'b': 2 };
     *
     * _.conformsTo(object, { 'b': function(n) { return n > 1; } });
     * // => true
     *
     * _.conformsTo(object, { 'b': function(n) { return n > 2; } });
     * // => false
     */
    function conformsTo(object, source) {
      return source == null || baseConformsTo(object, source, keys(source));
    }

    /**
     * Performs a
     * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)
     * comparison between two values to determine if they are equivalent.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * var object = { 'a': 1 };
     * var other = { 'a': 1 };
     *
     * _.eq(object, object);
     * // => true
     *
     * _.eq(object, other);
     * // => false
     *
     * _.eq('a', 'a');
     * // => true
     *
     * _.eq('a', Object('a'));
     * // => false
     *
     * _.eq(NaN, NaN);
     * // => true
     */
    function eq(value, other) {
      return value === other || (value !== value && other !== other);
    }

    /**
     * Checks if `value` is greater than `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is greater than `other`,
     *  else `false`.
     * @see _.lt
     * @example
     *
     * _.gt(3, 1);
     * // => true
     *
     * _.gt(3, 3);
     * // => false
     *
     * _.gt(1, 3);
     * // => false
     */
    var gt = createRelationalOperation(baseGt);

    /**
     * Checks if `value` is greater than or equal to `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is greater than or equal to
     *  `other`, else `false`.
     * @see _.lte
     * @example
     *
     * _.gte(3, 1);
     * // => true
     *
     * _.gte(3, 3);
     * // => true
     *
     * _.gte(1, 3);
     * // => false
     */
    var gte = createRelationalOperation(function(value, other) {
      return value >= other;
    });

    /**
     * Checks if `value` is likely an `arguments` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an `arguments` object,
     *  else `false`.
     * @example
     *
     * _.isArguments(function() { return arguments; }());
     * // => true
     *
     * _.isArguments([1, 2, 3]);
     * // => false
     */
    var isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {
      return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&
        !propertyIsEnumerable.call(value, 'callee');
    };

    /**
     * Checks if `value` is classified as an `Array` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array, else `false`.
     * @example
     *
     * _.isArray([1, 2, 3]);
     * // => true
     *
     * _.isArray(document.body.children);
     * // => false
     *
     * _.isArray('abc');
     * // => false
     *
     * _.isArray(_.noop);
     * // => false
     */
    var isArray = Array.isArray;

    /**
     * Checks if `value` is classified as an `ArrayBuffer` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array buffer, else `false`.
     * @example
     *
     * _.isArrayBuffer(new ArrayBuffer(2));
     * // => true
     *
     * _.isArrayBuffer(new Array(2));
     * // => false
     */
    var isArrayBuffer = nodeIsArrayBuffer ? baseUnary(nodeIsArrayBuffer) : baseIsArrayBuffer;

    /**
     * Checks if `value` is array-like. A value is considered array-like if it's
     * not a function and has a `value.length` that's an integer greater than or
     * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is array-like, else `false`.
     * @example
     *
     * _.isArrayLike([1, 2, 3]);
     * // => true
     *
     * _.isArrayLike(document.body.children);
     * // => true
     *
     * _.isArrayLike('abc');
     * // => true
     *
     * _.isArrayLike(_.noop);
     * // => false
     */
    function isArrayLike(value) {
      return value != null && isLength(value.length) && !isFunction(value);
    }

    /**
     * This method is like `_.isArrayLike` except that it also checks if `value`
     * is an object.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an array-like object,
     *  else `false`.
     * @example
     *
     * _.isArrayLikeObject([1, 2, 3]);
     * // => true
     *
     * _.isArrayLikeObject(document.body.children);
     * // => true
     *
     * _.isArrayLikeObject('abc');
     * // => false
     *
     * _.isArrayLikeObject(_.noop);
     * // => false
     */
    function isArrayLikeObject(value) {
      return isObjectLike(value) && isArrayLike(value);
    }

    /**
     * Checks if `value` is classified as a boolean primitive or object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a boolean, else `false`.
     * @example
     *
     * _.isBoolean(false);
     * // => true
     *
     * _.isBoolean(null);
     * // => false
     */
    function isBoolean(value) {
      return value === true || value === false ||
        (isObjectLike(value) && baseGetTag(value) == boolTag);
    }

    /**
     * Checks if `value` is a buffer.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.
     * @example
     *
     * _.isBuffer(new Buffer(2));
     * // => true
     *
     * _.isBuffer(new Uint8Array(2));
     * // => false
     */
    var isBuffer = nativeIsBuffer || stubFalse;

    /**
     * Checks if `value` is classified as a `Date` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a date object, else `false`.
     * @example
     *
     * _.isDate(new Date);
     * // => true
     *
     * _.isDate('Mon April 23 2012');
     * // => false
     */
    var isDate = nodeIsDate ? baseUnary(nodeIsDate) : baseIsDate;

    /**
     * Checks if `value` is likely a DOM element.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a DOM element, else `false`.
     * @example
     *
     * _.isElement(document.body);
     * // => true
     *
     * _.isElement('<body>');
     * // => false
     */
    function isElement(value) {
      return isObjectLike(value) && value.nodeType === 1 && !isPlainObject(value);
    }

    /**
     * Checks if `value` is an empty object, collection, map, or set.
     *
     * Objects are considered empty if they have no own enumerable string keyed
     * properties.
     *
     * Array-like values such as `arguments` objects, arrays, buffers, strings, or
     * jQuery-like collections are considered empty if they have a `length` of `0`.
     * Similarly, maps and sets are considered empty if they have a `size` of `0`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is empty, else `false`.
     * @example
     *
     * _.isEmpty(null);
     * // => true
     *
     * _.isEmpty(true);
     * // => true
     *
     * _.isEmpty(1);
     * // => true
     *
     * _.isEmpty([1, 2, 3]);
     * // => false
     *
     * _.isEmpty({ 'a': 1 });
     * // => false
     */
    function isEmpty(value) {
      if (value == null) {
        return true;
      }
      if (isArrayLike(value) &&
          (isArray(value) || typeof value == 'string' || typeof value.splice == 'function' ||
            isBuffer(value) || isTypedArray(value) || isArguments(value))) {
        return !value.length;
      }
      var tag = getTag(value);
      if (tag == mapTag || tag == setTag) {
        return !value.size;
      }
      if (isPrototype(value)) {
        return !baseKeys(value).length;
      }
      for (var key in value) {
        if (hasOwnProperty.call(value, key)) {
          return false;
        }
      }
      return true;
    }

    /**
     * Performs a deep comparison between two values to determine if they are
     * equivalent.
     *
     * **Note:** This method supports comparing arrays, array buffers, booleans,
     * date objects, error objects, maps, numbers, `Object` objects, regexes,
     * sets, strings, symbols, and typed arrays. `Object` objects are compared
     * by their own, not inherited, enumerable properties. Functions and DOM
     * nodes are compared by strict equality, i.e. `===`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * var object = { 'a': 1 };
     * var other = { 'a': 1 };
     *
     * _.isEqual(object, other);
     * // => true
     *
     * object === other;
     * // => false
     */
    function isEqual(value, other) {
      return baseIsEqual(value, other);
    }

    /**
     * This method is like `_.isEqual` except that it accepts `customizer` which
     * is invoked to compare values. If `customizer` returns `undefined`, comparisons
     * are handled by the method instead. The `customizer` is invoked with up to
     * six arguments: (objValue, othValue [, index|key, object, other, stack]).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @param {Function} [customizer] The function to customize comparisons.
     * @returns {boolean} Returns `true` if the values are equivalent, else `false`.
     * @example
     *
     * function isGreeting(value) {
     *   return /^h(?:i|ello)$/.test(value);
     * }
     *
     * function customizer(objValue, othValue) {
     *   if (isGreeting(objValue) && isGreeting(othValue)) {
     *     return true;
     *   }
     * }
     *
     * var array = ['hello', 'goodbye'];
     * var other = ['hi', 'goodbye'];
     *
     * _.isEqualWith(array, other, customizer);
     * // => true
     */
    function isEqualWith(value, other, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      var result = customizer ? customizer(value, other) : undefined;
      return result === undefined ? baseIsEqual(value, other, undefined, customizer) : !!result;
    }

    /**
     * Checks if `value` is an `Error`, `EvalError`, `RangeError`, `ReferenceError`,
     * `SyntaxError`, `TypeError`, or `URIError` object.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an error object, else `false`.
     * @example
     *
     * _.isError(new Error);
     * // => true
     *
     * _.isError(Error);
     * // => false
     */
    function isError(value) {
      if (!isObjectLike(value)) {
        return false;
      }
      var tag = baseGetTag(value);
      return tag == errorTag || tag == domExcTag ||
        (typeof value.message == 'string' && typeof value.name == 'string' && !isPlainObject(value));
    }

    /**
     * Checks if `value` is a finite primitive number.
     *
     * **Note:** This method is based on
     * [`Number.isFinite`](https://mdn.io/Number/isFinite).
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a finite number, else `false`.
     * @example
     *
     * _.isFinite(3);
     * // => true
     *
     * _.isFinite(Number.MIN_VALUE);
     * // => true
     *
     * _.isFinite(Infinity);
     * // => false
     *
     * _.isFinite('3');
     * // => false
     */
    function isFinite(value) {
      return typeof value == 'number' && nativeIsFinite(value);
    }

    /**
     * Checks if `value` is classified as a `Function` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a function, else `false`.
     * @example
     *
     * _.isFunction(_);
     * // => true
     *
     * _.isFunction(/abc/);
     * // => false
     */
    function isFunction(value) {
      if (!isObject(value)) {
        return false;
      }
      // The use of `Object#toString` avoids issues with the `typeof` operator
      // in Safari 9 which returns 'object' for typed arrays and other constructors.
      var tag = baseGetTag(value);
      return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;
    }

    /**
     * Checks if `value` is an integer.
     *
     * **Note:** This method is based on
     * [`Number.isInteger`](https://mdn.io/Number/isInteger).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an integer, else `false`.
     * @example
     *
     * _.isInteger(3);
     * // => true
     *
     * _.isInteger(Number.MIN_VALUE);
     * // => false
     *
     * _.isInteger(Infinity);
     * // => false
     *
     * _.isInteger('3');
     * // => false
     */
    function isInteger(value) {
      return typeof value == 'number' && value == toInteger(value);
    }

    /**
     * Checks if `value` is a valid array-like length.
     *
     * **Note:** This method is loosely based on
     * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.
     * @example
     *
     * _.isLength(3);
     * // => true
     *
     * _.isLength(Number.MIN_VALUE);
     * // => false
     *
     * _.isLength(Infinity);
     * // => false
     *
     * _.isLength('3');
     * // => false
     */
    function isLength(value) {
      return typeof value == 'number' &&
        value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;
    }

    /**
     * Checks if `value` is the
     * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)
     * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is an object, else `false`.
     * @example
     *
     * _.isObject({});
     * // => true
     *
     * _.isObject([1, 2, 3]);
     * // => true
     *
     * _.isObject(_.noop);
     * // => true
     *
     * _.isObject(null);
     * // => false
     */
    function isObject(value) {
      var type = typeof value;
      return value != null && (type == 'object' || type == 'function');
    }

    /**
     * Checks if `value` is object-like. A value is object-like if it's not `null`
     * and has a `typeof` result of "object".
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
     * @example
     *
     * _.isObjectLike({});
     * // => true
     *
     * _.isObjectLike([1, 2, 3]);
     * // => true
     *
     * _.isObjectLike(_.noop);
     * // => false
     *
     * _.isObjectLike(null);
     * // => false
     */
    function isObjectLike(value) {
      return value != null && typeof value == 'object';
    }

    /**
     * Checks if `value` is classified as a `Map` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a map, else `false`.
     * @example
     *
     * _.isMap(new Map);
     * // => true
     *
     * _.isMap(new WeakMap);
     * // => false
     */
    var isMap = nodeIsMap ? baseUnary(nodeIsMap) : baseIsMap;

    /**
     * Performs a partial deep comparison between `object` and `source` to
     * determine if `object` contains equivalent property values.
     *
     * **Note:** This method is equivalent to `_.matches` when `source` is
     * partially applied.
     *
     * Partial comparisons will match empty array and empty object `source`
     * values against any array or object value, respectively. See `_.isEqual`
     * for a list of supported value comparisons.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property values to match.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     * @example
     *
     * var object = { 'a': 1, 'b': 2 };
     *
     * _.isMatch(object, { 'b': 2 });
     * // => true
     *
     * _.isMatch(object, { 'b': 1 });
     * // => false
     */
    function isMatch(object, source) {
      return object === source || baseIsMatch(object, source, getMatchData(source));
    }

    /**
     * This method is like `_.isMatch` except that it accepts `customizer` which
     * is invoked to compare values. If `customizer` returns `undefined`, comparisons
     * are handled by the method instead. The `customizer` is invoked with five
     * arguments: (objValue, srcValue, index|key, object, source).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {Object} object The object to inspect.
     * @param {Object} source The object of property values to match.
     * @param {Function} [customizer] The function to customize comparisons.
     * @returns {boolean} Returns `true` if `object` is a match, else `false`.
     * @example
     *
     * function isGreeting(value) {
     *   return /^h(?:i|ello)$/.test(value);
     * }
     *
     * function customizer(objValue, srcValue) {
     *   if (isGreeting(objValue) && isGreeting(srcValue)) {
     *     return true;
     *   }
     * }
     *
     * var object = { 'greeting': 'hello' };
     * var source = { 'greeting': 'hi' };
     *
     * _.isMatchWith(object, source, customizer);
     * // => true
     */
    function isMatchWith(object, source, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return baseIsMatch(object, source, getMatchData(source), customizer);
    }

    /**
     * Checks if `value` is `NaN`.
     *
     * **Note:** This method is based on
     * [`Number.isNaN`](https://mdn.io/Number/isNaN) and is not the same as
     * global [`isNaN`](https://mdn.io/isNaN) which returns `true` for
     * `undefined` and other non-number values.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.
     * @example
     *
     * _.isNaN(NaN);
     * // => true
     *
     * _.isNaN(new Number(NaN));
     * // => true
     *
     * isNaN(undefined);
     * // => true
     *
     * _.isNaN(undefined);
     * // => false
     */
    function isNaN(value) {
      // An `NaN` primitive is the only value that is not equal to itself.
      // Perform the `toStringTag` check first to avoid errors with some
      // ActiveX objects in IE.
      return isNumber(value) && value != +value;
    }

    /**
     * Checks if `value` is a pristine native function.
     *
     * **Note:** This method can't reliably detect native functions in the presence
     * of the core-js package because core-js circumvents this kind of detection.
     * Despite multiple requests, the core-js maintainer has made it clear: any
     * attempt to fix the detection will be obstructed. As a result, we're left
     * with little choice but to throw an error. Unfortunately, this also affects
     * packages, like [babel-polyfill](https://www.npmjs.com/package/babel-polyfill),
     * which rely on core-js.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a native function,
     *  else `false`.
     * @example
     *
     * _.isNative(Array.prototype.push);
     * // => true
     *
     * _.isNative(_);
     * // => false
     */
    function isNative(value) {
      if (isMaskable(value)) {
        throw new Error(CORE_ERROR_TEXT);
      }
      return baseIsNative(value);
    }

    /**
     * Checks if `value` is `null`.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `null`, else `false`.
     * @example
     *
     * _.isNull(null);
     * // => true
     *
     * _.isNull(void 0);
     * // => false
     */
    function isNull(value) {
      return value === null;
    }

    /**
     * Checks if `value` is `null` or `undefined`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is nullish, else `false`.
     * @example
     *
     * _.isNil(null);
     * // => true
     *
     * _.isNil(void 0);
     * // => true
     *
     * _.isNil(NaN);
     * // => false
     */
    function isNil(value) {
      return value == null;
    }

    /**
     * Checks if `value` is classified as a `Number` primitive or object.
     *
     * **Note:** To exclude `Infinity`, `-Infinity`, and `NaN`, which are
     * classified as numbers, use the `_.isFinite` method.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a number, else `false`.
     * @example
     *
     * _.isNumber(3);
     * // => true
     *
     * _.isNumber(Number.MIN_VALUE);
     * // => true
     *
     * _.isNumber(Infinity);
     * // => true
     *
     * _.isNumber('3');
     * // => false
     */
    function isNumber(value) {
      return typeof value == 'number' ||
        (isObjectLike(value) && baseGetTag(value) == numberTag);
    }

    /**
     * Checks if `value` is a plain object, that is, an object created by the
     * `Object` constructor or one with a `[[Prototype]]` of `null`.
     *
     * @static
     * @memberOf _
     * @since 0.8.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     * }
     *
     * _.isPlainObject(new Foo);
     * // => false
     *
     * _.isPlainObject([1, 2, 3]);
     * // => false
     *
     * _.isPlainObject({ 'x': 0, 'y': 0 });
     * // => true
     *
     * _.isPlainObject(Object.create(null));
     * // => true
     */
    function isPlainObject(value) {
      if (!isObjectLike(value) || baseGetTag(value) != objectTag) {
        return false;
      }
      var proto = getPrototype(value);
      if (proto === null) {
        return true;
      }
      var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;
      return typeof Ctor == 'function' && Ctor instanceof Ctor &&
        funcToString.call(Ctor) == objectCtorString;
    }

    /**
     * Checks if `value` is classified as a `RegExp` object.
     *
     * @static
     * @memberOf _
     * @since 0.1.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a regexp, else `false`.
     * @example
     *
     * _.isRegExp(/abc/);
     * // => true
     *
     * _.isRegExp('/abc/');
     * // => false
     */
    var isRegExp = nodeIsRegExp ? baseUnary(nodeIsRegExp) : baseIsRegExp;

    /**
     * Checks if `value` is a safe integer. An integer is safe if it's an IEEE-754
     * double precision number which isn't the result of a rounded unsafe integer.
     *
     * **Note:** This method is based on
     * [`Number.isSafeInteger`](https://mdn.io/Number/isSafeInteger).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a safe integer, else `false`.
     * @example
     *
     * _.isSafeInteger(3);
     * // => true
     *
     * _.isSafeInteger(Number.MIN_VALUE);
     * // => false
     *
     * _.isSafeInteger(Infinity);
     * // => false
     *
     * _.isSafeInteger('3');
     * // => false
     */
    function isSafeInteger(value) {
      return isInteger(value) && value >= -MAX_SAFE_INTEGER && value <= MAX_SAFE_INTEGER;
    }

    /**
     * Checks if `value` is classified as a `Set` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a set, else `false`.
     * @example
     *
     * _.isSet(new Set);
     * // => true
     *
     * _.isSet(new WeakSet);
     * // => false
     */
    var isSet = nodeIsSet ? baseUnary(nodeIsSet) : baseIsSet;

    /**
     * Checks if `value` is classified as a `String` primitive or object.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a string, else `false`.
     * @example
     *
     * _.isString('abc');
     * // => true
     *
     * _.isString(1);
     * // => false
     */
    function isString(value) {
      return typeof value == 'string' ||
        (!isArray(value) && isObjectLike(value) && baseGetTag(value) == stringTag);
    }

    /**
     * Checks if `value` is classified as a `Symbol` primitive or object.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.
     * @example
     *
     * _.isSymbol(Symbol.iterator);
     * // => true
     *
     * _.isSymbol('abc');
     * // => false
     */
    function isSymbol(value) {
      return typeof value == 'symbol' ||
        (isObjectLike(value) && baseGetTag(value) == symbolTag);
    }

    /**
     * Checks if `value` is classified as a typed array.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.
     * @example
     *
     * _.isTypedArray(new Uint8Array);
     * // => true
     *
     * _.isTypedArray([]);
     * // => false
     */
    var isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;

    /**
     * Checks if `value` is `undefined`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is `undefined`, else `false`.
     * @example
     *
     * _.isUndefined(void 0);
     * // => true
     *
     * _.isUndefined(null);
     * // => false
     */
    function isUndefined(value) {
      return value === undefined;
    }

    /**
     * Checks if `value` is classified as a `WeakMap` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a weak map, else `false`.
     * @example
     *
     * _.isWeakMap(new WeakMap);
     * // => true
     *
     * _.isWeakMap(new Map);
     * // => false
     */
    function isWeakMap(value) {
      return isObjectLike(value) && getTag(value) == weakMapTag;
    }

    /**
     * Checks if `value` is classified as a `WeakSet` object.
     *
     * @static
     * @memberOf _
     * @since 4.3.0
     * @category Lang
     * @param {*} value The value to check.
     * @returns {boolean} Returns `true` if `value` is a weak set, else `false`.
     * @example
     *
     * _.isWeakSet(new WeakSet);
     * // => true
     *
     * _.isWeakSet(new Set);
     * // => false
     */
    function isWeakSet(value) {
      return isObjectLike(value) && baseGetTag(value) == weakSetTag;
    }

    /**
     * Checks if `value` is less than `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is less than `other`,
     *  else `false`.
     * @see _.gt
     * @example
     *
     * _.lt(1, 3);
     * // => true
     *
     * _.lt(3, 3);
     * // => false
     *
     * _.lt(3, 1);
     * // => false
     */
    var lt = createRelationalOperation(baseLt);

    /**
     * Checks if `value` is less than or equal to `other`.
     *
     * @static
     * @memberOf _
     * @since 3.9.0
     * @category Lang
     * @param {*} value The value to compare.
     * @param {*} other The other value to compare.
     * @returns {boolean} Returns `true` if `value` is less than or equal to
     *  `other`, else `false`.
     * @see _.gte
     * @example
     *
     * _.lte(1, 3);
     * // => true
     *
     * _.lte(3, 3);
     * // => true
     *
     * _.lte(3, 1);
     * // => false
     */
    var lte = createRelationalOperation(function(value, other) {
      return value <= other;
    });

    /**
     * Converts `value` to an array.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {Array} Returns the converted array.
     * @example
     *
     * _.toArray({ 'a': 1, 'b': 2 });
     * // => [1, 2]
     *
     * _.toArray('abc');
     * // => ['a', 'b', 'c']
     *
     * _.toArray(1);
     * // => []
     *
     * _.toArray(null);
     * // => []
     */
    function toArray(value) {
      if (!value) {
        return [];
      }
      if (isArrayLike(value)) {
        return isString(value) ? stringToArray(value) : copyArray(value);
      }
      if (symIterator && value[symIterator]) {
        return iteratorToArray(value[symIterator]());
      }
      var tag = getTag(value),
          func = tag == mapTag ? mapToArray : (tag == setTag ? setToArray : values);

      return func(value);
    }

    /**
     * Converts `value` to a finite number.
     *
     * @static
     * @memberOf _
     * @since 4.12.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted number.
     * @example
     *
     * _.toFinite(3.2);
     * // => 3.2
     *
     * _.toFinite(Number.MIN_VALUE);
     * // => 5e-324
     *
     * _.toFinite(Infinity);
     * // => 1.7976931348623157e+308
     *
     * _.toFinite('3.2');
     * // => 3.2
     */
    function toFinite(value) {
      if (!value) {
        return value === 0 ? value : 0;
      }
      value = toNumber(value);
      if (value === INFINITY || value === -INFINITY) {
        var sign = (value < 0 ? -1 : 1);
        return sign * MAX_INTEGER;
      }
      return value === value ? value : 0;
    }

    /**
     * Converts `value` to an integer.
     *
     * **Note:** This method is loosely based on
     * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.toInteger(3.2);
     * // => 3
     *
     * _.toInteger(Number.MIN_VALUE);
     * // => 0
     *
     * _.toInteger(Infinity);
     * // => 1.7976931348623157e+308
     *
     * _.toInteger('3.2');
     * // => 3
     */
    function toInteger(value) {
      var result = toFinite(value),
          remainder = result % 1;

      return result === result ? (remainder ? result - remainder : result) : 0;
    }

    /**
     * Converts `value` to an integer suitable for use as the length of an
     * array-like object.
     *
     * **Note:** This method is based on
     * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.toLength(3.2);
     * // => 3
     *
     * _.toLength(Number.MIN_VALUE);
     * // => 0
     *
     * _.toLength(Infinity);
     * // => 4294967295
     *
     * _.toLength('3.2');
     * // => 3
     */
    function toLength(value) {
      return value ? baseClamp(toInteger(value), 0, MAX_ARRAY_LENGTH) : 0;
    }

    /**
     * Converts `value` to a number.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to process.
     * @returns {number} Returns the number.
     * @example
     *
     * _.toNumber(3.2);
     * // => 3.2
     *
     * _.toNumber(Number.MIN_VALUE);
     * // => 5e-324
     *
     * _.toNumber(Infinity);
     * // => Infinity
     *
     * _.toNumber('3.2');
     * // => 3.2
     */
    function toNumber(value) {
      if (typeof value == 'number') {
        return value;
      }
      if (isSymbol(value)) {
        return NAN;
      }
      if (isObject(value)) {
        var other = typeof value.valueOf == 'function' ? value.valueOf() : value;
        value = isObject(other) ? (other + '') : other;
      }
      if (typeof value != 'string') {
        return value === 0 ? value : +value;
      }
      value = value.replace(reTrim, '');
      var isBinary = reIsBinary.test(value);
      return (isBinary || reIsOctal.test(value))
        ? freeParseInt(value.slice(2), isBinary ? 2 : 8)
        : (reIsBadHex.test(value) ? NAN : +value);
    }

    /**
     * Converts `value` to a plain object flattening inherited enumerable string
     * keyed properties of `value` to own properties of the plain object.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {Object} Returns the converted plain object.
     * @example
     *
     * function Foo() {
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.assign({ 'a': 1 }, new Foo);
     * // => { 'a': 1, 'b': 2 }
     *
     * _.assign({ 'a': 1 }, _.toPlainObject(new Foo));
     * // => { 'a': 1, 'b': 2, 'c': 3 }
     */
    function toPlainObject(value) {
      return copyObject(value, keysIn(value));
    }

    /**
     * Converts `value` to a safe integer. A safe integer can be compared and
     * represented correctly.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.toSafeInteger(3.2);
     * // => 3
     *
     * _.toSafeInteger(Number.MIN_VALUE);
     * // => 0
     *
     * _.toSafeInteger(Infinity);
     * // => 9007199254740991
     *
     * _.toSafeInteger('3.2');
     * // => 3
     */
    function toSafeInteger(value) {
      return value
        ? baseClamp(toInteger(value), -MAX_SAFE_INTEGER, MAX_SAFE_INTEGER)
        : (value === 0 ? value : 0);
    }

    /**
     * Converts `value` to a string. An empty string is returned for `null`
     * and `undefined` values. The sign of `-0` is preserved.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Lang
     * @param {*} value The value to convert.
     * @returns {string} Returns the converted string.
     * @example
     *
     * _.toString(null);
     * // => ''
     *
     * _.toString(-0);
     * // => '-0'
     *
     * _.toString([1, 2, 3]);
     * // => '1,2,3'
     */
    function toString(value) {
      return value == null ? '' : baseToString(value);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Assigns own enumerable string keyed properties of source objects to the
     * destination object. Source objects are applied from left to right.
     * Subsequent sources overwrite property assignments of previous sources.
     *
     * **Note:** This method mutates `object` and is loosely based on
     * [`Object.assign`](https://mdn.io/Object/assign).
     *
     * @static
     * @memberOf _
     * @since 0.10.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.assignIn
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     * }
     *
     * function Bar() {
     *   this.c = 3;
     * }
     *
     * Foo.prototype.b = 2;
     * Bar.prototype.d = 4;
     *
     * _.assign({ 'a': 0 }, new Foo, new Bar);
     * // => { 'a': 1, 'c': 3 }
     */
    var assign = createAssigner(function(object, source) {
      if (isPrototype(source) || isArrayLike(source)) {
        copyObject(source, keys(source), object);
        return;
      }
      for (var key in source) {
        if (hasOwnProperty.call(source, key)) {
          assignValue(object, key, source[key]);
        }
      }
    });

    /**
     * This method is like `_.assign` except that it iterates over own and
     * inherited source properties.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias extend
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.assign
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     * }
     *
     * function Bar() {
     *   this.c = 3;
     * }
     *
     * Foo.prototype.b = 2;
     * Bar.prototype.d = 4;
     *
     * _.assignIn({ 'a': 0 }, new Foo, new Bar);
     * // => { 'a': 1, 'b': 2, 'c': 3, 'd': 4 }
     */
    var assignIn = createAssigner(function(object, source) {
      copyObject(source, keysIn(source), object);
    });

    /**
     * This method is like `_.assignIn` except that it accepts `customizer`
     * which is invoked to produce the assigned values. If `customizer` returns
     * `undefined`, assignment is handled by the method instead. The `customizer`
     * is invoked with five arguments: (objValue, srcValue, key, object, source).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias extendWith
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} sources The source objects.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @see _.assignWith
     * @example
     *
     * function customizer(objValue, srcValue) {
     *   return _.isUndefined(objValue) ? srcValue : objValue;
     * }
     *
     * var defaults = _.partialRight(_.assignInWith, customizer);
     *
     * defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });
     * // => { 'a': 1, 'b': 2 }
     */
    var assignInWith = createAssigner(function(object, source, srcIndex, customizer) {
      copyObject(source, keysIn(source), object, customizer);
    });

    /**
     * This method is like `_.assign` except that it accepts `customizer`
     * which is invoked to produce the assigned values. If `customizer` returns
     * `undefined`, assignment is handled by the method instead. The `customizer`
     * is invoked with five arguments: (objValue, srcValue, key, object, source).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} sources The source objects.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @see _.assignInWith
     * @example
     *
     * function customizer(objValue, srcValue) {
     *   return _.isUndefined(objValue) ? srcValue : objValue;
     * }
     *
     * var defaults = _.partialRight(_.assignWith, customizer);
     *
     * defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });
     * // => { 'a': 1, 'b': 2 }
     */
    var assignWith = createAssigner(function(object, source, srcIndex, customizer) {
      copyObject(source, keys(source), object, customizer);
    });

    /**
     * Creates an array of values corresponding to `paths` of `object`.
     *
     * @static
     * @memberOf _
     * @since 1.0.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {...(string|string[])} [paths] The property paths to pick.
     * @returns {Array} Returns the picked values.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }, 4] };
     *
     * _.at(object, ['a[0].b.c', 'a[1]']);
     * // => [3, 4]
     */
    var at = flatRest(baseAt);

    /**
     * Creates an object that inherits from the `prototype` object. If a
     * `properties` object is given, its own enumerable string keyed properties
     * are assigned to the created object.
     *
     * @static
     * @memberOf _
     * @since 2.3.0
     * @category Object
     * @param {Object} prototype The object to inherit from.
     * @param {Object} [properties] The properties to assign to the object.
     * @returns {Object} Returns the new object.
     * @example
     *
     * function Shape() {
     *   this.x = 0;
     *   this.y = 0;
     * }
     *
     * function Circle() {
     *   Shape.call(this);
     * }
     *
     * Circle.prototype = _.create(Shape.prototype, {
     *   'constructor': Circle
     * });
     *
     * var circle = new Circle;
     * circle instanceof Circle;
     * // => true
     *
     * circle instanceof Shape;
     * // => true
     */
    function create(prototype, properties) {
      var result = baseCreate(prototype);
      return properties == null ? result : baseAssign(result, properties);
    }

    /**
     * Assigns own and inherited enumerable string keyed properties of source
     * objects to the destination object for all destination properties that
     * resolve to `undefined`. Source objects are applied from left to right.
     * Once a property is set, additional values of the same property are ignored.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.defaultsDeep
     * @example
     *
     * _.defaults({ 'a': 1 }, { 'b': 2 }, { 'a': 3 });
     * // => { 'a': 1, 'b': 2 }
     */
    var defaults = baseRest(function(object, sources) {
      object = Object(object);

      var index = -1;
      var length = sources.length;
      var guard = length > 2 ? sources[2] : undefined;

      if (guard && isIterateeCall(sources[0], sources[1], guard)) {
        length = 1;
      }

      while (++index < length) {
        var source = sources[index];
        var props = keysIn(source);
        var propsIndex = -1;
        var propsLength = props.length;

        while (++propsIndex < propsLength) {
          var key = props[propsIndex];
          var value = object[key];

          if (value === undefined ||
              (eq(value, objectProto[key]) && !hasOwnProperty.call(object, key))) {
            object[key] = source[key];
          }
        }
      }

      return object;
    });

    /**
     * This method is like `_.defaults` except that it recursively assigns
     * default properties.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @see _.defaults
     * @example
     *
     * _.defaultsDeep({ 'a': { 'b': 2 } }, { 'a': { 'b': 1, 'c': 3 } });
     * // => { 'a': { 'b': 2, 'c': 3 } }
     */
    var defaultsDeep = baseRest(function(args) {
      args.push(undefined, customDefaultsMerge);
      return apply(mergeWith, undefined, args);
    });

    /**
     * This method is like `_.find` except that it returns the key of the first
     * element `predicate` returns truthy for instead of the element itself.
     *
     * @static
     * @memberOf _
     * @since 1.1.0
     * @category Object
     * @param {Object} object The object to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {string|undefined} Returns the key of the matched element,
     *  else `undefined`.
     * @example
     *
     * var users = {
     *   'barney':  { 'age': 36, 'active': true },
     *   'fred':    { 'age': 40, 'active': false },
     *   'pebbles': { 'age': 1,  'active': true }
     * };
     *
     * _.findKey(users, function(o) { return o.age < 40; });
     * // => 'barney' (iteration order is not guaranteed)
     *
     * // The `_.matches` iteratee shorthand.
     * _.findKey(users, { 'age': 1, 'active': true });
     * // => 'pebbles'
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findKey(users, ['active', false]);
     * // => 'fred'
     *
     * // The `_.property` iteratee shorthand.
     * _.findKey(users, 'active');
     * // => 'barney'
     */
    function findKey(object, predicate) {
      return baseFindKey(object, getIteratee(predicate, 3), baseForOwn);
    }

    /**
     * This method is like `_.findKey` except that it iterates over elements of
     * a collection in the opposite order.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Object
     * @param {Object} object The object to inspect.
     * @param {Function} [predicate=_.identity] The function invoked per iteration.
     * @returns {string|undefined} Returns the key of the matched element,
     *  else `undefined`.
     * @example
     *
     * var users = {
     *   'barney':  { 'age': 36, 'active': true },
     *   'fred':    { 'age': 40, 'active': false },
     *   'pebbles': { 'age': 1,  'active': true }
     * };
     *
     * _.findLastKey(users, function(o) { return o.age < 40; });
     * // => returns 'pebbles' assuming `_.findKey` returns 'barney'
     *
     * // The `_.matches` iteratee shorthand.
     * _.findLastKey(users, { 'age': 36, 'active': true });
     * // => 'barney'
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.findLastKey(users, ['active', false]);
     * // => 'fred'
     *
     * // The `_.property` iteratee shorthand.
     * _.findLastKey(users, 'active');
     * // => 'pebbles'
     */
    function findLastKey(object, predicate) {
      return baseFindKey(object, getIteratee(predicate, 3), baseForOwnRight);
    }

    /**
     * Iterates over own and inherited enumerable string keyed properties of an
     * object and invokes `iteratee` for each property. The iteratee is invoked
     * with three arguments: (value, key, object). Iteratee functions may exit
     * iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @since 0.3.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forInRight
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forIn(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'a', 'b', then 'c' (iteration order is not guaranteed).
     */
    function forIn(object, iteratee) {
      return object == null
        ? object
        : baseFor(object, getIteratee(iteratee, 3), keysIn);
    }

    /**
     * This method is like `_.forIn` except that it iterates over properties of
     * `object` in the opposite order.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forIn
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forInRight(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'c', 'b', then 'a' assuming `_.forIn` logs 'a', 'b', then 'c'.
     */
    function forInRight(object, iteratee) {
      return object == null
        ? object
        : baseForRight(object, getIteratee(iteratee, 3), keysIn);
    }

    /**
     * Iterates over own enumerable string keyed properties of an object and
     * invokes `iteratee` for each property. The iteratee is invoked with three
     * arguments: (value, key, object). Iteratee functions may exit iteration
     * early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @since 0.3.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forOwnRight
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forOwn(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'a' then 'b' (iteration order is not guaranteed).
     */
    function forOwn(object, iteratee) {
      return object && baseForOwn(object, getIteratee(iteratee, 3));
    }

    /**
     * This method is like `_.forOwn` except that it iterates over properties of
     * `object` in the opposite order.
     *
     * @static
     * @memberOf _
     * @since 2.0.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns `object`.
     * @see _.forOwn
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.forOwnRight(new Foo, function(value, key) {
     *   console.log(key);
     * });
     * // => Logs 'b' then 'a' assuming `_.forOwn` logs 'a' then 'b'.
     */
    function forOwnRight(object, iteratee) {
      return object && baseForOwnRight(object, getIteratee(iteratee, 3));
    }

    /**
     * Creates an array of function property names from own enumerable properties
     * of `object`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the function names.
     * @see _.functionsIn
     * @example
     *
     * function Foo() {
     *   this.a = _.constant('a');
     *   this.b = _.constant('b');
     * }
     *
     * Foo.prototype.c = _.constant('c');
     *
     * _.functions(new Foo);
     * // => ['a', 'b']
     */
    function functions(object) {
      return object == null ? [] : baseFunctions(object, keys(object));
    }

    /**
     * Creates an array of function property names from own and inherited
     * enumerable properties of `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to inspect.
     * @returns {Array} Returns the function names.
     * @see _.functions
     * @example
     *
     * function Foo() {
     *   this.a = _.constant('a');
     *   this.b = _.constant('b');
     * }
     *
     * Foo.prototype.c = _.constant('c');
     *
     * _.functionsIn(new Foo);
     * // => ['a', 'b', 'c']
     */
    function functionsIn(object) {
      return object == null ? [] : baseFunctions(object, keysIn(object));
    }

    /**
     * Gets the value at `path` of `object`. If the resolved value is
     * `undefined`, the `defaultValue` is returned in its place.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the property to get.
     * @param {*} [defaultValue] The value returned for `undefined` resolved values.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }] };
     *
     * _.get(object, 'a[0].b.c');
     * // => 3
     *
     * _.get(object, ['a', '0', 'b', 'c']);
     * // => 3
     *
     * _.get(object, 'a.b.c', 'default');
     * // => 'default'
     */
    function get(object, path, defaultValue) {
      var result = object == null ? undefined : baseGet(object, path);
      return result === undefined ? defaultValue : result;
    }

    /**
     * Checks if `path` is a direct property of `object`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path to check.
     * @returns {boolean} Returns `true` if `path` exists, else `false`.
     * @example
     *
     * var object = { 'a': { 'b': 2 } };
     * var other = _.create({ 'a': _.create({ 'b': 2 }) });
     *
     * _.has(object, 'a');
     * // => true
     *
     * _.has(object, 'a.b');
     * // => true
     *
     * _.has(object, ['a', 'b']);
     * // => true
     *
     * _.has(other, 'a');
     * // => false
     */
    function has(object, path) {
      return object != null && hasPath(object, path, baseHas);
    }

    /**
     * Checks if `path` is a direct or inherited property of `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path to check.
     * @returns {boolean} Returns `true` if `path` exists, else `false`.
     * @example
     *
     * var object = _.create({ 'a': _.create({ 'b': 2 }) });
     *
     * _.hasIn(object, 'a');
     * // => true
     *
     * _.hasIn(object, 'a.b');
     * // => true
     *
     * _.hasIn(object, ['a', 'b']);
     * // => true
     *
     * _.hasIn(object, 'b');
     * // => false
     */
    function hasIn(object, path) {
      return object != null && hasPath(object, path, baseHasIn);
    }

    /**
     * Creates an object composed of the inverted keys and values of `object`.
     * If `object` contains duplicate values, subsequent values overwrite
     * property assignments of previous values.
     *
     * @static
     * @memberOf _
     * @since 0.7.0
     * @category Object
     * @param {Object} object The object to invert.
     * @returns {Object} Returns the new inverted object.
     * @example
     *
     * var object = { 'a': 1, 'b': 2, 'c': 1 };
     *
     * _.invert(object);
     * // => { '1': 'c', '2': 'b' }
     */
    var invert = createInverter(function(result, value, key) {
      if (value != null &&
          typeof value.toString != 'function') {
        value = nativeObjectToString.call(value);
      }

      result[value] = key;
    }, constant(identity));

    /**
     * This method is like `_.invert` except that the inverted object is generated
     * from the results of running each element of `object` thru `iteratee`. The
     * corresponding inverted value of each inverted key is an array of keys
     * responsible for generating the inverted value. The iteratee is invoked
     * with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.1.0
     * @category Object
     * @param {Object} object The object to invert.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {Object} Returns the new inverted object.
     * @example
     *
     * var object = { 'a': 1, 'b': 2, 'c': 1 };
     *
     * _.invertBy(object);
     * // => { '1': ['a', 'c'], '2': ['b'] }
     *
     * _.invertBy(object, function(value) {
     *   return 'group' + value;
     * });
     * // => { 'group1': ['a', 'c'], 'group2': ['b'] }
     */
    var invertBy = createInverter(function(result, value, key) {
      if (value != null &&
          typeof value.toString != 'function') {
        value = nativeObjectToString.call(value);
      }

      if (hasOwnProperty.call(result, value)) {
        result[value].push(key);
      } else {
        result[value] = [key];
      }
    }, getIteratee);

    /**
     * Invokes the method at `path` of `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the method to invoke.
     * @param {...*} [args] The arguments to invoke the method with.
     * @returns {*} Returns the result of the invoked method.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': [1, 2, 3, 4] } }] };
     *
     * _.invoke(object, 'a[0].b.c.slice', 1, 3);
     * // => [2, 3]
     */
    var invoke = baseRest(baseInvoke);

    /**
     * Creates an array of the own enumerable property names of `object`.
     *
     * **Note:** Non-object values are coerced to objects. See the
     * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)
     * for more details.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.keys(new Foo);
     * // => ['a', 'b'] (iteration order is not guaranteed)
     *
     * _.keys('hi');
     * // => ['0', '1']
     */
    function keys(object) {
      return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);
    }

    /**
     * Creates an array of the own and inherited enumerable property names of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property names.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.keysIn(new Foo);
     * // => ['a', 'b', 'c'] (iteration order is not guaranteed)
     */
    function keysIn(object) {
      return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);
    }

    /**
     * The opposite of `_.mapValues`; this method creates an object with the
     * same values as `object` and keys generated by running each own enumerable
     * string keyed property of `object` thru `iteratee`. The iteratee is invoked
     * with three arguments: (value, key, object).
     *
     * @static
     * @memberOf _
     * @since 3.8.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns the new mapped object.
     * @see _.mapValues
     * @example
     *
     * _.mapKeys({ 'a': 1, 'b': 2 }, function(value, key) {
     *   return key + value;
     * });
     * // => { 'a1': 1, 'b2': 2 }
     */
    function mapKeys(object, iteratee) {
      var result = {};
      iteratee = getIteratee(iteratee, 3);

      baseForOwn(object, function(value, key, object) {
        baseAssignValue(result, iteratee(value, key, object), value);
      });
      return result;
    }

    /**
     * Creates an object with the same keys as `object` and values generated
     * by running each own enumerable string keyed property of `object` thru
     * `iteratee`. The iteratee is invoked with three arguments:
     * (value, key, object).
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Object} Returns the new mapped object.
     * @see _.mapKeys
     * @example
     *
     * var users = {
     *   'fred':    { 'user': 'fred',    'age': 40 },
     *   'pebbles': { 'user': 'pebbles', 'age': 1 }
     * };
     *
     * _.mapValues(users, function(o) { return o.age; });
     * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)
     *
     * // The `_.property` iteratee shorthand.
     * _.mapValues(users, 'age');
     * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)
     */
    function mapValues(object, iteratee) {
      var result = {};
      iteratee = getIteratee(iteratee, 3);

      baseForOwn(object, function(value, key, object) {
        baseAssignValue(result, key, iteratee(value, key, object));
      });
      return result;
    }

    /**
     * This method is like `_.assign` except that it recursively merges own and
     * inherited enumerable string keyed properties of source objects into the
     * destination object. Source properties that resolve to `undefined` are
     * skipped if a destination value exists. Array and plain object properties
     * are merged recursively. Other objects and value types are overridden by
     * assignment. Source objects are applied from left to right. Subsequent
     * sources overwrite property assignments of previous sources.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 0.5.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} [sources] The source objects.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = {
     *   'a': [{ 'b': 2 }, { 'd': 4 }]
     * };
     *
     * var other = {
     *   'a': [{ 'c': 3 }, { 'e': 5 }]
     * };
     *
     * _.merge(object, other);
     * // => { 'a': [{ 'b': 2, 'c': 3 }, { 'd': 4, 'e': 5 }] }
     */
    var merge = createAssigner(function(object, source, srcIndex) {
      baseMerge(object, source, srcIndex);
    });

    /**
     * This method is like `_.merge` except that it accepts `customizer` which
     * is invoked to produce the merged values of the destination and source
     * properties. If `customizer` returns `undefined`, merging is handled by the
     * method instead. The `customizer` is invoked with six arguments:
     * (objValue, srcValue, key, object, source, stack).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The destination object.
     * @param {...Object} sources The source objects.
     * @param {Function} customizer The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @example
     *
     * function customizer(objValue, srcValue) {
     *   if (_.isArray(objValue)) {
     *     return objValue.concat(srcValue);
     *   }
     * }
     *
     * var object = { 'a': [1], 'b': [2] };
     * var other = { 'a': [3], 'b': [4] };
     *
     * _.mergeWith(object, other, customizer);
     * // => { 'a': [1, 3], 'b': [2, 4] }
     */
    var mergeWith = createAssigner(function(object, source, srcIndex, customizer) {
      baseMerge(object, source, srcIndex, customizer);
    });

    /**
     * The opposite of `_.pick`; this method creates an object composed of the
     * own and inherited enumerable property paths of `object` that are not omitted.
     *
     * **Note:** This method is considerably slower than `_.pick`.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The source object.
     * @param {...(string|string[])} [paths] The property paths to omit.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.omit(object, ['a', 'c']);
     * // => { 'b': '2' }
     */
    var omit = flatRest(function(object, paths) {
      var result = {};
      if (object == null) {
        return result;
      }
      var isDeep = false;
      paths = arrayMap(paths, function(path) {
        path = castPath(path, object);
        isDeep || (isDeep = path.length > 1);
        return path;
      });
      copyObject(object, getAllKeysIn(object), result);
      if (isDeep) {
        result = baseClone(result, CLONE_DEEP_FLAG | CLONE_FLAT_FLAG | CLONE_SYMBOLS_FLAG, customOmitClone);
      }
      var length = paths.length;
      while (length--) {
        baseUnset(result, paths[length]);
      }
      return result;
    });

    /**
     * The opposite of `_.pickBy`; this method creates an object composed of
     * the own and inherited enumerable string keyed properties of `object` that
     * `predicate` doesn't return truthy for. The predicate is invoked with two
     * arguments: (value, key).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The source object.
     * @param {Function} [predicate=_.identity] The function invoked per property.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.omitBy(object, _.isNumber);
     * // => { 'b': '2' }
     */
    function omitBy(object, predicate) {
      return pickBy(object, negate(getIteratee(predicate)));
    }

    /**
     * Creates an object composed of the picked `object` properties.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The source object.
     * @param {...(string|string[])} [paths] The property paths to pick.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.pick(object, ['a', 'c']);
     * // => { 'a': 1, 'c': 3 }
     */
    var pick = flatRest(function(object, paths) {
      return object == null ? {} : basePick(object, paths);
    });

    /**
     * Creates an object composed of the `object` properties `predicate` returns
     * truthy for. The predicate is invoked with two arguments: (value, key).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The source object.
     * @param {Function} [predicate=_.identity] The function invoked per property.
     * @returns {Object} Returns the new object.
     * @example
     *
     * var object = { 'a': 1, 'b': '2', 'c': 3 };
     *
     * _.pickBy(object, _.isNumber);
     * // => { 'a': 1, 'c': 3 }
     */
    function pickBy(object, predicate) {
      if (object == null) {
        return {};
      }
      var props = arrayMap(getAllKeysIn(object), function(prop) {
        return [prop];
      });
      predicate = getIteratee(predicate);
      return basePickBy(object, props, function(value, path) {
        return predicate(value, path[0]);
      });
    }

    /**
     * This method is like `_.get` except that if the resolved value is a
     * function it's invoked with the `this` binding of its parent object and
     * its result is returned.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @param {Array|string} path The path of the property to resolve.
     * @param {*} [defaultValue] The value returned for `undefined` resolved values.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c1': 3, 'c2': _.constant(4) } }] };
     *
     * _.result(object, 'a[0].b.c1');
     * // => 3
     *
     * _.result(object, 'a[0].b.c2');
     * // => 4
     *
     * _.result(object, 'a[0].b.c3', 'default');
     * // => 'default'
     *
     * _.result(object, 'a[0].b.c3', _.constant('default'));
     * // => 'default'
     */
    function result(object, path, defaultValue) {
      path = castPath(path, object);

      var index = -1,
          length = path.length;

      // Ensure the loop is entered when path is empty.
      if (!length) {
        length = 1;
        object = undefined;
      }
      while (++index < length) {
        var value = object == null ? undefined : object[toKey(path[index])];
        if (value === undefined) {
          index = length;
          value = defaultValue;
        }
        object = isFunction(value) ? value.call(object) : value;
      }
      return object;
    }

    /**
     * Sets the value at `path` of `object`. If a portion of `path` doesn't exist,
     * it's created. Arrays are created for missing index properties while objects
     * are created for all other missing properties. Use `_.setWith` to customize
     * `path` creation.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {*} value The value to set.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }] };
     *
     * _.set(object, 'a[0].b.c', 4);
     * console.log(object.a[0].b.c);
     * // => 4
     *
     * _.set(object, ['x', '0', 'y', 'z'], 5);
     * console.log(object.x[0].y.z);
     * // => 5
     */
    function set(object, path, value) {
      return object == null ? object : baseSet(object, path, value);
    }

    /**
     * This method is like `_.set` except that it accepts `customizer` which is
     * invoked to produce the objects of `path`.  If `customizer` returns `undefined`
     * path creation is handled by the method instead. The `customizer` is invoked
     * with three arguments: (nsValue, key, nsObject).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {*} value The value to set.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = {};
     *
     * _.setWith(object, '[0][1]', 'a', Object);
     * // => { '0': { '1': 'a' } }
     */
    function setWith(object, path, value, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return object == null ? object : baseSet(object, path, value, customizer);
    }

    /**
     * Creates an array of own enumerable string keyed-value pairs for `object`
     * which can be consumed by `_.fromPairs`. If `object` is a map or set, its
     * entries are returned.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias entries
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the key-value pairs.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.toPairs(new Foo);
     * // => [['a', 1], ['b', 2]] (iteration order is not guaranteed)
     */
    var toPairs = createToPairs(keys);

    /**
     * Creates an array of own and inherited enumerable string keyed-value pairs
     * for `object` which can be consumed by `_.fromPairs`. If `object` is a map
     * or set, its entries are returned.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @alias entriesIn
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the key-value pairs.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.toPairsIn(new Foo);
     * // => [['a', 1], ['b', 2], ['c', 3]] (iteration order is not guaranteed)
     */
    var toPairsIn = createToPairs(keysIn);

    /**
     * An alternative to `_.reduce`; this method transforms `object` to a new
     * `accumulator` object which is the result of running each of its own
     * enumerable string keyed properties thru `iteratee`, with each invocation
     * potentially mutating the `accumulator` object. If `accumulator` is not
     * provided, a new object with the same `[[Prototype]]` will be used. The
     * iteratee is invoked with four arguments: (accumulator, value, key, object).
     * Iteratee functions may exit iteration early by explicitly returning `false`.
     *
     * @static
     * @memberOf _
     * @since 1.3.0
     * @category Object
     * @param {Object} object The object to iterate over.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @param {*} [accumulator] The custom accumulator value.
     * @returns {*} Returns the accumulated value.
     * @example
     *
     * _.transform([2, 3, 4], function(result, n) {
     *   result.push(n *= n);
     *   return n % 2 == 0;
     * }, []);
     * // => [4, 9]
     *
     * _.transform({ 'a': 1, 'b': 2, 'c': 1 }, function(result, value, key) {
     *   (result[value] || (result[value] = [])).push(key);
     * }, {});
     * // => { '1': ['a', 'c'], '2': ['b'] }
     */
    function transform(object, iteratee, accumulator) {
      var isArr = isArray(object),
          isArrLike = isArr || isBuffer(object) || isTypedArray(object);

      iteratee = getIteratee(iteratee, 4);
      if (accumulator == null) {
        var Ctor = object && object.constructor;
        if (isArrLike) {
          accumulator = isArr ? new Ctor : [];
        }
        else if (isObject(object)) {
          accumulator = isFunction(Ctor) ? baseCreate(getPrototype(object)) : {};
        }
        else {
          accumulator = {};
        }
      }
      (isArrLike ? arrayEach : baseForOwn)(object, function(value, index, object) {
        return iteratee(accumulator, value, index, object);
      });
      return accumulator;
    }

    /**
     * Removes the property at `path` of `object`.
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to unset.
     * @returns {boolean} Returns `true` if the property is deleted, else `false`.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 7 } }] };
     * _.unset(object, 'a[0].b.c');
     * // => true
     *
     * console.log(object);
     * // => { 'a': [{ 'b': {} }] };
     *
     * _.unset(object, ['a', '0', 'b', 'c']);
     * // => true
     *
     * console.log(object);
     * // => { 'a': [{ 'b': {} }] };
     */
    function unset(object, path) {
      return object == null ? true : baseUnset(object, path);
    }

    /**
     * This method is like `_.set` except that accepts `updater` to produce the
     * value to set. Use `_.updateWith` to customize `path` creation. The `updater`
     * is invoked with one argument: (value).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.6.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {Function} updater The function to produce the updated value.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = { 'a': [{ 'b': { 'c': 3 } }] };
     *
     * _.update(object, 'a[0].b.c', function(n) { return n * n; });
     * console.log(object.a[0].b.c);
     * // => 9
     *
     * _.update(object, 'x[0].y.z', function(n) { return n ? n + 1 : 0; });
     * console.log(object.x[0].y.z);
     * // => 0
     */
    function update(object, path, updater) {
      return object == null ? object : baseUpdate(object, path, castFunction(updater));
    }

    /**
     * This method is like `_.update` except that it accepts `customizer` which is
     * invoked to produce the objects of `path`.  If `customizer` returns `undefined`
     * path creation is handled by the method instead. The `customizer` is invoked
     * with three arguments: (nsValue, key, nsObject).
     *
     * **Note:** This method mutates `object`.
     *
     * @static
     * @memberOf _
     * @since 4.6.0
     * @category Object
     * @param {Object} object The object to modify.
     * @param {Array|string} path The path of the property to set.
     * @param {Function} updater The function to produce the updated value.
     * @param {Function} [customizer] The function to customize assigned values.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var object = {};
     *
     * _.updateWith(object, '[0][1]', _.constant('a'), Object);
     * // => { '0': { '1': 'a' } }
     */
    function updateWith(object, path, updater, customizer) {
      customizer = typeof customizer == 'function' ? customizer : undefined;
      return object == null ? object : baseUpdate(object, path, castFunction(updater), customizer);
    }

    /**
     * Creates an array of the own enumerable string keyed property values of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property values.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.values(new Foo);
     * // => [1, 2] (iteration order is not guaranteed)
     *
     * _.values('hi');
     * // => ['h', 'i']
     */
    function values(object) {
      return object == null ? [] : baseValues(object, keys(object));
    }

    /**
     * Creates an array of the own and inherited enumerable string keyed property
     * values of `object`.
     *
     * **Note:** Non-object values are coerced to objects.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Object
     * @param {Object} object The object to query.
     * @returns {Array} Returns the array of property values.
     * @example
     *
     * function Foo() {
     *   this.a = 1;
     *   this.b = 2;
     * }
     *
     * Foo.prototype.c = 3;
     *
     * _.valuesIn(new Foo);
     * // => [1, 2, 3] (iteration order is not guaranteed)
     */
    function valuesIn(object) {
      return object == null ? [] : baseValues(object, keysIn(object));
    }

    /*------------------------------------------------------------------------*/

    /**
     * Clamps `number` within the inclusive `lower` and `upper` bounds.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Number
     * @param {number} number The number to clamp.
     * @param {number} [lower] The lower bound.
     * @param {number} upper The upper bound.
     * @returns {number} Returns the clamped number.
     * @example
     *
     * _.clamp(-10, -5, 5);
     * // => -5
     *
     * _.clamp(10, -5, 5);
     * // => 5
     */
    function clamp(number, lower, upper) {
      if (upper === undefined) {
        upper = lower;
        lower = undefined;
      }
      if (upper !== undefined) {
        upper = toNumber(upper);
        upper = upper === upper ? upper : 0;
      }
      if (lower !== undefined) {
        lower = toNumber(lower);
        lower = lower === lower ? lower : 0;
      }
      return baseClamp(toNumber(number), lower, upper);
    }

    /**
     * Checks if `n` is between `start` and up to, but not including, `end`. If
     * `end` is not specified, it's set to `start` with `start` then set to `0`.
     * If `start` is greater than `end` the params are swapped to support
     * negative ranges.
     *
     * @static
     * @memberOf _
     * @since 3.3.0
     * @category Number
     * @param {number} number The number to check.
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @returns {boolean} Returns `true` if `number` is in the range, else `false`.
     * @see _.range, _.rangeRight
     * @example
     *
     * _.inRange(3, 2, 4);
     * // => true
     *
     * _.inRange(4, 8);
     * // => true
     *
     * _.inRange(4, 2);
     * // => false
     *
     * _.inRange(2, 2);
     * // => false
     *
     * _.inRange(1.2, 2);
     * // => true
     *
     * _.inRange(5.2, 4);
     * // => false
     *
     * _.inRange(-3, -2, -6);
     * // => true
     */
    function inRange(number, start, end) {
      start = toFinite(start);
      if (end === undefined) {
        end = start;
        start = 0;
      } else {
        end = toFinite(end);
      }
      number = toNumber(number);
      return baseInRange(number, start, end);
    }

    /**
     * Produces a random number between the inclusive `lower` and `upper` bounds.
     * If only one argument is provided a number between `0` and the given number
     * is returned. If `floating` is `true`, or either `lower` or `upper` are
     * floats, a floating-point number is returned instead of an integer.
     *
     * **Note:** JavaScript follows the IEEE-754 standard for resolving
     * floating-point values which can produce unexpected results.
     *
     * @static
     * @memberOf _
     * @since 0.7.0
     * @category Number
     * @param {number} [lower=0] The lower bound.
     * @param {number} [upper=1] The upper bound.
     * @param {boolean} [floating] Specify returning a floating-point number.
     * @returns {number} Returns the random number.
     * @example
     *
     * _.random(0, 5);
     * // => an integer between 0 and 5
     *
     * _.random(5);
     * // => also an integer between 0 and 5
     *
     * _.random(5, true);
     * // => a floating-point number between 0 and 5
     *
     * _.random(1.2, 5.2);
     * // => a floating-point number between 1.2 and 5.2
     */
    function random(lower, upper, floating) {
      if (floating && typeof floating != 'boolean' && isIterateeCall(lower, upper, floating)) {
        upper = floating = undefined;
      }
      if (floating === undefined) {
        if (typeof upper == 'boolean') {
          floating = upper;
          upper = undefined;
        }
        else if (typeof lower == 'boolean') {
          floating = lower;
          lower = undefined;
        }
      }
      if (lower === undefined && upper === undefined) {
        lower = 0;
        upper = 1;
      }
      else {
        lower = toFinite(lower);
        if (upper === undefined) {
          upper = lower;
          lower = 0;
        } else {
          upper = toFinite(upper);
        }
      }
      if (lower > upper) {
        var temp = lower;
        lower = upper;
        upper = temp;
      }
      if (floating || lower % 1 || upper % 1) {
        var rand = nativeRandom();
        return nativeMin(lower + (rand * (upper - lower + freeParseFloat('1e-' + ((rand + '').length - 1)))), upper);
      }
      return baseRandom(lower, upper);
    }

    /*------------------------------------------------------------------------*/

    /**
     * Converts `string` to [camel case](https://en.wikipedia.org/wiki/CamelCase).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the camel cased string.
     * @example
     *
     * _.camelCase('Foo Bar');
     * // => 'fooBar'
     *
     * _.camelCase('--foo-bar--');
     * // => 'fooBar'
     *
     * _.camelCase('__FOO_BAR__');
     * // => 'fooBar'
     */
    var camelCase = createCompounder(function(result, word, index) {
      word = word.toLowerCase();
      return result + (index ? capitalize(word) : word);
    });

    /**
     * Converts the first character of `string` to upper case and the remaining
     * to lower case.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to capitalize.
     * @returns {string} Returns the capitalized string.
     * @example
     *
     * _.capitalize('FRED');
     * // => 'Fred'
     */
    function capitalize(string) {
      return upperFirst(toString(string).toLowerCase());
    }

    /**
     * Deburrs `string` by converting
     * [Latin-1 Supplement](https://en.wikipedia.org/wiki/Latin-1_Supplement_(Unicode_block)#Character_table)
     * and [Latin Extended-A](https://en.wikipedia.org/wiki/Latin_Extended-A)
     * letters to basic Latin letters and removing
     * [combining diacritical marks](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to deburr.
     * @returns {string} Returns the deburred string.
     * @example
     *
     * _.deburr('déjà vu');
     * // => 'deja vu'
     */
    function deburr(string) {
      string = toString(string);
      return string && string.replace(reLatin, deburrLetter).replace(reComboMark, '');
    }

    /**
     * Checks if `string` ends with the given target string.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to inspect.
     * @param {string} [target] The string to search for.
     * @param {number} [position=string.length] The position to search up to.
     * @returns {boolean} Returns `true` if `string` ends with `target`,
     *  else `false`.
     * @example
     *
     * _.endsWith('abc', 'c');
     * // => true
     *
     * _.endsWith('abc', 'b');
     * // => false
     *
     * _.endsWith('abc', 'b', 2);
     * // => true
     */
    function endsWith(string, target, position) {
      string = toString(string);
      target = baseToString(target);

      var length = string.length;
      position = position === undefined
        ? length
        : baseClamp(toInteger(position), 0, length);

      var end = position;
      position -= target.length;
      return position >= 0 && string.slice(position, end) == target;
    }

    /**
     * Converts the characters "&", "<", ">", '"', and "'" in `string` to their
     * corresponding HTML entities.
     *
     * **Note:** No other characters are escaped. To escape additional
     * characters use a third-party library like [_he_](https://mths.be/he).
     *
     * Though the ">" character is escaped for symmetry, characters like
     * ">" and "/" don't need escaping in HTML and have no special meaning
     * unless they're part of a tag or unquoted attribute value. See
     * [Mathias Bynens's article](https://mathiasbynens.be/notes/ambiguous-ampersands)
     * (under "semi-related fun fact") for more details.
     *
     * When working with HTML you should always
     * [quote attribute values](http://wonko.com/post/html-escaping) to reduce
     * XSS vectors.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category String
     * @param {string} [string=''] The string to escape.
     * @returns {string} Returns the escaped string.
     * @example
     *
     * _.escape('fred, barney, & pebbles');
     * // => 'fred, barney, &amp; pebbles'
     */
    function escape(string) {
      string = toString(string);
      return (string && reHasUnescapedHtml.test(string))
        ? string.replace(reUnescapedHtml, escapeHtmlChar)
        : string;
    }

    /**
     * Escapes the `RegExp` special characters "^", "$", "\", ".", "*", "+",
     * "?", "(", ")", "[", "]", "{", "}", and "|" in `string`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to escape.
     * @returns {string} Returns the escaped string.
     * @example
     *
     * _.escapeRegExp('[lodash](https://lodash.com/)');
     * // => '\[lodash\]\(https://lodash\.com/\)'
     */
    function escapeRegExp(string) {
      string = toString(string);
      return (string && reHasRegExpChar.test(string))
        ? string.replace(reRegExpChar, '\\$&')
        : string;
    }

    /**
     * Converts `string` to
     * [kebab case](https://en.wikipedia.org/wiki/Letter_case#Special_case_styles).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the kebab cased string.
     * @example
     *
     * _.kebabCase('Foo Bar');
     * // => 'foo-bar'
     *
     * _.kebabCase('fooBar');
     * // => 'foo-bar'
     *
     * _.kebabCase('__FOO_BAR__');
     * // => 'foo-bar'
     */
    var kebabCase = createCompounder(function(result, word, index) {
      return result + (index ? '-' : '') + word.toLowerCase();
    });

    /**
     * Converts `string`, as space separated words, to lower case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the lower cased string.
     * @example
     *
     * _.lowerCase('--Foo-Bar--');
     * // => 'foo bar'
     *
     * _.lowerCase('fooBar');
     * // => 'foo bar'
     *
     * _.lowerCase('__FOO_BAR__');
     * // => 'foo bar'
     */
    var lowerCase = createCompounder(function(result, word, index) {
      return result + (index ? ' ' : '') + word.toLowerCase();
    });

    /**
     * Converts the first character of `string` to lower case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the converted string.
     * @example
     *
     * _.lowerFirst('Fred');
     * // => 'fred'
     *
     * _.lowerFirst('FRED');
     * // => 'fRED'
     */
    var lowerFirst = createCaseFirst('toLowerCase');

    /**
     * Pads `string` on the left and right sides if it's shorter than `length`.
     * Padding characters are truncated if they can't be evenly divided by `length`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.pad('abc', 8);
     * // => '  abc   '
     *
     * _.pad('abc', 8, '_-');
     * // => '_-abc_-_'
     *
     * _.pad('abc', 3);
     * // => 'abc'
     */
    function pad(string, length, chars) {
      string = toString(string);
      length = toInteger(length);

      var strLength = length ? stringSize(string) : 0;
      if (!length || strLength >= length) {
        return string;
      }
      var mid = (length - strLength) / 2;
      return (
        createPadding(nativeFloor(mid), chars) +
        string +
        createPadding(nativeCeil(mid), chars)
      );
    }

    /**
     * Pads `string` on the right side if it's shorter than `length`. Padding
     * characters are truncated if they exceed `length`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.padEnd('abc', 6);
     * // => 'abc   '
     *
     * _.padEnd('abc', 6, '_-');
     * // => 'abc_-_'
     *
     * _.padEnd('abc', 3);
     * // => 'abc'
     */
    function padEnd(string, length, chars) {
      string = toString(string);
      length = toInteger(length);

      var strLength = length ? stringSize(string) : 0;
      return (length && strLength < length)
        ? (string + createPadding(length - strLength, chars))
        : string;
    }

    /**
     * Pads `string` on the left side if it's shorter than `length`. Padding
     * characters are truncated if they exceed `length`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to pad.
     * @param {number} [length=0] The padding length.
     * @param {string} [chars=' '] The string used as padding.
     * @returns {string} Returns the padded string.
     * @example
     *
     * _.padStart('abc', 6);
     * // => '   abc'
     *
     * _.padStart('abc', 6, '_-');
     * // => '_-_abc'
     *
     * _.padStart('abc', 3);
     * // => 'abc'
     */
    function padStart(string, length, chars) {
      string = toString(string);
      length = toInteger(length);

      var strLength = length ? stringSize(string) : 0;
      return (length && strLength < length)
        ? (createPadding(length - strLength, chars) + string)
        : string;
    }

    /**
     * Converts `string` to an integer of the specified radix. If `radix` is
     * `undefined` or `0`, a `radix` of `10` is used unless `value` is a
     * hexadecimal, in which case a `radix` of `16` is used.
     *
     * **Note:** This method aligns with the
     * [ES5 implementation](https://es5.github.io/#x15.1.2.2) of `parseInt`.
     *
     * @static
     * @memberOf _
     * @since 1.1.0
     * @category String
     * @param {string} string The string to convert.
     * @param {number} [radix=10] The radix to interpret `value` by.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {number} Returns the converted integer.
     * @example
     *
     * _.parseInt('08');
     * // => 8
     *
     * _.map(['6', '08', '10'], _.parseInt);
     * // => [6, 8, 10]
     */
    function parseInt(string, radix, guard) {
      if (guard || radix == null) {
        radix = 0;
      } else if (radix) {
        radix = +radix;
      }
      return nativeParseInt(toString(string).replace(reTrimStart, ''), radix || 0);
    }

    /**
     * Repeats the given string `n` times.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to repeat.
     * @param {number} [n=1] The number of times to repeat the string.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the repeated string.
     * @example
     *
     * _.repeat('*', 3);
     * // => '***'
     *
     * _.repeat('abc', 2);
     * // => 'abcabc'
     *
     * _.repeat('abc', 0);
     * // => ''
     */
    function repeat(string, n, guard) {
      if ((guard ? isIterateeCall(string, n, guard) : n === undefined)) {
        n = 1;
      } else {
        n = toInteger(n);
      }
      return baseRepeat(toString(string), n);
    }

    /**
     * Replaces matches for `pattern` in `string` with `replacement`.
     *
     * **Note:** This method is based on
     * [`String#replace`](https://mdn.io/String/replace).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to modify.
     * @param {RegExp|string} pattern The pattern to replace.
     * @param {Function|string} replacement The match replacement.
     * @returns {string} Returns the modified string.
     * @example
     *
     * _.replace('Hi Fred', 'Fred', 'Barney');
     * // => 'Hi Barney'
     */
    function replace() {
      var args = arguments,
          string = toString(args[0]);

      return args.length < 3 ? string : string.replace(args[1], args[2]);
    }

    /**
     * Converts `string` to
     * [snake case](https://en.wikipedia.org/wiki/Snake_case).
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the snake cased string.
     * @example
     *
     * _.snakeCase('Foo Bar');
     * // => 'foo_bar'
     *
     * _.snakeCase('fooBar');
     * // => 'foo_bar'
     *
     * _.snakeCase('--FOO-BAR--');
     * // => 'foo_bar'
     */
    var snakeCase = createCompounder(function(result, word, index) {
      return result + (index ? '_' : '') + word.toLowerCase();
    });

    /**
     * Splits `string` by `separator`.
     *
     * **Note:** This method is based on
     * [`String#split`](https://mdn.io/String/split).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to split.
     * @param {RegExp|string} separator The separator pattern to split by.
     * @param {number} [limit] The length to truncate results to.
     * @returns {Array} Returns the string segments.
     * @example
     *
     * _.split('a-b-c', '-', 2);
     * // => ['a', 'b']
     */
    function split(string, separator, limit) {
      if (limit && typeof limit != 'number' && isIterateeCall(string, separator, limit)) {
        separator = limit = undefined;
      }
      limit = limit === undefined ? MAX_ARRAY_LENGTH : limit >>> 0;
      if (!limit) {
        return [];
      }
      string = toString(string);
      if (string && (
            typeof separator == 'string' ||
            (separator != null && !isRegExp(separator))
          )) {
        separator = baseToString(separator);
        if (!separator && hasUnicode(string)) {
          return castSlice(stringToArray(string), 0, limit);
        }
      }
      return string.split(separator, limit);
    }

    /**
     * Converts `string` to
     * [start case](https://en.wikipedia.org/wiki/Letter_case#Stylistic_or_specialised_usage).
     *
     * @static
     * @memberOf _
     * @since 3.1.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the start cased string.
     * @example
     *
     * _.startCase('--foo-bar--');
     * // => 'Foo Bar'
     *
     * _.startCase('fooBar');
     * // => 'Foo Bar'
     *
     * _.startCase('__FOO_BAR__');
     * // => 'FOO BAR'
     */
    var startCase = createCompounder(function(result, word, index) {
      return result + (index ? ' ' : '') + upperFirst(word);
    });

    /**
     * Checks if `string` starts with the given target string.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to inspect.
     * @param {string} [target] The string to search for.
     * @param {number} [position=0] The position to search from.
     * @returns {boolean} Returns `true` if `string` starts with `target`,
     *  else `false`.
     * @example
     *
     * _.startsWith('abc', 'a');
     * // => true
     *
     * _.startsWith('abc', 'b');
     * // => false
     *
     * _.startsWith('abc', 'b', 1);
     * // => true
     */
    function startsWith(string, target, position) {
      string = toString(string);
      position = position == null
        ? 0
        : baseClamp(toInteger(position), 0, string.length);

      target = baseToString(target);
      return string.slice(position, position + target.length) == target;
    }

    /**
     * Creates a compiled template function that can interpolate data properties
     * in "interpolate" delimiters, HTML-escape interpolated data properties in
     * "escape" delimiters, and execute JavaScript in "evaluate" delimiters. Data
     * properties may be accessed as free variables in the template. If a setting
     * object is given, it takes precedence over `_.templateSettings` values.
     *
     * **Note:** In the development build `_.template` utilizes
     * [sourceURLs](http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-sourceurl)
     * for easier debugging.
     *
     * For more information on precompiling templates see
     * [lodash's custom builds documentation](https://lodash.com/custom-builds).
     *
     * For more information on Chrome extension sandboxes see
     * [Chrome's extensions documentation](https://developer.chrome.com/extensions/sandboxingEval).
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category String
     * @param {string} [string=''] The template string.
     * @param {Object} [options={}] The options object.
     * @param {RegExp} [options.escape=_.templateSettings.escape]
     *  The HTML "escape" delimiter.
     * @param {RegExp} [options.evaluate=_.templateSettings.evaluate]
     *  The "evaluate" delimiter.
     * @param {Object} [options.imports=_.templateSettings.imports]
     *  An object to import into the template as free variables.
     * @param {RegExp} [options.interpolate=_.templateSettings.interpolate]
     *  The "interpolate" delimiter.
     * @param {string} [options.sourceURL='lodash.templateSources[n]']
     *  The sourceURL of the compiled template.
     * @param {string} [options.variable='obj']
     *  The data object variable name.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Function} Returns the compiled template function.
     * @example
     *
     * // Use the "interpolate" delimiter to create a compiled template.
     * var compiled = _.template('hello <%= user %>!');
     * compiled({ 'user': 'fred' });
     * // => 'hello fred!'
     *
     * // Use the HTML "escape" delimiter to escape data property values.
     * var compiled = _.template('<b><%- value %></b>');
     * compiled({ 'value': '<script>' });
     * // => '<b>&lt;script&gt;</b>'
     *
     * // Use the "evaluate" delimiter to execute JavaScript and generate HTML.
     * var compiled = _.template('<% _.forEach(users, function(user) { %><li><%- user %></li><% }); %>');
     * compiled({ 'users': ['fred', 'barney'] });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // Use the internal `print` function in "evaluate" delimiters.
     * var compiled = _.template('<% print("hello " + user); %>!');
     * compiled({ 'user': 'barney' });
     * // => 'hello barney!'
     *
     * // Use the ES template literal delimiter as an "interpolate" delimiter.
     * // Disable support by replacing the "interpolate" delimiter.
     * var compiled = _.template('hello ${ user }!');
     * compiled({ 'user': 'pebbles' });
     * // => 'hello pebbles!'
     *
     * // Use backslashes to treat delimiters as plain text.
     * var compiled = _.template('<%= "\\<%- value %\\>" %>');
     * compiled({ 'value': 'ignored' });
     * // => '<%- value %>'
     *
     * // Use the `imports` option to import `jQuery` as `jq`.
     * var text = '<% jq.each(users, function(user) { %><li><%- user %></li><% }); %>';
     * var compiled = _.template(text, { 'imports': { 'jq': jQuery } });
     * compiled({ 'users': ['fred', 'barney'] });
     * // => '<li>fred</li><li>barney</li>'
     *
     * // Use the `sourceURL` option to specify a custom sourceURL for the template.
     * var compiled = _.template('hello <%= user %>!', { 'sourceURL': '/basic/greeting.jst' });
     * compiled(data);
     * // => Find the source of "greeting.jst" under the Sources tab or Resources panel of the web inspector.
     *
     * // Use the `variable` option to ensure a with-statement isn't used in the compiled template.
     * var compiled = _.template('hi <%= data.user %>!', { 'variable': 'data' });
     * compiled.source;
     * // => function(data) {
     * //   var __t, __p = '';
     * //   __p += 'hi ' + ((__t = ( data.user )) == null ? '' : __t) + '!';
     * //   return __p;
     * // }
     *
     * // Use custom template delimiters.
     * _.templateSettings.interpolate = /{{([\s\S]+?)}}/g;
     * var compiled = _.template('hello {{ user }}!');
     * compiled({ 'user': 'mustache' });
     * // => 'hello mustache!'
     *
     * // Use the `source` property to inline compiled templates for meaningful
     * // line numbers in error messages and stack traces.
     * fs.writeFileSync(path.join(process.cwd(), 'jst.js'), '\
     *   var JST = {\
     *     "main": ' + _.template(mainText).source + '\
     *   };\
     * ');
     */
    function template(string, options, guard) {
      // Based on John Resig's `tmpl` implementation
      // (http://ejohn.org/blog/javascript-micro-templating/)
      // and Laura Doktorova's doT.js (https://github.com/olado/doT).
      var settings = lodash.templateSettings;

      if (guard && isIterateeCall(string, options, guard)) {
        options = undefined;
      }
      string = toString(string);
      options = assignInWith({}, options, settings, customDefaultsAssignIn);

      var imports = assignInWith({}, options.imports, settings.imports, customDefaultsAssignIn),
          importsKeys = keys(imports),
          importsValues = baseValues(imports, importsKeys);

      var isEscaping,
          isEvaluating,
          index = 0,
          interpolate = options.interpolate || reNoMatch,
          source = "__p += '";

      // Compile the regexp to match each delimiter.
      var reDelimiters = RegExp(
        (options.escape || reNoMatch).source + '|' +
        interpolate.source + '|' +
        (interpolate === reInterpolate ? reEsTemplate : reNoMatch).source + '|' +
        (options.evaluate || reNoMatch).source + '|$'
      , 'g');

      // Use a sourceURL for easier debugging.
      // The sourceURL gets injected into the source that's eval-ed, so be careful
      // with lookup (in case of e.g. prototype pollution), and strip newlines if any.
      // A newline wouldn't be a valid sourceURL anyway, and it'd enable code injection.
      var sourceURL = '//# sourceURL=' +
        (hasOwnProperty.call(options, 'sourceURL')
          ? (options.sourceURL + '').replace(/[\r\n]/g, ' ')
          : ('lodash.templateSources[' + (++templateCounter) + ']')
        ) + '\n';

      string.replace(reDelimiters, function(match, escapeValue, interpolateValue, esTemplateValue, evaluateValue, offset) {
        interpolateValue || (interpolateValue = esTemplateValue);

        // Escape characters that can't be included in string literals.
        source += string.slice(index, offset).replace(reUnescapedString, escapeStringChar);

        // Replace delimiters with snippets.
        if (escapeValue) {
          isEscaping = true;
          source += "' +\n__e(" + escapeValue + ") +\n'";
        }
        if (evaluateValue) {
          isEvaluating = true;
          source += "';\n" + evaluateValue + ";\n__p += '";
        }
        if (interpolateValue) {
          source += "' +\n((__t = (" + interpolateValue + ")) == null ? '' : __t) +\n'";
        }
        index = offset + match.length;

        // The JS engine embedded in Adobe products needs `match` returned in
        // order to produce the correct `offset` value.
        return match;
      });

      source += "';\n";

      // If `variable` is not specified wrap a with-statement around the generated
      // code to add the data object to the top of the scope chain.
      // Like with sourceURL, we take care to not check the option's prototype,
      // as this configuration is a code injection vector.
      var variable = hasOwnProperty.call(options, 'variable') && options.variable;
      if (!variable) {
        source = 'with (obj) {\n' + source + '\n}\n';
      }
      // Cleanup code by stripping empty strings.
      source = (isEvaluating ? source.replace(reEmptyStringLeading, '') : source)
        .replace(reEmptyStringMiddle, '$1')
        .replace(reEmptyStringTrailing, '$1;');

      // Frame code as the function body.
      source = 'function(' + (variable || 'obj') + ') {\n' +
        (variable
          ? ''
          : 'obj || (obj = {});\n'
        ) +
        "var __t, __p = ''" +
        (isEscaping
           ? ', __e = _.escape'
           : ''
        ) +
        (isEvaluating
          ? ', __j = Array.prototype.join;\n' +
            "function print() { __p += __j.call(arguments, '') }\n"
          : ';\n'
        ) +
        source +
        'return __p\n}';

      var result = attempt(function() {
        return Function(importsKeys, sourceURL + 'return ' + source)
          .apply(undefined, importsValues);
      });

      // Provide the compiled function's source by its `toString` method or
      // the `source` property as a convenience for inlining compiled templates.
      result.source = source;
      if (isError(result)) {
        throw result;
      }
      return result;
    }

    /**
     * Converts `string`, as a whole, to lower case just like
     * [String#toLowerCase](https://mdn.io/toLowerCase).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the lower cased string.
     * @example
     *
     * _.toLower('--Foo-Bar--');
     * // => '--foo-bar--'
     *
     * _.toLower('fooBar');
     * // => 'foobar'
     *
     * _.toLower('__FOO_BAR__');
     * // => '__foo_bar__'
     */
    function toLower(value) {
      return toString(value).toLowerCase();
    }

    /**
     * Converts `string`, as a whole, to upper case just like
     * [String#toUpperCase](https://mdn.io/toUpperCase).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the upper cased string.
     * @example
     *
     * _.toUpper('--foo-bar--');
     * // => '--FOO-BAR--'
     *
     * _.toUpper('fooBar');
     * // => 'FOOBAR'
     *
     * _.toUpper('__foo_bar__');
     * // => '__FOO_BAR__'
     */
    function toUpper(value) {
      return toString(value).toUpperCase();
    }

    /**
     * Removes leading and trailing whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trim('  abc  ');
     * // => 'abc'
     *
     * _.trim('-_-abc-_-', '_-');
     * // => 'abc'
     *
     * _.map(['  foo  ', '  bar  '], _.trim);
     * // => ['foo', 'bar']
     */
    function trim(string, chars, guard) {
      string = toString(string);
      if (string && (guard || chars === undefined)) {
        return string.replace(reTrim, '');
      }
      if (!string || !(chars = baseToString(chars))) {
        return string;
      }
      var strSymbols = stringToArray(string),
          chrSymbols = stringToArray(chars),
          start = charsStartIndex(strSymbols, chrSymbols),
          end = charsEndIndex(strSymbols, chrSymbols) + 1;

      return castSlice(strSymbols, start, end).join('');
    }

    /**
     * Removes trailing whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trimEnd('  abc  ');
     * // => '  abc'
     *
     * _.trimEnd('-_-abc-_-', '_-');
     * // => '-_-abc'
     */
    function trimEnd(string, chars, guard) {
      string = toString(string);
      if (string && (guard || chars === undefined)) {
        return string.replace(reTrimEnd, '');
      }
      if (!string || !(chars = baseToString(chars))) {
        return string;
      }
      var strSymbols = stringToArray(string),
          end = charsEndIndex(strSymbols, stringToArray(chars)) + 1;

      return castSlice(strSymbols, 0, end).join('');
    }

    /**
     * Removes leading whitespace or specified characters from `string`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to trim.
     * @param {string} [chars=whitespace] The characters to trim.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {string} Returns the trimmed string.
     * @example
     *
     * _.trimStart('  abc  ');
     * // => 'abc  '
     *
     * _.trimStart('-_-abc-_-', '_-');
     * // => 'abc-_-'
     */
    function trimStart(string, chars, guard) {
      string = toString(string);
      if (string && (guard || chars === undefined)) {
        return string.replace(reTrimStart, '');
      }
      if (!string || !(chars = baseToString(chars))) {
        return string;
      }
      var strSymbols = stringToArray(string),
          start = charsStartIndex(strSymbols, stringToArray(chars));

      return castSlice(strSymbols, start).join('');
    }

    /**
     * Truncates `string` if it's longer than the given maximum string length.
     * The last characters of the truncated string are replaced with the omission
     * string which defaults to "...".
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to truncate.
     * @param {Object} [options={}] The options object.
     * @param {number} [options.length=30] The maximum string length.
     * @param {string} [options.omission='...'] The string to indicate text is omitted.
     * @param {RegExp|string} [options.separator] The separator pattern to truncate to.
     * @returns {string} Returns the truncated string.
     * @example
     *
     * _.truncate('hi-diddly-ho there, neighborino');
     * // => 'hi-diddly-ho there, neighbo...'
     *
     * _.truncate('hi-diddly-ho there, neighborino', {
     *   'length': 24,
     *   'separator': ' '
     * });
     * // => 'hi-diddly-ho there,...'
     *
     * _.truncate('hi-diddly-ho there, neighborino', {
     *   'length': 24,
     *   'separator': /,? +/
     * });
     * // => 'hi-diddly-ho there...'
     *
     * _.truncate('hi-diddly-ho there, neighborino', {
     *   'omission': ' [...]'
     * });
     * // => 'hi-diddly-ho there, neig [...]'
     */
    function truncate(string, options) {
      var length = DEFAULT_TRUNC_LENGTH,
          omission = DEFAULT_TRUNC_OMISSION;

      if (isObject(options)) {
        var separator = 'separator' in options ? options.separator : separator;
        length = 'length' in options ? toInteger(options.length) : length;
        omission = 'omission' in options ? baseToString(options.omission) : omission;
      }
      string = toString(string);

      var strLength = string.length;
      if (hasUnicode(string)) {
        var strSymbols = stringToArray(string);
        strLength = strSymbols.length;
      }
      if (length >= strLength) {
        return string;
      }
      var end = length - stringSize(omission);
      if (end < 1) {
        return omission;
      }
      var result = strSymbols
        ? castSlice(strSymbols, 0, end).join('')
        : string.slice(0, end);

      if (separator === undefined) {
        return result + omission;
      }
      if (strSymbols) {
        end += (result.length - end);
      }
      if (isRegExp(separator)) {
        if (string.slice(end).search(separator)) {
          var match,
              substring = result;

          if (!separator.global) {
            separator = RegExp(separator.source, toString(reFlags.exec(separator)) + 'g');
          }
          separator.lastIndex = 0;
          while ((match = separator.exec(substring))) {
            var newEnd = match.index;
          }
          result = result.slice(0, newEnd === undefined ? end : newEnd);
        }
      } else if (string.indexOf(baseToString(separator), end) != end) {
        var index = result.lastIndexOf(separator);
        if (index > -1) {
          result = result.slice(0, index);
        }
      }
      return result + omission;
    }

    /**
     * The inverse of `_.escape`; this method converts the HTML entities
     * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to
     * their corresponding characters.
     *
     * **Note:** No other HTML entities are unescaped. To unescape additional
     * HTML entities use a third-party library like [_he_](https://mths.be/he).
     *
     * @static
     * @memberOf _
     * @since 0.6.0
     * @category String
     * @param {string} [string=''] The string to unescape.
     * @returns {string} Returns the unescaped string.
     * @example
     *
     * _.unescape('fred, barney, &amp; pebbles');
     * // => 'fred, barney, & pebbles'
     */
    function unescape(string) {
      string = toString(string);
      return (string && reHasEscapedHtml.test(string))
        ? string.replace(reEscapedHtml, unescapeHtmlChar)
        : string;
    }

    /**
     * Converts `string`, as space separated words, to upper case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the upper cased string.
     * @example
     *
     * _.upperCase('--foo-bar');
     * // => 'FOO BAR'
     *
     * _.upperCase('fooBar');
     * // => 'FOO BAR'
     *
     * _.upperCase('__foo_bar__');
     * // => 'FOO BAR'
     */
    var upperCase = createCompounder(function(result, word, index) {
      return result + (index ? ' ' : '') + word.toUpperCase();
    });

    /**
     * Converts the first character of `string` to upper case.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category String
     * @param {string} [string=''] The string to convert.
     * @returns {string} Returns the converted string.
     * @example
     *
     * _.upperFirst('fred');
     * // => 'Fred'
     *
     * _.upperFirst('FRED');
     * // => 'FRED'
     */
    var upperFirst = createCaseFirst('toUpperCase');

    /**
     * Splits `string` into an array of its words.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category String
     * @param {string} [string=''] The string to inspect.
     * @param {RegExp|string} [pattern] The pattern to match words.
     * @param- {Object} [guard] Enables use as an iteratee for methods like `_.map`.
     * @returns {Array} Returns the words of `string`.
     * @example
     *
     * _.words('fred, barney, & pebbles');
     * // => ['fred', 'barney', 'pebbles']
     *
     * _.words('fred, barney, & pebbles', /[^, ]+/g);
     * // => ['fred', 'barney', '&', 'pebbles']
     */
    function words(string, pattern, guard) {
      string = toString(string);
      pattern = guard ? undefined : pattern;

      if (pattern === undefined) {
        return hasUnicodeWord(string) ? unicodeWords(string) : asciiWords(string);
      }
      return string.match(pattern) || [];
    }

    /*------------------------------------------------------------------------*/

    /**
     * Attempts to invoke `func`, returning either the result or the caught error
     * object. Any additional arguments are provided to `func` when it's invoked.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {Function} func The function to attempt.
     * @param {...*} [args] The arguments to invoke `func` with.
     * @returns {*} Returns the `func` result or error object.
     * @example
     *
     * // Avoid throwing errors for invalid selectors.
     * var elements = _.attempt(function(selector) {
     *   return document.querySelectorAll(selector);
     * }, '>_>');
     *
     * if (_.isError(elements)) {
     *   elements = [];
     * }
     */
    var attempt = baseRest(function(func, args) {
      try {
        return apply(func, undefined, args);
      } catch (e) {
        return isError(e) ? e : new Error(e);
      }
    });

    /**
     * Binds methods of an object to the object itself, overwriting the existing
     * method.
     *
     * **Note:** This method doesn't set the "length" property of bound functions.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {Object} object The object to bind and assign the bound methods to.
     * @param {...(string|string[])} methodNames The object method names to bind.
     * @returns {Object} Returns `object`.
     * @example
     *
     * var view = {
     *   'label': 'docs',
     *   'click': function() {
     *     console.log('clicked ' + this.label);
     *   }
     * };
     *
     * _.bindAll(view, ['click']);
     * jQuery(element).on('click', view.click);
     * // => Logs 'clicked docs' when clicked.
     */
    var bindAll = flatRest(function(object, methodNames) {
      arrayEach(methodNames, function(key) {
        key = toKey(key);
        baseAssignValue(object, key, bind(object[key], object));
      });
      return object;
    });

    /**
     * Creates a function that iterates over `pairs` and invokes the corresponding
     * function of the first predicate to return truthy. The predicate-function
     * pairs are invoked with the `this` binding and arguments of the created
     * function.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {Array} pairs The predicate-function pairs.
     * @returns {Function} Returns the new composite function.
     * @example
     *
     * var func = _.cond([
     *   [_.matches({ 'a': 1 }),           _.constant('matches A')],
     *   [_.conforms({ 'b': _.isNumber }), _.constant('matches B')],
     *   [_.stubTrue,                      _.constant('no match')]
     * ]);
     *
     * func({ 'a': 1, 'b': 2 });
     * // => 'matches A'
     *
     * func({ 'a': 0, 'b': 1 });
     * // => 'matches B'
     *
     * func({ 'a': '1', 'b': '2' });
     * // => 'no match'
     */
    function cond(pairs) {
      var length = pairs == null ? 0 : pairs.length,
          toIteratee = getIteratee();

      pairs = !length ? [] : arrayMap(pairs, function(pair) {
        if (typeof pair[1] != 'function') {
          throw new TypeError(FUNC_ERROR_TEXT);
        }
        return [toIteratee(pair[0]), pair[1]];
      });

      return baseRest(function(args) {
        var index = -1;
        while (++index < length) {
          var pair = pairs[index];
          if (apply(pair[0], this, args)) {
            return apply(pair[1], this, args);
          }
        }
      });
    }

    /**
     * Creates a function that invokes the predicate properties of `source` with
     * the corresponding property values of a given object, returning `true` if
     * all predicates return truthy, else `false`.
     *
     * **Note:** The created function is equivalent to `_.conformsTo` with
     * `source` partially applied.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {Object} source The object of property predicates to conform to.
     * @returns {Function} Returns the new spec function.
     * @example
     *
     * var objects = [
     *   { 'a': 2, 'b': 1 },
     *   { 'a': 1, 'b': 2 }
     * ];
     *
     * _.filter(objects, _.conforms({ 'b': function(n) { return n > 1; } }));
     * // => [{ 'a': 1, 'b': 2 }]
     */
    function conforms(source) {
      return baseConforms(baseClone(source, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that returns `value`.
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Util
     * @param {*} value The value to return from the new function.
     * @returns {Function} Returns the new constant function.
     * @example
     *
     * var objects = _.times(2, _.constant({ 'a': 1 }));
     *
     * console.log(objects);
     * // => [{ 'a': 1 }, { 'a': 1 }]
     *
     * console.log(objects[0] === objects[1]);
     * // => true
     */
    function constant(value) {
      return function() {
        return value;
      };
    }

    /**
     * Checks `value` to determine whether a default value should be returned in
     * its place. The `defaultValue` is returned if `value` is `NaN`, `null`,
     * or `undefined`.
     *
     * @static
     * @memberOf _
     * @since 4.14.0
     * @category Util
     * @param {*} value The value to check.
     * @param {*} defaultValue The default value.
     * @returns {*} Returns the resolved value.
     * @example
     *
     * _.defaultTo(1, 10);
     * // => 1
     *
     * _.defaultTo(undefined, 10);
     * // => 10
     */
    function defaultTo(value, defaultValue) {
      return (value == null || value !== value) ? defaultValue : value;
    }

    /**
     * Creates a function that returns the result of invoking the given functions
     * with the `this` binding of the created function, where each successive
     * invocation is supplied the return value of the previous.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {...(Function|Function[])} [funcs] The functions to invoke.
     * @returns {Function} Returns the new composite function.
     * @see _.flowRight
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var addSquare = _.flow([_.add, square]);
     * addSquare(1, 2);
     * // => 9
     */
    var flow = createFlow();

    /**
     * This method is like `_.flow` except that it creates a function that
     * invokes the given functions from right to left.
     *
     * @static
     * @since 3.0.0
     * @memberOf _
     * @category Util
     * @param {...(Function|Function[])} [funcs] The functions to invoke.
     * @returns {Function} Returns the new composite function.
     * @see _.flow
     * @example
     *
     * function square(n) {
     *   return n * n;
     * }
     *
     * var addSquare = _.flowRight([square, _.add]);
     * addSquare(1, 2);
     * // => 9
     */
    var flowRight = createFlow(true);

    /**
     * This method returns the first argument it receives.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {*} value Any value.
     * @returns {*} Returns `value`.
     * @example
     *
     * var object = { 'a': 1 };
     *
     * console.log(_.identity(object) === object);
     * // => true
     */
    function identity(value) {
      return value;
    }

    /**
     * Creates a function that invokes `func` with the arguments of the created
     * function. If `func` is a property name, the created function returns the
     * property value for a given element. If `func` is an array or object, the
     * created function returns `true` for elements that contain the equivalent
     * source properties, otherwise it returns `false`.
     *
     * @static
     * @since 4.0.0
     * @memberOf _
     * @category Util
     * @param {*} [func=_.identity] The value to convert to a callback.
     * @returns {Function} Returns the callback.
     * @example
     *
     * var users = [
     *   { 'user': 'barney', 'age': 36, 'active': true },
     *   { 'user': 'fred',   'age': 40, 'active': false }
     * ];
     *
     * // The `_.matches` iteratee shorthand.
     * _.filter(users, _.iteratee({ 'user': 'barney', 'active': true }));
     * // => [{ 'user': 'barney', 'age': 36, 'active': true }]
     *
     * // The `_.matchesProperty` iteratee shorthand.
     * _.filter(users, _.iteratee(['user', 'fred']));
     * // => [{ 'user': 'fred', 'age': 40 }]
     *
     * // The `_.property` iteratee shorthand.
     * _.map(users, _.iteratee('user'));
     * // => ['barney', 'fred']
     *
     * // Create custom iteratee shorthands.
     * _.iteratee = _.wrap(_.iteratee, function(iteratee, func) {
     *   return !_.isRegExp(func) ? iteratee(func) : function(string) {
     *     return func.test(string);
     *   };
     * });
     *
     * _.filter(['abc', 'def'], /ef/);
     * // => ['def']
     */
    function iteratee(func) {
      return baseIteratee(typeof func == 'function' ? func : baseClone(func, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that performs a partial deep comparison between a given
     * object and `source`, returning `true` if the given object has equivalent
     * property values, else `false`.
     *
     * **Note:** The created function is equivalent to `_.isMatch` with `source`
     * partially applied.
     *
     * Partial comparisons will match empty array and empty object `source`
     * values against any array or object value, respectively. See `_.isEqual`
     * for a list of supported value comparisons.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {Object} source The object of property values to match.
     * @returns {Function} Returns the new spec function.
     * @example
     *
     * var objects = [
     *   { 'a': 1, 'b': 2, 'c': 3 },
     *   { 'a': 4, 'b': 5, 'c': 6 }
     * ];
     *
     * _.filter(objects, _.matches({ 'a': 4, 'c': 6 }));
     * // => [{ 'a': 4, 'b': 5, 'c': 6 }]
     */
    function matches(source) {
      return baseMatches(baseClone(source, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that performs a partial deep comparison between the
     * value at `path` of a given object to `srcValue`, returning `true` if the
     * object value is equivalent, else `false`.
     *
     * **Note:** Partial comparisons will match empty array and empty object
     * `srcValue` values against any array or object value, respectively. See
     * `_.isEqual` for a list of supported value comparisons.
     *
     * @static
     * @memberOf _
     * @since 3.2.0
     * @category Util
     * @param {Array|string} path The path of the property to get.
     * @param {*} srcValue The value to match.
     * @returns {Function} Returns the new spec function.
     * @example
     *
     * var objects = [
     *   { 'a': 1, 'b': 2, 'c': 3 },
     *   { 'a': 4, 'b': 5, 'c': 6 }
     * ];
     *
     * _.find(objects, _.matchesProperty('a', 4));
     * // => { 'a': 4, 'b': 5, 'c': 6 }
     */
    function matchesProperty(path, srcValue) {
      return baseMatchesProperty(path, baseClone(srcValue, CLONE_DEEP_FLAG));
    }

    /**
     * Creates a function that invokes the method at `path` of a given object.
     * Any additional arguments are provided to the invoked method.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Util
     * @param {Array|string} path The path of the method to invoke.
     * @param {...*} [args] The arguments to invoke the method with.
     * @returns {Function} Returns the new invoker function.
     * @example
     *
     * var objects = [
     *   { 'a': { 'b': _.constant(2) } },
     *   { 'a': { 'b': _.constant(1) } }
     * ];
     *
     * _.map(objects, _.method('a.b'));
     * // => [2, 1]
     *
     * _.map(objects, _.method(['a', 'b']));
     * // => [2, 1]
     */
    var method = baseRest(function(path, args) {
      return function(object) {
        return baseInvoke(object, path, args);
      };
    });

    /**
     * The opposite of `_.method`; this method creates a function that invokes
     * the method at a given path of `object`. Any additional arguments are
     * provided to the invoked method.
     *
     * @static
     * @memberOf _
     * @since 3.7.0
     * @category Util
     * @param {Object} object The object to query.
     * @param {...*} [args] The arguments to invoke the method with.
     * @returns {Function} Returns the new invoker function.
     * @example
     *
     * var array = _.times(3, _.constant),
     *     object = { 'a': array, 'b': array, 'c': array };
     *
     * _.map(['a[2]', 'c[0]'], _.methodOf(object));
     * // => [2, 0]
     *
     * _.map([['a', '2'], ['c', '0']], _.methodOf(object));
     * // => [2, 0]
     */
    var methodOf = baseRest(function(object, args) {
      return function(path) {
        return baseInvoke(object, path, args);
      };
    });

    /**
     * Adds all own enumerable string keyed function properties of a source
     * object to the destination object. If `object` is a function, then methods
     * are added to its prototype as well.
     *
     * **Note:** Use `_.runInContext` to create a pristine `lodash` function to
     * avoid conflicts caused by modifying the original.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {Function|Object} [object=lodash] The destination object.
     * @param {Object} source The object of functions to add.
     * @param {Object} [options={}] The options object.
     * @param {boolean} [options.chain=true] Specify whether mixins are chainable.
     * @returns {Function|Object} Returns `object`.
     * @example
     *
     * function vowels(string) {
     *   return _.filter(string, function(v) {
     *     return /[aeiou]/i.test(v);
     *   });
     * }
     *
     * _.mixin({ 'vowels': vowels });
     * _.vowels('fred');
     * // => ['e']
     *
     * _('fred').vowels().value();
     * // => ['e']
     *
     * _.mixin({ 'vowels': vowels }, { 'chain': false });
     * _('fred').vowels();
     * // => ['e']
     */
    function mixin(object, source, options) {
      var props = keys(source),
          methodNames = baseFunctions(source, props);

      if (options == null &&
          !(isObject(source) && (methodNames.length || !props.length))) {
        options = source;
        source = object;
        object = this;
        methodNames = baseFunctions(source, keys(source));
      }
      var chain = !(isObject(options) && 'chain' in options) || !!options.chain,
          isFunc = isFunction(object);

      arrayEach(methodNames, function(methodName) {
        var func = source[methodName];
        object[methodName] = func;
        if (isFunc) {
          object.prototype[methodName] = function() {
            var chainAll = this.__chain__;
            if (chain || chainAll) {
              var result = object(this.__wrapped__),
                  actions = result.__actions__ = copyArray(this.__actions__);

              actions.push({ 'func': func, 'args': arguments, 'thisArg': object });
              result.__chain__ = chainAll;
              return result;
            }
            return func.apply(object, arrayPush([this.value()], arguments));
          };
        }
      });

      return object;
    }

    /**
     * Reverts the `_` variable to its previous value and returns a reference to
     * the `lodash` function.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @returns {Function} Returns the `lodash` function.
     * @example
     *
     * var lodash = _.noConflict();
     */
    function noConflict() {
      if (root._ === this) {
        root._ = oldDash;
      }
      return this;
    }

    /**
     * This method returns `undefined`.
     *
     * @static
     * @memberOf _
     * @since 2.3.0
     * @category Util
     * @example
     *
     * _.times(2, _.noop);
     * // => [undefined, undefined]
     */
    function noop() {
      // No operation performed.
    }

    /**
     * Creates a function that gets the argument at index `n`. If `n` is negative,
     * the nth argument from the end is returned.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {number} [n=0] The index of the argument to return.
     * @returns {Function} Returns the new pass-thru function.
     * @example
     *
     * var func = _.nthArg(1);
     * func('a', 'b', 'c', 'd');
     * // => 'b'
     *
     * var func = _.nthArg(-2);
     * func('a', 'b', 'c', 'd');
     * // => 'c'
     */
    function nthArg(n) {
      n = toInteger(n);
      return baseRest(function(args) {
        return baseNth(args, n);
      });
    }

    /**
     * Creates a function that invokes `iteratees` with the arguments it receives
     * and returns their results.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {...(Function|Function[])} [iteratees=[_.identity]]
     *  The iteratees to invoke.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var func = _.over([Math.max, Math.min]);
     *
     * func(1, 2, 3, 4);
     * // => [4, 1]
     */
    var over = createOver(arrayMap);

    /**
     * Creates a function that checks if **all** of the `predicates` return
     * truthy when invoked with the arguments it receives.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {...(Function|Function[])} [predicates=[_.identity]]
     *  The predicates to check.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var func = _.overEvery([Boolean, isFinite]);
     *
     * func('1');
     * // => true
     *
     * func(null);
     * // => false
     *
     * func(NaN);
     * // => false
     */
    var overEvery = createOver(arrayEvery);

    /**
     * Creates a function that checks if **any** of the `predicates` return
     * truthy when invoked with the arguments it receives.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {...(Function|Function[])} [predicates=[_.identity]]
     *  The predicates to check.
     * @returns {Function} Returns the new function.
     * @example
     *
     * var func = _.overSome([Boolean, isFinite]);
     *
     * func('1');
     * // => true
     *
     * func(null);
     * // => true
     *
     * func(NaN);
     * // => false
     */
    var overSome = createOver(arraySome);

    /**
     * Creates a function that returns the value at `path` of a given object.
     *
     * @static
     * @memberOf _
     * @since 2.4.0
     * @category Util
     * @param {Array|string} path The path of the property to get.
     * @returns {Function} Returns the new accessor function.
     * @example
     *
     * var objects = [
     *   { 'a': { 'b': 2 } },
     *   { 'a': { 'b': 1 } }
     * ];
     *
     * _.map(objects, _.property('a.b'));
     * // => [2, 1]
     *
     * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');
     * // => [1, 2]
     */
    function property(path) {
      return isKey(path) ? baseProperty(toKey(path)) : basePropertyDeep(path);
    }

    /**
     * The opposite of `_.property`; this method creates a function that returns
     * the value at a given path of `object`.
     *
     * @static
     * @memberOf _
     * @since 3.0.0
     * @category Util
     * @param {Object} object The object to query.
     * @returns {Function} Returns the new accessor function.
     * @example
     *
     * var array = [0, 1, 2],
     *     object = { 'a': array, 'b': array, 'c': array };
     *
     * _.map(['a[2]', 'c[0]'], _.propertyOf(object));
     * // => [2, 0]
     *
     * _.map([['a', '2'], ['c', '0']], _.propertyOf(object));
     * // => [2, 0]
     */
    function propertyOf(object) {
      return function(path) {
        return object == null ? undefined : baseGet(object, path);
      };
    }

    /**
     * Creates an array of numbers (positive and/or negative) progressing from
     * `start` up to, but not including, `end`. A step of `-1` is used if a negative
     * `start` is specified without an `end` or `step`. If `end` is not specified,
     * it's set to `start` with `start` then set to `0`.
     *
     * **Note:** JavaScript follows the IEEE-754 standard for resolving
     * floating-point values which can produce unexpected results.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @param {number} [step=1] The value to increment or decrement by.
     * @returns {Array} Returns the range of numbers.
     * @see _.inRange, _.rangeRight
     * @example
     *
     * _.range(4);
     * // => [0, 1, 2, 3]
     *
     * _.range(-4);
     * // => [0, -1, -2, -3]
     *
     * _.range(1, 5);
     * // => [1, 2, 3, 4]
     *
     * _.range(0, 20, 5);
     * // => [0, 5, 10, 15]
     *
     * _.range(0, -4, -1);
     * // => [0, -1, -2, -3]
     *
     * _.range(1, 4, 0);
     * // => [1, 1, 1]
     *
     * _.range(0);
     * // => []
     */
    var range = createRange();

    /**
     * This method is like `_.range` except that it populates values in
     * descending order.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {number} [start=0] The start of the range.
     * @param {number} end The end of the range.
     * @param {number} [step=1] The value to increment or decrement by.
     * @returns {Array} Returns the range of numbers.
     * @see _.inRange, _.range
     * @example
     *
     * _.rangeRight(4);
     * // => [3, 2, 1, 0]
     *
     * _.rangeRight(-4);
     * // => [-3, -2, -1, 0]
     *
     * _.rangeRight(1, 5);
     * // => [4, 3, 2, 1]
     *
     * _.rangeRight(0, 20, 5);
     * // => [15, 10, 5, 0]
     *
     * _.rangeRight(0, -4, -1);
     * // => [-3, -2, -1, 0]
     *
     * _.rangeRight(1, 4, 0);
     * // => [1, 1, 1]
     *
     * _.rangeRight(0);
     * // => []
     */
    var rangeRight = createRange(true);

    /**
     * This method returns a new empty array.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {Array} Returns the new empty array.
     * @example
     *
     * var arrays = _.times(2, _.stubArray);
     *
     * console.log(arrays);
     * // => [[], []]
     *
     * console.log(arrays[0] === arrays[1]);
     * // => false
     */
    function stubArray() {
      return [];
    }

    /**
     * This method returns `false`.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {boolean} Returns `false`.
     * @example
     *
     * _.times(2, _.stubFalse);
     * // => [false, false]
     */
    function stubFalse() {
      return false;
    }

    /**
     * This method returns a new empty object.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {Object} Returns the new empty object.
     * @example
     *
     * var objects = _.times(2, _.stubObject);
     *
     * console.log(objects);
     * // => [{}, {}]
     *
     * console.log(objects[0] === objects[1]);
     * // => false
     */
    function stubObject() {
      return {};
    }

    /**
     * This method returns an empty string.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {string} Returns the empty string.
     * @example
     *
     * _.times(2, _.stubString);
     * // => ['', '']
     */
    function stubString() {
      return '';
    }

    /**
     * This method returns `true`.
     *
     * @static
     * @memberOf _
     * @since 4.13.0
     * @category Util
     * @returns {boolean} Returns `true`.
     * @example
     *
     * _.times(2, _.stubTrue);
     * // => [true, true]
     */
    function stubTrue() {
      return true;
    }

    /**
     * Invokes the iteratee `n` times, returning an array of the results of
     * each invocation. The iteratee is invoked with one argument; (index).
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {number} n The number of times to invoke `iteratee`.
     * @param {Function} [iteratee=_.identity] The function invoked per iteration.
     * @returns {Array} Returns the array of results.
     * @example
     *
     * _.times(3, String);
     * // => ['0', '1', '2']
     *
     *  _.times(4, _.constant(0));
     * // => [0, 0, 0, 0]
     */
    function times(n, iteratee) {
      n = toInteger(n);
      if (n < 1 || n > MAX_SAFE_INTEGER) {
        return [];
      }
      var index = MAX_ARRAY_LENGTH,
          length = nativeMin(n, MAX_ARRAY_LENGTH);

      iteratee = getIteratee(iteratee);
      n -= MAX_ARRAY_LENGTH;

      var result = baseTimes(length, iteratee);
      while (++index < n) {
        iteratee(index);
      }
      return result;
    }

    /**
     * Converts `value` to a property path array.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Util
     * @param {*} value The value to convert.
     * @returns {Array} Returns the new property path array.
     * @example
     *
     * _.toPath('a.b.c');
     * // => ['a', 'b', 'c']
     *
     * _.toPath('a[0].b.c');
     * // => ['a', '0', 'b', 'c']
     */
    function toPath(value) {
      if (isArray(value)) {
        return arrayMap(value, toKey);
      }
      return isSymbol(value) ? [value] : copyArray(stringToPath(toString(value)));
    }

    /**
     * Generates a unique ID. If `prefix` is given, the ID is appended to it.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Util
     * @param {string} [prefix=''] The value to prefix the ID with.
     * @returns {string} Returns the unique ID.
     * @example
     *
     * _.uniqueId('contact_');
     * // => 'contact_104'
     *
     * _.uniqueId();
     * // => '105'
     */
    function uniqueId(prefix) {
      var id = ++idCounter;
      return toString(prefix) + id;
    }

    /*------------------------------------------------------------------------*/

    /**
     * Adds two numbers.
     *
     * @static
     * @memberOf _
     * @since 3.4.0
     * @category Math
     * @param {number} augend The first number in an addition.
     * @param {number} addend The second number in an addition.
     * @returns {number} Returns the total.
     * @example
     *
     * _.add(6, 4);
     * // => 10
     */
    var add = createMathOperation(function(augend, addend) {
      return augend + addend;
    }, 0);

    /**
     * Computes `number` rounded up to `precision`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Math
     * @param {number} number The number to round up.
     * @param {number} [precision=0] The precision to round up to.
     * @returns {number} Returns the rounded up number.
     * @example
     *
     * _.ceil(4.006);
     * // => 5
     *
     * _.ceil(6.004, 2);
     * // => 6.01
     *
     * _.ceil(6040, -2);
     * // => 6100
     */
    var ceil = createRound('ceil');

    /**
     * Divide two numbers.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Math
     * @param {number} dividend The first number in a division.
     * @param {number} divisor The second number in a division.
     * @returns {number} Returns the quotient.
     * @example
     *
     * _.divide(6, 4);
     * // => 1.5
     */
    var divide = createMathOperation(function(dividend, divisor) {
      return dividend / divisor;
    }, 1);

    /**
     * Computes `number` rounded down to `precision`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Math
     * @param {number} number The number to round down.
     * @param {number} [precision=0] The precision to round down to.
     * @returns {number} Returns the rounded down number.
     * @example
     *
     * _.floor(4.006);
     * // => 4
     *
     * _.floor(0.046, 2);
     * // => 0.04
     *
     * _.floor(4060, -2);
     * // => 4000
     */
    var floor = createRound('floor');

    /**
     * Computes the maximum value of `array`. If `array` is empty or falsey,
     * `undefined` is returned.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {*} Returns the maximum value.
     * @example
     *
     * _.max([4, 2, 8, 6]);
     * // => 8
     *
     * _.max([]);
     * // => undefined
     */
    function max(array) {
      return (array && array.length)
        ? baseExtremum(array, identity, baseGt)
        : undefined;
    }

    /**
     * This method is like `_.max` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the criterion by which
     * the value is ranked. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {*} Returns the maximum value.
     * @example
     *
     * var objects = [{ 'n': 1 }, { 'n': 2 }];
     *
     * _.maxBy(objects, function(o) { return o.n; });
     * // => { 'n': 2 }
     *
     * // The `_.property` iteratee shorthand.
     * _.maxBy(objects, 'n');
     * // => { 'n': 2 }
     */
    function maxBy(array, iteratee) {
      return (array && array.length)
        ? baseExtremum(array, getIteratee(iteratee, 2), baseGt)
        : undefined;
    }

    /**
     * Computes the mean of the values in `array`.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {number} Returns the mean.
     * @example
     *
     * _.mean([4, 2, 8, 6]);
     * // => 5
     */
    function mean(array) {
      return baseMean(array, identity);
    }

    /**
     * This method is like `_.mean` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the value to be averaged.
     * The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the mean.
     * @example
     *
     * var objects = [{ 'n': 4 }, { 'n': 2 }, { 'n': 8 }, { 'n': 6 }];
     *
     * _.meanBy(objects, function(o) { return o.n; });
     * // => 5
     *
     * // The `_.property` iteratee shorthand.
     * _.meanBy(objects, 'n');
     * // => 5
     */
    function meanBy(array, iteratee) {
      return baseMean(array, getIteratee(iteratee, 2));
    }

    /**
     * Computes the minimum value of `array`. If `array` is empty or falsey,
     * `undefined` is returned.
     *
     * @static
     * @since 0.1.0
     * @memberOf _
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {*} Returns the minimum value.
     * @example
     *
     * _.min([4, 2, 8, 6]);
     * // => 2
     *
     * _.min([]);
     * // => undefined
     */
    function min(array) {
      return (array && array.length)
        ? baseExtremum(array, identity, baseLt)
        : undefined;
    }

    /**
     * This method is like `_.min` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the criterion by which
     * the value is ranked. The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {*} Returns the minimum value.
     * @example
     *
     * var objects = [{ 'n': 1 }, { 'n': 2 }];
     *
     * _.minBy(objects, function(o) { return o.n; });
     * // => { 'n': 1 }
     *
     * // The `_.property` iteratee shorthand.
     * _.minBy(objects, 'n');
     * // => { 'n': 1 }
     */
    function minBy(array, iteratee) {
      return (array && array.length)
        ? baseExtremum(array, getIteratee(iteratee, 2), baseLt)
        : undefined;
    }

    /**
     * Multiply two numbers.
     *
     * @static
     * @memberOf _
     * @since 4.7.0
     * @category Math
     * @param {number} multiplier The first number in a multiplication.
     * @param {number} multiplicand The second number in a multiplication.
     * @returns {number} Returns the product.
     * @example
     *
     * _.multiply(6, 4);
     * // => 24
     */
    var multiply = createMathOperation(function(multiplier, multiplicand) {
      return multiplier * multiplicand;
    }, 1);

    /**
     * Computes `number` rounded to `precision`.
     *
     * @static
     * @memberOf _
     * @since 3.10.0
     * @category Math
     * @param {number} number The number to round.
     * @param {number} [precision=0] The precision to round to.
     * @returns {number} Returns the rounded number.
     * @example
     *
     * _.round(4.006);
     * // => 4
     *
     * _.round(4.006, 2);
     * // => 4.01
     *
     * _.round(4060, -2);
     * // => 4100
     */
    var round = createRound('round');

    /**
     * Subtract two numbers.
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {number} minuend The first number in a subtraction.
     * @param {number} subtrahend The second number in a subtraction.
     * @returns {number} Returns the difference.
     * @example
     *
     * _.subtract(6, 4);
     * // => 2
     */
    var subtract = createMathOperation(function(minuend, subtrahend) {
      return minuend - subtrahend;
    }, 0);

    /**
     * Computes the sum of the values in `array`.
     *
     * @static
     * @memberOf _
     * @since 3.4.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @returns {number} Returns the sum.
     * @example
     *
     * _.sum([4, 2, 8, 6]);
     * // => 20
     */
    function sum(array) {
      return (array && array.length)
        ? baseSum(array, identity)
        : 0;
    }

    /**
     * This method is like `_.sum` except that it accepts `iteratee` which is
     * invoked for each element in `array` to generate the value to be summed.
     * The iteratee is invoked with one argument: (value).
     *
     * @static
     * @memberOf _
     * @since 4.0.0
     * @category Math
     * @param {Array} array The array to iterate over.
     * @param {Function} [iteratee=_.identity] The iteratee invoked per element.
     * @returns {number} Returns the sum.
     * @example
     *
     * var objects = [{ 'n': 4 }, { 'n': 2 }, { 'n': 8 }, { 'n': 6 }];
     *
     * _.sumBy(objects, function(o) { return o.n; });
     * // => 20
     *
     * // The `_.property` iteratee shorthand.
     * _.sumBy(objects, 'n');
     * // => 20
     */
    function sumBy(array, iteratee) {
      return (array && array.length)
        ? baseSum(array, getIteratee(iteratee, 2))
        : 0;
    }

    /*------------------------------------------------------------------------*/

    // Add methods that return wrapped values in chain sequences.
    lodash.after = after;
    lodash.ary = ary;
    lodash.assign = assign;
    lodash.assignIn = assignIn;
    lodash.assignInWith = assignInWith;
    lodash.assignWith = assignWith;
    lodash.at = at;
    lodash.before = before;
    lodash.bind = bind;
    lodash.bindAll = bindAll;
    lodash.bindKey = bindKey;
    lodash.castArray = castArray;
    lodash.chain = chain;
    lodash.chunk = chunk;
    lodash.compact = compact;
    lodash.concat = concat;
    lodash.cond = cond;
    lodash.conforms = conforms;
    lodash.constant = constant;
    lodash.countBy = countBy;
    lodash.create = create;
    lodash.curry = curry;
    lodash.curryRight = curryRight;
    lodash.debounce = debounce;
    lodash.defaults = defaults;
    lodash.defaultsDeep = defaultsDeep;
    lodash.defer = defer;
    lodash.delay = delay;
    lodash.difference = difference;
    lodash.differenceBy = differenceBy;
    lodash.differenceWith = differenceWith;
    lodash.drop = drop;
    lodash.dropRight = dropRight;
    lodash.dropRightWhile = dropRightWhile;
    lodash.dropWhile = dropWhile;
    lodash.fill = fill;
    lodash.filter = filter;
    lodash.flatMap = flatMap;
    lodash.flatMapDeep = flatMapDeep;
    lodash.flatMapDepth = flatMapDepth;
    lodash.flatten = flatten;
    lodash.flattenDeep = flattenDeep;
    lodash.flattenDepth = flattenDepth;
    lodash.flip = flip;
    lodash.flow = flow;
    lodash.flowRight = flowRight;
    lodash.fromPairs = fromPairs;
    lodash.functions = functions;
    lodash.functionsIn = functionsIn;
    lodash.groupBy = groupBy;
    lodash.initial = initial;
    lodash.intersection = intersection;
    lodash.intersectionBy = intersectionBy;
    lodash.intersectionWith = intersectionWith;
    lodash.invert = invert;
    lodash.invertBy = invertBy;
    lodash.invokeMap = invokeMap;
    lodash.iteratee = iteratee;
    lodash.keyBy = keyBy;
    lodash.keys = keys;
    lodash.keysIn = keysIn;
    lodash.map = map;
    lodash.mapKeys = mapKeys;
    lodash.mapValues = mapValues;
    lodash.matches = matches;
    lodash.matchesProperty = matchesProperty;
    lodash.memoize = memoize;
    lodash.merge = merge;
    lodash.mergeWith = mergeWith;
    lodash.method = method;
    lodash.methodOf = methodOf;
    lodash.mixin = mixin;
    lodash.negate = negate;
    lodash.nthArg = nthArg;
    lodash.omit = omit;
    lodash.omitBy = omitBy;
    lodash.once = once;
    lodash.orderBy = orderBy;
    lodash.over = over;
    lodash.overArgs = overArgs;
    lodash.overEvery = overEvery;
    lodash.overSome = overSome;
    lodash.partial = partial;
    lodash.partialRight = partialRight;
    lodash.partition = partition;
    lodash.pick = pick;
    lodash.pickBy = pickBy;
    lodash.property = property;
    lodash.propertyOf = propertyOf;
    lodash.pull = pull;
    lodash.pullAll = pullAll;
    lodash.pullAllBy = pullAllBy;
    lodash.pullAllWith = pullAllWith;
    lodash.pullAt = pullAt;
    lodash.range = range;
    lodash.rangeRight = rangeRight;
    lodash.rearg = rearg;
    lodash.reject = reject;
    lodash.remove = remove;
    lodash.rest = rest;
    lodash.reverse = reverse;
    lodash.sampleSize = sampleSize;
    lodash.set = set;
    lodash.setWith = setWith;
    lodash.shuffle = shuffle;
    lodash.slice = slice;
    lodash.sortBy = sortBy;
    lodash.sortedUniq = sortedUniq;
    lodash.sortedUniqBy = sortedUniqBy;
    lodash.split = split;
    lodash.spread = spread;
    lodash.tail = tail;
    lodash.take = take;
    lodash.takeRight = takeRight;
    lodash.takeRightWhile = takeRightWhile;
    lodash.takeWhile = takeWhile;
    lodash.tap = tap;
    lodash.throttle = throttle;
    lodash.thru = thru;
    lodash.toArray = toArray;
    lodash.toPairs = toPairs;
    lodash.toPairsIn = toPairsIn;
    lodash.toPath = toPath;
    lodash.toPlainObject = toPlainObject;
    lodash.transform = transform;
    lodash.unary = unary;
    lodash.union = union;
    lodash.unionBy = unionBy;
    lodash.unionWith = unionWith;
    lodash.uniq = uniq;
    lodash.uniqBy = uniqBy;
    lodash.uniqWith = uniqWith;
    lodash.unset = unset;
    lodash.unzip = unzip;
    lodash.unzipWith = unzipWith;
    lodash.update = update;
    lodash.updateWith = updateWith;
    lodash.values = values;
    lodash.valuesIn = valuesIn;
    lodash.without = without;
    lodash.words = words;
    lodash.wrap = wrap;
    lodash.xor = xor;
    lodash.xorBy = xorBy;
    lodash.xorWith = xorWith;
    lodash.zip = zip;
    lodash.zipObject = zipObject;
    lodash.zipObjectDeep = zipObjectDeep;
    lodash.zipWith = zipWith;

    // Add aliases.
    lodash.entries = toPairs;
    lodash.entriesIn = toPairsIn;
    lodash.extend = assignIn;
    lodash.extendWith = assignInWith;

    // Add methods to `lodash.prototype`.
    mixin(lodash, lodash);

    /*------------------------------------------------------------------------*/

    // Add methods that return unwrapped values in chain sequences.
    lodash.add = add;
    lodash.attempt = attempt;
    lodash.camelCase = camelCase;
    lodash.capitalize = capitalize;
    lodash.ceil = ceil;
    lodash.clamp = clamp;
    lodash.clone = clone;
    lodash.cloneDeep = cloneDeep;
    lodash.cloneDeepWith = cloneDeepWith;
    lodash.cloneWith = cloneWith;
    lodash.conformsTo = conformsTo;
    lodash.deburr = deburr;
    lodash.defaultTo = defaultTo;
    lodash.divide = divide;
    lodash.endsWith = endsWith;
    lodash.eq = eq;
    lodash.escape = escape;
    lodash.escapeRegExp = escapeRegExp;
    lodash.every = every;
    lodash.find = find;
    lodash.findIndex = findIndex;
    lodash.findKey = findKey;
    lodash.findLast = findLast;
    lodash.findLastIndex = findLastIndex;
    lodash.findLastKey = findLastKey;
    lodash.floor = floor;
    lodash.forEach = forEach;
    lodash.forEachRight = forEachRight;
    lodash.forIn = forIn;
    lodash.forInRight = forInRight;
    lodash.forOwn = forOwn;
    lodash.forOwnRight = forOwnRight;
    lodash.get = get;
    lodash.gt = gt;
    lodash.gte = gte;
    lodash.has = has;
    lodash.hasIn = hasIn;
    lodash.head = head;
    lodash.identity = identity;
    lodash.includes = includes;
    lodash.indexOf = indexOf;
    lodash.inRange = inRange;
    lodash.invoke = invoke;
    lodash.isArguments = isArguments;
    lodash.isArray = isArray;
    lodash.isArrayBuffer = isArrayBuffer;
    lodash.isArrayLike = isArrayLike;
    lodash.isArrayLikeObject = isArrayLikeObject;
    lodash.isBoolean = isBoolean;
    lodash.isBuffer = isBuffer;
    lodash.isDate = isDate;
    lodash.isElement = isElement;
    lodash.isEmpty = isEmpty;
    lodash.isEqual = isEqual;
    lodash.isEqualWith = isEqualWith;
    lodash.isError = isError;
    lodash.isFinite = isFinite;
    lodash.isFunction = isFunction;
    lodash.isInteger = isInteger;
    lodash.isLength = isLength;
    lodash.isMap = isMap;
    lodash.isMatch = isMatch;
    lodash.isMatchWith = isMatchWith;
    lodash.isNaN = isNaN;
    lodash.isNative = isNative;
    lodash.isNil = isNil;
    lodash.isNull = isNull;
    lodash.isNumber = isNumber;
    lodash.isObject = isObject;
    lodash.isObjectLike = isObjectLike;
    lodash.isPlainObject = isPlainObject;
    lodash.isRegExp = isRegExp;
    lodash.isSafeInteger = isSafeInteger;
    lodash.isSet = isSet;
    lodash.isString = isString;
    lodash.isSymbol = isSymbol;
    lodash.isTypedArray = isTypedArray;
    lodash.isUndefined = isUndefined;
    lodash.isWeakMap = isWeakMap;
    lodash.isWeakSet = isWeakSet;
    lodash.join = join;
    lodash.kebabCase = kebabCase;
    lodash.last = last;
    lodash.lastIndexOf = lastIndexOf;
    lodash.lowerCase = lowerCase;
    lodash.lowerFirst = lowerFirst;
    lodash.lt = lt;
    lodash.lte = lte;
    lodash.max = max;
    lodash.maxBy = maxBy;
    lodash.mean = mean;
    lodash.meanBy = meanBy;
    lodash.min = min;
    lodash.minBy = minBy;
    lodash.stubArray = stubArray;
    lodash.stubFalse = stubFalse;
    lodash.stubObject = stubObject;
    lodash.stubString = stubString;
    lodash.stubTrue = stubTrue;
    lodash.multiply = multiply;
    lodash.nth = nth;
    lodash.noConflict = noConflict;
    lodash.noop = noop;
    lodash.now = now;
    lodash.pad = pad;
    lodash.padEnd = padEnd;
    lodash.padStart = padStart;
    lodash.parseInt = parseInt;
    lodash.random = random;
    lodash.reduce = reduce;
    lodash.reduceRight = reduceRight;
    lodash.repeat = repeat;
    lodash.replace = replace;
    lodash.result = result;
    lodash.round = round;
    lodash.runInContext = runInContext;
    lodash.sample = sample;
    lodash.size = size;
    lodash.snakeCase = snakeCase;
    lodash.some = some;
    lodash.sortedIndex = sortedIndex;
    lodash.sortedIndexBy = sortedIndexBy;
    lodash.sortedIndexOf = sortedIndexOf;
    lodash.sortedLastIndex = sortedLastIndex;
    lodash.sortedLastIndexBy = sortedLastIndexBy;
    lodash.sortedLastIndexOf = sortedLastIndexOf;
    lodash.startCase = startCase;
    lodash.startsWith = startsWith;
    lodash.subtract = subtract;
    lodash.sum = sum;
    lodash.sumBy = sumBy;
    lodash.template = template;
    lodash.times = times;
    lodash.toFinite = toFinite;
    lodash.toInteger = toInteger;
    lodash.toLength = toLength;
    lodash.toLower = toLower;
    lodash.toNumber = toNumber;
    lodash.toSafeInteger = toSafeInteger;
    lodash.toString = toString;
    lodash.toUpper = toUpper;
    lodash.trim = trim;
    lodash.trimEnd = trimEnd;
    lodash.trimStart = trimStart;
    lodash.truncate = truncate;
    lodash.unescape = unescape;
    lodash.uniqueId = uniqueId;
    lodash.upperCase = upperCase;
    lodash.upperFirst = upperFirst;

    // Add aliases.
    lodash.each = forEach;
    lodash.eachRight = forEachRight;
    lodash.first = head;

    mixin(lodash, (function() {
      var source = {};
      baseForOwn(lodash, function(func, methodName) {
        if (!hasOwnProperty.call(lodash.prototype, methodName)) {
          source[methodName] = func;
        }
      });
      return source;
    }()), { 'chain': false });

    /*------------------------------------------------------------------------*/

    /**
     * The semantic version number.
     *
     * @static
     * @memberOf _
     * @type {string}
     */
    lodash.VERSION = VERSION;

    // Assign default placeholders.
    arrayEach(['bind', 'bindKey', 'curry', 'curryRight', 'partial', 'partialRight'], function(methodName) {
      lodash[methodName].placeholder = lodash;
    });

    // Add `LazyWrapper` methods for `_.drop` and `_.take` variants.
    arrayEach(['drop', 'take'], function(methodName, index) {
      LazyWrapper.prototype[methodName] = function(n) {
        n = n === undefined ? 1 : nativeMax(toInteger(n), 0);

        var result = (this.__filtered__ && !index)
          ? new LazyWrapper(this)
          : this.clone();

        if (result.__filtered__) {
          result.__takeCount__ = nativeMin(n, result.__takeCount__);
        } else {
          result.__views__.push({
            'size': nativeMin(n, MAX_ARRAY_LENGTH),
            'type': methodName + (result.__dir__ < 0 ? 'Right' : '')
          });
        }
        return result;
      };

      LazyWrapper.prototype[methodName + 'Right'] = function(n) {
        return this.reverse()[methodName](n).reverse();
      };
    });

    // Add `LazyWrapper` methods that accept an `iteratee` value.
    arrayEach(['filter', 'map', 'takeWhile'], function(methodName, index) {
      var type = index + 1,
          isFilter = type == LAZY_FILTER_FLAG || type == LAZY_WHILE_FLAG;

      LazyWrapper.prototype[methodName] = function(iteratee) {
        var result = this.clone();
        result.__iteratees__.push({
          'iteratee': getIteratee(iteratee, 3),
          'type': type
        });
        result.__filtered__ = result.__filtered__ || isFilter;
        return result;
      };
    });

    // Add `LazyWrapper` methods for `_.head` and `_.last`.
    arrayEach(['head', 'last'], function(methodName, index) {
      var takeName = 'take' + (index ? 'Right' : '');

      LazyWrapper.prototype[methodName] = function() {
        return this[takeName](1).value()[0];
      };
    });

    // Add `LazyWrapper` methods for `_.initial` and `_.tail`.
    arrayEach(['initial', 'tail'], function(methodName, index) {
      var dropName = 'drop' + (index ? '' : 'Right');

      LazyWrapper.prototype[methodName] = function() {
        return this.__filtered__ ? new LazyWrapper(this) : this[dropName](1);
      };
    });

    LazyWrapper.prototype.compact = function() {
      return this.filter(identity);
    };

    LazyWrapper.prototype.find = function(predicate) {
      return this.filter(predicate).head();
    };

    LazyWrapper.prototype.findLast = function(predicate) {
      return this.reverse().find(predicate);
    };

    LazyWrapper.prototype.invokeMap = baseRest(function(path, args) {
      if (typeof path == 'function') {
        return new LazyWrapper(this);
      }
      return this.map(function(value) {
        return baseInvoke(value, path, args);
      });
    });

    LazyWrapper.prototype.reject = function(predicate) {
      return this.filter(negate(getIteratee(predicate)));
    };

    LazyWrapper.prototype.slice = function(start, end) {
      start = toInteger(start);

      var result = this;
      if (result.__filtered__ && (start > 0 || end < 0)) {
        return new LazyWrapper(result);
      }
      if (start < 0) {
        result = result.takeRight(-start);
      } else if (start) {
        result = result.drop(start);
      }
      if (end !== undefined) {
        end = toInteger(end);
        result = end < 0 ? result.dropRight(-end) : result.take(end - start);
      }
      return result;
    };

    LazyWrapper.prototype.takeRightWhile = function(predicate) {
      return this.reverse().takeWhile(predicate).reverse();
    };

    LazyWrapper.prototype.toArray = function() {
      return this.take(MAX_ARRAY_LENGTH);
    };

    // Add `LazyWrapper` methods to `lodash.prototype`.
    baseForOwn(LazyWrapper.prototype, function(func, methodName) {
      var checkIteratee = /^(?:filter|find|map|reject)|While$/.test(methodName),
          isTaker = /^(?:head|last)$/.test(methodName),
          lodashFunc = lodash[isTaker ? ('take' + (methodName == 'last' ? 'Right' : '')) : methodName],
          retUnwrapped = isTaker || /^find/.test(methodName);

      if (!lodashFunc) {
        return;
      }
      lodash.prototype[methodName] = function() {
        var value = this.__wrapped__,
            args = isTaker ? [1] : arguments,
            isLazy = value instanceof LazyWrapper,
            iteratee = args[0],
            useLazy = isLazy || isArray(value);

        var interceptor = function(value) {
          var result = lodashFunc.apply(lodash, arrayPush([value], args));
          return (isTaker && chainAll) ? result[0] : result;
        };

        if (useLazy && checkIteratee && typeof iteratee == 'function' && iteratee.length != 1) {
          // Avoid lazy use if the iteratee has a "length" value other than `1`.
          isLazy = useLazy = false;
        }
        var chainAll = this.__chain__,
            isHybrid = !!this.__actions__.length,
            isUnwrapped = retUnwrapped && !chainAll,
            onlyLazy = isLazy && !isHybrid;

        if (!retUnwrapped && useLazy) {
          value = onlyLazy ? value : new LazyWrapper(this);
          var result = func.apply(value, args);
          result.__actions__.push({ 'func': thru, 'args': [interceptor], 'thisArg': undefined });
          return new LodashWrapper(result, chainAll);
        }
        if (isUnwrapped && onlyLazy) {
          return func.apply(this, args);
        }
        result = this.thru(interceptor);
        return isUnwrapped ? (isTaker ? result.value()[0] : result.value()) : result;
      };
    });

    // Add `Array` methods to `lodash.prototype`.
    arrayEach(['pop', 'push', 'shift', 'sort', 'splice', 'unshift'], function(methodName) {
      var func = arrayProto[methodName],
          chainName = /^(?:push|sort|unshift)$/.test(methodName) ? 'tap' : 'thru',
          retUnwrapped = /^(?:pop|shift)$/.test(methodName);

      lodash.prototype[methodName] = function() {
        var args = arguments;
        if (retUnwrapped && !this.__chain__) {
          var value = this.value();
          return func.apply(isArray(value) ? value : [], args);
        }
        return this[chainName](function(value) {
          return func.apply(isArray(value) ? value : [], args);
        });
      };
    });

    // Map minified method names to their real names.
    baseForOwn(LazyWrapper.prototype, function(func, methodName) {
      var lodashFunc = lodash[methodName];
      if (lodashFunc) {
        var key = lodashFunc.name + '';
        if (!hasOwnProperty.call(realNames, key)) {
          realNames[key] = [];
        }
        realNames[key].push({ 'name': methodName, 'func': lodashFunc });
      }
    });

    realNames[createHybrid(undefined, WRAP_BIND_KEY_FLAG).name] = [{
      'name': 'wrapper',
      'func': undefined
    }];

    // Add methods to `LazyWrapper`.
    LazyWrapper.prototype.clone = lazyClone;
    LazyWrapper.prototype.reverse = lazyReverse;
    LazyWrapper.prototype.value = lazyValue;

    // Add chain sequence methods to the `lodash` wrapper.
    lodash.prototype.at = wrapperAt;
    lodash.prototype.chain = wrapperChain;
    lodash.prototype.commit = wrapperCommit;
    lodash.prototype.next = wrapperNext;
    lodash.prototype.plant = wrapperPlant;
    lodash.prototype.reverse = wrapperReverse;
    lodash.prototype.toJSON = lodash.prototype.valueOf = lodash.prototype.value = wrapperValue;

    // Add lazy aliases.
    lodash.prototype.first = lodash.prototype.head;

    if (symIterator) {
      lodash.prototype[symIterator] = wrapperToIterator;
    }
    return lodash;
  });

  /*--------------------------------------------------------------------------*/

  // Export lodash.
  var _ = runInContext();

  // Some AMD build optimizers, like r.js, check for condition patterns like:
  if (true) {
    // Expose Lodash on the global object to prevent errors when Lodash is
    // loaded by a script tag in the presence of an AMD loader.
    // See http://requirejs.org/docs/errors.html#mismatch for more details.
    // Use `_.noConflict` to remove Lodash from the global object.
    root._ = _;

    // Define as an anonymous module so, through path mapping, it can be
    // referenced as the "underscore" module.
    !(__WEBPACK_AMD_DEFINE_RESULT__ = (function() {
      return _;
    }).call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
  }
  // Check for `exports` after `define` in case a build optimizer adds it.
  else {}
}.call(this));

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../webpack/buildin/global.js */ "./node_modules/webpack/buildin/global.js"), __webpack_require__(/*! ./../webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./node_modules/re-resizable/lib/index.js":
/*!************************************************!*\
  !*** ./node_modules/re-resizable/lib/index.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, '__esModule', { value: true });

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var React = __webpack_require__(/*! react */ "react");
var memoize = _interopDefault(__webpack_require__(/*! fast-memoize */ "./node_modules/fast-memoize/src/index.js"));

/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};

var styles = {
    top: {
        width: '100%',
        height: '10px',
        top: '-5px',
        left: '0px',
        cursor: 'row-resize',
    },
    right: {
        width: '10px',
        height: '100%',
        top: '0px',
        right: '-5px',
        cursor: 'col-resize',
    },
    bottom: {
        width: '100%',
        height: '10px',
        bottom: '-5px',
        left: '0px',
        cursor: 'row-resize',
    },
    left: {
        width: '10px',
        height: '100%',
        top: '0px',
        left: '-5px',
        cursor: 'col-resize',
    },
    topRight: {
        width: '20px',
        height: '20px',
        position: 'absolute',
        right: '-10px',
        top: '-10px',
        cursor: 'ne-resize',
    },
    bottomRight: {
        width: '20px',
        height: '20px',
        position: 'absolute',
        right: '-10px',
        bottom: '-10px',
        cursor: 'se-resize',
    },
    bottomLeft: {
        width: '20px',
        height: '20px',
        position: 'absolute',
        left: '-10px',
        bottom: '-10px',
        cursor: 'sw-resize',
    },
    topLeft: {
        width: '20px',
        height: '20px',
        position: 'absolute',
        left: '-10px',
        top: '-10px',
        cursor: 'nw-resize',
    },
};
function Resizer(props) {
    return (React.createElement("div", { className: props.className || '', style: __assign({ position: 'absolute', userSelect: 'none' }, styles[props.direction], (props.replaceStyles || {})), onMouseDown: function (e) {
            props.onResizeStart(e, props.direction);
        }, onTouchStart: function (e) {
            props.onResizeStart(e, props.direction);
        } }, props.children));
}

var DEFAULT_SIZE = {
    width: 'auto',
    height: 'auto',
};
var clamp = memoize(function (n, min, max) { return Math.max(Math.min(n, max), min); });
var snap = memoize(function (n, size) { return Math.round(n / size) * size; });
var hasDirection = memoize(function (dir, target) { return new RegExp(dir, 'i').test(target); });
var findClosestSnap = memoize(function (n, snapArray, snapGap) {
    if (snapGap === void 0) { snapGap = 0; }
    var closestGapIndex = snapArray.reduce(function (prev, curr, index) { return (Math.abs(curr - n) < Math.abs(snapArray[prev] - n) ? index : prev); }, 0);
    var gap = Math.abs(snapArray[closestGapIndex] - n);
    return snapGap === 0 || gap < snapGap ? snapArray[closestGapIndex] : n;
});
var endsWith = memoize(function (str, searchStr) {
    return str.substr(str.length - searchStr.length, searchStr.length) === searchStr;
});
var getStringSize = memoize(function (n) {
    n = n.toString();
    if (n === 'auto') {
        return n;
    }
    if (endsWith(n, 'px')) {
        return n;
    }
    if (endsWith(n, '%')) {
        return n;
    }
    if (endsWith(n, 'vh')) {
        return n;
    }
    if (endsWith(n, 'vw')) {
        return n;
    }
    if (endsWith(n, 'vmax')) {
        return n;
    }
    if (endsWith(n, 'vmin')) {
        return n;
    }
    return n + "px";
});
var getPixelSize = function (size, parentSize) {
    if (size && typeof size === 'string') {
        if (endsWith(size, '%')) {
            var ratio = Number(size.replace('%', '')) / 100;
            return parentSize * ratio;
        }
        else if (endsWith(size, 'vw')) {
            var ratio = Number(size.replace('vw', '')) / 100;
            return window.innerWidth * ratio;
        }
        else if (endsWith(size, 'vh')) {
            var ratio = Number(size.replace('vh', '')) / 100;
            return window.innerHeight * ratio;
        }
    }
    return size;
};
var calculateNewMax = memoize(function (parentSize, maxWidth, maxHeight, minWidth, minHeight) {
    maxWidth = getPixelSize(maxWidth, parentSize.width);
    maxHeight = getPixelSize(maxHeight, parentSize.height);
    minWidth = getPixelSize(minWidth, parentSize.width);
    minHeight = getPixelSize(minHeight, parentSize.height);
    return {
        maxWidth: typeof maxWidth === 'undefined' ? undefined : Number(maxWidth),
        maxHeight: typeof maxHeight === 'undefined' ? undefined : Number(maxHeight),
        minWidth: typeof minWidth === 'undefined' ? undefined : Number(minWidth),
        minHeight: typeof minHeight === 'undefined' ? undefined : Number(minHeight),
    };
});
var definedProps = [
    'style',
    'className',
    'grid',
    'snap',
    'bounds',
    'size',
    'defaultSize',
    'minWidth',
    'minHeight',
    'maxWidth',
    'maxHeight',
    'lockAspectRatio',
    'lockAspectRatioExtraWidth',
    'lockAspectRatioExtraHeight',
    'enable',
    'handleStyles',
    'handleClasses',
    'handleWrapperStyle',
    'handleWrapperClass',
    'children',
    'onResizeStart',
    'onResize',
    'onResizeStop',
    'handleComponent',
    'scale',
    'resizeRatio',
    'snapGap',
];
// HACK: This class is used to calculate % size.
var baseClassName = '__resizable_base__';
var Resizable = /** @class */ (function (_super) {
    __extends(Resizable, _super);
    function Resizable(props) {
        var _this = _super.call(this, props) || this;
        _this.ratio = 1;
        _this.resizable = null;
        // For parent boundary
        _this.parentLeft = 0;
        _this.parentTop = 0;
        // For boundary
        _this.resizableLeft = 0;
        _this.resizableTop = 0;
        // For target boundary
        _this.targetLeft = 0;
        _this.targetTop = 0;
        _this.state = {
            isResizing: false,
            resizeCursor: 'auto',
            width: typeof (_this.propsSize && _this.propsSize.width) === 'undefined'
                ? 'auto'
                : _this.propsSize && _this.propsSize.width,
            height: typeof (_this.propsSize && _this.propsSize.height) === 'undefined'
                ? 'auto'
                : _this.propsSize && _this.propsSize.height,
            direction: 'right',
            original: {
                x: 0,
                y: 0,
                width: 0,
                height: 0,
            },
        };
        _this.onResizeStart = _this.onResizeStart.bind(_this);
        _this.onMouseMove = _this.onMouseMove.bind(_this);
        _this.onMouseUp = _this.onMouseUp.bind(_this);
        return _this;
    }
    Object.defineProperty(Resizable.prototype, "parentNode", {
        get: function () {
            if (!this.resizable) {
                return null;
            }
            return this.resizable.parentNode;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Resizable.prototype, "propsSize", {
        get: function () {
            return this.props.size || this.props.defaultSize || DEFAULT_SIZE;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Resizable.prototype, "base", {
        get: function () {
            var parent = this.parentNode;
            if (!parent) {
                return undefined;
            }
            var children = [].slice.call(parent.children);
            for (var _i = 0, children_1 = children; _i < children_1.length; _i++) {
                var n = children_1[_i];
                if (n instanceof HTMLElement) {
                    if (n.classList.contains(baseClassName)) {
                        return n;
                    }
                }
            }
            return undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Resizable.prototype, "size", {
        get: function () {
            var width = 0;
            var height = 0;
            if (typeof window !== 'undefined' && this.resizable) {
                var orgWidth = this.resizable.offsetWidth;
                var orgHeight = this.resizable.offsetHeight;
                // HACK: Set position `relative` to get parent size.
                //       This is because when re-resizable set `absolute`, I can not get base width correctly.
                var orgPosition = this.resizable.style.position;
                if (orgPosition !== 'relative') {
                    this.resizable.style.position = 'relative';
                }
                // INFO: Use original width or height if set auto.
                width = this.resizable.style.width !== 'auto' ? this.resizable.offsetWidth : orgWidth;
                height = this.resizable.style.height !== 'auto' ? this.resizable.offsetHeight : orgHeight;
                // Restore original position
                this.resizable.style.position = orgPosition;
            }
            return { width: width, height: height };
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Resizable.prototype, "sizeStyle", {
        get: function () {
            var _this = this;
            var size = this.props.size;
            var getSize = function (key) {
                if (typeof _this.state[key] === 'undefined' || _this.state[key] === 'auto') {
                    return 'auto';
                }
                if (_this.propsSize && _this.propsSize[key] && endsWith(_this.propsSize[key].toString(), '%')) {
                    if (endsWith(_this.state[key].toString(), '%')) {
                        return _this.state[key].toString();
                    }
                    var parentSize = _this.getParentSize();
                    var value = Number(_this.state[key].toString().replace('px', ''));
                    var percent = (value / parentSize[key]) * 100;
                    return percent + "%";
                }
                return getStringSize(_this.state[key]);
            };
            var width = size && typeof size.width !== 'undefined' && !this.state.isResizing
                ? getStringSize(size.width)
                : getSize('width');
            var height = size && typeof size.height !== 'undefined' && !this.state.isResizing
                ? getStringSize(size.height)
                : getSize('height');
            return { width: width, height: height };
        },
        enumerable: true,
        configurable: true
    });
    Resizable.prototype.getParentSize = function () {
        if (!this.base || !this.parentNode) {
            return { width: window.innerWidth, height: window.innerHeight };
        }
        // INFO: To calculate parent width with flex layout
        var wrapChanged = false;
        var wrap = this.parentNode.style.flexWrap;
        var minWidth = this.base.style.minWidth;
        if (wrap !== 'wrap') {
            wrapChanged = true;
            this.parentNode.style.flexWrap = 'wrap';
            // HACK: Use relative to get parent padding size
        }
        this.base.style.position = 'relative';
        this.base.style.minWidth = '100%';
        var size = {
            width: this.base.offsetWidth,
            height: this.base.offsetHeight,
        };
        this.base.style.position = 'absolute';
        if (wrapChanged) {
            this.parentNode.style.flexWrap = wrap;
        }
        this.base.style.minWidth = minWidth;
        return size;
    };
    Resizable.prototype.bindEvents = function () {
        if (typeof window !== 'undefined') {
            window.addEventListener('mouseup', this.onMouseUp);
            window.addEventListener('mousemove', this.onMouseMove);
            window.addEventListener('mouseleave', this.onMouseUp);
            window.addEventListener('touchmove', this.onMouseMove);
            window.addEventListener('touchend', this.onMouseUp);
        }
    };
    Resizable.prototype.unbindEvents = function () {
        if (typeof window !== 'undefined') {
            window.removeEventListener('mouseup', this.onMouseUp);
            window.removeEventListener('mousemove', this.onMouseMove);
            window.removeEventListener('mouseleave', this.onMouseUp);
            window.removeEventListener('touchmove', this.onMouseMove);
            window.removeEventListener('touchend', this.onMouseUp);
        }
    };
    Resizable.prototype.componentDidMount = function () {
        this.setState({
            width: this.state.width || this.size.width,
            height: this.state.height || this.size.height,
        });
        var parent = this.parentNode;
        if (!(parent instanceof HTMLElement)) {
            return;
        }
        if (this.base) {
            return;
        }
        var element = document.createElement('div');
        element.style.width = '100%';
        element.style.height = '100%';
        element.style.position = 'absolute';
        element.style.transform = 'scale(0, 0)';
        element.style.left = '0';
        element.style.flex = '0';
        if (element.classList) {
            element.classList.add(baseClassName);
        }
        else {
            element.className += baseClassName;
        }
        parent.appendChild(element);
    };
    Resizable.prototype.componentWillUnmount = function () {
        if (typeof window !== 'undefined') {
            this.unbindEvents();
            var parent_1 = this.parentNode;
            if (!this.base || !parent_1) {
                return;
            }
            if (!(parent_1 instanceof HTMLElement) || !(this.base instanceof Node)) {
                return;
            }
            parent_1.removeChild(this.base);
        }
    };
    Resizable.prototype.createSizeForCssProperty = function (newSize, kind) {
        var propsSize = this.propsSize && this.propsSize[kind];
        return this.state[kind] === 'auto' &&
            this.state.original[kind] === newSize &&
            (typeof propsSize === 'undefined' || propsSize === 'auto')
            ? 'auto'
            : newSize;
    };
    Resizable.prototype.calculateNewMaxFromBoundary = function (maxWidth, maxHeight) {
        if (this.props.bounds === 'parent') {
            var parent_2 = this.parentNode;
            if (parent_2 instanceof HTMLElement) {
                var boundWidth = parent_2.offsetWidth + (this.parentLeft - this.resizableLeft);
                var boundHeight = parent_2.offsetHeight + (this.parentTop - this.resizableTop);
                maxWidth = maxWidth && maxWidth < boundWidth ? maxWidth : boundWidth;
                maxHeight = maxHeight && maxHeight < boundHeight ? maxHeight : boundHeight;
            }
        }
        else if (this.props.bounds === 'window') {
            if (typeof window !== 'undefined') {
                var boundWidth = window.innerWidth - this.resizableLeft;
                var boundHeight = window.innerHeight - this.resizableTop;
                maxWidth = maxWidth && maxWidth < boundWidth ? maxWidth : boundWidth;
                maxHeight = maxHeight && maxHeight < boundHeight ? maxHeight : boundHeight;
            }
        }
        else if (this.props.bounds instanceof HTMLElement) {
            var boundWidth = this.props.bounds.offsetWidth + (this.targetLeft - this.resizableLeft);
            var boundHeight = this.props.bounds.offsetHeight + (this.targetTop - this.resizableTop);
            maxWidth = maxWidth && maxWidth < boundWidth ? maxWidth : boundWidth;
            maxHeight = maxHeight && maxHeight < boundHeight ? maxHeight : boundHeight;
        }
        return { maxWidth: maxWidth, maxHeight: maxHeight };
    };
    Resizable.prototype.calculateNewSizeFromDirection = function (clientX, clientY) {
        var scale = this.props.scale || 1;
        var resizeRatio = this.props.resizeRatio || 1;
        var _a = this.state, direction = _a.direction, original = _a.original;
        var _b = this.props, lockAspectRatio = _b.lockAspectRatio, lockAspectRatioExtraHeight = _b.lockAspectRatioExtraHeight, lockAspectRatioExtraWidth = _b.lockAspectRatioExtraWidth;
        var newWidth = original.width;
        var newHeight = original.height;
        var extraHeight = lockAspectRatioExtraHeight || 0;
        var extraWidth = lockAspectRatioExtraWidth || 0;
        if (hasDirection('right', direction)) {
            newWidth = original.width + ((clientX - original.x) * resizeRatio) / scale;
            if (lockAspectRatio) {
                newHeight = (newWidth - extraWidth) / this.ratio + extraHeight;
            }
        }
        if (hasDirection('left', direction)) {
            newWidth = original.width - ((clientX - original.x) * resizeRatio) / scale;
            if (lockAspectRatio) {
                newHeight = (newWidth - extraWidth) / this.ratio + extraHeight;
            }
        }
        if (hasDirection('bottom', direction)) {
            newHeight = original.height + ((clientY - original.y) * resizeRatio) / scale;
            if (lockAspectRatio) {
                newWidth = (newHeight - extraHeight) * this.ratio + extraWidth;
            }
        }
        if (hasDirection('top', direction)) {
            newHeight = original.height - ((clientY - original.y) * resizeRatio) / scale;
            if (lockAspectRatio) {
                newWidth = (newHeight - extraHeight) * this.ratio + extraWidth;
            }
        }
        return { newWidth: newWidth, newHeight: newHeight };
    };
    Resizable.prototype.calculateNewSizeFromAspectRatio = function (newWidth, newHeight, max, min) {
        var _a = this.props, lockAspectRatio = _a.lockAspectRatio, lockAspectRatioExtraHeight = _a.lockAspectRatioExtraHeight, lockAspectRatioExtraWidth = _a.lockAspectRatioExtraWidth;
        var computedMinWidth = typeof min.width === 'undefined' ? 10 : min.width;
        var computedMaxWidth = typeof max.width === 'undefined' || max.width < 0 ? newWidth : max.width;
        var computedMinHeight = typeof min.height === 'undefined' ? 10 : min.height;
        var computedMaxHeight = typeof max.height === 'undefined' || max.height < 0 ? newHeight : max.height;
        var extraHeight = lockAspectRatioExtraHeight || 0;
        var extraWidth = lockAspectRatioExtraWidth || 0;
        if (lockAspectRatio) {
            var extraMinWidth = (computedMinHeight - extraHeight) * this.ratio + extraWidth;
            var extraMaxWidth = (computedMaxHeight - extraHeight) * this.ratio + extraWidth;
            var extraMinHeight = (computedMinWidth - extraWidth) / this.ratio + extraHeight;
            var extraMaxHeight = (computedMaxWidth - extraWidth) / this.ratio + extraHeight;
            var lockedMinWidth = Math.max(computedMinWidth, extraMinWidth);
            var lockedMaxWidth = Math.min(computedMaxWidth, extraMaxWidth);
            var lockedMinHeight = Math.max(computedMinHeight, extraMinHeight);
            var lockedMaxHeight = Math.min(computedMaxHeight, extraMaxHeight);
            newWidth = clamp(newWidth, lockedMinWidth, lockedMaxWidth);
            newHeight = clamp(newHeight, lockedMinHeight, lockedMaxHeight);
        }
        else {
            newWidth = clamp(newWidth, computedMinWidth, computedMaxWidth);
            newHeight = clamp(newHeight, computedMinHeight, computedMaxHeight);
        }
        return { newWidth: newWidth, newHeight: newHeight };
    };
    Resizable.prototype.setBoundingClientRect = function () {
        // For parent boundary
        if (this.props.bounds === 'parent') {
            var parent_3 = this.parentNode;
            if (parent_3 instanceof HTMLElement) {
                var parentRect = parent_3.getBoundingClientRect();
                this.parentLeft = parentRect.left;
                this.parentTop = parentRect.top;
            }
        }
        // For target(html element) boundary
        if (this.props.bounds instanceof HTMLElement) {
            var targetRect = this.props.bounds.getBoundingClientRect();
            this.targetLeft = targetRect.left;
            this.targetTop = targetRect.top;
        }
        // For boundary
        if (this.resizable) {
            var _a = this.resizable.getBoundingClientRect(), left = _a.left, top_1 = _a.top;
            this.resizableLeft = left;
            this.resizableTop = top_1;
        }
    };
    Resizable.prototype.onResizeStart = function (event, direction) {
        var clientX = 0;
        var clientY = 0;
        if (event.nativeEvent instanceof MouseEvent) {
            clientX = event.nativeEvent.clientX;
            clientY = event.nativeEvent.clientY;
            // When user click with right button the resize is stuck in resizing mode
            // until users clicks again, dont continue if right click is used.
            // HACK: MouseEvent does not have `which` from flow-bin v0.68.
            if (event.nativeEvent.which === 3) {
                return;
            }
        }
        else if (event.nativeEvent instanceof TouchEvent) {
            clientX = event.nativeEvent.touches[0].clientX;
            clientY = event.nativeEvent.touches[0].clientY;
        }
        if (this.props.onResizeStart) {
            if (this.resizable) {
                var startResize = this.props.onResizeStart(event, direction, this.resizable);
                if (startResize === false) {
                    return;
                }
            }
        }
        // Fix #168
        if (this.props.size) {
            if (typeof this.props.size.height !== 'undefined' && this.props.size.height !== this.state.height) {
                this.setState({ height: this.props.size.height });
            }
            if (typeof this.props.size.width !== 'undefined' && this.props.size.width !== this.state.width) {
                this.setState({ width: this.props.size.width });
            }
        }
        // For lockAspectRatio case
        this.ratio =
            typeof this.props.lockAspectRatio === 'number' ? this.props.lockAspectRatio : this.size.width / this.size.height;
        // For boundary
        this.setBoundingClientRect();
        this.bindEvents();
        this.setState({
            original: {
                x: clientX,
                y: clientY,
                width: this.size.width,
                height: this.size.height,
            },
            isResizing: true,
            resizeCursor: window.getComputedStyle(event.target).cursor || 'auto',
            direction: direction,
        });
    };
    Resizable.prototype.onMouseMove = function (event) {
        if (!this.state.isResizing || !this.resizable) {
            return;
        }
        var _a = this.props, maxWidth = _a.maxWidth, maxHeight = _a.maxHeight, minWidth = _a.minWidth, minHeight = _a.minHeight;
        var clientX = event instanceof MouseEvent ? event.clientX : event.touches[0].clientX;
        var clientY = event instanceof MouseEvent ? event.clientY : event.touches[0].clientY;
        var _b = this.state, direction = _b.direction, original = _b.original, width = _b.width, height = _b.height;
        var parentSize = this.getParentSize();
        var max = calculateNewMax(parentSize, maxWidth, maxHeight, minWidth, minHeight);
        maxWidth = max.maxWidth;
        maxHeight = max.maxHeight;
        minWidth = max.minWidth;
        minHeight = max.minHeight;
        // Calculate new size
        var _c = this.calculateNewSizeFromDirection(clientX, clientY), newHeight = _c.newHeight, newWidth = _c.newWidth;
        // Calculate max size from boundary settings
        var boundaryMax = this.calculateNewMaxFromBoundary(maxWidth, maxHeight);
        // Calculate new size from aspect ratio
        var newSize = this.calculateNewSizeFromAspectRatio(newWidth, newHeight, { width: boundaryMax.maxWidth, height: boundaryMax.maxHeight }, { width: minWidth, height: minHeight });
        newWidth = newSize.newWidth;
        newHeight = newSize.newHeight;
        if (this.props.grid) {
            var newGridWidth = snap(newWidth, this.props.grid[0]);
            var newGridHeight = snap(newHeight, this.props.grid[1]);
            var gap = this.props.snapGap || 0;
            newWidth = gap === 0 || Math.abs(newGridWidth - newWidth) <= gap ? newGridWidth : newWidth;
            newHeight = gap === 0 || Math.abs(newGridHeight - newHeight) <= gap ? newGridHeight : newHeight;
        }
        if (this.props.snap && this.props.snap.x) {
            newWidth = findClosestSnap(newWidth, this.props.snap.x, this.props.snapGap);
        }
        if (this.props.snap && this.props.snap.y) {
            newHeight = findClosestSnap(newHeight, this.props.snap.y, this.props.snapGap);
        }
        var delta = {
            width: newWidth - original.width,
            height: newHeight - original.height,
        };
        if (width && typeof width === 'string') {
            if (endsWith(width, '%')) {
                var percent = (newWidth / parentSize.width) * 100;
                newWidth = percent + "%";
            }
            else if (endsWith(width, 'vw')) {
                var vw = (newWidth / window.innerWidth) * 100;
                newWidth = vw + "vw";
            }
            else if (endsWith(width, 'vh')) {
                var vh = (newWidth / window.innerHeight) * 100;
                newWidth = vh + "vh";
            }
        }
        if (height && typeof height === 'string') {
            if (endsWith(height, '%')) {
                var percent = (newHeight / parentSize.height) * 100;
                newHeight = percent + "%";
            }
            else if (endsWith(height, 'vw')) {
                var vw = (newHeight / window.innerWidth) * 100;
                newHeight = vw + "vw";
            }
            else if (endsWith(height, 'vh')) {
                var vh = (newHeight / window.innerHeight) * 100;
                newHeight = vh + "vh";
            }
        }
        this.setState({
            width: this.createSizeForCssProperty(newWidth, 'width'),
            height: this.createSizeForCssProperty(newHeight, 'height'),
        });
        if (this.props.onResize) {
            this.props.onResize(event, direction, this.resizable, delta);
        }
    };
    Resizable.prototype.onMouseUp = function (event) {
        var _a = this.state, isResizing = _a.isResizing, direction = _a.direction, original = _a.original;
        if (!isResizing || !this.resizable) {
            return;
        }
        var delta = {
            width: this.size.width - original.width,
            height: this.size.height - original.height,
        };
        if (this.props.onResizeStop) {
            this.props.onResizeStop(event, direction, this.resizable, delta);
        }
        if (this.props.size) {
            this.setState(this.props.size);
        }
        this.unbindEvents();
        this.setState({ isResizing: false, resizeCursor: 'auto' });
    };
    Resizable.prototype.updateSize = function (size) {
        this.setState({ width: size.width, height: size.height });
    };
    Resizable.prototype.renderResizer = function () {
        var _this = this;
        var _a = this.props, enable = _a.enable, handleStyles = _a.handleStyles, handleClasses = _a.handleClasses, handleWrapperStyle = _a.handleWrapperStyle, handleWrapperClass = _a.handleWrapperClass, handleComponent = _a.handleComponent;
        if (!enable) {
            return null;
        }
        var resizers = Object.keys(enable).map(function (dir) {
            if (enable[dir] !== false) {
                return (React.createElement(Resizer, { key: dir, direction: dir, onResizeStart: _this.onResizeStart, replaceStyles: handleStyles && handleStyles[dir], className: handleClasses && handleClasses[dir] }, handleComponent && handleComponent[dir] ? handleComponent[dir] : null));
            }
            return null;
        });
        // #93 Wrap the resize box in span (will not break 100% width/height)
        return (React.createElement("span", { className: handleWrapperClass, style: handleWrapperStyle }, resizers));
    };
    Resizable.prototype.render = function () {
        var _this = this;
        var extendsProps = Object.keys(this.props).reduce(function (acc, key) {
            if (definedProps.indexOf(key) !== -1) {
                return acc;
            }
            acc[key] = _this.props[key];
            return acc;
        }, {});
        return (React.createElement("div", __assign({ ref: function (c) {
                if (c) {
                    _this.resizable = c;
                }
            }, style: __assign({ position: 'relative', userSelect: this.state.isResizing ? 'none' : 'auto' }, this.props.style, this.sizeStyle, { maxWidth: this.props.maxWidth, maxHeight: this.props.maxHeight, minWidth: this.props.minWidth, minHeight: this.props.minHeight, boxSizing: 'border-box', flexShrink: 0 }), className: this.props.className }, extendsProps),
            this.state.isResizing && (React.createElement("div", { style: {
                    height: '100%',
                    width: '100%',
                    backgroundColor: 'rgba(0,0,0,0)',
                    cursor: "" + (this.state.resizeCursor || 'auto'),
                    opacity: 0,
                    position: 'fixed',
                    zIndex: 9999,
                    top: '0',
                    left: '0',
                    bottom: '0',
                    right: '0',
                } })),
            this.props.children,
            this.renderResizer()));
    };
    Resizable.defaultProps = {
        onResizeStart: function () { },
        onResize: function () { },
        onResizeStop: function () { },
        enable: {
            top: true,
            right: true,
            bottom: true,
            left: true,
            topRight: true,
            bottomRight: true,
            bottomLeft: true,
            topLeft: true,
        },
        style: {},
        grid: [1, 1],
        lockAspectRatio: false,
        lockAspectRatioExtraWidth: 0,
        lockAspectRatioExtraHeight: 0,
        scale: 1,
        resizeRatio: 1,
        snapGap: 0,
    };
    return Resizable;
}(React.PureComponent));

exports.Resizable = Resizable;


/***/ }),

/***/ "./node_modules/react-draggable/build/web/react-draggable.min.js":
/*!***********************************************************************!*\
  !*** ./node_modules/react-draggable/build/web/react-draggable.min.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

!function(t,e){ true?module.exports=e(__webpack_require__(/*! react */ "react"),__webpack_require__(/*! react-dom */ "react-dom")):undefined}(window,function(t,e){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){t.exports=n(5)()},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e,n){var r;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/!function(){"use strict";var n={}.hasOwnProperty;function o(){for(var t=[],e=0;e<arguments.length;e++){var r=arguments[e];if(r){var a=typeof r;if("string"===a||"number"===a)t.push(r);else if(Array.isArray(r)&&r.length){var i=o.apply(null,r);i&&t.push(i)}else if("object"===a)for(var s in r)n.call(r,s)&&r[s]&&t.push(s)}}return t.join(" ")}t.exports?(o.default=o,t.exports=o):void 0===(r=function(){return o}.apply(e,[]))||(t.exports=r)}()},function(t,e,n){var r=n(7),o=r.default,a=r.DraggableCore;t.exports=o,t.exports.default=o,t.exports.DraggableCore=a},function(t,e,n){"use strict";var r=n(6);function o(){}function a(){}a.resetWarningCache=o,t.exports=function(){function t(t,e,n,o,a,i){if(i!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var n={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:a,resetWarningCache:o};return n.PropTypes=n,n}},function(t,e,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,e,n){"use strict";n.r(e);var r=n(1),o=n.n(r),a=n(0),i=n.n(a),s=n(2),u=n.n(s),c=n(3),l=n.n(c);function f(t,e){for(var n=0,r=t.length;n<r;n++)if(e.apply(e,[t[n],n,t]))return t[n]}function p(t){return"function"==typeof t||"[object Function]"===Object.prototype.toString.call(t)}function d(t){return"number"==typeof t&&!isNaN(t)}function g(t){return parseInt(t,10)}function y(t,e,n){if(t[e])return new Error("Invalid prop ".concat(e," passed to ").concat(n," - do not set this, set it on the child."))}var h=["Moz","Webkit","O","ms"];function b(t,e){return e?"".concat(e).concat(function(t){for(var e="",n=!0,r=0;r<t.length;r++)n?(e+=t[r].toUpperCase(),n=!1):"-"===t[r]?n=!0:e+=t[r];return e}(t)):t}var m=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"transform";if("undefined"==typeof window||void 0===window.document)return"";var e=window.document.documentElement.style;if(t in e)return"";for(var n=0;n<h.length;n++)if(b(t,h[n])in e)return h[n];return""}();function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var O="";function S(t,e){return O||(O=f(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"],function(e){return p(t[e])})),!!p(t[O])&&t[O](e)}function D(t,e,n){var r=t;do{if(S(r,e))return!0;if(r===n)return!1;r=r.parentNode}while(r);return!1}function x(t,e,n){t&&(t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener?t.addEventListener(e,n,!0):t["on"+e]=n)}function P(t,e,n){t&&(t.detachEvent?t.detachEvent("on"+e,n):t.removeEventListener?t.removeEventListener(e,n,!0):t["on"+e]=null)}function j(t){var e=t.clientHeight,n=t.ownerDocument.defaultView.getComputedStyle(t);return e+=g(n.borderTopWidth),e+=g(n.borderBottomWidth)}function E(t){var e=t.clientWidth,n=t.ownerDocument.defaultView.getComputedStyle(t);return e+=g(n.borderLeftWidth),e+=g(n.borderRightWidth)}function T(t){var e=t.clientHeight,n=t.ownerDocument.defaultView.getComputedStyle(t);return e-=g(n.paddingTop),e-=g(n.paddingBottom)}function N(t){var e=t.clientWidth,n=t.ownerDocument.defaultView.getComputedStyle(t);return e-=g(n.paddingLeft),e-=g(n.paddingRight)}function C(t,e,n){var r=t.x,o=t.y,a="translate(".concat(r).concat(n,",").concat(o).concat(n,")");if(e){var i="".concat("string"==typeof e.x?e.x:e.x+n),s="".concat("string"==typeof e.y?e.y:e.y+n);a="translate(".concat(i,", ").concat(s,")")+a}return a}function M(t){if(t){var e,n,r=t.getElementById("react-draggable-style-el");r||((r=t.createElement("style")).type="text/css",r.id="react-draggable-style-el",r.innerHTML=".react-draggable-transparent-selection *::-moz-selection {all: inherit;}\n",r.innerHTML+=".react-draggable-transparent-selection *::selection {all: inherit;}\n",t.getElementsByTagName("head")[0].appendChild(r)),t.body&&(e=t.body,n="react-draggable-transparent-selection",e.classList?e.classList.add(n):e.className.match(new RegExp("(?:^|\\s)".concat(n,"(?!\\S)")))||(e.className+=" ".concat(n)))}}function k(t){try{t&&t.body&&(e=t.body,n="react-draggable-transparent-selection",e.classList?e.classList.remove(n):e.className=e.className.replace(new RegExp("(?:^|\\s)".concat(n,"(?!\\S)"),"g"),"")),t.selection?t.selection.empty():window.getSelection().removeAllRanges()}catch(t){}var e,n}function _(){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(n,!0).forEach(function(e){w(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({touchAction:"none"},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function X(t){return"both"===t.props.axis||"x"===t.props.axis}function Y(t){return"both"===t.props.axis||"y"===t.props.axis}function L(t,e,n){var r="number"==typeof e?function(t,e){return t.targetTouches&&f(t.targetTouches,function(t){return e===t.identifier})||t.changedTouches&&f(t.changedTouches,function(t){return e===t.identifier})}(t,e):null;if("number"==typeof e&&!r)return null;var o=I(n);return function(t,e,n){var r=e===e.ownerDocument.body?{left:0,top:0}:e.getBoundingClientRect();return{x:(t.clientX+e.scrollLeft-r.left)/n,y:(t.clientY+e.scrollTop-r.top)/n}}(r||t,n.props.offsetParent||o.offsetParent||o.ownerDocument.body,n.props.scale)}function R(t,e,n){var r=t.state,o=!d(r.lastX),a=I(t);return o?{node:a,deltaX:0,deltaY:0,lastX:e,lastY:n,x:e,y:n}:{node:a,deltaX:e-r.lastX,deltaY:n-r.lastY,lastX:r.lastX,lastY:r.lastY,x:e,y:n}}function A(t,e){var n=t.props.scale;return{node:e.node,x:t.state.x+e.deltaX/n,y:t.state.y+e.deltaY/n,deltaX:e.deltaX/n,deltaY:e.deltaY/n,lastX:t.state.x,lastY:t.state.y}}function I(t){var e=u.a.findDOMNode(t);if(!e)throw new Error("<DraggableCore>: Unmounted during event!");return e}function U(t){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function W(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function H(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var z={touch:{start:"touchstart",move:"touchmove",stop:"touchend"},mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"}},F=z.mouse,J=function(t){function e(){var t,n,r,o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return r=this,o=(t=B(e)).call.apply(t,[this].concat(i)),n=!o||"object"!==U(o)&&"function"!=typeof o?H(r):o,G(H(n),"state",{dragging:!1,lastX:NaN,lastY:NaN,touchIdentifier:null}),G(H(n),"handleDragStart",function(t){if(n.props.onMouseDown(t),!n.props.allowAnyClick&&"number"==typeof t.button&&0!==t.button)return!1;var e=u.a.findDOMNode(H(n));if(!e||!e.ownerDocument||!e.ownerDocument.body)throw new Error("<DraggableCore> not mounted on DragStart!");var r=e.ownerDocument;if(!(n.props.disabled||!(t.target instanceof r.defaultView.Node)||n.props.handle&&!D(t.target,n.props.handle,e)||n.props.cancel&&D(t.target,n.props.cancel,e))){var o=function(t){return t.targetTouches&&t.targetTouches[0]?t.targetTouches[0].identifier:t.changedTouches&&t.changedTouches[0]?t.changedTouches[0].identifier:void 0}(t);n.setState({touchIdentifier:o});var a=L(t,o,H(n));if(null!=a){var i=a.x,s=a.y,c=R(H(n),i,s);n.props.onStart,!1!==n.props.onStart(t,c)&&(n.props.enableUserSelectHack&&M(r),n.setState({dragging:!0,lastX:i,lastY:s}),x(r,F.move,n.handleDrag),x(r,F.stop,n.handleDragStop))}}}),G(H(n),"handleDrag",function(t){"touchmove"===t.type&&t.preventDefault();var e=L(t,n.state.touchIdentifier,H(n));if(null!=e){var r,o,a,i=e.x,s=e.y;if(Array.isArray(n.props.grid)){var u=i-n.state.lastX,c=s-n.state.lastY,l=V((r=n.props.grid,o=u,a=c,[Math.round(o/r[0])*r[0],Math.round(a/r[1])*r[1]]),2);if(u=l[0],c=l[1],!u&&!c)return;i=n.state.lastX+u,s=n.state.lastY+c}var f=R(H(n),i,s);if(!1!==n.props.onDrag(t,f))n.setState({lastX:i,lastY:s});else try{n.handleDragStop(new MouseEvent("mouseup"))}catch(t){var p=document.createEvent("MouseEvents");p.initMouseEvent("mouseup",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.handleDragStop(p)}}}),G(H(n),"handleDragStop",function(t){if(n.state.dragging){var e=L(t,n.state.touchIdentifier,H(n));if(null!=e){var r=e.x,o=e.y,a=R(H(n),r,o),i=u.a.findDOMNode(H(n));i&&n.props.enableUserSelectHack&&k(i.ownerDocument),n.setState({dragging:!1,lastX:NaN,lastY:NaN}),n.props.onStop(t,a),i&&(P(i.ownerDocument,F.move,n.handleDrag),P(i.ownerDocument,F.stop,n.handleDragStop))}}}),G(H(n),"onMouseDown",function(t){return F=z.mouse,n.handleDragStart(t)}),G(H(n),"onMouseUp",function(t){return F=z.mouse,n.handleDragStop(t)}),G(H(n),"onTouchStart",function(t){return F=z.touch,n.handleDragStart(t)}),G(H(n),"onTouchEnd",function(t){return F=z.touch,n.handleDragStop(t)}),n}var n,r,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(e,o.a.Component),n=e,(r=[{key:"componentWillUnmount",value:function(){var t=u.a.findDOMNode(this);if(t){var e=t.ownerDocument;P(e,z.mouse.move,this.handleDrag),P(e,z.touch.move,this.handleDrag),P(e,z.mouse.stop,this.handleDragStop),P(e,z.touch.stop,this.handleDragStop),this.props.enableUserSelectHack&&k(e)}}},{key:"render",value:function(){return o.a.cloneElement(o.a.Children.only(this.props.children),{style:_(this.props.children.props.style),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd})}}])&&W(n.prototype,r),a&&W(n,a),e}();function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Q(){return(Q=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function Z(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function $(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function tt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function et(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tt(n,!0).forEach(function(e){st(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tt(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function nt(t){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function at(t,e,n){return e&&ot(t.prototype,e),n&&ot(t,n),t}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function st(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}G(J,"displayName","DraggableCore"),G(J,"propTypes",{allowAnyClick:i.a.bool,disabled:i.a.bool,enableUserSelectHack:i.a.bool,offsetParent:function(t,e){if(t[e]&&1!==t[e].nodeType)throw new Error("Draggable's offsetParent must be a DOM Node.")},grid:i.a.arrayOf(i.a.number),handle:i.a.string,cancel:i.a.string,onStart:i.a.func,onDrag:i.a.func,onStop:i.a.func,onMouseDown:i.a.func,scale:i.a.number,className:y,style:y,transform:y}),G(J,"defaultProps",{allowAnyClick:!1,cancel:null,disabled:!1,enableUserSelectHack:!0,offsetParent:null,handle:null,grid:null,transform:null,onStart:function(){},onDrag:function(){},onStop:function(){},onMouseDown:function(){},scale:1}),n.d(e,"default",function(){return ut}),n.d(e,"DraggableCore",function(){return J});var ut=function(t){function e(t){var n,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,o=nt(e).call(this,t),n=!o||"object"!==K(o)&&"function"!=typeof o?rt(r):o,st(rt(n),"onDragStart",function(t,e){if(!1===n.props.onStart(t,A(rt(n),e)))return!1;n.setState({dragging:!0,dragged:!0})}),st(rt(n),"onDrag",function(t,e){if(!n.state.dragging)return!1;var r=A(rt(n),e),o={x:r.x,y:r.y};if(n.props.bounds){var a=o.x,i=o.y;o.x+=n.state.slackX,o.y+=n.state.slackY;var s=$(function(t,e,n){if(!t.props.bounds)return[e,n];var r=t.props.bounds;r="string"==typeof r?r:function(t){return{left:t.left,top:t.top,right:t.right,bottom:t.bottom}}(r);var o=I(t);if("string"==typeof r){var a,i=o.ownerDocument,s=i.defaultView;if(!((a="parent"===r?o.parentNode:i.querySelector(r))instanceof s.HTMLElement))throw new Error('Bounds selector "'+r+'" could not find an element.');var u=s.getComputedStyle(o),c=s.getComputedStyle(a);r={left:-o.offsetLeft+g(c.paddingLeft)+g(u.marginLeft),top:-o.offsetTop+g(c.paddingTop)+g(u.marginTop),right:N(a)-E(o)-o.offsetLeft+g(c.paddingRight)-g(u.marginRight),bottom:T(a)-j(o)-o.offsetTop+g(c.paddingBottom)-g(u.marginBottom)}}return d(r.right)&&(e=Math.min(e,r.right)),d(r.bottom)&&(n=Math.min(n,r.bottom)),d(r.left)&&(e=Math.max(e,r.left)),d(r.top)&&(n=Math.max(n,r.top)),[e,n]}(rt(n),o.x,o.y),2),u=s[0],c=s[1];o.x=u,o.y=c,o.slackX=n.state.slackX+(a-o.x),o.slackY=n.state.slackY+(i-o.y),r.x=o.x,r.y=o.y,r.deltaX=o.x-n.state.x,r.deltaY=o.y-n.state.y}if(!1===n.props.onDrag(t,r))return!1;n.setState(o)}),st(rt(n),"onDragStop",function(t,e){if(!n.state.dragging)return!1;if(!1===n.props.onStop(t,A(rt(n),e)))return!1;var r={dragging:!1,slackX:0,slackY:0};if(Boolean(n.props.position)){var o=n.props.position,a=o.x,i=o.y;r.x=a,r.y=i}n.setState(r)}),n.state={dragging:!1,dragged:!1,x:t.position?t.position.x:t.defaultPosition.x,y:t.position?t.position.y:t.defaultPosition.y,prevPropsPosition:et({},t.position),slackX:0,slackY:0,isElementSVG:!1},!t.position||t.onDrag||t.onStop||console.warn("A `position` was applied to this <Draggable>, without drag handlers. This will make this component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the `position` of this element."),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(e,o.a.Component),at(e,null,[{key:"getDerivedStateFromProps",value:function(t,e){var n=t.position,r=e.prevPropsPosition;return!n||r&&n.x===r.x&&n.y===r.y?null:{x:n.x,y:n.y,prevPropsPosition:et({},n)}}}]),at(e,[{key:"componentDidMount",value:function(){void 0!==window.SVGElement&&u.a.findDOMNode(this)instanceof window.SVGElement&&this.setState({isElementSVG:!0})}},{key:"componentWillUnmount",value:function(){this.setState({dragging:!1})}},{key:"render",value:function(){var t,e=this.props,n=(e.axis,e.bounds,e.children),r=e.defaultPosition,a=e.defaultClassName,i=e.defaultClassNameDragging,s=e.defaultClassNameDragged,u=e.position,c=e.positionOffset,f=(e.scale,Z(e,["axis","bounds","children","defaultPosition","defaultClassName","defaultClassNameDragging","defaultClassNameDragged","position","positionOffset","scale"])),p={},d=null,g=!Boolean(u)||this.state.dragging,y=u||r,h={x:X(this)&&g?this.state.x:y.x,y:Y(this)&&g?this.state.y:y.y};this.state.isElementSVG?d=function(t,e){return C(t,e,"")}(h,c):p=function(t,e){var n=C(t,e,"px");return w({},b("transform",m),n)}(h,c);var v=l()(n.props.className||"",a,(st(t={},i,this.state.dragging),st(t,s,this.state.dragged),t));return o.a.createElement(J,Q({},f,{onStart:this.onDragStart,onDrag:this.onDrag,onStop:this.onDragStop}),o.a.cloneElement(o.a.Children.only(n),{className:v,style:et({},n.props.style,{},p),transform:d}))}}]),e}();st(ut,"displayName","Draggable"),st(ut,"propTypes",et({},J.propTypes,{axis:i.a.oneOf(["both","x","y","none"]),bounds:i.a.oneOfType([i.a.shape({left:i.a.number,right:i.a.number,top:i.a.number,bottom:i.a.number}),i.a.string,i.a.oneOf([!1])]),defaultClassName:i.a.string,defaultClassNameDragging:i.a.string,defaultClassNameDragged:i.a.string,defaultPosition:i.a.shape({x:i.a.number,y:i.a.number}),positionOffset:i.a.shape({x:i.a.oneOfType([i.a.number,i.a.string]),y:i.a.oneOfType([i.a.number,i.a.string])}),position:i.a.shape({x:i.a.number,y:i.a.number}),className:y,style:y,transform:y})),st(ut,"defaultProps",et({},J.defaultProps,{axis:"both",bounds:!1,defaultClassName:"react-draggable",defaultClassNameDragging:"react-draggable-dragging",defaultClassNameDragged:"react-draggable-dragged",defaultPosition:{x:0,y:0},position:null,scale:1}))}])});
//# sourceMappingURL=react-draggable.min.js.map

/***/ }),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

var g;

// This works in non-strict mode
g = (function() {
	return this;
})();

try {
	// This works if eval is allowed (see CSP)
	g = g || new Function("return this")();
} catch (e) {
	// This works if the window reference is available
	if (typeof window === "object") g = window;
}

// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}

module.exports = g;


/***/ }),

/***/ "./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function(module) {
	if (!module.webpackPolyfill) {
		module.deprecate = function() {};
		module.paths = [];
		// module.parent = undefined by default
		if (!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		module.webpackPolyfill = 1;
	}
	return module;
};


/***/ }),

/***/ "./src/Browser.ts":
/*!************************!*\
  !*** ./src/Browser.ts ***!
  \************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
var Browser = /** @class */ (function () {
    function Browser() {
    }
    Object.defineProperty(Browser, "AudioContext", {
        get: function () {
            if (Browser._AudioContext === null) {
                Browser._AudioContext =
                    typeof (AudioContext) != 'undefined' ? new AudioContext() :
                        typeof (window.webkitAudioContext) != 'undefined' ? new window.webkitAudioContext() :
                            typeof (window.mozAudioContext) != 'undefined' ? new window.mozAudioContext() : null;
            }
            return Browser._AudioContext;
        },
        enumerable: true,
        configurable: true
    });
    Browser.bindRequestPointerLock = function (domElement) {
        domElement.requestPointerLock =
            domElement.requestPointerLock ||
                domElement.mozRequestPointerLock ||
                domElement.webkitRequestPointerLock;
    };
    Browser.bindRequestFullscreen = function (domElement) {
        domElement.requestFullscreen =
            domElement.requestFullscreen ||
                domElement.mozRequestFullScreen ||
                domElement.webkitRequestFullscreen ||
                domElement.webkitRequestFullScreen;
    };
    Object.defineProperty(Browser, "QueryString", {
        get: function () {
            var query_string = {}, query = window.location.search.substring(1), vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                // If first entry with this name
                if (typeof query_string[decodeURIComponent(pair[0])] === "undefined") {
                    query_string[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);
                    // If second entry with this name
                }
                else if (typeof query_string[decodeURIComponent(pair[0])] === "string") {
                    var arr = [query_string[decodeURIComponent(pair[0])], decodeURIComponent(pair[1])];
                    query_string[decodeURIComponent(pair[0])] = arr;
                    // If third or later entry with this name
                }
                else {
                    query_string[decodeURIComponent(pair[0])].push(decodeURIComponent(pair[1]));
                }
            }
            Browser._qs = query_string;
            return Browser._qs;
        },
        enumerable: true,
        configurable: true
    });
    Browser._qs = null;
    Browser._AudioContext = null;
    return Browser;
}());
/* harmony default export */ __webpack_exports__["default"] = (Browser);


/***/ }),

/***/ "./src/CSM/CSM.ts":
/*!************************!*\
  !*** ./src/CSM/CSM.ts ***!
  \************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _StandardShadow__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./StandardShadow */ "./src/CSM/StandardShadow.ts");
/* harmony import */ var _CSMGUI__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./CSMGUI */ "./src/CSM/CSMGUI.tsx");
/* harmony import */ var _csmShadowGenerator__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./csmShadowGenerator */ "./src/CSM/csmShadowGenerator.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




var CSM = /** @class */ (function (_super) {
    __extends(CSM, _super);
    function CSM(scene, camera, parent, name) {
        var _this = _super.call(this, scene, camera, parent, name) || this;
        window.csm = _this;
        return _this;
        //this._shadowMapPlane.rotate(new Vector3(0, 0, 1), -Math.PI / 2);
        //this._shadowMapPlane.bakeCurrentTransformIntoVertices();
    }
    CSM.prototype.getCSMGenerator = function () {
        return this._shadowGenerator;
    };
    Object.defineProperty(CSM.prototype, "cameraNearPlane", {
        get: function () {
            return this._cameraNearPlane;
        },
        set: function (cnp) {
            this._cameraNearPlane = cnp;
            this.camera.minZ = cnp;
            this.getCSMGenerator().setDistanceSplit();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "cameraFarPlane", {
        get: function () {
            return this._cameraFarPlane;
        },
        set: function (cfp) {
            this._cameraFarPlane = cfp;
            this.camera.maxZ = cfp;
            this.getCSMGenerator().setDistanceSplit();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmNumCascades", {
        get: function () {
            return this._csmNumCascades;
        },
        set: function (num) {
            this._csmNumCascades = num;
            this.getCSMGenerator().dispose();
            this._csmActiveCascade = 0;
            this.createShadowGenerator();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmActiveCascade", {
        get: function () {
            return this._csmActiveCascade;
        },
        set: function (cac) {
            this._csmActiveCascade = cac;
            this.getCSMGenerator().activeCascade = cac;
            this._shadowMapFilter = this.getCSMGenerator().filter;
            this._shadowMapBias = this.getCSMGenerator().bias;
            this._shadowMapNormalBias = this.getCSMGenerator().normalBias;
            this._shadowMapDarkness = this.getCSMGenerator().darkness;
            this._shadowMapQuality = this.getCSMGenerator().filteringQuality;
            this._shadowMapDepthScale = this.getCSMGenerator().depthScale;
            this._shadowMapBlurScale = this.getCSMGenerator().blurScale;
            this._shadowMapUseKernelBlur = this.getCSMGenerator().useKernelBlur;
            this._shadowMapBlurKernel = this.getCSMGenerator().blurKernel;
            this._shadowMapBlurBoxOffset = this.getCSMGenerator().blurBoxOffset;
            this._shadowMapLightSizeUVRatio = this.getCSMGenerator().contactHardeningLightSizeUVRatio;
            this.setShadowMapViewerTexture();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmVisualizeCascades", {
        get: function () {
            return this._csmVisualizeCascades;
        },
        set: function (cvc) {
            this._csmVisualizeCascades = cvc;
            this.getCSMGenerator().debug = cvc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmStabilizeCascades", {
        get: function () {
            return this._csmStabilizeCascades;
        },
        set: function (ssc) {
            this._csmStabilizeCascades = ssc;
            this.getCSMGenerator().stabilizeCascades = ssc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmDepthClamp", {
        get: function () {
            return this._csmDepthClamp;
        },
        set: function (cdc) {
            this._csmDepthClamp = cdc;
            this.getCSMGenerator().depthClamp = cdc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmLambda", {
        get: function () {
            return this._csmLambda;
        },
        set: function (cl) {
            this._csmLambda = cl;
            this.getCSMGenerator().lambda = cl;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmUseRightDirectionAsUpForOrthoProj", {
        get: function () {
            return this._csmUseRightDirectionAsUpForOrthoProj;
        },
        set: function (curdfop) {
            this._csmUseRightDirectionAsUpForOrthoProj = curdfop;
            this.getCSMGenerator().useRightDirectionAsUpForOrthoProj = curdfop;
        },
        enumerable: true,
        configurable: true
    });
    CSM.prototype.getLightExtents = function () {
        var cascade = this.getCSMGenerator().cascade;
        if (!cascade) {
            return null;
        }
        var csmSM = cascade.generator;
        return {
            "min": csmSM.lightMinExtents,
            "max": csmSM.lightMaxExtents,
        };
    };
    CSM.prototype.createGUI = function () {
        this.gui = new _CSMGUI__WEBPACK_IMPORTED_MODULE_2__["default"](this.name, this.scene.getEngine(), this._container, this);
        this.gui.createGUI();
    };
    CSM.prototype.createGenerator = function () {
        var generator = new _csmShadowGenerator__WEBPACK_IMPORTED_MODULE_3__["CSMShadowGenerator"](this.shadowMapSize, this.sun, this._csmNumCascades);
        ;
        generator.activeCascade = _csmShadowGenerator__WEBPACK_IMPORTED_MODULE_3__["CSMShadowGenerator"].CASCADE_ALL;
        return generator;
    };
    CSM.prototype.setShadowMapViewerTexture = function () {
        this._shadowMapPlane.material.diffuseTexture =
            this._csmActiveCascade !== _csmShadowGenerator__WEBPACK_IMPORTED_MODULE_3__["CSMShadowGenerator"].CASCADE_ALL && this._shadowMapFilter !== babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF ? this.getCSMGenerator().getShadowMaps()[this._csmActiveCascade] : null;
    };
    CSM.prototype.createShadowGenerator = function () {
        _super.prototype.createShadowGenerator.call(this);
        var shadowGenerator = this.getCSMGenerator();
        shadowGenerator.stabilizeCascades = this._csmStabilizeCascades;
        shadowGenerator.depthClamp = this._csmDepthClamp;
        shadowGenerator.lambda = this._csmLambda;
        shadowGenerator.freezeShadowCastersBoundingInfo = true;
        shadowGenerator.activeCascade = this._csmActiveCascade;
        this.setShadowMapViewerTexture();
    };
    CSM.className = "CSM";
    return CSM;
}(_StandardShadow__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (CSM);


/***/ }),

/***/ "./src/CSM/CSMGUI.tsx":
/*!****************************!*\
  !*** ./src/CSM/CSMGUI.tsx ***!
  \****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SplitBaseGUI */ "./src/CSM/SplitBaseGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var CSMGUI = /** @class */ (function (_super) {
    __extends(CSMGUI, _super);
    function CSMGUI(name, engine, container, parent) {
        var _this = _super.call(this, name, engine, container, parent) || this;
        _this._showAutoCalcPlanes = false;
        _this._showCSM = true;
        _this.dimensions.height = 860;
        return _this;
    }
    CSMGUI.prototype.createCustomGUIProperties = function () {
        var Properties = function () {
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
        };
        return Properties();
    };
    return CSMGUI;
}(_SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (CSMGUI);


/***/ }),

/***/ "./src/CSM/GlobalGUI.tsx":
/*!*******************************!*\
  !*** ./src/CSM/GlobalGUI.tsx ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @material-ui/core */ "@material-ui/core");
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_material_ui_core__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _MainGUI__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../MainGUI */ "./src/MainGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};




var GlobalGUI = /** @class */ (function (_super) {
    __extends(GlobalGUI, _super);
    function GlobalGUI(name, engine, parent) {
        var _this = _super.call(this, name, engine, parent) || this;
        _this._selectedScene = 0;
        _this.scenes = [
            {
                "dname": "Power Plant",
                "path": "./resources/3d/powerplant/",
                "name": "powerplant.obj",
                "backfaceCulling": false,
                "camera": {
                    "position": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](40, 5, 5),
                    "target": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](0, 0, 5),
                },
                "scaling": 0.5,
                "sunColor": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Color3"](1, 1, 1),
                "light": {
                    "nearPlane": -90,
                    "farPlane": 130,
                },
            },
            {
                "dname": "Tower",
                "path": "./resources/3d/Tower/",
                "name": "Tower.obj",
                "backfaceCulling": true,
                "camera": {
                    "position": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](40, 5, 5),
                    "target": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](0, 5, 5),
                },
                "scaling": 0.025,
                "sunColor": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Color3"](1, 0.8, 0.5),
                "light": {
                    "nearPlane": -50,
                    "farPlane": 150,
                },
            } /*,
            {
                "dname": "Dude",
                "path": "./resources/3d/Dude/",
                "name": "dude.babylon",
                "backfaceCulling": true,
                "camera": {
                    "position": new Vector3(0, 76, 154),
                    "target": new Vector3(0, 0, 0),
                },
                "scaling": 0.25,
            }*/,
            {
                "dname": "Columns",
                "path": "./resources/3d/Columns/",
                "name": "Columns.obj",
                "backfaceCulling": true,
                "camera": {
                    "position": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](40, 5, 5),
                    "target": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](0, 5, 5),
                },
                "scaling": 0.25,
                "sunColor": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Color3"](1, 0.8, 0.5),
                "light": {
                    "nearPlane": -92,
                    "farPlane": 150,
                },
            }
        ];
        return _this;
    }
    Object.defineProperty(GlobalGUI.prototype, "selectedScene", {
        get: function () {
            return this._selectedScene;
        },
        enumerable: true,
        configurable: true
    });
    GlobalGUI.prototype.createCustomGUIProperties = function () {
        var _this = this;
        var classes = this._useStyles();
        var _a = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](this._selectedScene), 2), scene = _a[0], setScene = _a[1];
        var changeScene = function (event, child) {
            _this._selectedScene = event.target.value;
            setScene(_this._selectedScene);
        };
        return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyTitle }, "Scene")),
            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, id: "scene", value: scene, onChange: changeScene }, this.scenes.map(function (scene, idx) {
                    return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { key: idx, value: idx }, scene.dname));
                })))));
    };
    return GlobalGUI;
}(_MainGUI__WEBPACK_IMPORTED_MODULE_3__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (GlobalGUI);


/***/ }),

/***/ "./src/CSM/SplitBase.ts":
/*!******************************!*\
  !*** ./src/CSM/SplitBase.ts ***!
  \******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sample */ "./src/Sample.ts");
/* harmony import */ var _Split__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Split */ "./src/Split.ts");
/* harmony import */ var _Utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../Utils */ "./src/Utils.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




var SplitBase = /** @class */ (function (_super) {
    __extends(SplitBase, _super);
    function SplitBase(scene, camera, parent, name) {
        var _this = _super.call(this, scene, camera, parent, name) || this;
        _this._sunDir = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]();
        _this._sunColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"]();
        _this._sceneName = "";
        _this._cameraNearPlane = 0.25;
        _this._cameraFarPlane = 250;
        _this._animateLight = false;
        _this._autoCalcShadowZBounds = false;
        _this._lightNearPlane = -90;
        _this._lightFarPlane = 130;
        _this._showLightHelper = false;
        _this._rotateLightObservable = null;
        _this._shadowMapShowDepthMap = false;
        _this._showDepthMapObservable = null;
        _this._shadowMapSize = 1024;
        _this._shadowMapFilter = babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF;
        _this._shadowMapBias = 0.007;
        _this._shadowMapNormalBias = 0;
        _this._shadowMapDarkness = 0;
        _this._shadowMapQuality = babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].QUALITY_MEDIUM;
        _this._shadowMapDepthScale = 25;
        _this._shadowMapBlurScale = 2;
        _this._shadowMapUseKernelBlur = true;
        _this._shadowMapBlurKernel = 1;
        _this._shadowMapBlurBoxOffset = 1;
        _this._shadowMapLightSizeUVRatio = 0.005;
        _this._csmNumCascades = 4;
        _this._csmActiveCascade = 0;
        _this._csmVisualizeCascades = false;
        _this._csmStabilizeCascades = true;
        _this._csmDepthClamp = false;
        _this._csmLambda = 0.7;
        _this._csmUseRightDirectionAsUpForOrthoProj = false;
        _this._shadowMapPlane = null;
        var size = 1;
        _this._shadowMapPlane = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreatePlane(_this.name + "_shadowmap", {
            "width": size,
            "height": size,
        }, _this.scene);
        _this._shadowMapPlane.position.x += size / 2;
        _this._shadowMapPlane.position.y -= size / 2;
        _this._shadowMapPlane.bakeCurrentTransformIntoVertices();
        _this._shadowMapPlane.alwaysSelectAsActiveMesh = true;
        var material = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"](_this.name + "_shadowmap_material", scene);
        material.emissiveColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1);
        material.disableLighting = true;
        material.depthFunction = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Engine"].ALWAYS;
        _this._shadowMapPlane.material = material;
        _this._shadowMapPlane.setEnabled(false);
        return _this;
    }
    SplitBase.prototype.render = function () {
        var sky = this.scene.getMeshByName("skyBox");
        if (sky) {
            sky.position.set(this.camera.position.x, this.camera.position.y, this.camera.position.z);
        }
        _super.prototype.render.call(this);
    };
    Object.defineProperty(SplitBase.prototype, "shadowMapPlane", {
        get: function () {
            return this._shadowMapPlane;
        },
        enumerable: true,
        configurable: true
    });
    SplitBase.prototype.initialize = function (scene, ambientColor, sunDir) {
        return Promise.resolve(this);
    };
    Object.defineProperty(SplitBase.prototype, "sceneName", {
        get: function () {
            return this._sceneName;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "cameraNearPlane", {
        get: function () {
            return this._cameraNearPlane;
        },
        set: function (cnp) {
            this._cameraNearPlane = cnp;
            this.camera.minZ = cnp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "cameraFarPlane", {
        get: function () {
            return this._cameraFarPlane;
        },
        set: function (cfp) {
            this._cameraFarPlane = cfp;
            this.camera.maxZ = cfp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "animateLight", {
        get: function () {
            return this._animateLight;
        },
        set: function (al) {
            if (this._rotateLightObservable && !al) {
                this.scene.onBeforeRenderObservable.remove(this._rotateLightObservable);
                this._rotateLightObservable = null;
            }
            this._animateLight = al;
            if (!this._rotateLightObservable && al) {
                this._rotateLightObservable = this.scene.onBeforeRenderObservable.add(this.rotateLight.bind(this));
            }
            this.setDirectionFromSibling(this._animateLight);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightColor", {
        get: function () {
            return this._sunColor.toHexString();
        },
        set: function (lc) {
            this._sunColor = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"].FromHexString(lc);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightDirection", {
        get: function () {
            return this._sunDir;
        },
        set: function (ld) {
            this._sunDir = ld;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "showLightHelper", {
        get: function () {
            return this._showLightHelper;
        },
        set: function (slh) {
            this._showLightHelper = slh;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapShowDepthMap", {
        get: function () {
            return this._shadowMapShowDepthMap;
        },
        set: function (smsdm) {
            if (this._shadowMapShowDepthMap && !smsdm) {
                this.scene.onBeforeRenderObservable.remove(this._showDepthMapObservable);
                this._showDepthMapObservable = null;
            }
            this._shadowMapShowDepthMap = smsdm;
            this._shadowMapPlane.setEnabled(smsdm);
            if (!this._showDepthMapObservable && smsdm) {
                this._showDepthMapObservable = this.scene.onBeforeRenderObservable.add(this.showDepthMap.bind(this));
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapSize", {
        get: function () {
            return this._shadowMapSize;
        },
        set: function (sms) {
            this._shadowMapSize = sms;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapFilter", {
        get: function () {
            return this._shadowMapFilter;
        },
        set: function (smf) {
            this._shadowMapFilter = smf;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBias", {
        get: function () {
            return this._shadowMapBias;
        },
        set: function (smb) {
            this._shadowMapBias = smb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapNormalBias", {
        get: function () {
            return this._shadowMapNormalBias;
        },
        set: function (smnb) {
            this._shadowMapNormalBias = smnb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapDarkness", {
        get: function () {
            return this._shadowMapDarkness;
        },
        set: function (smd) {
            this._shadowMapDarkness = smd;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapQuality", {
        get: function () {
            return this._shadowMapQuality;
        },
        set: function (smq) {
            this._shadowMapQuality = smq;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapDepthScale", {
        get: function () {
            return this._shadowMapDepthScale;
        },
        set: function (smds) {
            this._shadowMapDepthScale = smds;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBlurScale", {
        get: function () {
            return this._shadowMapBlurScale;
        },
        set: function (smbs) {
            this._shadowMapBlurScale = smbs;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapUseKernelBlur", {
        get: function () {
            return this._shadowMapUseKernelBlur;
        },
        set: function (smukb) {
            this._shadowMapUseKernelBlur = smukb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBlurKernel", {
        get: function () {
            return this._shadowMapBlurKernel;
        },
        set: function (smbk) {
            this._shadowMapBlurKernel = smbk;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBlurBoxOffset", {
        get: function () {
            return this._shadowMapBlurBoxOffset;
        },
        set: function (smbbo) {
            this._shadowMapBlurBoxOffset = smbbo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapLightSizeUVRatio", {
        get: function () {
            return this._shadowMapLightSizeUVRatio;
        },
        set: function (smlsuvr) {
            this._shadowMapLightSizeUVRatio = smlsuvr;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightNearPlane", {
        get: function () {
            return this._lightNearPlane;
        },
        set: function (lnp) {
            this._lightNearPlane = lnp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightFarPlane", {
        get: function () {
            return this._lightFarPlane;
        },
        set: function (lfp) {
            this._lightFarPlane = lfp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "autoCalcShadowZBounds", {
        get: function () {
            return this._autoCalcShadowZBounds;
        },
        set: function (acszb) {
            this._autoCalcShadowZBounds = acszb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmNumCascades", {
        get: function () {
            return this._csmNumCascades;
        },
        set: function (num) {
            this._csmNumCascades = num;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmActiveCascade", {
        get: function () {
            return this._csmActiveCascade;
        },
        set: function (cac) {
            this._csmActiveCascade = cac;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmVisualizeCascades", {
        get: function () {
            return this._csmVisualizeCascades;
        },
        set: function (cvc) {
            this._csmVisualizeCascades = cvc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmStabilizeCascades", {
        get: function () {
            return this._csmStabilizeCascades;
        },
        set: function (csc) {
            this._csmStabilizeCascades = csc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmDepthClamp", {
        get: function () {
            return this._csmDepthClamp;
        },
        set: function (cdc) {
            this._csmDepthClamp = cdc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmLambda", {
        get: function () {
            return this._csmLambda;
        },
        set: function (cl) {
            this._csmLambda = cl;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmUseRightDirectionAsUpForOrthoProj", {
        get: function () {
            return this._csmUseRightDirectionAsUpForOrthoProj;
        },
        set: function (curdfop) {
            this._csmUseRightDirectionAsUpForOrthoProj = curdfop;
        },
        enumerable: true,
        configurable: true
    });
    SplitBase.prototype.setDirectionFromSibling = function (checkAnimate) {
        if (checkAnimate === void 0) { checkAnimate = true; }
        for (var i = 0; i < this._container.splits.length; ++i) {
            var ssplit = this._container.splits[i];
            if (ssplit !== this && (ssplit.animateLight === checkAnimate) && ssplit.group === this.group) {
                this.lightDirection = ssplit.lightDirection.clone();
                break;
            }
        }
    };
    SplitBase.prototype.rotateLight = function () {
        var deltaTime = this.scene.getEngine().getDeltaTime() / 1000;
        var matrix = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"]();
        var rotY = _Utils__WEBPACK_IMPORTED_MODULE_3__["default"].XMScalarModAngle(deltaTime * 0.25);
        var rotation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Quaternion"].RotationAxis(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0.0, 1.0, 0.0), rotY);
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].FromQuaternionToRef(rotation, matrix);
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinatesToRef(this._sunDir, matrix, this._sunDir);
        this.lightDirection = this._sunDir;
    };
    SplitBase.prototype.showDepthMap = function () {
        this.camera.getViewMatrix(); // make sure the transformation matrix we get when calling 'getTransformationMatrix()' is calculated with an up to date view matrix
        var invertCameraViewProj = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Invert(this.camera.getTransformationMatrix());
        var h = 256 / this.scene.getEngine().getRenderWidth(true);
        var pOfst = 0;
        if (this._container.splitMode === _Sample__WEBPACK_IMPORTED_MODULE_1__["enumSplitMode"].LINEAR) {
            var sidx = this._container.splits.indexOf(this), sw = 2 / this._container.splits.length;
            pOfst = sw * sidx + sw / 2 - h;
        }
        else {
            pOfst = 1 - h;
        }
        var p = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1, 1, -1 + 0.001);
        var q = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1 + h * 2, 1, -1 + 0.001);
        var pt = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(p, invertCameraViewProj);
        var qt = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(q, invertCameraViewProj);
        var d = qt.subtract(pt).length();
        this.shadowMapPlane.scaling = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](d, d, 1);
        p.x += pOfst;
        this.shadowMapPlane.rotation = this.camera.rotation;
        this.shadowMapPlane.position = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(p, invertCameraViewProj);
    };
    return SplitBase;
}(_Split__WEBPACK_IMPORTED_MODULE_2__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (SplitBase);


/***/ }),

/***/ "./src/CSM/SplitBaseGUI.tsx":
/*!**********************************!*\
  !*** ./src/CSM/SplitBaseGUI.tsx ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @material-ui/core */ "@material-ui/core");
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_material_ui_core__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _GUI__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../GUI */ "./src/GUI.tsx");
/* harmony import */ var _SplitGUI__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../SplitGUI */ "./src/SplitGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (undefined && undefined.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};





var SplitBaseGUI = /** @class */ (function (_super) {
    __extends(SplitBaseGUI, _super);
    function SplitBaseGUI(name, engine, container, parent) {
        var _this = _super.call(this, name, engine, container, parent) || this;
        _this._sparent = parent;
        _this._showAutoCalcPlanes = true;
        _this._showCSM = false;
        _this.dimensions.width = 320;
        _this.dimensions.height = 750;
        return _this;
    }
    SplitBaseGUI.prototype.createCustomGUI = function () {
        var _this = this;
        var classes = this._useStyles();
        var Properties = function () {
            //const [ignored, forceUpdate] = React.useReducer((x) => x + 1, 0);
            var _a = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.cameraNearPlane), 2), cameraNearPlane = _a[0], setCameraNearPlane = _a[1];
            var _b = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.cameraFarPlane), 2), cameraFarPlane = _b[0], setCameraFarPlane = _b[1];
            var _c = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.animateLight), 2), animateLight = _c[0], setAnimateLight = _c[1];
            var _d = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.lightColor), 2), lightColor = _d[0], setLightColor = _d[1];
            var _e = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](Math.floor(_this._sparent.lightNearPlane)), 2), lightNearPlane = _e[0], setLightNearPlane = _e[1];
            var _f = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](Math.floor(_this._sparent.lightFarPlane)), 2), lightFarPlane = _f[0], setLightFarPlane = _f[1];
            var _g = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.autoCalcShadowZBounds), 2), autoCalcShadowZBounds = _g[0], setAutoCalcShadowZBounds = _g[1];
            var _h = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.showLightHelper), 2), showLightHelper = _h[0], setShowLightHelper = _h[1];
            var _j = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapShowDepthMap), 2), shadowMapShowDepthMap = _j[0], setShadowMapShowDepthMap = _j[1];
            var _k = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapSize), 2), shadowMapSize = _k[0], setShadowMapSize = _k[1];
            var _l = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBias), 2), shadowMapBias = _l[0], setShadowMapBias = _l[1];
            var _m = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapNormalBias), 2), shadowMapNormalBias = _m[0], setShadowMapNormalBias = _m[1];
            var _o = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapDarkness), 2), shadowMapDarkness = _o[0], setShadowMapDarkness = _o[1];
            var _p = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapFilter), 2), shadowMapFilter = _p[0], setShadowMapFilter = _p[1];
            var _q = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapQuality), 2), shadowMapQuality = _q[0], setShadowMapQuality = _q[1];
            var _r = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapDepthScale), 2), shadowMapDepthScale = _r[0], setShadowMapDepthScale = _r[1];
            var _s = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBlurScale), 2), shadowMapBlurScale = _s[0], setShadowMapBlurScale = _s[1];
            var _t = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapUseKernelBlur), 2), shadowMapUseKernelBlur = _t[0], setShadowMapUseKernelBlur = _t[1];
            var _u = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBlurKernel), 2), shadowMapBlurKernel = _u[0], setShadowMapBlurKernel = _u[1];
            var _v = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBlurBoxOffset), 2), shadowMapBlurBoxOffset = _v[0], setShadowMapBlurBoxOffset = _v[1];
            var _w = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapLightSizeUVRatio), 2), shadowMapLightSizeUVRatio = _w[0], setShadowMapLightSizeUVRatio = _w[1];
            var _x = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmNumCascades), 2), csmNumCascades = _x[0], setCSMNumCascades = _x[1];
            var _y = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmActiveCascade), 2), csmActiveCascade = _y[0], setCSMActiveCascade = _y[1];
            var _z = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmVisualizeCascades), 2), csmVisualizeCascades = _z[0], setCSMVisualizeCascades = _z[1];
            var _0 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmStabilizeCascades), 2), csmStabilizeCascades = _0[0], setCSMStabilizeCascades = _0[1];
            var _1 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmDepthClamp), 2), csmDepthClamp = _1[0], setCSMDepthClamp = _1[1];
            var _2 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmLambda), 2), csmLambda = _2[0], setCSMLambda = _2[1];
            var _3 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmUseRightDirectionAsUpForOrthoProj), 2), csmUseRightDirectionAsUpForOrthoProj = _3[0], setCSMUseRightDirectionAsUpForOrthoProj = _3[1];
            var changeCameraNearPlane = function (event, value) {
                _this._sparent.cameraNearPlane = value;
                setCameraNearPlane(_this._sparent.cameraNearPlane);
            };
            var changeCameraFarPlane = function (event, value) {
                _this._sparent.cameraFarPlane = value;
                setCameraFarPlane(_this._sparent.cameraFarPlane);
            };
            var changeAnimateLight = function (event, checked) {
                setAnimateLight(checked);
                _this._sparent.animateLight = checked;
            };
            var changeLightColor = function (event) {
                _this._sparent.lightColor = event.target.value;
                setLightColor(_this._sparent.lightColor);
            };
            var changeLightNearPlane = function (event, value) {
                _this._sparent.lightNearPlane = value;
                setLightNearPlane(_this._sparent.lightNearPlane);
            };
            var changeLightFarPlane = function (event, value) {
                _this._sparent.lightFarPlane = value;
                setLightFarPlane(_this._sparent.lightFarPlane);
            };
            var changeAutoCalcShadowZBounds = function (event, checked) {
                setAutoCalcShadowZBounds(checked);
                _this._sparent.autoCalcShadowZBounds = checked;
            };
            var changeShowLightHelper = function (event, checked) {
                setShowLightHelper(checked);
                _this._sparent.showLightHelper = checked;
            };
            var changeShadowMapShowDepthMap = function (event, checked) {
                setShadowMapShowDepthMap(checked);
                _this._sparent.shadowMapShowDepthMap = checked;
            };
            var changeShadowMapSize = function (event, child) {
                _this._sparent.shadowMapSize = event.target.value;
                setShadowMapSize(_this._sparent.shadowMapSize);
            };
            var changeShadowMapBias = function (event) {
                _this._sparent.shadowMapBias = event.target.value;
                setShadowMapBias(_this._sparent.shadowMapBias);
            };
            var changeShadowMapNormalBias = function (event) {
                _this._sparent.shadowMapNormalBias = event.target.value;
                setShadowMapNormalBias(_this._sparent.shadowMapNormalBias);
            };
            var changeShadowMapDarkness = function (event, value) {
                _this._sparent.shadowMapDarkness = value;
                setShadowMapDarkness(_this._sparent.shadowMapDarkness);
            };
            var changeShadowMapFilter = function (event, child) {
                _this._sparent.shadowMapFilter = event.target.value;
                setShadowMapFilter(_this._sparent.shadowMapFilter);
            };
            var changeShadowMapQuality = function (event, child) {
                _this._sparent.shadowMapQuality = event.target.value;
                setShadowMapQuality(_this._sparent.shadowMapQuality);
            };
            var changeShadowMapDepthScale = function (event) {
                _this._sparent.shadowMapDepthScale = event.target.value;
                setShadowMapDepthScale(_this._sparent.shadowMapDepthScale);
            };
            var changeShadowMapBlurScale = function (event, value) {
                _this._sparent.shadowMapBlurScale = value;
                setShadowMapBlurScale(_this._sparent.shadowMapBlurScale);
            };
            var changeShadowMapUseKernelBlur = function (event, checked) {
                setShadowMapUseKernelBlur(checked);
                _this._sparent.shadowMapUseKernelBlur = checked;
            };
            var changeShadowMapBlurKernel = function (event, value) {
                _this._sparent.shadowMapBlurKernel = value;
                setShadowMapBlurKernel(_this._sparent.shadowMapBlurKernel);
            };
            var changeShadowMapBlurBoxOffset = function (event, value) {
                _this._sparent.shadowMapBlurBoxOffset = value;
                setShadowMapBlurBoxOffset(_this._sparent.shadowMapBlurBoxOffset);
            };
            var changeShadowMapLightSizeUVRatio = function (event) {
                _this._sparent.shadowMapLightSizeUVRatio = event.target.value;
                setShadowMapLightSizeUVRatio(_this._sparent.shadowMapLightSizeUVRatio);
            };
            var changeNumCascades = function (event, child) {
                _this._sparent.csmNumCascades = event.target.value;
                setCSMNumCascades(_this._sparent.csmNumCascades);
                setCSMActiveCascade(_this._sparent.csmActiveCascade);
            };
            var changeActiveCascade = function (event, child) {
                _this._sparent.csmActiveCascade = event.target.value;
                setCSMActiveCascade(_this._sparent.csmActiveCascade);
                setShadowMapBias(_this._sparent.shadowMapBias);
                setShadowMapNormalBias(_this._sparent.shadowMapNormalBias);
                setShadowMapDarkness(_this._sparent.shadowMapDarkness);
                setShadowMapFilter(_this._sparent.shadowMapFilter);
                setShadowMapQuality(_this._sparent.shadowMapQuality);
                setShadowMapDepthScale(_this._sparent.shadowMapDepthScale);
                setShadowMapBlurScale(_this._sparent.shadowMapBlurScale);
                setShadowMapUseKernelBlur(_this._sparent.shadowMapUseKernelBlur);
                setShadowMapBlurKernel(_this._sparent.shadowMapBlurKernel);
                setShadowMapBlurBoxOffset(_this._sparent.shadowMapBlurBoxOffset);
                setShadowMapLightSizeUVRatio(_this._sparent.shadowMapLightSizeUVRatio);
            };
            var changeCSMVisualizeCascades = function (event, checked) {
                setCSMVisualizeCascades(checked);
                _this._sparent.csmVisualizeCascades = checked;
            };
            var changeCSMStabilizeCascades = function (event, checked) {
                setCSMStabilizeCascades(checked);
                _this._sparent.csmStabilizeCascades = checked;
            };
            var changeCSMDepthClamp = function (event, checked) {
                setCSMDepthClamp(checked);
                _this._sparent.csmDepthClamp = checked;
            };
            var changeCSMLambda = function (event, value) {
                _this._sparent.csmLambda = value;
                setCSMLambda(_this._sparent.csmLambda);
            };
            var changeCSMUseRightDirectionAsUpForOrthoProj = function (event, checked) {
                setCSMUseRightDirectionAsUpForOrthoProj(checked);
                _this._sparent.csmUseRightDirectionAsUpForOrthoProj = checked;
            };
            react__WEBPACK_IMPORTED_MODULE_0__["useEffect"](function () {
                var handler = function (event) {
                    switch (event.detail.type) {
                        case 'setShadowZBounds': {
                            setLightNearPlane(Math.floor(_this._sparent.lightNearPlane));
                            setLightFarPlane(Math.floor(_this._sparent.lightFarPlane));
                            break;
                        }
                    }
                };
                window.addEventListener('gui_set_value', handler);
                return function () {
                    window.removeEventListener('gui_set_value', handler);
                };
            }, []);
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, "Scene")),
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Current Scene")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue }, _this._sparent.sceneName)),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Camera Near Plane")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: cameraNearPlane, min: 0, max: 10, step: 0.01, onChange: changeCameraNearPlane }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Camera Far Plane")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: cameraFarPlane, min: 0, max: 2000, step: 10, onChange: changeCameraFarPlane })))))),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, "Light")),
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Show Helper")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: showLightHelper, onChange: changeShowLightHelper }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Animate")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: animateLight, onChange: changeAnimateLight }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Color")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "color", value: lightColor, variant: "filled", onChange: changeLightColor }))),
                            _this._showAutoCalcPlanes && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Auto Calc Planes")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: autoCalcShadowZBounds, onChange: changeAutoCalcShadowZBounds }))),
                                 true && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Near Plane")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { disabled: autoCalcShadowZBounds, valueLabelDisplay: "auto", value: lightNearPlane, min: -250, max: 250, step: 1, onChange: changeLightNearPlane }))),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Far Plane")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { disabled: autoCalcShadowZBounds, valueLabelDisplay: "auto", value: lightFarPlane, min: 0, max: 500, step: 1, onChange: changeLightFarPlane })))))))),
                _this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, "Cascaded Shadow Maps")),
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Num of Cascades")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: csmNumCascades, onChange: changeNumCascades }, __spread(Array(8).keys()).map(function (_, i) { return react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { key: i + 1, value: i + 1 }, i + 1); }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Active Cascade")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: csmActiveCascade, onChange: changeActiveCascade }, __spread(Array(csmNumCascades).keys()).map(function (_, i) { return react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { key: i, value: i }, i + 1); }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Visualize Cascades")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmVisualizeCascades, onChange: changeCSMVisualizeCascades }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Stabilize Cascades")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmStabilizeCascades, onChange: changeCSMStabilizeCascades }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Depth Clamp")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmDepthClamp, onChange: changeCSMDepthClamp }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Lambda")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: csmLambda, min: 0, max: 1, step: 0.01, onChange: changeCSMLambda }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Use Right as Up")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmUseRightDirectionAsUpForOrthoProj, onChange: changeCSMUseRightDirectionAsUpForOrthoProj }))))))),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, _this._showCSM ? "Cascade" : "Shadow Map")),
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Show Depth Map")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: shadowMapShowDepthMap, onChange: changeShadowMapShowDepthMap }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Size")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapSize, onChange: changeShadowMapSize },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 2048 }, "2048x2048"),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 1024 }, "1024x1024"),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 512 }, "512x512"),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 256 }, "256x256"))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Bias")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapBias, variant: "standard", inputProps: { step: "0.001" }, onChange: changeShadowMapBias }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Normal Bias")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapNormalBias, variant: "standard", inputProps: { step: "0.001" }, onChange: changeShadowMapNormalBias }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Darkness")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: shadowMapDarkness, min: 0, max: 1, step: 0.01, onChange: changeShadowMapDarkness }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Filter Type")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                !_this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapFilter, onChange: changeShadowMapFilter },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCSS }, "PCSS"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCF }, "PCF"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLURCLOSEEXPONENTIALSHADOWMAP }, "CESM (Blur)"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_CLOSEEXPONENTIALSHADOWMAP }, "CESM"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP }, "ESM (Blur)"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_EXPONENTIALSHADOWMAP }, "ESM"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_POISSONSAMPLING }, "Poisson"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_NONE }, "None"))),
                                _this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapFilter, onChange: changeShadowMapFilter },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCF }, "PCF"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_NONE }, "None")))),
                            (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCSS || shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCF) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Filtering Quality")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapQuality, onChange: changeShadowMapQuality },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].QUALITY_LOW }, "Low"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].QUALITY_MEDIUM }, "Medium"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].QUALITY_HIGH }, "High")))),
                            (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCSS) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Light Size UV Ratio")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapLightSizeUVRatio, variant: "standard", inputProps: { step: "0.001" }, onChange: changeShadowMapLightSizeUVRatio })))),
                            (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP || shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_EXPONENTIALSHADOWMAP) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Depth Scale")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapDepthScale, variant: "standard", inputProps: { step: "1" }, onChange: changeShadowMapDepthScale })))),
                            (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Blur Scale")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", defaultValue: shadowMapBlurScale, min: 1, max: 4, step: 1, onChange: changeShadowMapBlurScale })))),
                            (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLURCLOSEEXPONENTIALSHADOWMAP || shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Use Kernel Blur")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: shadowMapUseKernelBlur, onChange: changeShadowMapUseKernelBlur }))),
                                shadowMapUseKernelBlur && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Blur Kernel")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", defaultValue: shadowMapBlurKernel, min: 1, max: 64, step: 1, onChange: changeShadowMapBlurKernel })))),
                                !shadowMapUseKernelBlur && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Blur Box Offset")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", defaultValue: shadowMapBlurBoxOffset, min: 1, max: 64, step: 1, onChange: changeShadowMapBlurBoxOffset })))))))),
                _this.createCustomGUIProperties()));
        };
        return Properties();
    };
    SplitBaseGUI.prototype.createCustomGUIProperties = function () {
        return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
    };
    return SplitBaseGUI;
}(_SplitGUI__WEBPACK_IMPORTED_MODULE_4__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (SplitBaseGUI);


/***/ }),

/***/ "./src/CSM/StandardShadow.ts":
/*!***********************************!*\
  !*** ./src/CSM/StandardShadow.ts ***!
  \***********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Utils */ "./src/Utils.ts");
/* harmony import */ var _SplitBase__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./SplitBase */ "./src/CSM/SplitBase.ts");
/* harmony import */ var _StandardShadowGUI__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./StandardShadowGUI */ "./src/CSM/StandardShadowGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};




var testFog = false;
var StandardShadow = /** @class */ (function (_super) {
    __extends(StandardShadow, _super);
    function StandardShadow(scene, camera, parent, name) {
        var _this = _super.call(this, scene, camera, parent, name) || this;
        _this.sun = null;
        _this._shadowGenerator = null;
        _this._lightHelperFrustumLines = [];
        _this._lightGizmo = null;
        return _this;
    }
    StandardShadow.prototype.getStandardGenerator = function () {
        return this._shadowGenerator;
    };
    Object.defineProperty(StandardShadow.prototype, "lightColor", {
        get: function () {
            return this._sunColor.toHexString();
        },
        set: function (lc) {
            this._sunColor = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"].FromHexString(lc);
            this.sun.diffuse = this._sunColor;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "lightDirection", {
        get: function () {
            return this._sunDir;
        },
        set: function (ld) {
            this._sunDir = ld;
            this.sun.direction = ld;
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapSize", {
        get: function () {
            return this._shadowMapSize;
        },
        set: function (sms) {
            this._shadowMapSize = sms;
            this.createShadowGenerator();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapFilter", {
        get: function () {
            return this._shadowMapFilter;
        },
        set: function (smf) {
            this.getStandardGenerator().filter = smf;
            this._shadowMapFilter = this.getStandardGenerator().filter;
            this.setShadowMapViewerTexture();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBias", {
        get: function () {
            return this._shadowMapBias;
        },
        set: function (smb) {
            this._shadowMapBias = smb;
            this.getStandardGenerator().bias = smb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapNormalBias", {
        get: function () {
            return this._shadowMapNormalBias;
        },
        set: function (smnb) {
            this._shadowMapNormalBias = smnb;
            this.getStandardGenerator().normalBias = smnb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapDarkness", {
        get: function () {
            return this._shadowMapDarkness;
        },
        set: function (smd) {
            this._shadowMapDarkness = smd;
            this.getStandardGenerator().darkness = smd;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapQuality", {
        get: function () {
            return this._shadowMapQuality;
        },
        set: function (smq) {
            this._shadowMapQuality = smq;
            this.getStandardGenerator().filteringQuality = smq;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapDepthScale", {
        get: function () {
            return this._shadowMapDepthScale;
        },
        set: function (smds) {
            this._shadowMapDepthScale = smds;
            this.getStandardGenerator().depthScale = smds;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBlurScale", {
        get: function () {
            return this._shadowMapBlurScale;
        },
        set: function (smbs) {
            this._shadowMapBlurScale = smbs;
            this.getStandardGenerator().blurScale = smbs;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapUseKernelBlur", {
        get: function () {
            return this._shadowMapUseKernelBlur;
        },
        set: function (smukb) {
            this._shadowMapUseKernelBlur = smukb;
            this.getStandardGenerator().useKernelBlur = smukb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBlurKernel", {
        get: function () {
            return this._shadowMapBlurKernel;
        },
        set: function (smbk) {
            this._shadowMapBlurKernel = smbk;
            this.getStandardGenerator().blurKernel = smbk;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBlurBoxOffset", {
        get: function () {
            return this._shadowMapBlurBoxOffset;
        },
        set: function (smbbo) {
            this._shadowMapBlurBoxOffset = smbbo;
            this.getStandardGenerator().blurBoxOffset = smbbo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapLightSizeUVRatio", {
        get: function () {
            return this._shadowMapLightSizeUVRatio;
        },
        set: function (smlsuvr) {
            this._shadowMapLightSizeUVRatio = smlsuvr;
            this.getStandardGenerator().contactHardeningLightSizeUVRatio = smlsuvr;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "lightNearPlane", {
        get: function () {
            return this._lightNearPlane;
        },
        set: function (lnp) {
            this._lightNearPlane = lnp;
            this.sun.shadowMinZ = lnp;
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "lightFarPlane", {
        get: function () {
            return this._lightFarPlane;
        },
        set: function (lfp) {
            this._lightFarPlane = lfp;
            this.sun.shadowMaxZ = lfp;
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "showLightHelper", {
        get: function () {
            return this._showLightHelper;
        },
        set: function (slh) {
            this._showLightHelper = slh;
            if (this._lightGizmo && !slh) {
                this._lightGizmo.dispose();
                this._lightGizmo = null;
            }
            if (slh) {
                this._lightGizmo = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["LightGizmo"]();
                this._lightGizmo.light = this.sun;
            }
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "autoCalcShadowZBounds", {
        get: function () {
            return this._autoCalcShadowZBounds;
        },
        set: function (acszb) {
            this._autoCalcShadowZBounds = acszb;
            this.sun.autoCalcShadowZBounds = acszb;
            if (this._autoCalcShadowZBounds) {
                // @ts-ignore
                this.sun.setShadowProjectionMatrix(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Identity(), this.getStandardGenerator().viewMatrix, this.getStandardGenerator().getShadowMaps()[0].renderList);
            }
            else {
                this._lightNearPlane = this.sun.shadowMinZ;
                this._lightFarPlane = this.sun.shadowMaxZ;
                var event_1 = new CustomEvent('gui_set_value', { detail: { type: 'setShadowZBounds' } });
                window.dispatchEvent(event_1);
            }
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    StandardShadow.prototype.getLightExtents = function () {
        var light = this.sun;
        return {
            "min": new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](light._orthoLeft, light._orthoBottom, this.sun.shadowMinZ),
            "max": new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](light._orthoRight, light._orthoTop, this.sun.shadowMaxZ),
        };
    };
    StandardShadow.prototype.getViewMatrix = function () {
        // @ts-ignore
        return this.getStandardGenerator().viewMatrix;
    };
    StandardShadow.prototype.buildLightHelper = function () {
        var _this = this;
        this._lightHelperFrustumLines.forEach(function (mesh) {
            mesh.dispose();
        });
        this._lightHelperFrustumLines = [];
        if (!this._showLightHelper) {
            return;
        }
        var lightExtents = this.getLightExtents();
        var lightView = this.getViewMatrix();
        if (!lightExtents || !lightView) {
            return;
        }
        var invLightView = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Invert(lightView);
        var n1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.max.y, lightExtents.min.z);
        var n2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.min.y, lightExtents.min.z);
        var n3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.min.y, lightExtents.min.z);
        var n4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.max.y, lightExtents.min.z);
        var near1 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n1, invLightView);
        var near2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n2, invLightView);
        var near3 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n3, invLightView);
        var near4 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n4, invLightView);
        var f1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.max.y, lightExtents.max.z);
        var f2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.min.y, lightExtents.max.z);
        var f3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.min.y, lightExtents.max.z);
        var f4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.max.y, lightExtents.max.z);
        var far1 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f1, invLightView);
        var far2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f2, invLightView);
        var far3 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f3, invLightView);
        var far4 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f4, invLightView);
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("nearlines", { points: [near1, near2, near3, near4, near1] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("farlines", { points: [far1, far2, far3, far4, far1] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("trlines", { points: [near1, far1] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("brlines", { points: [near2, far2] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("tllines", { points: [near3, far3] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("bllines", { points: [near4, far4] }, this.scene));
        var makePlane = function (name, color, positions) {
            var plane = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"](name + "plane", _this.scene), mat = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"](name + "PlaneMat", _this.scene);
            plane.material = mat;
            mat.emissiveColor = color;
            mat.alpha = 0.3;
            mat.backFaceCulling = false;
            mat.disableLighting = true;
            var indices = [0, 1, 2, 0, 2, 3];
            var vertexData = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["VertexData"]();
            vertexData.positions = positions;
            vertexData.indices = indices;
            vertexData.applyToMesh(plane);
            _this._lightHelperFrustumLines.push(plane);
        };
        makePlane("near", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 0, 0), [near1.x, near1.y, near1.z, near2.x, near2.y, near2.z, near3.x, near3.y, near3.z, near4.x, near4.y, near4.z]);
        makePlane("far", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0.3, 0, 0), [far1.x, far1.y, far1.z, far2.x, far2.y, far2.z, far3.x, far3.y, far3.z, far4.x, far4.y, far4.z]);
        makePlane("right", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 1, 0), [near1.x, near1.y, near1.z, far1.x, far1.y, far1.z, far2.x, far2.y, far2.z, near2.x, near2.y, near2.z]);
        makePlane("left", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0.3, 0), [near4.x, near4.y, near4.z, far4.x, far4.y, far4.z, far3.x, far3.y, far3.z, near3.x, near3.y, near3.z]);
        makePlane("top", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 1), [near1.x, near1.y, near1.z, far1.x, far1.y, far1.z, far4.x, far4.y, far4.z, near4.x, near4.y, near4.z]);
        makePlane("bottom", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0.3), [near2.x, near2.y, near2.z, far2.x, far2.y, far2.z, far3.x, far3.y, far3.z, near3.x, near3.y, near3.z]);
    };
    StandardShadow.prototype.createGUI = function () {
        this.gui = new _StandardShadowGUI__WEBPACK_IMPORTED_MODULE_3__["default"](this.name, this.scene.getEngine(), this._container, this);
        this.gui.createGUI();
    };
    StandardShadow.prototype.initialize = function (scene, ambientColor, sunDir) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.scene.metadata = { "name": this.name };
                        this._sceneName = scene.dname;
                        this._sunDir = sunDir;
                        this._sunColor = scene.sunColor.clone();
                        this.sun = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DirectionalLight"]("sun", sunDir, this.scene);
                        this.sun.intensity = 1;
                        this.sun.shadowMinZ = scene.light.nearPlane;
                        this.sun.shadowMaxZ = scene.light.farPlane;
                        this.sun.diffuse = this._sunColor;
                        window.sun = this.sun;
                        this._skyBox = _Utils__WEBPACK_IMPORTED_MODULE_1__["default"].addSkybox("Clouds.dds", this.scene, 100);
                        return [4 /*yield*/, _Utils__WEBPACK_IMPORTED_MODULE_1__["default"].loadObj(this.scene, scene.path, scene.name)];
                    case 1:
                        _a.sent();
                        this.scene.activeCamera = this.camera;
                        this.scene.meshes.forEach(function (m) {
                            if (m.name == 'skyBox' || m.name.indexOf("_shadowmap") >= 0) {
                                return;
                            }
                            if (!m.material) {
                                return;
                            }
                            var mat = m.material;
                            mat.diffuseColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1., 1., 1.);
                            mat.specularColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0., 0., 0.);
                            mat.ambientColor = ambientColor;
                            mat.ambientTexture = null;
                            mat.backFaceCulling = scene.backfaceCulling;
                            if (!mat.diffuseTexture) {
                                mat.ambientColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0);
                            }
                            //!mat.freeze();
                            m.receiveShadows = true;
                            if (scene.scaling != 1) {
                                var matrix = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Identity();
                                matrix.scaleToRef(scene.scaling, matrix);
                                matrix.setRowFromFloats(3, 0, 0, 0, 1);
                                m.bakeTransformIntoVertices(matrix);
                                m.refreshBoundingInfo();
                            }
                        });
                        this.createShadowGenerator();
                        return [2 /*return*/, this];
                }
            });
        });
    };
    StandardShadow.prototype.createGenerator = function () {
        return new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"](this.shadowMapSize, this.sun);
    };
    StandardShadow.prototype.setShadowMapViewerTexture = function () {
        // @ts-ignore
        this._shadowMapPlane.material.diffuseTexture = this._shadowMapFilter !== babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF ? this._shadowGenerator.getShadowMaps()[0] : null;
    };
    StandardShadow.prototype.createShadowGenerator = function () {
        var _this = this;
        if (this._shadowGenerator) {
            this._shadowGenerator.dispose();
            this._shadowGenerator = null;
        }
        var shadowGenerator = this.createGenerator();
        this._shadowGenerator = shadowGenerator;
        shadowGenerator.bias = this._shadowMapBias;
        shadowGenerator.normalBias = this._shadowMapNormalBias;
        shadowGenerator.darkness = this._shadowMapDarkness;
        shadowGenerator.filter = this._shadowMapFilter;
        shadowGenerator.filteringQuality = this._shadowMapQuality;
        shadowGenerator.depthScale = this._shadowMapDepthScale;
        shadowGenerator.blurScale = this._shadowMapBlurScale;
        shadowGenerator.useKernelBlur = this._shadowMapUseKernelBlur;
        shadowGenerator.blurKernel = this._shadowMapBlurKernel;
        shadowGenerator.blurBoxOffset = this._shadowMapBlurBoxOffset;
        shadowGenerator.contactHardeningLightSizeUVRatio = this._shadowMapLightSizeUVRatio;
        this.setShadowMapViewerTexture();
        window.sg = shadowGenerator;
        // @ts-ignore
        var renderList = shadowGenerator.renderList;
        var num = 0, lstm = [];
        this.scene.meshes.forEach(function (m) {
            if (m.name == 'skyBox') {
                return;
            }
            renderList.push(m);
            if (testFog) {
                var diffText = m.material.diffuseTexture;
                if (diffText) {
                    //m.material = this.buildNodeMaterial(diffText as Texture);
                    m.material = _this.buildShaderMaterial();
                    m.material.setTexture("TextureSampler", diffText);
                }
            }
            /*if (m.name == "mesh_108_Mesh_main_floor_subset_6" || m.name == "mesh_121_Mesh_g_bace_main05_subset_0") {
                if (m.name=="mesh_121_Mesh_g_bace_main05_subset_0")
                    renderList.push(m);
            } else {
                lstm.push(m);
            }*/
        });
        lstm.forEach(function (m) {
            m.dispose();
        });
        if (testFog) {
            this.scene.onBeforeRenderObservable.add(function () {
                var time = new Date().getTime();
                _this.scene.meshes.forEach(function (m) {
                    if (m.name == 'skyBox') {
                        return;
                    }
                    if (m.material instanceof babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShaderMaterial"]) {
                        m.material.setVector3("u_Cameraposition", _this.camera.position);
                        m.material.setFloat("u_FogRadius", 23 + 18 * Math.cos(time / 500));
                        m.material.setFloat("u_FogDensity", 7 + 5 * Math.cos(time / 500));
                    }
                });
            });
        }
    };
    StandardShadow.prototype.buildShaderMaterial = function () {
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["customVertexShader"] = "   \n        precision highp float;\n\n        attribute vec3 position;\n        attribute vec2 uv;\n        \n        \n        uniform mat4 world;\n        uniform mat4 worldViewProjection;\n        #ifdef UVTRANSFORM0\n        uniform mat4 textureTransform;\n        #endif\n        \n        \n        #ifdef UVTRANSFORM0\n        varying vec2 transformedUV;\n        #endif\n        #ifdef VMAINUV\n        varying vec2 vMainuv;\n        #endif\n        varying vec4 v_output2;\n        \n        \n        \n        \n        float u_ = 1.0;\n        float u_PIOver = 1.57;\n        float u_1 = 0.0;\n        float u_2 = 1.0;\n        float u_3 = 0.0;\n        float u_4 = 0.0;\n        float u_5 = 0.0;\n        float u_6 = 0.0;\n        \n        \n        void main(void) {\n        vec4 output2 = world * vec4(position, 1.0);\n        vec4 output1 = world * vec4(position, 1.0);\n        vec4 output0 = worldViewProjection * vec4(position, 1.0);\n        gl_Position = output0;\n        #ifdef UVTRANSFORM0\n        transformedUV = vec2(textureTransform * vec4(uv.xy, 1.0, 0.0));\n        #endif\n        #ifdef VMAINUV\n        vMainuv = uv.xy;\n        #endif\n        v_output2 = output2;\n        \n        }\n        ";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["customFragmentShader"] = "\n        precision highp float;\n\n        #ifdef UVTRANSFORM0\n        uniform mat4 textureTransform;\n        #endif\n        uniform vec3 u_FogColor;\n        uniform vec3 u_FogCenter;\n        uniform vec3 u_Cameraposition;\n        uniform float u_FogRadius;\n        uniform float u_FogDensity;\n        \n        \n        uniform sampler2D TextureSampler;\n        \n        \n        #ifdef UVTRANSFORM0\n        varying vec2 transformedUV;\n        #endif\n        #ifdef VMAINUV\n        varying vec2 vMainuv;\n        #endif\n        varying vec4 v_output2;\n\n        #include<helperFunctions>\n\n        float u_ = 1.0;\n        float u_PIOver = 1.57;\n        float u_1 = 0.0;\n        float u_2 = 1.0;\n        float u_3 = 0.0;\n        float u_4 = 0.0;\n        float u_5 = 0.0;\n        float u_6 = 0.0;\n        \n        void main(void) {\n            #ifdef UVTRANSFORM0\n            vec4 tempTextureRead = texture(TextureSampler, transformedUV);\n            #endif\n            #ifdef VMAINUV\n            vec4 tempTextureRead = texture(TextureSampler, vMainuv);\n            #endif\n            vec4 rgba = tempTextureRead.rgba;\n            #ifdef ISLINEAR0\n            rgba = toGammaSpace(rgba);\n            #endif\n\n            vec3 volFogCenter = u_FogCenter;\n            vec3 volFogColor = u_FogColor;\n            float volFogRadius = u_FogRadius;\n            vec4 vwPos = v_output2;\n            vec3 vwCamPos = u_Cameraposition;\n\n            float volFogRadius2 = volFogRadius * volFogRadius;\n            float distCamToPos = distance(vwPos.xyz, vwCamPos);\n            vec3 dir = normalize(vwPos.xyz - vwCamPos);\n            vec3 L = volFogCenter - vwCamPos;\n            float tca = dot(L, dir);\n            float d2 = dot(L, L) - tca * tca;\n        \n            float thc = sqrt(max(volFogRadius2 - d2, 0.0));\n            float t0 = tca - thc;\n            float t1 = tca + thc;\n            float dist =  mix(0.0, min(distCamToPos, t1), max(sign(-t0), 0.0)*max(sign(t1), 0.0))\n                        + mix(0.0, min(distCamToPos, t1) - t0, max(sign(t0), 0.0)*max(sign(t1), 0.0)*max(sign(distCamToPos - t0), 0.0));\n            float distToCenter = length(cross(volFogCenter - vwCamPos, dir));\n            float fr = smoothstep(0.0, 1.0, cos(distToCenter/volFogRadius*3.141592/2.0));\n            float e = dist/(volFogRadius*2.0);\n            e = 1.0 - exp(-e * u_FogDensity);\n            vec4 glFragColorWithFog = mix(rgba, vec4(volFogColor, rgba.a), clamp(e*fr, 0.0, 1.0));\n        \n            rgba = mix(rgba, glFragColorWithFog, max(sign(volFogRadius2 - d2), 0.0));\n        \n        \n            gl_FragColor = rgba;//output3;\n        }\n        ";
        var mat = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShaderMaterial"]("shader", this.scene, {
            vertex: "custom",
            fragment: "custom",
        }, {
            attributes: ["position", "uv"],
            uniforms: ["world", "worldViewProjection", "u_FogColor", "u_FogCenter", "u_FogRadius", "u_Cameraposition"],
            defines: ["#define VMAINUV"]
        });
        mat.setColor3("u_FogColor", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0.95, 0.95, 0.95));
        mat.setVector3("u_FogCenter", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 5, 0));
        mat.setFloat("u_FogRadius", 25);
        mat.setFloat("u_FogDensity", 4);
        return mat;
    };
    StandardShadow.prototype.buildNodeMaterial = function (diffText) {
        var nodeMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["NodeMaterial"]("node");
        // InputBlock
        var position = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("position");
        position.setAsAttribute("position");
        // TransformBlock
        var worldPos = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TransformBlock"]("worldPos");
        worldPos.complementZ = 0;
        worldPos.complementW = 1;
        // InputBlock
        var world = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("world");
        world.setAsSystemValue(babylonjs__WEBPACK_IMPORTED_MODULE_0__["NodeMaterialSystemValues"].World);
        // TransformBlock
        var Worldposition = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TransformBlock"]("World position");
        Worldposition.complementZ = 0;
        Worldposition.complementW = 1;
        // VectorSplitterBlock
        var VectorSplitter = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["VectorSplitterBlock"]("VectorSplitter");
        // SubtractBlock
        var wPoscamPos = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("wPos-camPos");
        // InputBlock
        var Cameraposition = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("Camera position");
        Cameraposition.setAsSystemValue(babylonjs__WEBPACK_IMPORTED_MODULE_0__["NodeMaterialSystemValues"].CameraPosition);
        // DistanceBlock
        var distCamToPos = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DistanceBlock"]("distCamToPos");
        // MinBlock
        var Min = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MinBlock"]("Min");
        // AddBlock
        var t = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["AddBlock"]("t1");
        // DotBlock
        var tca = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DotBlock"]("tca");
        // SubtractBlock
        var L = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("L");
        // InputBlock
        var FogCenter = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("Fog Center");
        FogCenter.value = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](30, 15, 0);
        FogCenter.isConstant = false;
        FogCenter.visibleInInspector = false;
        // SubtractBlock
        var Subtract = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("Subtract");
        // InputBlock
        var Cameraposition1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("Camera position");
        Cameraposition1.setAsSystemValue(babylonjs__WEBPACK_IMPORTED_MODULE_0__["NodeMaterialSystemValues"].CameraPosition);
        // CrossBlock
        var Cross = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["CrossBlock"]("Cross");
        // NormalizeBlock
        var dir = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["NormalizeBlock"]("dir");
        // LengthBlock
        var distToCenter = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["LengthBlock"]("distToCenter");
        // DivideBlock
        var Divide = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DivideBlock"]("Divide");
        // InputBlock
        var FogRadius = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("Fog Radius");
        FogRadius.value = 15;
        FogRadius.min = 0;
        FogRadius.max = 10;
        FogRadius.matrixMode = 0;
        FogRadius.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // MultiplyBlock
        var volFogRadius = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MultiplyBlock"]("volFogRadius2");
        // SubtractBlock
        var Subtract1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("Subtract");
        // SubtractBlock
        var d = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("d2");
        // DotBlock
        var LdotL = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DotBlock"]("LdotL");
        // MultiplyBlock
        var tcaSquare = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MultiplyBlock"]("tcaSquare");
        // SubtractBlock
        var Subtract2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("Subtract");
        // TrigonometryBlock
        var Sign = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("Sign");
        Sign.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Sign;
        // MaxBlock
        var Max = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MaxBlock"]("Max");
        // InputBlock
        var ce = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("c0e");
        ce.value = 0;
        ce.min = 0;
        ce.max = 0;
        ce.matrixMode = 0;
        ce.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // LerpBlock
        var Lerp = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["LerpBlock"]("Lerp");
        // TextureBlock
        var Texture_ = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TextureBlock"]("Texture");
        Texture_.texture = diffText;
        Texture_.texture.wrapU = 1;
        Texture_.texture.wrapV = 1;
        Texture_.texture.uAng = 0;
        Texture_.texture.vAng = 0;
        Texture_.texture.wAng = 0;
        Texture_.texture.uOffset = 0;
        Texture_.texture.vOffset = 0;
        Texture_.texture.uScale = 1;
        Texture_.texture.vScale = 1;
        Texture_.texture.gammaSpace = true;
        // InputBlock
        var uv = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("uv");
        uv.setAsAttribute("uv");
        // LerpBlock
        var glFragColorWithFog = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["LerpBlock"]("glFragColorWithFog");
        // VectorMergerBlock
        var VectorMerger = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["VectorMergerBlock"]("VectorMerger");
        // InputBlock
        var FogColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("Fog Color");
        FogColor.value = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0.9490196078431372, 0.9490196078431372, 0.9490196078431372);
        FogColor.isConstant = false;
        FogColor.visibleInInspector = false;
        // InputBlock
        var cb = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("c1b");
        cb.value = 1;
        cb.min = 0;
        cb.max = 0;
        cb.matrixMode = 0;
        cb.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // ClampBlock
        var Clamp = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ClampBlock"]("Clamp");
        Clamp.minimum = 0;
        Clamp.maximum = 1;
        // MultiplyBlock
        var Multiply = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MultiplyBlock"]("Multiply");
        // SmoothStepBlock
        var fr = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SmoothStepBlock"]("fr");
        // TrigonometryBlock
        var Cos = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("Cos");
        Cos.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Cos;
        // MultiplyBlock
        var Multiply1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MultiplyBlock"]("Multiply");
        // InputBlock
        var PIOverTwo = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("PIOverTwo");
        PIOverTwo.value = 1.57;
        PIOverTwo.min = 0;
        PIOverTwo.max = 0;
        PIOverTwo.matrixMode = 0;
        PIOverTwo.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // InputBlock
        var cd = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("c0d");
        cd.value = 0;
        cd.min = 0;
        cd.max = 0;
        cd.matrixMode = 0;
        cd.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // InputBlock
        var ca = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("c1a");
        ca.value = 1;
        ca.min = 0;
        ca.max = 0;
        ca.matrixMode = 0;
        ca.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // DivideBlock
        var Divide1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DivideBlock"]("Divide");
        // AddBlock
        var dist = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["AddBlock"]("dist");
        // LerpBlock
        var dist1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["LerpBlock"]("dist1");
        // InputBlock
        var cb1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("c0b");
        cb1.value = 0;
        cb1.min = 0;
        cb1.max = 0;
        cb1.matrixMode = 0;
        cb1.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // MaxBlock
        var Max1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MaxBlock"]("Max");
        // TrigonometryBlock
        var Sign1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("Sign");
        Sign1.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Sign;
        // NegateBlock
        var Negate = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["NegateBlock"]("Negate");
        // SubtractBlock
        var t1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("t0");
        // TrigonometryBlock
        var thc = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("thc");
        thc.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Sqrt;
        // MaxBlock
        var Max2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MaxBlock"]("Max");
        // InputBlock
        var ca1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("c0a");
        ca1.value = 0;
        ca1.min = 0;
        ca1.max = 0;
        ca1.matrixMode = 0;
        ca1.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // SubtractBlock
        var Subtract3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("Subtract");
        // MinBlock
        var Min1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MinBlock"]("Min");
        // LerpBlock
        var dist2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["LerpBlock"]("dist2");
        // InputBlock
        var cc = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("c0c");
        cc.value = 0;
        cc.min = 0;
        cc.max = 0;
        cc.matrixMode = 0;
        cc.animationType = babylonjs__WEBPACK_IMPORTED_MODULE_0__["AnimatedInputBlockTypes"].None;
        // MaxBlock
        var Max3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MaxBlock"]("Max");
        // TrigonometryBlock
        var Sign2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("Sign");
        Sign2.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Sign;
        // SubtractBlock
        var Subtract4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["SubtractBlock"]("Subtract");
        // MultiplyBlock
        var Multiply2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MultiplyBlock"]("Multiply");
        // MultiplyBlock
        var Multiply3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MultiplyBlock"]("Multiply");
        // MaxBlock
        var Max4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MaxBlock"]("Max");
        // TrigonometryBlock
        var Sign3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("Sign");
        Sign3.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Sign;
        // MaxBlock
        var Max5 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MaxBlock"]("Max");
        // TrigonometryBlock
        var Sign4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("Sign");
        Sign4.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Sign;
        // MultiplyBlock
        var Multiply4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MultiplyBlock"]("Multiply");
        // MaxBlock
        var Max6 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["MaxBlock"]("Max");
        // TrigonometryBlock
        var Sign5 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlock"]("Sign");
        Sign5.operation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["TrigonometryBlockOperations"].Sign;
        // AddBlock
        var Add = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["AddBlock"]("Add");
        // FragmentOutputBlock
        var fragmentOutput = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["FragmentOutputBlock"]("fragmentOutput");
        // TransformBlock
        var worldPosviewProjectionTransform = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["TransformBlock"]("worldPos * viewProjectionTransform");
        worldPosviewProjectionTransform.complementZ = 0;
        worldPosviewProjectionTransform.complementW = 1;
        // InputBlock
        var viewProjection = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["InputBlock"]("viewProjection");
        viewProjection.setAsSystemValue(babylonjs__WEBPACK_IMPORTED_MODULE_0__["NodeMaterialSystemValues"].ViewProjection);
        // VertexOutputBlock
        var vertexOutput = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["VertexOutputBlock"]("vertexOutput");
        // Connections
        position.output.connectTo(worldPos.vector);
        world.output.connectTo(worldPos.transform);
        worldPos.output.connectTo(worldPosviewProjectionTransform.vector);
        viewProjection.output.connectTo(worldPosviewProjectionTransform.transform);
        worldPosviewProjectionTransform.output.connectTo(vertexOutput.vector);
        uv.output.connectTo(Texture_.uv);
        Texture_.rgba.connectTo(Lerp.left);
        Texture_.rgba.connectTo(glFragColorWithFog.left);
        FogColor.output.connectTo(VectorMerger.xyz);
        cb.output.connectTo(VectorMerger.w);
        VectorMerger.xyzw.connectTo(glFragColorWithFog.right);
        FogCenter.output.connectTo(Subtract.left);
        Cameraposition1.output.connectTo(Subtract.right);
        Subtract.output.connectTo(Cross.left);
        position.output.connectTo(Worldposition.vector);
        world.output.connectTo(Worldposition.transform);
        Worldposition.output.connectTo(VectorSplitter.xyzw);
        VectorSplitter.xyzOut.connectTo(wPoscamPos.left);
        Cameraposition.output.connectTo(wPoscamPos.right);
        wPoscamPos.output.connectTo(dir.input);
        dir.output.connectTo(Cross.right);
        Cross.output.connectTo(distToCenter.value);
        distToCenter.output.connectTo(Divide.left);
        FogRadius.output.connectTo(Divide.right);
        Divide.output.connectTo(Multiply1.left);
        PIOverTwo.output.connectTo(Multiply1.right);
        Multiply1.output.connectTo(Cos.input);
        Cos.output.connectTo(fr.value);
        cd.output.connectTo(fr.edge0);
        ca.output.connectTo(fr.edge1);
        fr.output.connectTo(Multiply.left);
        cb1.output.connectTo(dist1.left);
        VectorSplitter.xyzOut.connectTo(distCamToPos.left);
        Cameraposition.output.connectTo(distCamToPos.right);
        distCamToPos.output.connectTo(Min.left);
        FogCenter.output.connectTo(L.left);
        Cameraposition.output.connectTo(L.right);
        L.output.connectTo(tca.left);
        dir.output.connectTo(tca.right);
        tca.output.connectTo(t.left);
        FogRadius.output.connectTo(volFogRadius.left);
        FogRadius.output.connectTo(volFogRadius.right);
        volFogRadius.output.connectTo(Subtract1.left);
        L.output.connectTo(LdotL.left);
        L.output.connectTo(LdotL.right);
        LdotL.output.connectTo(d.left);
        tca.output.connectTo(tcaSquare.left);
        tca.output.connectTo(tcaSquare.right);
        tcaSquare.output.connectTo(d.right);
        d.output.connectTo(Subtract1.right);
        Subtract1.output.connectTo(Max2.left);
        ca1.output.connectTo(Max2.right);
        Max2.output.connectTo(thc.input);
        thc.output.connectTo(t.right);
        t.output.connectTo(Min.right);
        Min.output.connectTo(dist1.right);
        tca.output.connectTo(t1.left);
        thc.output.connectTo(t1.right);
        t1.output.connectTo(Negate.value);
        Negate.output.connectTo(Sign1.input);
        Sign1.output.connectTo(Max1.left);
        cb1.output.connectTo(Max1.right);
        Max1.output.connectTo(Multiply4.left);
        t.output.connectTo(Sign5.input);
        Sign5.output.connectTo(Max6.left);
        cb1.output.connectTo(Max6.right);
        Max6.output.connectTo(Multiply4.right);
        Multiply4.output.connectTo(dist1.gradient);
        dist1.output.connectTo(dist.left);
        cc.output.connectTo(dist2.left);
        distCamToPos.output.connectTo(Min1.left);
        t.output.connectTo(Min1.right);
        Min1.output.connectTo(Subtract3.left);
        t1.output.connectTo(Subtract3.right);
        Subtract3.output.connectTo(dist2.right);
        distCamToPos.output.connectTo(Subtract4.left);
        t1.output.connectTo(Subtract4.right);
        Subtract4.output.connectTo(Sign2.input);
        Sign2.output.connectTo(Max3.left);
        cc.output.connectTo(Max3.right);
        Max3.output.connectTo(Multiply2.left);
        t1.output.connectTo(Sign3.input);
        Sign3.output.connectTo(Max4.left);
        cc.output.connectTo(Max4.right);
        Max4.output.connectTo(Multiply3.left);
        t.output.connectTo(Sign4.input);
        Sign4.output.connectTo(Max5.left);
        cc.output.connectTo(Max5.right);
        Max5.output.connectTo(Multiply3.right);
        Multiply3.output.connectTo(Multiply2.right);
        Multiply2.output.connectTo(dist2.gradient);
        dist2.output.connectTo(dist.right);
        dist.output.connectTo(Divide1.left);
        FogRadius.output.connectTo(Add.left);
        FogRadius.output.connectTo(Add.right);
        Add.output.connectTo(Divide1.right);
        Divide1.output.connectTo(Multiply.right);
        Multiply.output.connectTo(Clamp.value);
        Clamp.output.connectTo(glFragColorWithFog.gradient);
        glFragColorWithFog.output.connectTo(Lerp.right);
        volFogRadius.output.connectTo(Subtract2.left);
        d.output.connectTo(Subtract2.right);
        Subtract2.output.connectTo(Sign.input);
        Sign.output.connectTo(Max.left);
        ce.output.connectTo(Max.right);
        Max.output.connectTo(Lerp.gradient);
        Lerp.output.connectTo(fragmentOutput.rgba);
        // Output nodes
        nodeMaterial.addOutputNode(vertexOutput);
        nodeMaterial.addOutputNode(fragmentOutput);
        nodeMaterial.build();
        //nodeMaterial.depthFunction = Engine.LEQUAL;
        nodeMaterial.forceDepthWrite = true;
        return nodeMaterial;
    };
    StandardShadow.prototype.render = function () {
        this._skyBox.position.copyFrom(this.camera.position);
        this.scene.render();
        /*if (this._animateLight && this._autoCalcShadowZBounds) {
            this._lightNearPlane = this.sun.shadowMinZ;
            this._lightFarPlane = this.sun.shadowMaxZ;

            const event = new CustomEvent('gui_set_value', { detail: { type: 'setShadowZBounds' } });

            window.dispatchEvent(event);
        }*/
    };
    StandardShadow.className = "Standard";
    return StandardShadow;
}(_SplitBase__WEBPACK_IMPORTED_MODULE_2__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (StandardShadow);


/***/ }),

/***/ "./src/CSM/StandardShadowGUI.tsx":
/*!***************************************!*\
  !*** ./src/CSM/StandardShadowGUI.tsx ***!
  \***************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SplitBaseGUI */ "./src/CSM/SplitBaseGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var StandardShadowGUI = /** @class */ (function (_super) {
    __extends(StandardShadowGUI, _super);
    function StandardShadowGUI() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    StandardShadowGUI.prototype.createCustomGUIProperties = function () {
        var Properties = function () {
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
        };
        return Properties();
    };
    return StandardShadowGUI;
}(_SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (StandardShadowGUI);


/***/ }),

/***/ "./src/CSM/csmShadowGenerator.ts":
/*!***************************************!*\
  !*** ./src/CSM/csmShadowGenerator.ts ***!
  \***************************************/
/*! exports provided: CSMShadowGenerator */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CSMShadowGenerator", function() { return CSMShadowGenerator; });
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _csmShadowMap__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./csmShadowMap */ "./src/CSM/csmShadowMap.ts");
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (undefined && undefined.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};
var __values = (undefined && undefined.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};


// @ts-ignore
var CSMShadowGenerator = /** @class */ (function () {
    function CSMShadowGenerator(mapSize, light, numCascades, usefulFloatFirst) {
        if (numCascades === void 0) { numCascades = 4; }
        this._freezeShadowCastersBoundingInfo = false;
        this._freezeShadowCastersBoundingInfoObservable = null;
        if (numCascades < 1) {
            numCascades = 1;
        }
        if (light.getTypeID() != babylonjs__WEBPACK_IMPORTED_MODULE_0__["Light"].LIGHTTYPEID_DIRECTIONALLIGHT) {
            console.error('Invalid light type for CSMShadowGenerator! Only directional lights are allowed.');
        }
        this._cascades = [];
        this._activeCascade = CSMShadowGenerator.CASCADE_ALL;
        this._renderList = [];
        this._numCascades = numCascades;
        this._lambda = 0.7;
        this._minDistance = 0;
        this._maxDistance = 1;
        this._stabilizeCascades = false;
        this._useRightDirectionAsUpForOrthoProj = false;
        this._shadowCastersBoundingInfo = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["BoundingInfo"](new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, 0), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, 0));
        this._lightMatrices = new Float32Array(numCascades * 16);
        this._samplers = new Array(numCascades);
        this._cascadeDepths = new Array(numCascades);
        this._debug = false;
        this._mapSize = mapSize;
        this._usefulFloatFirst = usefulFloatFirst;
        this._light = light;
        this._scene = light.getScene();
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"]._SceneComponentInitialization(this._scene);
        this.freezeShadowCastersBoundingInfo = false;
        this._initializeGenerator();
    }
    Object.defineProperty(CSMShadowGenerator.prototype, "activeCascade", {
        get: function () {
            return this._activeCascade;
        },
        set: function (index) {
            if (index !== CSMShadowGenerator.CASCADE_ALL && (index < 0 || index >= this._numCascades)) {
                index = 0;
            }
            this._activeCascade = index;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "numCascades", {
        get: function () {
            return this._numCascades;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "lambda", {
        get: function () {
            return this._lambda;
        },
        set: function (value) {
            this._lambda = value;
            this.setDistanceSplit();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "minDistance", {
        get: function () {
            return this._minDistance;
        },
        set: function (min) {
            this._minDistance = min;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "maxDistance", {
        get: function () {
            return this._maxDistance;
        },
        set: function (min) {
            this._maxDistance = min;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "stabilizeCascades", {
        get: function () {
            return this._stabilizeCascades;
        },
        set: function (value) {
            this._stabilizeCascades = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "useRightDirectionAsUpForOrthoProj", {
        get: function () {
            return this._useRightDirectionAsUpForOrthoProj;
        },
        set: function (value) {
            this._useRightDirectionAsUpForOrthoProj = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "freezeShadowCastersBoundingInfo", {
        get: function () {
            return this._freezeShadowCastersBoundingInfo;
        },
        set: function (freeze) {
            if (this._freezeShadowCastersBoundingInfoObservable && freeze) {
                this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable);
                this._freezeShadowCastersBoundingInfoObservable = null;
            }
            if (!this._freezeShadowCastersBoundingInfoObservable && !freeze) {
                this._freezeShadowCastersBoundingInfoObservable = this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this));
            }
            this._freezeShadowCastersBoundingInfo = freeze;
            if (freeze) {
                this._computeShadowCastersBoundingInfo();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "shadowCastersBoundingInfo", {
        get: function () {
            return this._shadowCastersBoundingInfo;
        },
        set: function (boundingInfo) {
            this._shadowCastersBoundingInfo = boundingInfo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "debug", {
        get: function () {
            return this._debug;
        },
        set: function (dbg) {
            this._debug = dbg;
            this._light._markMeshesAsLightDirty();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "cascade", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade] : null;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "renderList", {
        get: function () {
            return this._renderList;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "bias", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.bias : -1;
        },
        set: function (bias) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.bias = bias; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "normalBias", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.normalBias : -1;
        },
        set: function (normalBias) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.normalBias = normalBias; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "blurBoxOffset", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.blurBoxOffset : -1;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.blurBoxOffset = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "blurScale", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.blurScale : -1;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.blurScale = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "blurKernel", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.blurKernel : -1;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.blurKernel = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "useKernelBlur", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.useKernelBlur : false;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.useKernelBlur = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "depthScale", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.depthScale : -1;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.depthScale = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "filter", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.filter : -1;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.filter = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "filteringQuality", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.filteringQuality : -1;
        },
        set: function (filteringQuality) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.filteringQuality = filteringQuality; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "contactHardeningLightSizeUVRatio", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.contactHardeningLightSizeUVRatio : -1;
        },
        set: function (contactHardeningLightSizeUVRatio) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.contactHardeningLightSizeUVRatio = contactHardeningLightSizeUVRatio; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "darkness", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.darkness : -1;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.darkness = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "transparencyShadow", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.transparencyShadow : false;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.transparencyShadow = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "forceBackFacesOnly", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.forceBackFacesOnly : false;
        },
        set: function (value) {
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.forceBackFacesOnly = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "depthClamp", {
        get: function () {
            // @ts-ignore
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.depthClamp : false;
        },
        set: function (value) {
            // @ts-ignore
            this._getActiveCascades().forEach(function (cascade) { return cascade.generator.depthClamp = value; });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowGenerator.prototype, "viewMatrix", {
        get: function () {
            return this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? this._cascades[this._activeCascade].generator.viewMatrix : null;
        },
        enumerable: true,
        configurable: true
    });
    CSMShadowGenerator.prototype.getClassName = function () {
        return "CSMShadowGenerator";
    };
    CSMShadowGenerator.prototype.addShadowCaster = function (mesh, includeDescendants) {
        var _a;
        if (includeDescendants === void 0) { includeDescendants = true; }
        this._renderList.push(mesh);
        if (includeDescendants) {
            (_a = this._renderList).push.apply(_a, __spread(mesh.getChildMeshes()));
        }
        return this;
    };
    CSMShadowGenerator.prototype.removeShadowCaster = function (mesh, includeDescendants) {
        var e_1, _a;
        if (includeDescendants === void 0) { includeDescendants = true; }
        var index = this._renderList.indexOf(mesh);
        if (index !== -1) {
            this._renderList.splice(index, 1);
        }
        if (includeDescendants) {
            try {
                for (var _b = __values(mesh.getChildren()), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var child = _c.value;
                    this.removeShadowCaster(child);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        return this;
    };
    CSMShadowGenerator.prototype._getActiveCascades = function (forceAll) {
        if (forceAll === void 0) { forceAll = true; }
        return this._activeCascade === CSMShadowGenerator.CASCADE_ALL || forceAll ? this._cascades :
            this._activeCascade >= 0 && this._activeCascade < this._cascades.length ? [this._cascades[this._activeCascade]] : [];
    };
    CSMShadowGenerator.prototype.getLight = function () {
        return this._light;
    };
    CSMShadowGenerator.prototype._initializeGenerator = function () {
        this._light._markMeshesAsLightDirty();
        this._initializeCSM();
    };
    CSMShadowGenerator.prototype._initializeCSM = function () {
        for (var cascadeIndex = 0; cascadeIndex < this._numCascades; ++cascadeIndex) {
            var cascade = {
                generator: new _csmShadowMap__WEBPACK_IMPORTED_MODULE_1__["CSMShadowMap"](this._mapSize, this._light, !!this._usefulFloatFirst, this),
                prevSplitDistance: 0,
                splitDistance: 0,
            };
            cascade.generator.cascade = cascade;
            // @ts-ignore
            cascade.generator.renderList = this._renderList;
            this._cascades.push(cascade);
        }
        if (this._activeCascade !== CSMShadowGenerator.CASCADE_ALL && this._activeCascade >= this._numCascades) {
            this._activeCascade = 0;
        }
        this.setDistanceSplit();
    };
    CSMShadowGenerator.prototype.setDistanceSplit = function () {
        var camera = this._scene.activeCamera;
        if (!camera) {
            return;
        }
        var near = camera.minZ, far = camera.maxZ, cameraRange = far - near;
        var minZ = near + this._minDistance * cameraRange, maxZ = near + this._maxDistance * cameraRange;
        var range = maxZ - minZ, ratio = maxZ / minZ;
        for (var cascadeIndex = 0; cascadeIndex < this._cascades.length; ++cascadeIndex) {
            var p = (cascadeIndex + 1) / this._numCascades, log = minZ * (Math.pow(ratio, p)), uniform = minZ + range * p;
            var d = this._lambda * (log - uniform) + uniform;
            this._cascades[cascadeIndex].prevSplitDistance = cascadeIndex === 0 ? this._minDistance : this._cascades[cascadeIndex - 1].splitDistance;
            this._cascades[cascadeIndex].splitDistance = (d - near) / cameraRange;
        }
    };
    CSMShadowGenerator.prototype._computeShadowCastersBoundingInfo = function () {
        var min = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE), max = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](Number.MIN_VALUE, Number.MIN_VALUE, Number.MIN_VALUE);
        for (var meshIndex = 0; meshIndex < this._renderList.length; meshIndex++) {
            var mesh = this._renderList[meshIndex];
            if (!mesh) {
                continue;
            }
            var boundingInfo = mesh.getBoundingInfo(), boundingBox = boundingInfo.boundingBox;
            min.minimizeInPlace(boundingBox.minimumWorld);
            max.maximizeInPlace(boundingBox.maximumWorld);
        }
        this._shadowCastersBoundingInfo.reConstruct(min, max);
    };
    Object.defineProperty(CSMShadowGenerator.prototype, "mustRender", {
        get: function () {
            return this.renderList.length > 0;
        },
        enumerable: true,
        configurable: true
    });
    CSMShadowGenerator.prototype.isReady = function (subMesh, useInstances) {
        var ready = true;
        for (var cascadeIndex = 0; cascadeIndex < this._cascades.length && ready; ++cascadeIndex) {
            ready = ready && this._cascades[cascadeIndex].generator.isReady(subMesh, useInstances);
        }
        return ready;
    };
    CSMShadowGenerator.prototype.getShadowMaps = function () {
        var rttList = [];
        for (var cascadeIndex = 0; cascadeIndex < this._cascades.length; ++cascadeIndex) {
            var cascade = this._cascades[cascadeIndex], rtt = cascade.generator.getShadowMap();
            if (rtt) {
                rttList.push(rtt);
            }
        }
        return rttList;
    };
    CSMShadowGenerator.prototype.prepareDefines = function (defines, lightIndex) {
        var scene = this._scene;
        var light = this._light;
        if (!scene.shadowsEnabled || !light.shadowEnabled || this._cascades.length < 1) {
            return;
        }
        this._cascades[0].generator.prepareDefines(defines, lightIndex);
        defines["SHADOWCSM" + lightIndex] = true;
        defines["SHADOWCSM" + lightIndex + "_NUMCASCADES"] = this._numCascades;
        defines["SHADOWCSM" + lightIndex + "_DEBUG"] = this._debug;
    };
    CSMShadowGenerator.prototype.bindShadowLight = function (lightIndex, effect) {
        var light = this._light;
        var scene = this._scene;
        if (!scene.shadowsEnabled || !light.shadowEnabled || this._cascades.length < 1) {
            return;
        }
        var camera = scene.activeCamera;
        if (!camera) {
            return;
        }
        var masterGenerator = this._cascades[0].generator;
        var shadowMap0 = masterGenerator.getShadowMap();
        if (!shadowMap0) {
            return;
        }
        var cameraRange = camera.maxZ - camera.minZ;
        for (var cascadeIndex = 0; cascadeIndex < this._cascades.length; ++cascadeIndex) {
            var cascade = this._cascades[cascadeIndex];
            var matrix = cascade.generator.getTransformMatrix();
            matrix.copyToArray(this._lightMatrices, cascadeIndex * 16);
            if (masterGenerator.filter === babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF) {
                effect.setDepthStencilTexture("shadowSampler" + lightIndex + "_" + cascadeIndex, cascade.generator.getShadowMapForRendering());
            }
            else {
                this._samplers[cascadeIndex] = cascade.generator.getShadowMapForRendering();
            }
            this._cascadeDepths[cascadeIndex] = camera.minZ + cascade.splitDistance * cameraRange;
        }
        if (!light.needCube()) {
            effect.setMatrices("lightMatrix" + lightIndex, this._lightMatrices);
        }
        effect.setInt("numCascades" + lightIndex, this._cascades.length);
        if (masterGenerator.filter !== babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF) {
            effect.setTextureArray("shadowSampler" + lightIndex, this._samplers);
        }
        effect.setArray("cascadeSplits" + lightIndex, this._cascadeDepths);
        if (masterGenerator.filter === babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF) {
            light._uniformBuffer.updateFloat4("shadowsInfo", masterGenerator.getDarkness(), shadowMap0.getSize().width, 1 / shadowMap0.getSize().width, masterGenerator.frustumEdgeFalloff, lightIndex);
        }
        else if (masterGenerator.filter === babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCSS) {
            light._uniformBuffer.updateFloat4("shadowsInfo", masterGenerator.getDarkness(), 1 / shadowMap0.getSize().width, masterGenerator.contactHardeningLightSizeUVRatio * shadowMap0.getSize().width, masterGenerator.frustumEdgeFalloff, lightIndex);
        }
        else {
            light._uniformBuffer.updateFloat4("shadowsInfo", masterGenerator.getDarkness(), masterGenerator.blurScale / shadowMap0.getSize().width, masterGenerator.depthScale, masterGenerator.frustumEdgeFalloff, lightIndex);
        }
        light._uniformBuffer.updateFloat2("depthValues", this.getLight().getDepthMinZ(camera), this.getLight().getDepthMinZ(camera) + this.getLight().getDepthMaxZ(camera), lightIndex);
    };
    CSMShadowGenerator.prototype.recreate = function () {
        for (var cascadeIndex = 0; cascadeIndex < this._cascades.length; ++cascadeIndex) {
            // @ts-ignore
            this._cascades[cascadeIndex].generator.recreate();
        }
    };
    CSMShadowGenerator.prototype.forceCompilation = function (onCompiled, options) {
        // todo
    };
    CSMShadowGenerator.prototype.forceCompilationAsync = function (options) {
        // todo
        return Promise.resolve();
    };
    CSMShadowGenerator.prototype.serialize = function () {
        // todo
    };
    CSMShadowGenerator.prototype.dispose = function () {
        for (var cascadeIndex = 0; cascadeIndex < this._cascades.length; ++cascadeIndex) {
            this._cascades[cascadeIndex].generator.dispose();
        }
        this._cascades = [];
        this._numCascades = 0;
        if (this._freezeShadowCastersBoundingInfoObservable) {
            this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable);
            this._freezeShadowCastersBoundingInfoObservable = null;
        }
    };
    CSMShadowGenerator.CASCADE_ALL = -1;
    CSMShadowGenerator.CASCADE_1 = 0;
    CSMShadowGenerator.CASCADE_2 = 1;
    CSMShadowGenerator.CASCADE_3 = 2;
    CSMShadowGenerator.CASCADE_4 = 3;
    CSMShadowGenerator.CASCADE_5 = 4;
    CSMShadowGenerator.CASCADE_6 = 5;
    CSMShadowGenerator.CASCADE_7 = 6;
    CSMShadowGenerator.CASCADE_8 = 7;
    return CSMShadowGenerator;
}());



/***/ }),

/***/ "./src/CSM/csmShadowMap.ts":
/*!*********************************!*\
  !*** ./src/CSM/csmShadowMap.ts ***!
  \*********************************/
/*! exports provided: CSMShadowMap */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CSMShadowMap", function() { return CSMShadowMap; });
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var UpDir = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Up();
var RightDir = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Right();
var ZeroVec = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero();
var tmpv1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](), tmpv2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](), matrix = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"]();
var CSMShadowMap = /** @class */ (function (_super) {
    __extends(CSMShadowMap, _super);
    function CSMShadowMap(mapSize, light, usefulFloatFirst, parent) {
        var _this = _super.call(this, mapSize, light, usefulFloatFirst) || this;
        // @ts-ignore
        _this._light._shadowGenerator = parent;
        _this._parent = parent;
        _this._cascade = null;
        _this._lightMinExtents = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, 0);
        _this._lightMaxExtents = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, 0);
        _this._frustumCornersWorldSpace = [];
        for (var i = 0; i < CSMShadowMap.frustumCornersNDCSpace.length; ++i) {
            _this._frustumCornersWorldSpace.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]());
        }
        _this._minExtents = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]();
        _this._maxExtents = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]();
        _this._frustumCenter = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]();
        _this._cascadeExtents = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]();
        _this._shadowCameraPos = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]();
        return _this;
    }
    Object.defineProperty(CSMShadowMap.prototype, "lightMinExtents", {
        get: function () {
            return this._lightMinExtents;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowMap.prototype, "lightMaxExtents", {
        get: function () {
            return this._lightMaxExtents;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowMap.prototype, "viewMatrix", {
        get: function () {
            // @ts-ignore
            return this._viewMatrix;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSMShadowMap.prototype, "cascade", {
        get: function () {
            return this._cascade;
        },
        set: function (cascade) {
            this._cascade = cascade;
        },
        enumerable: true,
        configurable: true
    });
    CSMShadowMap.prototype.getTransformMatrix = function () {
        // @ts-ignore
        var scene = this._scene;
        // @ts-ignore
        if (this._currentRenderID === scene.getRenderId() && this._currentFaceIndexCache === this._currentFaceIndex) {
            // @ts-ignore
            return this._transformMatrix;
        }
        // @ts-ignore
        this._currentRenderID = scene.getRenderId();
        // @ts-ignore
        this._currentFaceIndexCache = this._currentFaceIndex;
        // @ts-ignore
        var lightPosition = this._light.position;
        // @ts-ignore
        if (this._light.computeTransformedInformation()) {
            // @ts-ignore
            lightPosition = this._light.transformedPosition;
        }
        // @ts-ignore
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex), this._lightDirection);
        // @ts-ignore
        if (Math.abs(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Dot(this._lightDirection, babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Up())) === 1.0) {
            // @ts-ignore
            this._lightDirection.z = 0.0000000000001; // Required to avoid perfectly perpendicular light
        }
        // @ts-ignore
        if (this._light.needProjectionMatrixCompute() || !this._cachedPosition || !this._cachedDirection || !lightPosition.equals(this._cachedPosition) || !this._lightDirection.equals(this._cachedDirection)) {
            // @ts-ignore
            this._cachedPosition.copyFrom(lightPosition);
            // @ts-ignore
            this._cachedDirection.copyFrom(this._lightDirection);
            this._computeLightMatrices();
        }
        // @ts-ignore
        return this._transformMatrix;
    };
    // Get the 8 points of the view frustum in world space
    CSMShadowMap.prototype._computeFrustumInWorldSpace = function () {
        // @ts-ignore
        if (!this._cascade || !this._scene.activeCamera) {
            return;
        }
        var prevSplitDist = this._cascade.prevSplitDistance, splitDist = this._cascade.splitDistance;
        // @ts-ignore
        this._scene.activeCamera.getViewMatrix(); // make sure the transformation matrix we get when calling 'getTransformationMatrix()' is calculated with an up to date view matrix
        // @ts-ignore
        var invViewProj = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Invert(this._scene.activeCamera.getTransformationMatrix());
        for (var cornerIndex = 0; cornerIndex < CSMShadowMap.frustumCornersNDCSpace.length; ++cornerIndex) {
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinatesToRef(CSMShadowMap.frustumCornersNDCSpace[cornerIndex], invViewProj, this._frustumCornersWorldSpace[cornerIndex]);
        }
        // Get the corners of the current cascade slice of the view frustum
        for (var cornerIndex = 0; cornerIndex < CSMShadowMap.frustumCornersNDCSpace.length / 2; ++cornerIndex) {
            tmpv1.copyFrom(this._frustumCornersWorldSpace[cornerIndex + 4]).subtractInPlace(this._frustumCornersWorldSpace[cornerIndex]);
            tmpv2.copyFrom(tmpv1).scaleInPlace(prevSplitDist); // near corner ray
            tmpv1.scaleInPlace(splitDist); // far corner ray
            tmpv1.addInPlace(this._frustumCornersWorldSpace[cornerIndex]);
            this._frustumCornersWorldSpace[cornerIndex + 4].copyFrom(tmpv1);
            this._frustumCornersWorldSpace[cornerIndex].addInPlace(tmpv2);
        }
    };
    CSMShadowMap.prototype._computeLightFrustum = function () {
        this._minExtents.copyFromFloats(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);
        this._maxExtents.copyFromFloats(Number.MIN_VALUE, Number.MIN_VALUE, Number.MIN_VALUE);
        this._frustumCenter.copyFromFloats(0, 0, 0);
        // @ts-ignore
        var camera = this._scene.activeCamera;
        if (!camera) {
            return;
        }
        // Calculate the centroid of the view frustum slice
        for (var cornerIndex = 0; cornerIndex < this._frustumCornersWorldSpace.length; ++cornerIndex) {
            this._frustumCenter.addInPlace(this._frustumCornersWorldSpace[cornerIndex]);
        }
        this._frustumCenter.scaleInPlace(1 / this._frustumCornersWorldSpace.length);
        if (this._parent.stabilizeCascades) {
            // Calculate the radius of a bounding sphere surrounding the frustum corners
            var sphereRadius = 0;
            for (var cornerIndex = 0; cornerIndex < this._frustumCornersWorldSpace.length; ++cornerIndex) {
                var dist = this._frustumCornersWorldSpace[cornerIndex].subtract(this._frustumCenter).length();
                sphereRadius = Math.max(sphereRadius, dist);
            }
            sphereRadius = Math.ceil(sphereRadius * 16) / 16;
            this._maxExtents.copyFromFloats(sphereRadius, sphereRadius, sphereRadius);
            this._minExtents.copyFromFloats(-sphereRadius, -sphereRadius, -sphereRadius);
        }
        else {
            // Create a temporary view matrix for the light
            var upDir = this._parent.useRightDirectionAsUpForOrthoProj ? camera.getDirection(RightDir) : UpDir;
            var lightCameraPos = this._frustumCenter;
            // @ts-ignore
            this._frustumCenter.addToRef(this._lightDirection, tmpv1); // tmpv1 = look at
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].LookAtLHToRef(lightCameraPos, tmpv1, upDir, matrix); // matrix = lightView
            // Calculate an AABB around the frustum corners
            for (var cornerIndex = 0; cornerIndex < this._frustumCornersWorldSpace.length; ++cornerIndex) {
                babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinatesToRef(this._frustumCornersWorldSpace[cornerIndex], matrix, tmpv1);
                this._minExtents.minimizeInPlace(tmpv1);
                this._maxExtents.maximizeInPlace(tmpv1);
            }
        }
        return;
    };
    CSMShadowMap.prototype._computeLightMatrices = function () {
        // @ts-ignore
        var camera = this._scene.activeCamera;
        if (!camera) {
            return;
        }
        this._computeFrustumInWorldSpace();
        this._computeLightFrustum();
        this._maxExtents.subtractToRef(this._minExtents, this._cascadeExtents);
        // Get position of the shadow camera
        // @ts-ignore
        this._frustumCenter.addToRef(this._lightDirection.scale(this._minExtents.z), this._shadowCameraPos);
        // Come up with a new orthographic camera for the shadow caster
        var upDir = this._parent.stabilizeCascades || !this._parent.useRightDirectionAsUpForOrthoProj ? UpDir : camera.getDirection(RightDir);
        // @ts-ignore
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].LookAtLHToRef(this._shadowCameraPos, this._frustumCenter, upDir, this._viewMatrix);
        var minZ = 0, maxZ = this._cascadeExtents.z;
        // Try to tighten minZ and maxZ based on the bounding box of the shadow casters
        var boundingInfo = this._parent.shadowCastersBoundingInfo;
        // @ts-ignore
        boundingInfo.update(this._viewMatrix);
        maxZ = Math.min(maxZ, boundingInfo.boundingBox.maximumWorld.z);
        if (!this._parent.depthClamp) {
            // If we don't use depth clamping, we must set minZ so that all shadow casters are in the light frustum
            minZ = Math.min(minZ, boundingInfo.boundingBox.minimumWorld.z);
        }
        else {
            // If using depth clamping, we can adjust minZ to reduce the [minZ, maxZ] range (and get some additional precision in the shadow map)
            minZ = Math.max(minZ, boundingInfo.boundingBox.minimumWorld.z);
        }
        // @ts-ignore
        if (this._scene.useRightHandedSystem) {
            // @ts-ignore
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].OrthoOffCenterRHToRef(this._minExtents.x, this._maxExtents.x, this._minExtents.y, this._maxExtents.y, minZ, maxZ, this._projectionMatrix);
        }
        else {
            // @ts-ignore
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].OrthoOffCenterLHToRef(this._minExtents.x, this._maxExtents.x, this._minExtents.y, this._maxExtents.y, minZ, maxZ, this._projectionMatrix);
        }
        this._lightMinExtents.set(this._minExtents.x, this._minExtents.y, minZ);
        this._lightMaxExtents.set(this._maxExtents.x, this._maxExtents.y, maxZ);
        // @ts-ignore
        this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix);
        if (this._parent.stabilizeCascades) {
            // Create the rounding matrix, by projecting the world-space origin and determining
            // the fractional offset in texel space
            // @ts-ignore
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinatesToRef(ZeroVec, this._transformMatrix, tmpv1); // tmpv1 = shadowOrigin
            // @ts-ignore
            tmpv1.scaleInPlace(this._mapSize / 2);
            tmpv2.copyFromFloats(Math.round(tmpv1.x), Math.round(tmpv1.y), Math.round(tmpv1.z)); // tmpv2 = roundedOrigin
            // @ts-ignore
            tmpv2.subtractInPlace(tmpv1).scaleInPlace(2 / this._mapSize); // tmpv2 = roundOffset
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].TranslationToRef(tmpv2.x, tmpv2.y, 0.0, matrix);
            // @ts-ignore
            this._projectionMatrix.multiplyToRef(matrix, this._projectionMatrix);
            // @ts-ignore
            this._viewMatrix.multiplyToRef(this._projectionMatrix, this._transformMatrix);
        }
    };
    CSMShadowMap.frustumCornersNDCSpace = [
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1.0, +1.0, -1.0),
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](+1.0, +1.0, -1.0),
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](+1.0, -1.0, -1.0),
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1.0, -1.0, -1.0),
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1.0, +1.0, +1.0),
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](+1.0, +1.0, +1.0),
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](+1.0, -1.0, +1.0),
        new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1.0, -1.0, +1.0),
    ];
    return CSMShadowMap;
}(babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"]));



/***/ }),

/***/ "./src/CSM/index.ts":
/*!**************************!*\
  !*** ./src/CSM/index.ts ***!
  \**************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sample */ "./src/Sample.ts");
/* harmony import */ var _GlobalGUI__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GlobalGUI */ "./src/CSM/GlobalGUI.tsx");
/* harmony import */ var _StandardShadow__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./StandardShadow */ "./src/CSM/StandardShadow.ts");
/* harmony import */ var _CSM__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./CSM */ "./src/CSM/CSM.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};





var CSMSample = /** @class */ (function (_super) {
    __extends(CSMSample, _super);
    function CSMSample(engine, canvas) {
        var _this = _super.call(this, engine, canvas) || this;
        _this._sunDir = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1, -1, -1);
        //        this._sunDir = new Vector3(32, -30, 22);
        _this._sunDir.normalize();
        _this._ambientColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0.3, 0.3, 0.3);
        _this._clearColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color4"](0.17773, 0.41797, 0.65234, 1);
        _this.registerClass("std", _StandardShadow__WEBPACK_IMPORTED_MODULE_3__["default"]);
        _this.registerClass("csm", _CSM__WEBPACK_IMPORTED_MODULE_4__["default"]);
        _this.splitMode = _Sample__WEBPACK_IMPORTED_MODULE_1__["enumSplitMode"].LINEAR;
        _this.splitType = "csm";
        _this._gui = new _GlobalGUI__WEBPACK_IMPORTED_MODULE_2__["default"]("Global settings", _this._engine, _this);
        var ocont = jQuery('<div id="fps2"></div>').css('position', 'absolute').css('left', '2px').css('top', '2px').css('z-index', '201');
        jQuery(document.body).append(ocont);
        return _this;
    }
    CSMSample.prototype.create = function () {
        var _this = this;
        Promise.all([this.createNewSplit()]).then(function () {
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["SceneLoader"].ShowLoadingScreen = false;
            _this.createGUI();
        });
    };
    CSMSample.prototype.createGUI = function () {
        this._gui.zIndex = 200;
        this._gui.createGUI();
    };
    CSMSample.prototype.createNewSplit = function () {
        return __awaiter(this, void 0, void 0, function () {
            var split, camera, gscene;
            var _this = this;
            return __generator(this, function (_a) {
                this.detachControlFromAllCameras();
                split = this.addSplit(this.splitType, this.splitClasses.get(this.splitType).className, false, false), camera = split.camera;
                gscene = this._gui.scenes[this._gui.selectedScene];
                split.group = this._gui.selectedScene;
                split.isLoading = true;
                camera.position = gscene.camera.position.clone();
                camera.setTarget(gscene.camera.target.clone());
                return [2 /*return*/, split.initialize(gscene, this._ambientColor, this._sunDir.clone()).then(function () {
                        split.isLoading = false;
                        split.createGUI();
                        _this.resyncCameras();
                        _this.attachControlToAllCameras();
                    })];
            });
        });
    };
    CSMSample.prototype.render = function () {
        _super.prototype.render.call(this);
        jQuery('#fps2').html(this._engine.getFps().toFixed() + " fps");
    };
    CSMSample.prototype.createSceneAndCamera = function (attachControls) {
        var _a = __read(_super.prototype.createSceneAndCamera.call(this, attachControls), 2), scene = _a[0], camera = _a[1];
        scene.ambientColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1);
        scene.clearColor = this._clearColor;
        camera.fov = Math.PI / 4 * 0.75;
        camera.minZ = 0.25;
        camera.maxZ = 250;
        return [scene, camera];
    };
    return CSMSample;
}(_Sample__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (CSMSample);
_Sample__WEBPACK_IMPORTED_MODULE_1__["default"].registerSampleClass("csm", {
    "displayName": "Implementation of the Cascaded Shadow Maps rendering technic",
    "description": "",
    "class": CSMSample,
});


/***/ }),

/***/ "./src/CSM2/CSM.ts":
/*!*************************!*\
  !*** ./src/CSM2/CSM.ts ***!
  \*************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _StandardShadow__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./StandardShadow */ "./src/CSM2/StandardShadow.ts");
/* harmony import */ var _CSMGUI__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./CSMGUI */ "./src/CSM2/CSMGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();



//import { CascadedShadowGenerator } from "./cascadedShadowGenerator";
var useSceneDepthRenderer = false;
var CSM = /** @class */ (function (_super) {
    __extends(CSM, _super);
    function CSM(scene, camera, parent, name) {
        var _this = _super.call(this, scene, camera, parent, name) || this;
        _this._shadowMapFilter = babylonjs__WEBPACK_IMPORTED_MODULE_0__["CascadedShadowGenerator"].FILTER_PCF;
        window.csm = _this;
        if (useSceneDepthRenderer) {
            _this._depthRenderer = scene.enableDepthRenderer(camera, false);
        }
        return _this;
    }
    CSM.prototype.getCSMGenerator = function () {
        return this._shadowGenerator;
    };
    Object.defineProperty(CSM.prototype, "cameraNearPlane", {
        get: function () {
            return this._cameraNearPlane;
        },
        set: function (cnp) {
            this._cameraNearPlane = cnp;
            this.camera.minZ = cnp;
            var val = this.getCSMGenerator().shadowMaxZ;
            this.getCSMGenerator().shadowMaxZ = this._cameraNearPlane; // make shadowMaxZ change
            this.getCSMGenerator().shadowMaxZ = val; // so trigger a cascade recomputation
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "cameraFarPlane", {
        get: function () {
            return this._cameraFarPlane;
        },
        set: function (cfp) {
            this._cameraFarPlane = cfp;
            this.camera.maxZ = cfp;
            var val = this.getCSMGenerator().shadowMaxZ;
            this.getCSMGenerator().shadowMaxZ = this._cameraNearPlane; // make shadowMaxZ change
            this.getCSMGenerator().shadowMaxZ = val; // so trigger a cascade recomputation
            this._csmShadowMaxZ = this.getCSMGenerator().shadowMaxZ;
            var event = new CustomEvent('gui_set_value', { detail: { type: 'setShadowMaxZ' } });
            window.dispatchEvent(event);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmNumCascades", {
        get: function () {
            return this._csmNumCascades;
        },
        set: function (num) {
            this._csmNumCascades = num;
            this.getCSMGenerator().numCascades = num;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmActiveCascade", {
        get: function () {
            return this._csmActiveCascade;
        },
        set: function (cac) {
            this._csmActiveCascade = cac;
            this.setShadowMapViewerTexture();
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmVisualizeCascades", {
        get: function () {
            return this._csmVisualizeCascades;
        },
        set: function (cvc) {
            this._csmVisualizeCascades = cvc;
            this.getCSMGenerator().debug = cvc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmStabilizeCascades", {
        get: function () {
            return this._csmStabilizeCascades;
        },
        set: function (ssc) {
            this._csmStabilizeCascades = ssc;
            this.getCSMGenerator().stabilizeCascades = ssc;
            window.setTimeout(this.buildLightHelper.bind(this), 100);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmDepthClamp", {
        get: function () {
            return this._csmDepthClamp;
        },
        set: function (cdc) {
            this._csmDepthClamp = cdc;
            this.getCSMGenerator().depthClamp = cdc;
            window.setTimeout(this.buildLightHelper.bind(this), 100);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmLambda", {
        get: function () {
            return this._csmLambda;
        },
        set: function (cl) {
            this._csmLambda = cl;
            this.getCSMGenerator().lambda = cl;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmSplitBlendPercentage", {
        get: function () {
            return this._csmSplitBlendPercentage;
        },
        set: function (csbp) {
            this._csmSplitBlendPercentage = csbp;
            this.getCSMGenerator().cascadeBlendPercentage = csbp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmPenumbraDarkness", {
        get: function () {
            return this._csmPenumbraDarkness;
        },
        set: function (cpd) {
            this._csmPenumbraDarkness = cpd;
            this.getCSMGenerator().penumbraDarkness = cpd;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmShadowMaxZ", {
        get: function () {
            return this._csmShadowMaxZ;
        },
        set: function (csmz) {
            this._csmShadowMaxZ = csmz;
            this.getCSMGenerator().shadowMaxZ = csmz;
            this._csmShadowMaxZ = this.getCSMGenerator().shadowMaxZ;
            var event = new CustomEvent('gui_set_value', { detail: { type: 'setShadowMaxZ' } });
            window.dispatchEvent(event);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CSM.prototype, "csmAutoCalcDepthBounds", {
        get: function () {
            return this._csmAutoCalcDepthBounds;
        },
        set: function (cacdb) {
            if (this._csmAutoCalcDepthBounds === cacdb) {
                return;
            }
            this._csmAutoCalcDepthBounds = cacdb;
            this.getCSMGenerator().autoCalcDepthBounds = cacdb;
        },
        enumerable: true,
        configurable: true
    });
    CSM.prototype.getLightExtents = function () {
        var min = this.getCSMGenerator().getCascadeMinExtents(this._csmActiveCascade), max = this.getCSMGenerator().getCascadeMaxExtents(this._csmActiveCascade);
        return {
            "min": min,
            "max": max,
        };
    };
    CSM.prototype.getViewMatrix = function () {
        return this.getCSMGenerator().getCascadeViewMatrix(this._csmActiveCascade);
    };
    CSM.prototype.createGUI = function () {
        this.gui = new _CSMGUI__WEBPACK_IMPORTED_MODULE_2__["default"](this.name, this.scene.getEngine(), this._container, this);
        this.gui.createGUI();
    };
    CSM.prototype.createGenerator = function () {
        var generator = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["CascadedShadowGenerator"](this.shadowMapSize, this.sun);
        generator.numCascades = this._csmNumCascades;
        return generator;
    };
    CSM.prototype.setShadowMapViewerTexture = function () {
        this._shadowMapPlane.material.diffuseTexture = this.getCSMGenerator().getShadowMap();
    };
    CSM.prototype.createShadowGenerator = function () {
        _super.prototype.createShadowGenerator.call(this);
        var shadowGenerator = this.getCSMGenerator();
        shadowGenerator.stabilizeCascades = this._csmStabilizeCascades;
        shadowGenerator.depthClamp = this._csmDepthClamp;
        shadowGenerator.lambda = this._csmLambda;
        shadowGenerator.debug = this._csmVisualizeCascades;
        shadowGenerator.cascadeBlendPercentage = this._csmSplitBlendPercentage;
        shadowGenerator.penumbraDarkness = this._csmPenumbraDarkness;
        shadowGenerator.shadowMaxZ = this._csmShadowMaxZ;
        shadowGenerator.freezeShadowCastersBoundingInfo = true;
        shadowGenerator.autoCalcDepthBounds = this._csmAutoCalcDepthBounds;
        if (useSceneDepthRenderer) {
            shadowGenerator.setDepthRenderer(this._depthRenderer);
        }
        this.setShadowMapViewerTexture();
    };
    CSM.className = "CSM";
    return CSM;
}(_StandardShadow__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (CSM);


/***/ }),

/***/ "./src/CSM2/CSMGUI.tsx":
/*!*****************************!*\
  !*** ./src/CSM2/CSMGUI.tsx ***!
  \*****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SplitBaseGUI */ "./src/CSM2/SplitBaseGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var CSMGUI = /** @class */ (function (_super) {
    __extends(CSMGUI, _super);
    function CSMGUI(name, engine, container, parent) {
        var _this = _super.call(this, name, engine, container, parent) || this;
        _this._showAutoCalcPlanes = false;
        _this._showCSM = true;
        _this.dimensions.height = 950;
        return _this;
    }
    CSMGUI.prototype.createCustomGUIProperties = function () {
        var Properties = function () {
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
        };
        return Properties();
    };
    return CSMGUI;
}(_SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (CSMGUI);


/***/ }),

/***/ "./src/CSM2/GlobalGUI.tsx":
/*!********************************!*\
  !*** ./src/CSM2/GlobalGUI.tsx ***!
  \********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @material-ui/core */ "@material-ui/core");
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_material_ui_core__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _MainGUI__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../MainGUI */ "./src/MainGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};




var GlobalGUI = /** @class */ (function (_super) {
    __extends(GlobalGUI, _super);
    function GlobalGUI(name, engine, parent) {
        var _this = _super.call(this, name, engine, parent) || this;
        _this._selectedScene = 0;
        _this.scenes = [
            {
                "dname": "Power Plant",
                "path": "./resources/3d/powerplant/",
                "name": "powerplant.obj",
                "backfaceCulling": false,
                "camera": {
                    "position": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](40, 5, 5),
                    "target": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](0, 0, 5),
                },
                "scaling": 0.5,
                "sunColor": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Color3"](1, 1, 1),
                "light": {
                    "nearPlane": -90,
                    "farPlane": 130,
                },
            },
            {
                "dname": "Tower",
                "path": "./resources/3d/Tower/",
                "name": "Tower.obj",
                "backfaceCulling": true,
                "camera": {
                    "position": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](40, 5, 5),
                    "target": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](0, 5, 5),
                },
                "scaling": 0.025,
                "sunColor": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Color3"](1, 0.8, 0.5),
                "light": {
                    "nearPlane": -50,
                    "farPlane": 150,
                },
            } /*,
            {
                "dname": "Dude",
                "path": "./resources/3d/Dude/",
                "name": "dude.babylon",
                "backfaceCulling": true,
                "camera": {
                    "position": new Vector3(0, 76, 154),
                    "target": new Vector3(0, 0, 0),
                },
                "scaling": 0.25,
            }*/,
            {
                "dname": "Columns",
                "path": "./resources/3d/Columns/",
                "name": "Columns.obj",
                "backfaceCulling": true,
                "camera": {
                    "position": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](40, 5, 5),
                    "target": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Vector3"](0, 5, 5),
                },
                "scaling": 0.25,
                "sunColor": new babylonjs__WEBPACK_IMPORTED_MODULE_2__["Color3"](1, 0.8, 0.5),
                "light": {
                    "nearPlane": -92,
                    "farPlane": 150,
                },
            }
        ];
        return _this;
    }
    Object.defineProperty(GlobalGUI.prototype, "selectedScene", {
        get: function () {
            return this._selectedScene;
        },
        enumerable: true,
        configurable: true
    });
    GlobalGUI.prototype.createCustomGUIProperties = function () {
        var _this = this;
        var classes = this._useStyles();
        var _a = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](this._selectedScene), 2), scene = _a[0], setScene = _a[1];
        var changeScene = function (event, child) {
            _this._selectedScene = event.target.value;
            setScene(_this._selectedScene);
        };
        return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyTitle }, "Scene")),
            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, id: "scene", value: scene, onChange: changeScene }, this.scenes.map(function (scene, idx) {
                    return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { key: idx, value: idx }, scene.dname));
                })))));
    };
    return GlobalGUI;
}(_MainGUI__WEBPACK_IMPORTED_MODULE_3__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (GlobalGUI);


/***/ }),

/***/ "./src/CSM2/SplitBase.ts":
/*!*******************************!*\
  !*** ./src/CSM2/SplitBase.ts ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sample */ "./src/Sample.ts");
/* harmony import */ var _Split__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Split */ "./src/Split.ts");
/* harmony import */ var _Utils__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../Utils */ "./src/Utils.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();




var SplitBase = /** @class */ (function (_super) {
    __extends(SplitBase, _super);
    function SplitBase(scene, camera, parent, name) {
        var _this = _super.call(this, scene, camera, parent, name) || this;
        _this._sunDir = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"]();
        _this._sunColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"]();
        _this._sceneName = "";
        _this._cameraNearPlane = 0.25;
        _this._cameraFarPlane = 250;
        _this._animateLight = false;
        _this._autoCalcShadowZBounds = false;
        _this._lightNearPlane = -90;
        _this._lightFarPlane = 130;
        _this._showLightHelper = false;
        _this._rotateLightObservable = null;
        _this._shadowMapShowDepthMap = false;
        _this._showDepthMapObservable = null;
        _this._shadowMapSize = 1024;
        _this._shadowMapFilter = babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF;
        _this._shadowMapBias = 0.003;
        _this._shadowMapNormalBias = 0;
        _this._shadowMapDarkness = 0;
        _this._shadowMapQuality = babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].QUALITY_MEDIUM;
        _this._shadowMapDepthScale = 25;
        _this._shadowMapBlurScale = 2;
        _this._shadowMapUseKernelBlur = true;
        _this._shadowMapBlurKernel = 1;
        _this._shadowMapBlurBoxOffset = 1;
        _this._shadowMapLightSizeUVRatio = 0.01;
        _this._csmNumCascades = 4;
        _this._csmActiveCascade = 0;
        _this._csmVisualizeCascades = false;
        _this._csmStabilizeCascades = false;
        _this._csmDepthClamp = true;
        _this._csmLambda = 0.7;
        _this._csmSplitBlendPercentage = 0.05;
        _this._csmPenumbraDarkness = 0.7;
        _this._csmShadowMaxZ = 250;
        _this._csmAutoCalcDepthBounds = false;
        _this._shadowMapPlane = null;
        var size = 1;
        _this._shadowMapPlane = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreatePlane(_this.name + "_shadowmap", {
            "width": size,
            "height": size,
        }, _this.scene);
        _this._shadowMapPlane.position.x += size / 2;
        _this._shadowMapPlane.position.y -= size / 2;
        _this._shadowMapPlane.bakeCurrentTransformIntoVertices();
        _this._shadowMapPlane.alwaysSelectAsActiveMesh = true;
        //const material = this.buildShaderMaterial();
        var material = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"](_this.name + "_shadowmap_material", scene);
        material.emissiveColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1);
        material.disableLighting = true;
        material.depthFunction = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Engine"].ALWAYS;
        _this._shadowMapPlane.material = material;
        _this._shadowMapPlane.setEnabled(false);
        return _this;
    }
    SplitBase.prototype.buildShaderMaterial = function () {
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["customVertexShader"] = "   \n        precision highp float;\n\n        attribute vec3 position;\n        attribute vec2 uv;\n        \n        uniform mat4 world;\n        uniform mat4 worldViewProjection;\n        \n        varying vec2 vUv;\n        \n        void main(void) {\n            vUv = uv;\n            gl_Position = worldViewProjection * vec4(position, 1.0);\n        }\n        ";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["customFragmentShader"] = "\n        precision highp float;\n\n        varying vec2 vUv;\n    \tuniform highp sampler2DArrayShadow textureSampler;\n        \n        void main(void) {\n            float shadow = texelFetch(textureSampler, vUv, 0);\n            gl_FragColor = shadow;//vec4(vec3(shadow), 1.0);\n        }\n        ";
        var mat = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShaderMaterial"]("shader", this.scene, {
            vertex: "custom",
            fragment: "custom",
        }, {
            attributes: ["position", "uv"],
            uniforms: ["world", "worldViewProjection"],
        });
        return mat;
    };
    SplitBase.prototype.render = function () {
        var sky = this.scene.getMeshByName("skyBox");
        if (sky) {
            sky.position.set(this.camera.position.x, this.camera.position.y, this.camera.position.z);
        }
        _super.prototype.render.call(this);
    };
    Object.defineProperty(SplitBase.prototype, "shadowMapPlane", {
        get: function () {
            return this._shadowMapPlane;
        },
        enumerable: true,
        configurable: true
    });
    SplitBase.prototype.initialize = function (scene, ambientColor, sunDir) {
        return Promise.resolve(this);
    };
    Object.defineProperty(SplitBase.prototype, "sceneName", {
        get: function () {
            return this._sceneName;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "cameraNearPlane", {
        get: function () {
            return this._cameraNearPlane;
        },
        set: function (cnp) {
            this._cameraNearPlane = cnp;
            this.camera.minZ = cnp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "cameraFarPlane", {
        get: function () {
            return this._cameraFarPlane;
        },
        set: function (cfp) {
            this._cameraFarPlane = cfp;
            this.camera.maxZ = cfp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "animateLight", {
        get: function () {
            return this._animateLight;
        },
        set: function (al) {
            if (this._rotateLightObservable && !al) {
                this.scene.onBeforeRenderObservable.remove(this._rotateLightObservable);
                this._rotateLightObservable = null;
            }
            this._animateLight = al;
            if (!this._rotateLightObservable && al) {
                this._rotateLightObservable = this.scene.onBeforeRenderObservable.add(this.rotateLight.bind(this));
            }
            this.setDirectionFromSibling(this._animateLight);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightColor", {
        get: function () {
            return this._sunColor.toHexString();
        },
        set: function (lc) {
            this._sunColor = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"].FromHexString(lc);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightDirection", {
        get: function () {
            return this._sunDir;
        },
        set: function (ld) {
            this._sunDir = ld;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "showLightHelper", {
        get: function () {
            return this._showLightHelper;
        },
        set: function (slh) {
            this._showLightHelper = slh;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapShowDepthMap", {
        get: function () {
            return this._shadowMapShowDepthMap;
        },
        set: function (smsdm) {
            if (this._shadowMapShowDepthMap && !smsdm) {
                this.scene.onBeforeRenderObservable.remove(this._showDepthMapObservable);
                this._showDepthMapObservable = null;
            }
            this._shadowMapShowDepthMap = smsdm;
            this._shadowMapPlane.setEnabled(smsdm);
            if (!this._showDepthMapObservable && smsdm) {
                this._showDepthMapObservable = this.scene.onBeforeRenderObservable.add(this.showDepthMap.bind(this));
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapSize", {
        get: function () {
            return this._shadowMapSize;
        },
        set: function (sms) {
            this._shadowMapSize = sms;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapFilter", {
        get: function () {
            return this._shadowMapFilter;
        },
        set: function (smf) {
            this._shadowMapFilter = smf;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBias", {
        get: function () {
            return this._shadowMapBias;
        },
        set: function (smb) {
            this._shadowMapBias = smb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapNormalBias", {
        get: function () {
            return this._shadowMapNormalBias;
        },
        set: function (smnb) {
            this._shadowMapNormalBias = smnb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapDarkness", {
        get: function () {
            return this._shadowMapDarkness;
        },
        set: function (smd) {
            this._shadowMapDarkness = smd;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapQuality", {
        get: function () {
            return this._shadowMapQuality;
        },
        set: function (smq) {
            this._shadowMapQuality = smq;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapDepthScale", {
        get: function () {
            return this._shadowMapDepthScale;
        },
        set: function (smds) {
            this._shadowMapDepthScale = smds;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBlurScale", {
        get: function () {
            return this._shadowMapBlurScale;
        },
        set: function (smbs) {
            this._shadowMapBlurScale = smbs;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapUseKernelBlur", {
        get: function () {
            return this._shadowMapUseKernelBlur;
        },
        set: function (smukb) {
            this._shadowMapUseKernelBlur = smukb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBlurKernel", {
        get: function () {
            return this._shadowMapBlurKernel;
        },
        set: function (smbk) {
            this._shadowMapBlurKernel = smbk;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapBlurBoxOffset", {
        get: function () {
            return this._shadowMapBlurBoxOffset;
        },
        set: function (smbbo) {
            this._shadowMapBlurBoxOffset = smbbo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "shadowMapLightSizeUVRatio", {
        get: function () {
            return this._shadowMapLightSizeUVRatio;
        },
        set: function (smlsuvr) {
            this._shadowMapLightSizeUVRatio = smlsuvr;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightNearPlane", {
        get: function () {
            return this._lightNearPlane;
        },
        set: function (lnp) {
            this._lightNearPlane = lnp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "lightFarPlane", {
        get: function () {
            return this._lightFarPlane;
        },
        set: function (lfp) {
            this._lightFarPlane = lfp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "autoCalcShadowZBounds", {
        get: function () {
            return this._autoCalcShadowZBounds;
        },
        set: function (acszb) {
            this._autoCalcShadowZBounds = acszb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmNumCascades", {
        get: function () {
            return this._csmNumCascades;
        },
        set: function (num) {
            this._csmNumCascades = num;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmActiveCascade", {
        get: function () {
            return this._csmActiveCascade;
        },
        set: function (cac) {
            this._csmActiveCascade = cac;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmVisualizeCascades", {
        get: function () {
            return this._csmVisualizeCascades;
        },
        set: function (cvc) {
            this._csmVisualizeCascades = cvc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmStabilizeCascades", {
        get: function () {
            return this._csmStabilizeCascades;
        },
        set: function (csc) {
            this._csmStabilizeCascades = csc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmDepthClamp", {
        get: function () {
            return this._csmDepthClamp;
        },
        set: function (cdc) {
            this._csmDepthClamp = cdc;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmLambda", {
        get: function () {
            return this._csmLambda;
        },
        set: function (cl) {
            this._csmLambda = cl;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmSplitBlendPercentage", {
        get: function () {
            return this._csmSplitBlendPercentage;
        },
        set: function (csbp) {
            this._csmSplitBlendPercentage = csbp;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmPenumbraDarkness", {
        get: function () {
            return this._csmPenumbraDarkness;
        },
        set: function (cpd) {
            this._csmPenumbraDarkness = cpd;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmShadowMaxZ", {
        get: function () {
            return this._csmShadowMaxZ;
        },
        set: function (csmz) {
            this._csmShadowMaxZ = csmz;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SplitBase.prototype, "csmAutoCalcDepthBounds", {
        get: function () {
            return this._csmAutoCalcDepthBounds;
        },
        set: function (cacdb) {
            this._csmAutoCalcDepthBounds = cacdb;
        },
        enumerable: true,
        configurable: true
    });
    SplitBase.prototype.setDirectionFromSibling = function (checkAnimate) {
        if (checkAnimate === void 0) { checkAnimate = true; }
        for (var i = 0; i < this._container.splits.length; ++i) {
            var ssplit = this._container.splits[i];
            if (ssplit !== this && (ssplit.animateLight === checkAnimate) && ssplit.group === this.group) {
                this.lightDirection = ssplit.lightDirection.clone();
                break;
            }
        }
    };
    SplitBase.prototype.rotateLight = function () {
        var deltaTime = this.scene.getEngine().getDeltaTime() / 1000;
        var matrix = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"]();
        var rotY = _Utils__WEBPACK_IMPORTED_MODULE_3__["default"].XMScalarModAngle(deltaTime * 0.25);
        var rotation = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Quaternion"].RotationAxis(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0.0, 1.0, 0.0), rotY);
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].FromQuaternionToRef(rotation, matrix);
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinatesToRef(this._sunDir, matrix, this._sunDir);
        this.lightDirection = this._sunDir;
    };
    SplitBase.prototype.showDepthMap = function () {
        this.camera.getViewMatrix(); // make sure the transformation matrix we get when calling 'getTransformationMatrix()' is calculated with an up to date view matrix
        var invertCameraViewProj = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Invert(this.camera.getTransformationMatrix());
        var h = 256 / this.scene.getEngine().getRenderWidth(true);
        var pOfst = 0;
        if (this._container.splitMode === _Sample__WEBPACK_IMPORTED_MODULE_1__["enumSplitMode"].LINEAR) {
            var sidx = this._container.splits.indexOf(this), sw = 2 / this._container.splits.length;
            pOfst = sw * sidx + sw / 2 - h;
        }
        else {
            pOfst = 1 - h;
        }
        var p = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1, 1, -1 + 0.001);
        var q = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1 + h * 2, 1, -1 + 0.001);
        var pt = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(p, invertCameraViewProj);
        var qt = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(q, invertCameraViewProj);
        var d = qt.subtract(pt).length();
        this.shadowMapPlane.scaling = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](d, d, 1);
        p.x += pOfst;
        this.shadowMapPlane.rotation = this.camera.rotation;
        this.shadowMapPlane.position = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(p, invertCameraViewProj);
    };
    return SplitBase;
}(_Split__WEBPACK_IMPORTED_MODULE_2__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (SplitBase);


/***/ }),

/***/ "./src/CSM2/SplitBaseGUI.tsx":
/*!***********************************!*\
  !*** ./src/CSM2/SplitBaseGUI.tsx ***!
  \***********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @material-ui/core */ "@material-ui/core");
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_material_ui_core__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _GUI__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../GUI */ "./src/GUI.tsx");
/* harmony import */ var _SplitGUI__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../SplitGUI */ "./src/SplitGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (undefined && undefined.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};





var SplitBaseGUI = /** @class */ (function (_super) {
    __extends(SplitBaseGUI, _super);
    function SplitBaseGUI(name, engine, container, parent) {
        var _this = _super.call(this, name, engine, container, parent) || this;
        _this._sparent = parent;
        _this._showAutoCalcPlanes = true;
        _this._showCSM = false;
        _this.dimensions.width = 320;
        _this.dimensions.height = 750;
        return _this;
    }
    SplitBaseGUI.prototype.createCustomGUI = function () {
        var _this = this;
        var classes = this._useStyles();
        var Properties = function () {
            //const [ignored, forceUpdate] = React.useReducer((x) => x + 1, 0);
            var _a = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.cameraNearPlane), 2), cameraNearPlane = _a[0], setCameraNearPlane = _a[1];
            var _b = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.cameraFarPlane), 2), cameraFarPlane = _b[0], setCameraFarPlane = _b[1];
            var _c = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.animateLight), 2), animateLight = _c[0], setAnimateLight = _c[1];
            var _d = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.lightColor), 2), lightColor = _d[0], setLightColor = _d[1];
            var _e = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](Math.floor(_this._sparent.lightNearPlane)), 2), lightNearPlane = _e[0], setLightNearPlane = _e[1];
            var _f = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](Math.floor(_this._sparent.lightFarPlane)), 2), lightFarPlane = _f[0], setLightFarPlane = _f[1];
            var _g = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.autoCalcShadowZBounds), 2), autoCalcShadowZBounds = _g[0], setAutoCalcShadowZBounds = _g[1];
            var _h = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.showLightHelper), 2), showLightHelper = _h[0], setShowLightHelper = _h[1];
            var _j = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapShowDepthMap), 2), shadowMapShowDepthMap = _j[0], setShadowMapShowDepthMap = _j[1];
            var _k = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapSize), 2), shadowMapSize = _k[0], setShadowMapSize = _k[1];
            var _l = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBias), 2), shadowMapBias = _l[0], setShadowMapBias = _l[1];
            var _m = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapNormalBias), 2), shadowMapNormalBias = _m[0], setShadowMapNormalBias = _m[1];
            var _o = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapDarkness), 2), shadowMapDarkness = _o[0], setShadowMapDarkness = _o[1];
            var _p = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapFilter), 2), shadowMapFilter = _p[0], setShadowMapFilter = _p[1];
            var _q = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapQuality), 2), shadowMapQuality = _q[0], setShadowMapQuality = _q[1];
            var _r = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapDepthScale), 2), shadowMapDepthScale = _r[0], setShadowMapDepthScale = _r[1];
            var _s = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBlurScale), 2), shadowMapBlurScale = _s[0], setShadowMapBlurScale = _s[1];
            var _t = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapUseKernelBlur), 2), shadowMapUseKernelBlur = _t[0], setShadowMapUseKernelBlur = _t[1];
            var _u = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBlurKernel), 2), shadowMapBlurKernel = _u[0], setShadowMapBlurKernel = _u[1];
            var _v = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapBlurBoxOffset), 2), shadowMapBlurBoxOffset = _v[0], setShadowMapBlurBoxOffset = _v[1];
            var _w = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.shadowMapLightSizeUVRatio), 2), shadowMapLightSizeUVRatio = _w[0], setShadowMapLightSizeUVRatio = _w[1];
            var _x = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmNumCascades), 2), csmNumCascades = _x[0], setCSMNumCascades = _x[1];
            var _y = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmActiveCascade), 2), csmActiveCascade = _y[0], setCSMActiveCascade = _y[1];
            var _z = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmVisualizeCascades), 2), csmVisualizeCascades = _z[0], setCSMVisualizeCascades = _z[1];
            var _0 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmStabilizeCascades), 2), csmStabilizeCascades = _0[0], setCSMStabilizeCascades = _0[1];
            var _1 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmDepthClamp), 2), csmDepthClamp = _1[0], setCSMDepthClamp = _1[1];
            var _2 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmLambda), 2), csmLambda = _2[0], setCSMLambda = _2[1];
            var _3 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmSplitBlendPercentage), 2), csmSplitBlendPercentage = _3[0], setCSMSplitBlendPercentage = _3[1];
            var _4 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmPenumbraDarkness), 2), csmPenumbraDarkness = _4[0], setCSMPenumbraDarkness = _4[1];
            var _5 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmShadowMaxZ), 2), csmShadowMaxZ = _5[0], setCSMShadowMaxZ = _5[1];
            var _6 = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._sparent.csmAutoCalcDepthBounds), 2), csmAutoCalcDepthBounds = _6[0], setCSMAutoCalcDepthBounds = _6[1];
            var changeCameraNearPlane = function (event, value) {
                _this._sparent.cameraNearPlane = value;
                setCameraNearPlane(_this._sparent.cameraNearPlane);
            };
            var changeCameraFarPlane = function (event, value) {
                _this._sparent.cameraFarPlane = value;
                setCameraFarPlane(_this._sparent.cameraFarPlane);
            };
            var changeAnimateLight = function (event, checked) {
                setAnimateLight(checked);
                _this._sparent.animateLight = checked;
            };
            var changeLightColor = function (event) {
                _this._sparent.lightColor = event.target.value;
                setLightColor(_this._sparent.lightColor);
            };
            var changeLightNearPlane = function (event, value) {
                _this._sparent.lightNearPlane = value;
                setLightNearPlane(_this._sparent.lightNearPlane);
            };
            var changeLightFarPlane = function (event, value) {
                _this._sparent.lightFarPlane = value;
                setLightFarPlane(_this._sparent.lightFarPlane);
            };
            var changeAutoCalcShadowZBounds = function (event, checked) {
                setAutoCalcShadowZBounds(checked);
                _this._sparent.autoCalcShadowZBounds = checked;
            };
            var changeShowLightHelper = function (event, checked) {
                setShowLightHelper(checked);
                _this._sparent.showLightHelper = checked;
            };
            var changeShadowMapShowDepthMap = function (event, checked) {
                setShadowMapShowDepthMap(checked);
                _this._sparent.shadowMapShowDepthMap = checked;
            };
            var changeShadowMapSize = function (event, child) {
                _this._sparent.shadowMapSize = event.target.value;
                setShadowMapSize(_this._sparent.shadowMapSize);
            };
            var changeShadowMapBias = function (event) {
                _this._sparent.shadowMapBias = event.target.value;
                setShadowMapBias(_this._sparent.shadowMapBias);
            };
            var changeShadowMapNormalBias = function (event) {
                _this._sparent.shadowMapNormalBias = event.target.value;
                setShadowMapNormalBias(_this._sparent.shadowMapNormalBias);
            };
            var changeShadowMapDarkness = function (event, value) {
                _this._sparent.shadowMapDarkness = value;
                setShadowMapDarkness(_this._sparent.shadowMapDarkness);
            };
            var changeShadowMapFilter = function (event, child) {
                _this._sparent.shadowMapFilter = event.target.value;
                setShadowMapFilter(_this._sparent.shadowMapFilter);
            };
            var changeShadowMapQuality = function (event, child) {
                _this._sparent.shadowMapQuality = event.target.value;
                setShadowMapQuality(_this._sparent.shadowMapQuality);
            };
            var changeShadowMapDepthScale = function (event) {
                _this._sparent.shadowMapDepthScale = event.target.value;
                setShadowMapDepthScale(_this._sparent.shadowMapDepthScale);
            };
            var changeShadowMapBlurScale = function (event, value) {
                _this._sparent.shadowMapBlurScale = value;
                setShadowMapBlurScale(_this._sparent.shadowMapBlurScale);
            };
            var changeShadowMapUseKernelBlur = function (event, checked) {
                setShadowMapUseKernelBlur(checked);
                _this._sparent.shadowMapUseKernelBlur = checked;
            };
            var changeShadowMapBlurKernel = function (event, value) {
                _this._sparent.shadowMapBlurKernel = value;
                setShadowMapBlurKernel(_this._sparent.shadowMapBlurKernel);
            };
            var changeShadowMapBlurBoxOffset = function (event, value) {
                _this._sparent.shadowMapBlurBoxOffset = value;
                setShadowMapBlurBoxOffset(_this._sparent.shadowMapBlurBoxOffset);
            };
            var changeShadowMapLightSizeUVRatio = function (event) {
                _this._sparent.shadowMapLightSizeUVRatio = event.target.value;
                setShadowMapLightSizeUVRatio(_this._sparent.shadowMapLightSizeUVRatio);
            };
            var changeNumCascades = function (event, child) {
                _this._sparent.csmNumCascades = event.target.value;
                setCSMNumCascades(_this._sparent.csmNumCascades);
                setCSMActiveCascade(_this._sparent.csmActiveCascade);
            };
            var changeActiveCascade = function (event, child) {
                _this._sparent.csmActiveCascade = event.target.value;
                setCSMActiveCascade(_this._sparent.csmActiveCascade);
                setShadowMapBias(_this._sparent.shadowMapBias);
                setShadowMapNormalBias(_this._sparent.shadowMapNormalBias);
                setShadowMapDarkness(_this._sparent.shadowMapDarkness);
                setShadowMapFilter(_this._sparent.shadowMapFilter);
                setShadowMapQuality(_this._sparent.shadowMapQuality);
            };
            var changeCSMVisualizeCascades = function (event, checked) {
                setCSMVisualizeCascades(checked);
                _this._sparent.csmVisualizeCascades = checked;
            };
            var changeCSMStabilizeCascades = function (event, checked) {
                setCSMStabilizeCascades(checked);
                _this._sparent.csmStabilizeCascades = checked;
            };
            var changeCSMDepthClamp = function (event, checked) {
                setCSMDepthClamp(checked);
                _this._sparent.csmDepthClamp = checked;
            };
            var changeCSMLambda = function (event, value) {
                _this._sparent.csmLambda = value;
                setCSMLambda(_this._sparent.csmLambda);
            };
            var changeCSMSplitBlendPercentage = function (event, value) {
                _this._sparent.csmSplitBlendPercentage = value;
                setCSMSplitBlendPercentage(_this._sparent.csmSplitBlendPercentage);
            };
            var changeCSMPenumbraDarkness = function (event, value) {
                _this._sparent.csmPenumbraDarkness = value;
                setCSMPenumbraDarkness(_this._sparent.csmPenumbraDarkness);
            };
            var changeCSMShadowMaxZ = function (event, value) {
                _this._sparent.csmShadowMaxZ = value;
                setCSMShadowMaxZ(_this._sparent.csmShadowMaxZ);
            };
            var changeCSMAutoCalcDepthBounds = function (event, checked) {
                setCSMAutoCalcDepthBounds(checked);
                _this._sparent.csmAutoCalcDepthBounds = checked;
            };
            react__WEBPACK_IMPORTED_MODULE_0__["useEffect"](function () {
                var handler = function (event) {
                    switch (event.detail.type) {
                        case 'setShadowZBounds': {
                            setLightNearPlane(Math.floor(_this._sparent.lightNearPlane));
                            setLightFarPlane(Math.floor(_this._sparent.lightFarPlane));
                            break;
                        }
                        case 'setShadowMaxZ': {
                            setCSMShadowMaxZ(Math.floor(_this._sparent.csmShadowMaxZ));
                            break;
                        }
                    }
                };
                window.addEventListener('gui_set_value', handler);
                return function () {
                    window.removeEventListener('gui_set_value', handler);
                };
            }, []);
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, "Scene")),
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Current Scene")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue }, _this._sparent.sceneName)),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Camera Near Plane")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: cameraNearPlane, min: 0, max: 10, step: 0.01, onChange: changeCameraNearPlane }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Camera Far Plane")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: cameraFarPlane, min: 0, max: 2000, step: 10, onChange: changeCameraFarPlane })))))),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, "Light")),
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Show Helper")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: showLightHelper, onChange: changeShowLightHelper }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Animate")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: animateLight, onChange: changeAnimateLight }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Color")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "color", value: lightColor, variant: "filled", onChange: changeLightColor }))),
                            _this._showAutoCalcPlanes && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Auto Calc Planes")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: autoCalcShadowZBounds, onChange: changeAutoCalcShadowZBounds }))),
                                 true && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Near Plane")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { disabled: autoCalcShadowZBounds, valueLabelDisplay: "auto", value: lightNearPlane, min: -250, max: 250, step: 1, onChange: changeLightNearPlane }))),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Far Plane")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { disabled: autoCalcShadowZBounds, valueLabelDisplay: "auto", value: lightFarPlane, min: 0, max: 500, step: 1, onChange: changeLightFarPlane })))))))),
                _this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, "Cascaded Shadow Maps")),
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Num of Cascades")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: csmNumCascades, onChange: changeNumCascades }, __spread(Array(3).keys()).map(function (_, i) { return react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { key: i + 2, value: i + 2 }, i + 2); }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Active Cascade")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: csmActiveCascade, onChange: changeActiveCascade }, __spread(Array(csmNumCascades).keys()).map(function (_, i) { return react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { key: i, value: i }, i + 1); }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Visualize Cascades")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmVisualizeCascades, onChange: changeCSMVisualizeCascades }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Stabilize Cascades")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmStabilizeCascades, onChange: changeCSMStabilizeCascades }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Lambda")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: csmLambda, min: 0, max: 1, step: 0.01, onChange: changeCSMLambda }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Cascade Blend")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: csmSplitBlendPercentage, min: 0, max: 1, step: 0.01, onChange: changeCSMSplitBlendPercentage }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Auto-Calc Depth")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmAutoCalcDepthBounds, onChange: changeCSMAutoCalcDepthBounds }))),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Shadow MaxZ")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: csmShadowMaxZ, min: 0, max: 500, step: 10, onChange: changeCSMShadowMaxZ }))))))),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanel"], { defaultExpanded: true },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelSummary"], { expandIcon: react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Icon"], null, "expand_more") },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Typography"], null, _this._showCSM ? "Cascade" : "Shadow Map")),
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["ExpansionPanelDetails"], null,
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                            (!_this._showCSM || _this._showCSM && shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["CascadedShadowGenerator"].FILTER_NONE) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Show Depth Map")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: shadowMapShowDepthMap, onChange: changeShadowMapShowDepthMap })))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Size")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapSize, onChange: changeShadowMapSize },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 2048 }, "2048x2048"),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 1024 }, "1024x1024"),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 512 }, "512x512"),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: 256 }, "256x256"))),
                            _this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Depth Clamp")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: csmDepthClamp, onChange: changeCSMDepthClamp })))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Bias")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapBias, variant: "standard", inputProps: { step: "0.001" }, onChange: changeShadowMapBias }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Normal Bias")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapNormalBias, variant: "standard", inputProps: { step: "0.001" }, onChange: changeShadowMapNormalBias }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Darkness")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: shadowMapDarkness, min: 0, max: 1, step: 0.01, onChange: changeShadowMapDarkness }))),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Filter Type")),
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                !_this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapFilter, onChange: changeShadowMapFilter },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCSS }, "PCSS"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCF }, "PCF"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLURCLOSEEXPONENTIALSHADOWMAP }, "CESM (Blur)"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_CLOSEEXPONENTIALSHADOWMAP }, "CESM"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP }, "ESM (Blur)"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_EXPONENTIALSHADOWMAP }, "ESM"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_POISSONSAMPLING }, "Poisson"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_NONE }, "None"))),
                                _this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapFilter, onChange: changeShadowMapFilter },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["CascadedShadowGenerator"].FILTER_PCSS }, "PCSS"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["CascadedShadowGenerator"].FILTER_PCF }, "PCF"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["CascadedShadowGenerator"].FILTER_NONE }, "None")))),
                            ((shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCSS || shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCF) && !_this._showCSM || (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["CascadedShadowGenerator"].FILTER_PCSS || shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["CascadedShadowGenerator"].FILTER_PCF) && _this._showCSM) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Filtering Quality")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, value: shadowMapQuality, onChange: changeShadowMapQuality },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].QUALITY_LOW }, "Low"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].QUALITY_MEDIUM }, "Medium"),
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].QUALITY_HIGH }, "High")))),
                            ((shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_PCSS) && !_this._showCSM || (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["CascadedShadowGenerator"].FILTER_PCSS) && _this._showCSM) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Light Size UV Ratio")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapLightSizeUVRatio, variant: "standard", inputProps: { step: "0.001" }, onChange: changeShadowMapLightSizeUVRatio }))),
                                _this._showCSM && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Penumbra Darkness")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", value: csmPenumbraDarkness, min: 0, max: 1, step: 0.01, onChange: changeCSMPenumbraDarkness }))))),
                            !_this._showCSM && (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP || shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_EXPONENTIALSHADOWMAP) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Depth Scale")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["TextField"], { type: "number", value: shadowMapDepthScale, variant: "standard", inputProps: { step: "1" }, onChange: changeShadowMapDepthScale })))),
                            !_this._showCSM && (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Blur Scale")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", defaultValue: shadowMapBlurScale, min: 1, max: 4, step: 1, onChange: changeShadowMapBlurScale })))),
                            !_this._showCSM && (shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLURCLOSEEXPONENTIALSHADOWMAP || shadowMapFilter === babylonjs__WEBPACK_IMPORTED_MODULE_2__["ShadowGenerator"].FILTER_BLUREXPONENTIALSHADOWMAP) && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Use Kernel Blur")),
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: shadowMapUseKernelBlur, onChange: changeShadowMapUseKernelBlur }))),
                                shadowMapUseKernelBlur && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Blur Kernel")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", defaultValue: shadowMapBlurKernel, min: 1, max: 64, step: 1, onChange: changeShadowMapBlurKernel })))),
                                !shadowMapUseKernelBlur && react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.subPropertyTitle }, "Blur Box Offset")),
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6, className: classes.propertyValue },
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_GUI__WEBPACK_IMPORTED_MODULE_3__["PrettoSlider"], { valueLabelDisplay: "auto", defaultValue: shadowMapBlurBoxOffset, min: 1, max: 64, step: 1, onChange: changeShadowMapBlurBoxOffset })))))))),
                _this.createCustomGUIProperties()));
        };
        return Properties();
    };
    SplitBaseGUI.prototype.createCustomGUIProperties = function () {
        return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
    };
    return SplitBaseGUI;
}(_SplitGUI__WEBPACK_IMPORTED_MODULE_4__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (SplitBaseGUI);


/***/ }),

/***/ "./src/CSM2/StandardShadow.ts":
/*!************************************!*\
  !*** ./src/CSM2/StandardShadow.ts ***!
  \************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Utils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Utils */ "./src/Utils.ts");
/* harmony import */ var _SplitBase__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./SplitBase */ "./src/CSM2/SplitBase.ts");
/* harmony import */ var _StandardShadowGUI__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./StandardShadowGUI */ "./src/CSM2/StandardShadowGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};




var StandardShadow = /** @class */ (function (_super) {
    __extends(StandardShadow, _super);
    function StandardShadow(scene, camera, parent, name) {
        var _this = _super.call(this, scene, camera, parent, name) || this;
        _this.sun = null;
        _this._shadowGenerator = null;
        _this._lightHelperFrustumLines = [];
        _this._lightGizmo = null;
        return _this;
    }
    StandardShadow.prototype.getStandardGenerator = function () {
        return this._shadowGenerator;
    };
    Object.defineProperty(StandardShadow.prototype, "lightColor", {
        get: function () {
            return this._sunColor.toHexString();
        },
        set: function (lc) {
            this._sunColor = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"].FromHexString(lc);
            this.sun.diffuse = this._sunColor;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "lightDirection", {
        get: function () {
            return this._sunDir;
        },
        set: function (ld) {
            this._sunDir = ld;
            this.sun.direction = ld;
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapSize", {
        get: function () {
            return this._shadowMapSize;
        },
        set: function (sms) {
            this._shadowMapSize = sms;
            this.createShadowGenerator();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapFilter", {
        get: function () {
            return this._shadowMapFilter;
        },
        set: function (smf) {
            this.getStandardGenerator().filter = smf;
            this._shadowMapFilter = this.getStandardGenerator().filter;
            this.setShadowMapViewerTexture();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBias", {
        get: function () {
            return this._shadowMapBias;
        },
        set: function (smb) {
            this._shadowMapBias = smb;
            this.getStandardGenerator().bias = smb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapNormalBias", {
        get: function () {
            return this._shadowMapNormalBias;
        },
        set: function (smnb) {
            this._shadowMapNormalBias = smnb;
            this.getStandardGenerator().normalBias = smnb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapDarkness", {
        get: function () {
            return this._shadowMapDarkness;
        },
        set: function (smd) {
            this._shadowMapDarkness = smd;
            this.getStandardGenerator().darkness = smd;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapQuality", {
        get: function () {
            return this._shadowMapQuality;
        },
        set: function (smq) {
            this._shadowMapQuality = smq;
            this.getStandardGenerator().filteringQuality = smq;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapDepthScale", {
        get: function () {
            return this._shadowMapDepthScale;
        },
        set: function (smds) {
            this._shadowMapDepthScale = smds;
            this.getStandardGenerator().depthScale = smds;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBlurScale", {
        get: function () {
            return this._shadowMapBlurScale;
        },
        set: function (smbs) {
            this._shadowMapBlurScale = smbs;
            this.getStandardGenerator().blurScale = smbs;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapUseKernelBlur", {
        get: function () {
            return this._shadowMapUseKernelBlur;
        },
        set: function (smukb) {
            this._shadowMapUseKernelBlur = smukb;
            this.getStandardGenerator().useKernelBlur = smukb;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBlurKernel", {
        get: function () {
            return this._shadowMapBlurKernel;
        },
        set: function (smbk) {
            this._shadowMapBlurKernel = smbk;
            this.getStandardGenerator().blurKernel = smbk;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapBlurBoxOffset", {
        get: function () {
            return this._shadowMapBlurBoxOffset;
        },
        set: function (smbbo) {
            this._shadowMapBlurBoxOffset = smbbo;
            this.getStandardGenerator().blurBoxOffset = smbbo;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "shadowMapLightSizeUVRatio", {
        get: function () {
            return this._shadowMapLightSizeUVRatio;
        },
        set: function (smlsuvr) {
            this._shadowMapLightSizeUVRatio = smlsuvr;
            this.getStandardGenerator().contactHardeningLightSizeUVRatio = smlsuvr;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "lightNearPlane", {
        get: function () {
            return this._lightNearPlane;
        },
        set: function (lnp) {
            this._lightNearPlane = lnp;
            this.sun.shadowMinZ = lnp;
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "lightFarPlane", {
        get: function () {
            return this._lightFarPlane;
        },
        set: function (lfp) {
            this._lightFarPlane = lfp;
            this.sun.shadowMaxZ = lfp;
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "showLightHelper", {
        get: function () {
            return this._showLightHelper;
        },
        set: function (slh) {
            this._showLightHelper = slh;
            if (this._lightGizmo && !slh) {
                this._lightGizmo.dispose();
                this._lightGizmo = null;
            }
            if (slh) {
                this._lightGizmo = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["LightGizmo"]();
                this._lightGizmo.light = this.sun;
            }
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StandardShadow.prototype, "autoCalcShadowZBounds", {
        get: function () {
            return this._autoCalcShadowZBounds;
        },
        set: function (acszb) {
            this._autoCalcShadowZBounds = acszb;
            this.sun.autoCalcShadowZBounds = acszb;
            if (this._autoCalcShadowZBounds) {
                this.sun.setShadowProjectionMatrix(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Identity(), this.getStandardGenerator()._viewMatrix, this.getStandardGenerator().getShadowMap().renderList);
            }
            else {
                this._lightNearPlane = this.sun.shadowMinZ;
                this._lightFarPlane = this.sun.shadowMaxZ;
                var event_1 = new CustomEvent('gui_set_value', { detail: { type: 'setShadowZBounds' } });
                window.dispatchEvent(event_1);
            }
            this.buildLightHelper();
        },
        enumerable: true,
        configurable: true
    });
    StandardShadow.prototype.getLightExtents = function () {
        var light = this.sun;
        return {
            "min": new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](light._orthoLeft, light._orthoBottom, this.sun.shadowMinZ),
            "max": new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](light._orthoRight, light._orthoTop, this.sun.shadowMaxZ),
        };
    };
    StandardShadow.prototype.getViewMatrix = function () {
        return this.getStandardGenerator()._viewMatrix;
    };
    StandardShadow.prototype.buildLightHelper = function () {
        var _this = this;
        this._lightHelperFrustumLines.forEach(function (mesh) {
            mesh.dispose();
        });
        this._lightHelperFrustumLines = [];
        if (!this._showLightHelper) {
            return;
        }
        var lightExtents = this.getLightExtents();
        var lightView = this.getViewMatrix();
        if (!lightExtents || !lightView) {
            return;
        }
        var invLightView = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Invert(lightView);
        var n1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.max.y, lightExtents.min.z);
        var n2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.min.y, lightExtents.min.z);
        var n3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.min.y, lightExtents.min.z);
        var n4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.max.y, lightExtents.min.z);
        var near1 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n1, invLightView);
        var near2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n2, invLightView);
        var near3 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n3, invLightView);
        var near4 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(n4, invLightView);
        var f1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.max.y, lightExtents.max.z);
        var f2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.max.x, lightExtents.min.y, lightExtents.max.z);
        var f3 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.min.y, lightExtents.max.z);
        var f4 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](lightExtents.min.x, lightExtents.max.y, lightExtents.max.z);
        var far1 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f1, invLightView);
        var far2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f2, invLightView);
        var far3 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f3, invLightView);
        var far4 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(f4, invLightView);
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("nearlines", { points: [near1, near2, near3, near4, near1] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("farlines", { points: [far1, far2, far3, far4, far1] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("trlines", { points: [near1, far1] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("brlines", { points: [near2, far2] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("tllines", { points: [near3, far3] }, this.scene));
        this._lightHelperFrustumLines.push(babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateLines("bllines", { points: [near4, far4] }, this.scene));
        var makePlane = function (name, color, positions) {
            var plane = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"](name + "plane", _this.scene), mat = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"](name + "PlaneMat", _this.scene);
            plane.material = mat;
            mat.emissiveColor = color;
            mat.alpha = 0.3;
            mat.backFaceCulling = false;
            mat.disableLighting = true;
            var indices = [0, 1, 2, 0, 2, 3];
            var vertexData = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["VertexData"]();
            vertexData.positions = positions;
            vertexData.indices = indices;
            vertexData.applyToMesh(plane);
            _this._lightHelperFrustumLines.push(plane);
        };
        makePlane("near", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 0, 0), [near1.x, near1.y, near1.z, near2.x, near2.y, near2.z, near3.x, near3.y, near3.z, near4.x, near4.y, near4.z]);
        makePlane("far", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0.3, 0, 0), [far1.x, far1.y, far1.z, far2.x, far2.y, far2.z, far3.x, far3.y, far3.z, far4.x, far4.y, far4.z]);
        makePlane("right", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 1, 0), [near1.x, near1.y, near1.z, far1.x, far1.y, far1.z, far2.x, far2.y, far2.z, near2.x, near2.y, near2.z]);
        makePlane("left", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0.3, 0), [near4.x, near4.y, near4.z, far4.x, far4.y, far4.z, far3.x, far3.y, far3.z, near3.x, near3.y, near3.z]);
        makePlane("top", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 1), [near1.x, near1.y, near1.z, far1.x, far1.y, far1.z, far4.x, far4.y, far4.z, near4.x, near4.y, near4.z]);
        makePlane("bottom", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0.3), [near2.x, near2.y, near2.z, far2.x, far2.y, far2.z, far3.x, far3.y, far3.z, near3.x, near3.y, near3.z]);
    };
    StandardShadow.prototype.createGUI = function () {
        this.gui = new _StandardShadowGUI__WEBPACK_IMPORTED_MODULE_3__["default"](this.name, this.scene.getEngine(), this._container, this);
        this.gui.createGUI();
    };
    StandardShadow.prototype.initialize = function (scene, ambientColor, sunDir) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.scene.metadata = { "name": this.name };
                        this._sceneName = scene.dname;
                        this._sunDir = sunDir;
                        this._sunColor = scene.sunColor.clone();
                        this.sun = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DirectionalLight"]("sun", sunDir, this.scene);
                        this.sun.intensity = 1;
                        this.sun.shadowMinZ = scene.light.nearPlane;
                        this.sun.shadowMaxZ = scene.light.farPlane;
                        this.sun.diffuse = this._sunColor;
                        window.sun = this.sun;
                        this._skybox = _Utils__WEBPACK_IMPORTED_MODULE_1__["default"].addSkybox("Clouds.dds", this.scene, 100);
                        return [4 /*yield*/, _Utils__WEBPACK_IMPORTED_MODULE_1__["default"].loadObj(this.scene, scene.path, scene.name)];
                    case 1:
                        _a.sent();
                        this.scene.activeCamera = this.camera;
                        this.scene.meshes.forEach(function (m) {
                            if (m.name == 'skyBox' || m.name.indexOf("_shadowmap") >= 0) {
                                return;
                            }
                            if (!m.material) {
                                return;
                            }
                            var mat = m.material;
                            mat.diffuseColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1., 1., 1.);
                            mat.specularColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0., 0., 0.);
                            mat.ambientColor = ambientColor;
                            mat.ambientTexture = null;
                            mat.backFaceCulling = scene.backfaceCulling;
                            if (!mat.diffuseTexture) {
                                mat.ambientColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0);
                            }
                            //!mat.freeze();
                            m.receiveShadows = true;
                            if (scene.scaling != 1) {
                                var matrix = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Identity();
                                matrix.scaleToRef(scene.scaling, matrix);
                                matrix.setRowFromFloats(3, 0, 0, 0, 1);
                                m.bakeTransformIntoVertices(matrix);
                                m.refreshBoundingInfo();
                            }
                        });
                        this.createShadowGenerator();
                        return [2 /*return*/, this];
                }
            });
        });
    };
    StandardShadow.prototype.createGenerator = function () {
        return new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"](this.shadowMapSize, this.sun);
    };
    StandardShadow.prototype.setShadowMapViewerTexture = function () {
        this._shadowMapPlane.material.diffuseTexture = this._shadowMapFilter !== babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShadowGenerator"].FILTER_PCF ? this._shadowGenerator.getShadowMap() : null;
    };
    StandardShadow.prototype.createShadowGenerator = function () {
        var _a;
        if (this._shadowGenerator) {
            this._shadowGenerator.dispose();
            this._shadowGenerator = null;
        }
        var shadowGenerator = this.createGenerator();
        this._shadowGenerator = shadowGenerator;
        shadowGenerator.bias = this._shadowMapBias;
        shadowGenerator.normalBias = this._shadowMapNormalBias;
        shadowGenerator.darkness = this._shadowMapDarkness;
        shadowGenerator.filter = this._shadowMapFilter;
        shadowGenerator.filteringQuality = this._shadowMapQuality;
        shadowGenerator.depthScale = this._shadowMapDepthScale;
        shadowGenerator.blurScale = this._shadowMapBlurScale;
        shadowGenerator.useKernelBlur = this._shadowMapUseKernelBlur;
        shadowGenerator.blurKernel = this._shadowMapBlurKernel;
        shadowGenerator.blurBoxOffset = this._shadowMapBlurBoxOffset;
        shadowGenerator.contactHardeningLightSizeUVRatio = this._shadowMapLightSizeUVRatio;
        this.setShadowMapViewerTexture();
        window.sg = shadowGenerator;
        var renderList = (_a = shadowGenerator.getShadowMap()) === null || _a === void 0 ? void 0 : _a.renderList;
        var num = 0, lstm = [];
        this.scene.meshes.forEach(function (m) {
            if (m.name == 'skyBox') {
                return;
            }
            renderList.push(m);
        });
        lstm.forEach(function (m) {
            m.dispose();
        });
    };
    StandardShadow.prototype.render = function () {
        this._skybox.position.copyFrom(this.camera.position);
        this.scene.render();
        /*if (this._animateLight && this._autoCalcShadowZBounds) {
            this._lightNearPlane = this.sun.shadowMinZ;
            this._lightFarPlane = this.sun.shadowMaxZ;

            const event = new CustomEvent('gui_set_value', { detail: { type: 'setShadowZBounds' } });

            window.dispatchEvent(event);
        }*/
    };
    StandardShadow.className = "Standard";
    return StandardShadow;
}(_SplitBase__WEBPACK_IMPORTED_MODULE_2__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (StandardShadow);


/***/ }),

/***/ "./src/CSM2/StandardShadowGUI.tsx":
/*!****************************************!*\
  !*** ./src/CSM2/StandardShadowGUI.tsx ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./SplitBaseGUI */ "./src/CSM2/SplitBaseGUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var StandardShadowGUI = /** @class */ (function (_super) {
    __extends(StandardShadowGUI, _super);
    function StandardShadowGUI() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    StandardShadowGUI.prototype.createCustomGUIProperties = function () {
        var Properties = function () {
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
        };
        return Properties();
    };
    return StandardShadowGUI;
}(_SplitBaseGUI__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (StandardShadowGUI);


/***/ }),

/***/ "./src/CSM2/index.ts":
/*!***************************!*\
  !*** ./src/CSM2/index.ts ***!
  \***************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sample */ "./src/Sample.ts");
/* harmony import */ var _GlobalGUI__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GlobalGUI */ "./src/CSM2/GlobalGUI.tsx");
/* harmony import */ var _StandardShadow__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./StandardShadow */ "./src/CSM2/StandardShadow.ts");
/* harmony import */ var _CSM__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./CSM */ "./src/CSM2/CSM.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};





var CSMSample = /** @class */ (function (_super) {
    __extends(CSMSample, _super);
    function CSMSample(engine, canvas) {
        var _this = _super.call(this, engine, canvas) || this;
        _this._sunDir = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-1, -1, -1);
        //        this._sunDir = new Vector3(32, -30, 22);
        _this._sunDir.normalize();
        _this._ambientColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0.3, 0.3, 0.3);
        _this._clearColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color4"](0.17773, 0.41797, 0.65234, 1);
        _this.registerClass("std", _StandardShadow__WEBPACK_IMPORTED_MODULE_3__["default"]);
        _this.registerClass("csm", _CSM__WEBPACK_IMPORTED_MODULE_4__["default"]);
        _this.splitMode = _Sample__WEBPACK_IMPORTED_MODULE_1__["enumSplitMode"].LINEAR;
        _this.splitType = "csm";
        _this._gui = new _GlobalGUI__WEBPACK_IMPORTED_MODULE_2__["default"]("Global settings", _this._engine, _this);
        var ocont = jQuery('<div id="fps2"></div>').css('position', 'absolute').css('left', '2px').css('top', '2px').css('z-index', '201');
        jQuery(document.body).append(ocont);
        return _this;
    }
    CSMSample.prototype.create = function () {
        var _this = this;
        Promise.all([this.createNewSplit()]).then(function () {
            babylonjs__WEBPACK_IMPORTED_MODULE_0__["SceneLoader"].ShowLoadingScreen = false;
            _this.createGUI();
        });
    };
    CSMSample.prototype.createGUI = function () {
        this._gui.zIndex = 200;
        this._gui.createGUI();
    };
    CSMSample.prototype.createNewSplit = function () {
        return __awaiter(this, void 0, void 0, function () {
            var split, camera, gscene;
            var _this = this;
            return __generator(this, function (_a) {
                this.detachControlFromAllCameras();
                split = this.addSplit(this.splitType, this.splitClasses.get(this.splitType).className, false, false), camera = split.camera;
                gscene = this._gui.scenes[this._gui.selectedScene];
                split.group = this._gui.selectedScene;
                split.isLoading = true;
                camera.position = gscene.camera.position.clone();
                if (gscene.camera.rotation) {
                    camera.rotation.copyFrom(gscene.camera.rotation);
                }
                else {
                    camera.setTarget(gscene.camera.target.clone());
                }
                return [2 /*return*/, split.initialize(gscene, this._ambientColor, this._sunDir.clone()).then(function () {
                        split.isLoading = false;
                        split.createGUI();
                        _this.resyncCameras();
                        _this.attachControlToAllCameras();
                    })];
            });
        });
    };
    CSMSample.prototype.render = function () {
        _super.prototype.render.call(this);
        jQuery('#fps2').html(this._engine.getFps().toFixed() + " fps");
    };
    CSMSample.prototype.createSceneAndCamera = function (attachControls) {
        var _a = __read(_super.prototype.createSceneAndCamera.call(this, attachControls), 2), scene = _a[0], camera = _a[1];
        scene.ambientColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1);
        scene.clearColor = this._clearColor;
        camera.fov = Math.PI / 4 * 0.75;
        camera.minZ = 0.25;
        camera.maxZ = 250;
        return [scene, camera];
    };
    return CSMSample;
}(_Sample__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (CSMSample);
_Sample__WEBPACK_IMPORTED_MODULE_1__["default"].registerSampleClass("csm2", {
    "displayName": "Implementation of the Cascaded Shadow Maps rendering technic",
    "description": "",
    "class": CSMSample,
});


/***/ }),

/***/ "./src/DepthMinMax/index.ts":
/*!**********************************!*\
  !*** ./src/DepthMinMax/index.ts ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _SampleBasic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../SampleBasic */ "./src/SampleBasic.ts");
/* harmony import */ var _Utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Utils */ "./src/Utils.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};



var DepthMinMax = /** @class */ (function (_super) {
    __extends(DepthMinMax, _super);
    function DepthMinMax() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DepthMinMax.prototype.populateScene = function (scene, camera) {
        return __awaiter(this, void 0, void 0, function () {
            var scaling, sunDir, sun, hemil, depthRenderer, depthMap, depthReductionPhases, depthReductionInitial, w, h, index, depthReduction, func, postProcessManager, buffer, first;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        camera.position.x = 40;
                        camera.position.y = 5;
                        camera.position.z = 5;
                        camera.fov = Math.PI / 4 * 0.75;
                        camera.minZ = 0.25;
                        camera.maxZ = 250;
                        camera.setTarget(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](39, 5, 5));
                        //this._skyBox = Utils.addSkybox("Clouds.dds", scene, 100);
                        return [4 /*yield*/, _Utils__WEBPACK_IMPORTED_MODULE_2__["default"].loadObj(scene, "./resources/3d/powerplant/", "powerplant.obj")];
                    case 1:
                        //this._skyBox = Utils.addSkybox("Clouds.dds", scene, 100);
                        _a.sent();
                        scaling = 0.5;
                        scene.meshes.forEach(function (m) {
                            if (m.name == 'skyBox') {
                                return;
                            }
                            if (!m.material) {
                                return;
                            }
                            var matrix = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Matrix"].Identity();
                            matrix.scaleToRef(scaling, matrix);
                            matrix.setRowFromFloats(3, 0, 0, 0, 1);
                            m.bakeTransformIntoVertices(matrix);
                            m.refreshBoundingInfo();
                        });
                        sunDir = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](32, -30, 22);
                        sun = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DirectionalLight"]("sun", sunDir, scene);
                        sun.intensity = 1;
                        hemil = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["HemisphericLight"]("hemil", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 1, 0), scene);
                        hemil.intensity = 1;
                        depthRenderer = scene.enableDepthRenderer(camera, false);
                        depthRenderer.getDepthMap().updateSamplingMode(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Constants"].TEXTURE_NEAREST_NEAREST /*Texture.NEAREST_SAMPLINGMODE*/);
                        depthRenderer.useOnlyInActiveCamera = true;
                        depthRenderer.getDepthMap().ignoreCameraViewport = false;
                        depthMap = depthRenderer.getDepthMap();
                        //
                        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.depthReductionInitialFragmentShader = "\n            #version 300 es\n            precision highp float;\n            precision highp int;\n\n            in vec2 vUV;\n\n            uniform sampler2D textureSampler;\n            uniform sampler2D depthTexture;\n\n            //#define METHOD1\n\n            out vec2 glFragColor;\n\n            void main(void)\n            {\n            #ifdef METHOD1\n                ivec2 size = textureSize(depthTexture, 0);\n                vec2 texelSize = vec2(1.0 / float(size.x), 1.0 / float(size.y));\n\n                float f1 = texture(depthTexture, vUV).r;\n                float f2 = texture(depthTexture, vUV + vec2(texelSize.x, 0.0)).r;\n                float f3 = texture(depthTexture, vUV + vec2(texelSize.x, texelSize.y)).r;\n                float f4 = texture(depthTexture, vUV + vec2(0.0, texelSize.y)).r;\n            #else\n                vec2 size = vec2(textureSize(depthTexture, 0) - 1);\n                vec2 texcoord = vUV * size;\n                ivec2 coord = ivec2(texcoord);\n\n                float f1 = texelFetch(depthTexture, coord, 0).r;\n                float f2 = texelFetch(depthTexture, coord + ivec2(1, 0), 0).r;\n                float f3 = texelFetch(depthTexture, coord + ivec2(1, 1), 0).r;\n                float f4 = texelFetch(depthTexture, coord + ivec2(0, 1), 0).r;\n            #endif\n\n                float minz = min(min(min(f1, f2), f3), f4);\n                float maxz = max(max(max(sign(1.0 - f1) * f1, sign(1.0 - f2) * f2), sign(1.0 - f3) * f3), sign(1.0 - f4) * f4);\n\n                glFragColor = vec2(minz, maxz);\n            }\n        ";
                        //
                        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.depthReductionFragmentShader = "\n            #version 300 es\n            precision highp float;\n            precision highp int;\n\n            in vec2 vUV;\n\n            uniform sampler2D textureSampler;\n\n            //#define METHOD1\n\n            out vec2 glFragColor;\n\n            void main(void)\n            {\n            #ifdef METHOD1\n                ivec2 size = textureSize(textureSampler, 0);\n                vec2 texelSize = vec2(1.0 / float(size.x), 1.0 / float(size.y));\n\n                vec2 f1 = texture(textureSampler, vUV).rg;\n                vec2 f2 = texture(textureSampler, vUV + vec2(texelSize.x, 0.0)).rg;\n                vec2 f3 = texture(textureSampler, vUV + vec2(texelSize.x, texelSize.y)).rg;\n                vec2 f4 = texture(textureSampler, vUV + vec2(0.0, texelSize.y)).rg;\n            #else\n                vec2 size = vec2(textureSize(textureSampler, 0) - 1);\n                vec2 texcoord = vUV * size;\n                ivec2 coord = ivec2(texcoord);\n\n                vec2 f1 = texelFetch(textureSampler, coord, 0).rg;\n                vec2 f2 = texelFetch(textureSampler, coord + ivec2(1, 0), 0).rg;\n                vec2 f3 = texelFetch(textureSampler, coord + ivec2(1, 1), 0).rg;\n                vec2 f4 = texelFetch(textureSampler, coord + ivec2(0, 1), 0).rg;\n            #endif\n\n                float minz = min(min(min(f1.x, f2.x), f3.x), f4.x);\n                float maxz = max(max(max(f1.y, f2.y), f3.y), f4.y);\n\n                glFragColor = vec2(minz, maxz);\n            }\n        ";
                        //
                        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.depthReductionALastFragmentShader = "\n            #version 300 es\n            precision highp float;\n            precision highp int;\n\n            in vec2 vUV;\n\n            uniform sampler2D textureSampler;\n\n            out vec2 glFragColor;\n\n            void main(void)\n            {\n                ivec2 size = textureSize(textureSampler, 0);\n                vec2 texcoord = vUV * (vec2(size - 1));\n                ivec2 coord = ivec2(texcoord);\n\n                vec2 f1 = texelFetch(textureSampler, coord % size, 0).rg;\n                vec2 f2 = texelFetch(textureSampler, (coord + ivec2(1, 0)) % size, 0).rg;\n                vec2 f3 = texelFetch(textureSampler, (coord + ivec2(1, 1)) % size, 0).rg;\n                vec2 f4 = texelFetch(textureSampler, (coord + ivec2(0, 1)) % size, 0).rg;\n\n                float minz = min(f1.x, f2.x);\n                float maxz = max(f1.y, f2.y);\n\n                glFragColor = vec2(minz, maxz);\n            }\n        ";
                        //
                        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.depthReductionLastFragmentShader = "\n            #version 300 es\n            precision highp float;\n            precision highp int;\n\n            in vec2 vUV;\n\n            uniform sampler2D textureSampler;\n\n            out vec2 glFragColor;\n\n            void main(void)\n            {\n                vec2 f1 = texelFetch(textureSampler, ivec2(0), 0).rg;\n\n                glFragColor = f1;\n            }\n        ";
                        depthReductionPhases = [];
                        depthReductionInitial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PostProcess"]('Initial depth reduction phase', 'depthReductionInitial', // shader
                        null, ['depthTexture'], // textures
                        1.0, // options
                        null, // camera
                        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Constants"].TEXTURE_NEAREST_NEAREST, // sampling
                        this._engine, // engine
                        false, // reusable
                        undefined, // defines
                        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Constants"].TEXTURETYPE_HALF_FLOAT, undefined, undefined, undefined, babylonjs__WEBPACK_IMPORTED_MODULE_0__["Constants"].TEXTUREFORMAT_RG);
                        depthReductionInitial.autoClear = false;
                        depthReductionInitial.forceFullscreenViewport = false;
                        depthReductionInitial.onApply = function (effect) {
                            effect.setTexture('depthTexture', depthMap);
                        };
                        depthReductionPhases.push(depthReductionInitial);
                        w = depthMap.getSize().width, h = depthMap.getSize().height;
                        index = 1;
                        while (w > 1 || h > 1) {
                            w = Math.max(Math.round(w / 2), 1);
                            h = Math.max(Math.round(h / 2), 1);
                            console.log(w, h);
                            depthReduction = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PostProcess"]('Depth reduction phase ' + index, (w == 1 && h == 1) ? 'depthReductionLast' : (w == 1 || h == 1) ? 'depthReductionALast' : 'depthReduction', // shader
                            null, // attributes
                            null, { width: w, height: h }, // options
                            null, // camera
                            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Constants"].TEXTURE_NEAREST_NEAREST, // sampling
                            this._engine, // engine
                            false, // reusable
                            undefined, // defines
                            babylonjs__WEBPACK_IMPORTED_MODULE_0__["Constants"].TEXTURETYPE_HALF_FLOAT, undefined, undefined, undefined, babylonjs__WEBPACK_IMPORTED_MODULE_0__["Constants"].TEXTUREFORMAT_RG);
                            depthReduction.autoClear = false;
                            depthReduction.forceFullscreenViewport = false;
                            depthReductionPhases.push(depthReduction);
                            index++;
                            if ((w == 1 && h == 1) || (w == 2 && h == 1) /* || (w == 6 && h == 3)*/) {
                                func = function (w, h, depthReduction) {
                                    var first0 = true;
                                    var buffer0 = new Float32Array(4 * w * h);
                                    return function () {
                                        if (first0) {
                                            var texture = depthReduction.inputTexture;
                                            _this._readTexturePixels(scene.getEngine(), texture, w, h, -1, 0, buffer0);
                                            if ((buffer0[0] != 0 && buffer0[0] != 1) || buffer0[1] != 0) {
                                                first0 = false;
                                                console.log('w = ' + w + ', h = ' + h, buffer0);
                                            }
                                        }
                                    };
                                };
                                depthReduction.onAfterRenderObservable.add(func(w, h, depthReduction));
                            }
                        }
                        postProcessManager = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PostProcessManager"](scene);
                        scene.onBeforeDrawPhaseObservable.add(function () {
                            //postProcessManager._prepareFrame(depthMap.getInternalTexture(), depthReductionPhases);
                            depthReductionPhases[0].activate(camera, depthMap.getInternalTexture());
                            postProcessManager.directRender(depthReductionPhases, depthReductionPhases[0].inputTexture, false);
                            _this._engine.unBindFramebuffer(depthReductionPhases[0].inputTexture, false);
                        });
                        buffer = new Float32Array(4 * depthMap.getSize().width * depthMap.getSize().height);
                        first = true;
                        scene.onBeforeRenderObservable.add(function () {
                            if (_this._skyBox) {
                                _this._skyBox.position.copyFrom(camera.position);
                            }
                        });
                        scene.onAfterRenderObservable.add(function () {
                            if (first) {
                                _this._readTexturePixels(scene.getEngine(), depthMap._texture, depthMap.getSize().width, depthMap.getSize().height, -1, 0, buffer);
                                first = false;
                                console.log('calc min max', _this.calcMinMax(buffer));
                                console.log(buffer);
                            }
                        });
                        return [2 /*return*/, Promise.resolve(0)];
                }
            });
        });
    };
    DepthMinMax.prototype._readTexturePixels = function (engine, texture, width, height, faceIndex, level, buffer) {
        if (faceIndex === void 0) { faceIndex = -1; }
        if (level === void 0) { level = 0; }
        if (buffer === void 0) { buffer = null; }
        var gl = engine._gl;
        if (!this._dummyFramebuffer) {
            var dummy = gl.createFramebuffer();
            if (!dummy) {
                throw new Error("Unable to create dummy framebuffer");
            }
            this._dummyFramebuffer = dummy;
        }
        gl.bindFramebuffer(gl.FRAMEBUFFER, this._dummyFramebuffer);
        if (faceIndex > -1) {
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, texture._webGLTexture, level);
        }
        else {
            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture._webGLTexture, level);
        }
        var readType = (texture.type !== undefined) ? engine._getWebGLTextureType(texture.type) : gl.UNSIGNED_BYTE;
        switch (readType) {
            case gl.UNSIGNED_BYTE:
                if (!buffer) {
                    buffer = new Uint8Array(4 * width * height);
                }
                readType = gl.UNSIGNED_BYTE;
                break;
            default:
                if (!buffer) {
                    buffer = new Float32Array(4 * width * height);
                }
                readType = gl.FLOAT;
                break;
        }
        gl.readPixels(0, 0, width, height, gl.RGBA, readType, buffer);
        gl.bindFramebuffer(gl.FRAMEBUFFER, engine._currentFramebuffer);
        return buffer;
    };
    DepthMinMax.prototype.calcMinMax = function (buffer) {
        var min = 1, max = 0;
        for (var i = 0; i < buffer.length; i += 4) {
            var f = buffer[i];
            if (f < min) {
                min = f;
            }
            if (f > max && f < 1.0) {
                max = f;
            }
        }
        return [min, max];
    };
    return DepthMinMax;
}(_SampleBasic__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (DepthMinMax);
_SampleBasic__WEBPACK_IMPORTED_MODULE_1__["default"].registerSampleClass("depthminmax", {
    "displayName": "Calculate depth min and max in scene zbuffer",
    "description": "",
    "class": DepthMinMax,
});


/***/ }),

/***/ "./src/DrawEdges/index.ts":
/*!********************************!*\
  !*** ./src/DrawEdges/index.ts ***!
  \********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! babylonjs-gui */ "./node_modules/babylonjs-gui/babylon.gui.min.js");
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _SampleBasic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../SampleBasic */ "./src/SampleBasic.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (undefined && undefined.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};



var DrawEdges = /** @class */ (function (_super) {
    __extends(DrawEdges, _super);
    function DrawEdges() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DrawEdges.prototype.populateScene = function (scene, camera) {
        camera.position.x = 0;
        camera.position.y = 5;
        camera.position.z = -10;
        camera.setTarget(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero());
        scene.clearColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color4"](0.54, 0.74, 1., 1);
        var light = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["HemisphericLight"]("light1", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 1, 0), scene);
        light.intensity = 0.7;
        var pl = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PointLight"]("pl", babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero(), scene);
        pl.diffuse = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1);
        pl.specular = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1);
        pl.intensity = 0.8;
        // GUI
        var advancedTexture = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["AdvancedDynamicTexture"].CreateFullscreenUI("ui1");
        var createLabel = function (mesh) {
            var label = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Rectangle"]("label for " + mesh.name);
            label.height = "30px";
            label.alpha = 0.5;
            label.width = "100px";
            label.linkOffsetY = 30;
            advancedTexture.addControl(label);
            label.linkWithMesh(mesh);
            var text1 = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["TextBlock"]();
            text1.text = mesh.name;
            text1.color = "black";
            label.addControl(text1);
            return label;
        };
        var whiteMaterials = true;
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["customVertexShader"] = "\n            precision highp float;\n            // Attributes\n            attribute vec3 position;\n            // Uniforms\n            uniform mat4 worldViewProjection;\n            uniform mat4 world;\n            // Varying\n            varying vec4 wpos;\n            void main(void) {\n                vec4 q = vec4(position, 1.0);\n                wpos = world * q;\n                gl_Position = worldViewProjection * q;\n            }";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["customFragmentShader"] = "\n            precision highp float;\n            uniform vec3 lineColor;\n            varying vec4 wpos;\n            void main(void) {\n                vec4 col = vec4(lineColor, 1.);\n                float sum = wpos.x + wpos.y + wpos.z;\n                if (mod(sum, .33) < 0.12) discard;\n                gl_FragColor = vec4(col.xyz, 0.3);\n            }";
        // define material
        var lineMaterial1 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("lineMaterial_1", scene);
        lineMaterial1.emissiveColor = whiteMaterials ? new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0) : new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1);
        lineMaterial1.disableLighting = true;
        var lineMaterial1_hidden = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShaderMaterial"]("shader", scene, {
            vertex: "custom",
            fragment: "custom",
        }, {
            attributes: ["position"],
            uniforms: ["world", "worldViewProjection", "lineColor"],
            needAlphaBlending: true
        });
        lineMaterial1_hidden.setColor3("lineColor", lineMaterial1.emissiveColor);
        lineMaterial1_hidden.depthFunction = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Engine"].ALWAYS;
        var lineMaterial2 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("lineMaterial_2", scene);
        lineMaterial2.diffuseColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 0, 0);
        var materialX = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("materialX", scene);
        materialX.diffuseColor = whiteMaterials ? new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1) : new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 1);
        if (whiteMaterials) {
            materialX.emissiveColor = materialX.diffuseColor;
            materialX.disableLighting = true;
        }
        // materialX.alpha = 0.2;
        var materialZ = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("materialZ", scene);
        materialZ.diffuseColor = whiteMaterials ? new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1) : new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 1, 0);
        if (whiteMaterials) {
            materialZ.emissiveColor = materialZ.diffuseColor;
            materialZ.disableLighting = true;
        }
        // materialZ.alpha = 0.2;
        var materialY = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("materialY", scene);
        materialY.diffuseColor = whiteMaterials ? new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 1, 1) : new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 0, 0);
        if (whiteMaterials) {
            materialY.emissiveColor = materialY.diffuseColor;
            materialY.disableLighting = true;
        }
        // materialY.alpha = 0.2;
        // create a line
        var createLine = function (id, position, length, direction, radius, mat) {
            if (!radius) {
                radius = 0.005;
            }
            if (!mat) {
                mat = lineMaterial1;
            }
            var points = direction === 'y'
                ? [new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, -length / 2, 0), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, length / 2, 0)]
                : direction === 'x'
                    ? [new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-length / 2, 0, 0), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](length / 2, 0, 0)]
                    : [new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, -length / 2), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, length / 2)];
            var shape = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateTube(id, { path: points, radius: radius, sideOrientation: babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"].DOUBLESIDE }, scene);
            shape.position = position;
            shape.material = mat;
            shape.renderingGroupId = 0;
            return shape;
        };
        // distance from center of the shape to camera
        var distance = function (mesh) {
            var camPos = camera.position;
            var meshPos = mesh.position;
            var pow = Math.pow(meshPos.x - camPos.x, 2) + Math.pow(meshPos.y - camPos.y, 2) + Math.pow(meshPos.z - camPos.z, 2);
            return Math.sqrt(pow);
        };
        var planes = {};
        var counter = 0;
        var markers = {};
        // points should be in counter clockwise order
        var CreatePlanes = function (points, y) {
            planes["horizontal" + counter] = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"]
                .CreatePolygon("horizontal" + counter, { shape: points, sideOrientation: babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"].DOUBLESIDE }, scene);
            planes["horizontal" + counter].position.y = y;
            planes["horizontal" + counter].material = materialY;
            counter++;
        };
        var CreateMarkers = function (points) {
            points.forEach(function (p, i) {
                markers["marker_" + i] = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"].CreateSphere("marker_" + i, 32, 0.2, scene);
                markers["marker_" + i].position = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.x, p.y, p.z);
                markers["marker_" + i].material = lineMaterial2;
            });
        };
        var a = 1.5;
        var lineLength = 3;
        var b = lineLength / 2;
        var data = [
            // top
            { points: [0, a, b], length: lineLength, direction: 'x' },
            { points: [-b, a, 0], length: lineLength, direction: 'z' },
            { points: [0, a, -b], length: lineLength, direction: 'x' },
            { points: [b, a, -b + lineLength / 6], length: lineLength / 3, direction: 'z' },
            { points: [lineLength / 3, a, -b + (lineLength / 3)], length: lineLength / 3, direction: 'x' },
            { points: [b - lineLength / 3, a, 0], length: lineLength / 3, direction: 'z' },
            { points: [lineLength / 3, a, b - lineLength / 3], length: lineLength / 3, direction: 'x' },
            { points: [b, a, b - lineLength / 6], length: lineLength / 3, direction: 'z' },
            // bottom
            { points: [0, -a, b], length: lineLength, direction: 'x' },
            { points: [-b, -a, 0], length: lineLength, direction: 'z' },
            { points: [0, -a, -b], length: lineLength, direction: 'x' },
            { points: [b, -a, -b + lineLength / 6], length: lineLength / 3, direction: 'z' },
            { points: [lineLength / 3, -a, -b + (lineLength / 3)], length: lineLength / 3, direction: 'x' },
            { points: [b - lineLength / 3, -a, 0], length: lineLength / 3, direction: 'z' },
            { points: [lineLength / 3, -a, b - lineLength / 3], length: lineLength / 3, direction: 'x' },
            { points: [b, -a, b - lineLength / 6], length: lineLength / 3, direction: 'z' },
            // pillars
            { points: [b, 0, b], length: lineLength, direction: 'y' },
            { points: [-b, 0, b], length: lineLength, direction: 'y' },
            { points: [-b, 0, -b], length: lineLength, direction: 'y' },
            { points: [b, 0, -b], length: lineLength, direction: 'y' },
            { points: [b, 0, -b + lineLength / 3], length: lineLength, direction: 'y' },
            { points: [b - lineLength / 3, 0, -b + lineLength / 3], length: lineLength, direction: 'y' },
            { points: [b - lineLength / 3, 0, b - lineLength / 3], length: lineLength, direction: 'y' },
            { points: [b, 0, b - lineLength / 3], length: lineLength, direction: 'y' }
        ];
        var genHorizontalFaces = function () {
            // unique y values
            var uniqueValues = __spread(new Set(data.map(function (x) { return x.points[1]; })));
            uniqueValues.forEach(function (plane) {
                var f = data.filter(function (d) { return d.points[1] === plane; });
                var face = [];
                f.forEach(function (p) {
                    if (p.direction === 'z') {
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0], p.points[1], p.points[2] + p.length / 2));
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0], p.points[1], p.points[2] - p.length / 2));
                    }
                    if (p.direction === 'x') {
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0] + p.length / 2, p.points[1], p.points[2]));
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0] - p.length / 2, p.points[1], p.points[2]));
                    }
                });
                // remove duplicates
                var dedup = face.filter(function (v, i, a) { return a.findIndex(function (t) { return (t.x === v.x && t.y === v.y && t.z === v.z); }) === i; });
                if (dedup.length) {
                    //CreateMarkers(dedup);
                    CreatePlanes(dedup, plane);
                }
            });
        };
        var genVerticalFacesX = function () {
            // unique y values
            var uniqueValues = __spread(new Set(data.map(function (x) { return x.points[2]; })));
            uniqueValues.forEach(function (plane) {
                var f1 = data.filter(function (d) { return d.points[2] === plane && d.direction === 'x'; });
                if (f1.length) {
                    var unique = __spread(new Set(f1.map(function (x) { return x.points[2]; })));
                    unique.forEach(function (x) {
                        var f = f1.filter(function (d) { return d.points[2] === x; });
                        var height = f[0].points[1] - f[1].points[1];
                        var yStart = Math.min(f[0].points[1], f[1].points[1]);
                        planes["verticalX" + counter] = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"]
                            .CreateBox("verticalX" + counter, { height: height, width: f[0].length, depth: 0.001 }, scene);
                        planes["verticalX" + counter].position = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](f[0].points[0], 0, f[0].points[2]);
                        planes["verticalX" + counter].material = materialX;
                        counter++;
                    });
                }
            });
        };
        var genVerticalFacesZ = function () {
            // unique y values
            var uniqueValues = __spread(new Set(data.map(function (x) { return x.points[2]; })));
            uniqueValues.forEach(function (plane) {
                var f1 = data.filter(function (d) { return d.points[2] === plane && d.direction === 'z'; });
                if (f1.length) {
                    var unique = __spread(new Set(f1.map(function (x) { return x.points[0]; })));
                    unique.forEach(function (z) {
                        var f = f1.filter(function (d) { return d.points[0] === z; });
                        var height = f[0].points[1] - f[1].points[1];
                        var yStart = Math.min(f[0].points[1], f[1].points[1]);
                        planes["verticalZ" + counter] = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"]
                            .CreateBox("verticalZ" + counter, { height: height, depth: f[0].length, width: 0.001 }, scene);
                        planes["verticalZ" + counter].position = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](f[0].points[0], 0, f[0].points[2]);
                        planes["verticalZ" + counter].material = materialZ;
                        counter++;
                    });
                }
            });
        };
        var genMarkers = function () {
            // unique y values
            var uniqueValues = __spread(new Set(data.map(function (x) { return x.points[1]; })));
            uniqueValues.forEach(function (plane) {
                var f = data.filter(function (d) { return d.points[1] === plane; });
                var face = [];
                f.forEach(function (p) {
                    if (p.direction === 'z') {
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0], p.points[1], p.points[2] + p.length / 2));
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0], p.points[1], p.points[2] - p.length / 2));
                    }
                    if (p.direction === 'x') {
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0] + p.length / 2, p.points[1], p.points[2]));
                        face.push(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p.points[0] - p.length / 2, p.points[1], p.points[2]));
                    }
                });
                // remove duplicates
                var dedup = face.filter(function (v, i, a) { return a.findIndex(function (t) { return (t.x === v.x && t.y === v.y && t.z === v.z); }) === i; });
                if (dedup.length) {
                    CreateMarkers(dedup);
                }
            });
        };
        // comment these 3 functions to hide planes
        genHorizontalFaces();
        genVerticalFacesX();
        genVerticalFacesZ();
        var lines = {};
        data.forEach(function (d, i) {
            var p = d.points;
            lines["line_" + i] = createLine("line_" + i, new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p[0], p[1], p[2]), d.length, d.direction, 0.03);
        });
        data.forEach(function (d, i) {
            var p = d.points;
            var meshl = createLine("line2_" + i, new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](p[0], p[1], p[2]), d.length, d.direction, 0.005, lineMaterial1_hidden);
        });
        genMarkers();
        function showWorldAxis(size) {
            var makeTextPlane = function (text, color, size) {
                var dynamicTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["DynamicTexture"]("DynamicTexture", 50, scene, true);
                dynamicTexture.hasAlpha = true;
                dynamicTexture.drawText(text, 5, 40, "bold 36px Arial", color, "transparent", true);
                var plane = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"].CreatePlane("TextPlane", size, scene, true);
                plane.material = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("TextPlaneMaterial", scene);
                plane.material.backFaceCulling = false;
                plane.material.specularColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0);
                plane.material.diffuseTexture = dynamicTexture;
                return plane;
            };
            var axisX = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"].CreateLines("axisX", [
                babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero(), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](size, 0, 0), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](size * 0.95, 0.05 * size, 0),
                new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](size, 0, 0), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](size * 0.95, -0.05 * size, 0)
            ], scene);
            axisX.color = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](1, 0, 0);
            var xChar = makeTextPlane("X", "red", size / 10);
            xChar.position = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0.9 * size, -0.05 * size, 0);
            var axisY = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"].CreateLines("axisY", [
                babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero(), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, size, 0), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](-0.05 * size, size * 0.95, 0),
                new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, size, 0), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0.05 * size, size * 0.95, 0)
            ], scene);
            axisY.color = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 1, 0);
            var yChar = makeTextPlane("Y", "green", size / 10);
            yChar.position = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0.9 * size, -0.05 * size);
            var axisZ = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Mesh"].CreateLines("axisZ", [
                babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero(), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, size), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, -0.05 * size, size * 0.95),
                new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0, size), new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0.05 * size, size * 0.95)
            ], scene);
            axisZ.color = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 1);
            var zChar = makeTextPlane("Z", "blue", size / 10);
            zChar.position = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0.05 * size, 0.9 * size);
        }
        showWorldAxis(1);
    };
    return DrawEdges;
}(_SampleBasic__WEBPACK_IMPORTED_MODULE_2__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (DrawEdges);
_SampleBasic__WEBPACK_IMPORTED_MODULE_2__["default"].registerSampleClass("drawedges", {
    "displayName": "Create a Render Target Texture and use it in a post process pass",
    "description": "",
    "class": DrawEdges,
});


/***/ }),

/***/ "./src/GUI.tsx":
/*!*********************!*\
  !*** ./src/GUI.tsx ***!
  \*********************/
/*! exports provided: enumDefaultPosition, PrettoSlider, default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "enumDefaultPosition", function() { return enumDefaultPosition; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "PrettoSlider", function() { return PrettoSlider; });
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react-dom */ "react-dom");
/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react_dom__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @material-ui/core */ "@material-ui/core");
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_material_ui_core__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _material_ui_core_colors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @material-ui/core/colors */ "@material-ui/core/colors");
/* harmony import */ var _material_ui_core_colors__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_material_ui_core_colors__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var react_draggable__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! react-draggable */ "./node_modules/react-draggable/build/web/react-draggable.min.js");
/* harmony import */ var react_draggable__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(react_draggable__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var re_resizable__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! re-resizable */ "./node_modules/re-resizable/lib/index.js");
/* harmony import */ var re_resizable__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(re_resizable__WEBPACK_IMPORTED_MODULE_5__);
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};







var enumDefaultPosition;
(function (enumDefaultPosition) {
    enumDefaultPosition[enumDefaultPosition["TOP_LEFT"] = 0] = "TOP_LEFT";
    enumDefaultPosition[enumDefaultPosition["TOP_RIGHT"] = 1] = "TOP_RIGHT";
})(enumDefaultPosition || (enumDefaultPosition = {}));
var PrettoSlider = Object(_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["withStyles"])({
    root: {
        color: '#52af77',
        height: 8,
        width: '90%',
        padding: 0,
    },
    thumb: {
        height: 16,
        width: 16,
        backgroundColor: '#fff',
        border: '2px solid currentColor',
        marginTop: -6,
        marginLeft: -2,
        '&:focus,&:hover,&$active': {
            boxShadow: 'inherit',
        },
        '&.Mui-disabled': {
            width: 12,
            height: 12,
            marginTop: -4,
        },
    },
    active: {},
    valueLabel: {
        left: 'calc(-50% - 4px)',
    },
    track: {
        height: 6,
        borderRadius: 4,
    },
    rail: {
        height: 6,
        borderRadius: 4,
    },
})(_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["Slider"]);
var GUI = /** @class */ (function () {
    function GUI(name, engine) {
        this._name = name;
        this._engine = engine;
        this._showCloseButton = true;
        this.dimensions = {
            x: 0,
            y: 0,
            width: 300,
            height: 400,
            minWidth: 100,
            minHeight: 50,
        };
        this._guiElemCont = null;
        this._defaultPos = enumDefaultPosition.TOP_RIGHT;
        this.zIndex = 20;
        this._useStyles = Object(_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["makeStyles"])(function (theme) { return ({
            propertyTitle: {
                padding: '4px 0px 4px 8px',
                textAlign: 'left',
                color: 'white',
                whiteSpace: 'nowrap',
                marginBottom: theme.spacing(0),
                textShadow: '1px 1px black',
            },
            propertyValue: {
                padding: '4px 4px 4px 4px',
                textAlign: 'left',
                color: '#00ff00',
                whiteSpace: 'nowrap',
                marginBottom: theme.spacing(0),
                backgroundColor: '#1565c060',
                textShadow: 'none',
            },
            subPropertyTitle: {
                padding: '4px 2px 4px 4px',
                marginLeft: "-12px",
                textAlign: 'left',
                color: 'white',
                whiteSpace: 'nowrap',
                marginBottom: theme.spacing(0),
                textShadow: '1px 1px black',
            },
        }); });
    }
    Object.defineProperty(GUI.prototype, "showCloseButton", {
        get: function () {
            return this._showCloseButton;
        },
        set: function (s) {
            this._showCloseButton = s;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(GUI.prototype, "defaultPosition", {
        get: function () {
            return this._defaultPos;
        },
        set: function (d) {
            this._defaultPos = d;
        },
        enumerable: true,
        configurable: true
    });
    GUI.prototype.createGUITheme = function () {
        var _a;
        var theme = Object(_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["createMuiTheme"])({});
        theme = __assign(__assign({}, theme), { overrides: {
                MuiButton: {},
                MuiContainer: {
                    fixed: {
                        padding: '0',
                        backgroundColor: '#e0e0e080',
                        border: '1px solid white',
                        color: 'white',
                        height: '100%',
                        overflowX: 'hidden',
                        overflowY: 'auto',
                    },
                    maxWidthLg: (_a = {},
                        _a[theme.breakpoints.up("lg")] = {
                            maxWidth: 'inherit'
                        },
                        _a)
                },
                MuiExpansionPanel: {
                    root: {
                        '&$expanded': {
                            margin: '0',
                        }
                    },
                },
                MuiExpansionPanelSummary: {
                    root: {
                        padding: '0 6px 0 4px',
                        color: _material_ui_core_colors__WEBPACK_IMPORTED_MODULE_3__["yellow"][300],
                        backgroundColor: '#40C0FF60',
                        minHeight: 'inherit',
                        textShadow: '1px 1px black',
                        '&$expanded': {
                            minHeight: 'inherit',
                        }
                    },
                    expandIcon: {
                        padding: '2px 8px 2px 0px',
                        '&$expanded': {
                            padding: '2px 0 2px 8px',
                        }
                    },
                    content: {
                        margin: 'inherit',
                        '&$expanded': {
                            margin: 'inherit',
                        }
                    },
                },
                MuiFilledInput: {
                    input: {
                        padding: "0",
                    },
                    underline: {
                        '&:before': {
                            borderBottom: '0px solid black',
                        },
                    },
                },
                MuiFormControl: {
                    root: {
                        width: "100%",
                    },
                },
                MuiGrid: {
                    "spacing-xs-1": {
                        "& > .MuiGrid-item": {
                            padding: "1px",
                        },
                    },
                },
                MuiIcon: {
                    root: {
                        'color': 'white',
                    }
                },
                MuiInput: {
                    underline: {
                        "&:before": {
                            borderBottom: "0px solid black",
                        },
                    },
                },
                MuiInputBase: {
                    input: {
                        padding: '0',
                        color: '#00ff00',
                    },
                },
                MuiListItem: {
                    root: {
                        textAlign: 'center',
                        paddingTop: '0',
                    },
                },
                MuiMenu: {
                    paper: {
                        backgroundColor: "white",
                    },
                },
                MuiPaper: {
                    root: {
                        backgroundColor: 'transparent',
                    },
                },
                MuiSelect: {
                    icon: {
                        color: "white",
                    },
                },
                MuiSwitch: {
                    colorSecondary: {
                        "&$checked": {
                            color: "#69f0ae",
                            "& + .MuiSwitch-track": {
                                backgroundColor: "#69f0ae",
                            },
                        },
                    },
                    root: {
                        width: "48px",
                        height: "20px",
                        padding: "0",
                    },
                    switchBase: {
                        paddingTop: "4px",
                        height: "12px",
                    },
                    thumb: {
                        width: '14px',
                        height: '14px',
                    },
                },
            }, props: {} });
        return theme;
    };
    GUI.prototype.canClose = function () {
        return true;
    };
    GUI.prototype.closed = function () {
    };
    GUI.prototype.getBounds = function () {
        return {
            x: 0,
            y: 0,
            w: this._engine.getRenderWidth(),
            h: this._engine.getRenderHeight() - 20
        };
    };
    GUI.prototype.handleEvent = function (event) {
        return true;
    };
    GUI.prototype.createGUI = function () {
        var _this = this;
        var theme = this.createGUITheme();
        var GUI = function () {
            var _a = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](!_this.canClose()), 2), disableCloseButton = _a[0], setDisableCloseButton = _a[1];
            var _b = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"]({ left: 0, top: 0, right: _this._engine.getRenderWidth() - _this.dimensions.width, bottom: _this._engine.getRenderHeight() - 20 }), 2), bounds = _b[0], setBounds = _b[1];
            var _c = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](function () {
                var pos = { x: 2, y: 2 };
                if (_this.defaultPosition == enumDefaultPosition.TOP_RIGHT) {
                    pos.x = Math.max(bounds.right - 2, bounds.left);
                }
                return pos;
            }), 2), position = _c[0], setPosition = _c[1];
            var _d = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"]({ maxWidth: _this._engine.getRenderWidth(), maxHeight: _this._engine.getRenderHeight() }), 2), maxSizes = _d[0], setMaxSizes = _d[1];
            var _e = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"]({ width: _this.dimensions.width, height: _this.dimensions.height }), 2), size = _e[0], setSize = _e[1];
            var onStopDrag = function (e, data) {
                _this.dimensions.x = data.x;
                _this.dimensions.y = data.y;
                setPosition({ x: _this.dimensions.x, y: _this.dimensions.y });
                updateMaxSizes();
            };
            var updateBounds = function (setGUIPosition) {
                if (setGUIPosition === void 0) { setGUIPosition = true; }
                var sbounds = _this.getBounds();
                setBounds({
                    left: sbounds.x,
                    top: sbounds.y,
                    right: sbounds.x + sbounds.w - _this.dimensions.width,
                    bottom: sbounds.y + sbounds.h - 20
                });
                if (setGUIPosition) {
                    _this.dimensions.x = _this.defaultPosition == enumDefaultPosition.TOP_RIGHT ? Math.max(sbounds.x + sbounds.w - _this.dimensions.width - 2, 0) : 2;
                    _this.dimensions.y = 2;
                    setPosition({ x: _this.dimensions.x, y: _this.dimensions.y });
                }
            };
            var updateMaxSizes = function () {
                var sbounds = _this.getBounds();
                setMaxSizes({
                    maxWidth: Math.max(sbounds.x + sbounds.w - _this.dimensions.x, 0),
                    maxHeight: Math.max(sbounds.y + sbounds.h - _this.dimensions.y, 0)
                });
            };
            var onStopResize = function (event, direction, refToElement, delta) {
                _this.dimensions.width += delta.width;
                _this.dimensions.height += delta.height;
                setSize({ width: _this.dimensions.width, height: _this.dimensions.height });
                updateMaxSizes();
                updateBounds(false);
            };
            var onResizeWindow = function (event) {
                var updatePosition = _this.handleEvent(event);
                updateMaxSizes();
                updateBounds(updatePosition);
            };
            react__WEBPACK_IMPORTED_MODULE_0__["useEffect"](function () {
                var handler = function (event) {
                    var updatePosition = _this.handleEvent(event);
                    setDisableCloseButton(!_this.canClose());
                    updateBounds(updatePosition);
                    updateMaxSizes();
                };
                window.addEventListener('split_added', handler);
                window.addEventListener('split_removed', handler);
                window.addEventListener('resize', onResizeWindow);
                return function () {
                    window.removeEventListener('split_added', handler);
                    window.removeEventListener('split_removed', handler);
                    window.removeEventListener('resize', onResizeWindow);
                };
            }, []);
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["ThemeProvider"], { theme: theme },
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react_draggable__WEBPACK_IMPORTED_MODULE_4___default.a, { position: position, handle: ".gui_title", bounds: bounds, onStop: onStopDrag },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](re_resizable__WEBPACK_IMPORTED_MODULE_5__["Resizable"], { size: size, minWidth: _this.dimensions.minWidth, minHeight: _this.dimensions.minHeight, maxWidth: maxSizes.maxWidth, maxHeight: maxSizes.maxHeight, onResizeStop: onStopResize, enable: { top: false, right: true, bottom: true, left: false, topRight: false, bottomRight: true, bottomLeft: false, topLeft: false }, style: { zIndex: _this.zIndex } },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["Container"], { fixed: true },
                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["List"], { className: "gui_title", disablePadding: true },
                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["ListItem"], null,
                                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["ListItemText"], { primary: _this._name }),
                                    _this._showCloseButton &&
                                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["ListItemSecondaryAction"], null,
                                            react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["IconButton"], { edge: "end", style: { marginTop: '-12px', marginRight: '-20px' }, onClick: _this.closed.bind(_this), disabled: disableCloseButton },
                                                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_2__["Icon"], null, "cancel_presentation"))))),
                            _this.createCustomGUI())))));
        };
        this._guiElemCont = document.createElement("div");
        jQuery(this._guiElemCont).css('position', 'absolute').css('user-select', 'none').css('top', '0').css('left', '0').css('z-index', this.zIndex);
        document.body.append(this._guiElemCont);
        react_dom__WEBPACK_IMPORTED_MODULE_1__["render"](react__WEBPACK_IMPORTED_MODULE_0__["createElement"](GUI, null), this._guiElemCont);
    };
    GUI.prototype.createCustomGUI = function () {
        return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
    };
    GUI.prototype.showGUI = function (show) {
        jQuery(this._guiElemCont).css('display', show ? 'block' : 'none');
    };
    GUI.prototype.toggleGUI = function () {
        jQuery(this._guiElemCont).css('display', jQuery(this._guiElemCont).css('display') === 'none' ? 'block' : 'none');
    };
    GUI.prototype.removeGUI = function () {
        react_dom__WEBPACK_IMPORTED_MODULE_1__["unmountComponentAtNode"](this._guiElemCont);
        this._guiElemCont = null;
    };
    return GUI;
}());
/* harmony default export */ __webpack_exports__["default"] = (GUI);


/***/ }),

/***/ "./src/Main.ts":
/*!*********************!*\
  !*** ./src/Main.ts ***!
  \*********************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "jquery");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _allSamples__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./allSamples */ "./src/allSamples.ts");
/* harmony import */ var _Browser__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Browser */ "./src/Browser.ts");
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Sample */ "./src/Sample.ts");





var showDebugLayer = false;
glMatrix.glMatrix.setMatrixArrayType(Array);
var qs = _Browser__WEBPACK_IMPORTED_MODULE_3__["default"].QueryString;
var canvas = document.getElementById('renderCanvas'), engine = new babylonjs__WEBPACK_IMPORTED_MODULE_1__["Engine"](canvas, true, { premultipliedAlpha: false, stencil: true, disableWebGL2Support: false, preserveDrawingBuffer: true, antialias: false });
function setContainerDimensions() {
    engine.resize();
}
jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).on('resize', setContainerDimensions);
jquery__WEBPACK_IMPORTED_MODULE_0___default()(window).on('load', setContainerDimensions);
var sampleName = _Sample__WEBPACK_IMPORTED_MODULE_4__["default"].sampleList.keys().next().value;
if (qs['sample']) {
    sampleName = qs['sample'];
}
var sample = _Sample__WEBPACK_IMPORTED_MODULE_4__["default"].createSample(sampleName, engine, canvas);
if (sample === null) {
    alert("Unknown sample \"" + sampleName + "\" !");
}
else {
    var divFps_1 = document.getElementById("fps");
    /*if (showDebugLayer) {
        scene.debugLayer.show({ embedMode: false, handleResize: false, overlay: true, showExplorer: true, showInspector: true });
    }*/
    engine.runRenderLoop(function () {
        sample.onBeforeRender(engine.getDeltaTime() / 1000.0);
        sample.render();
        if (divFps_1) {
            divFps_1.innerHTML = engine.getFps().toFixed(2) + " fps";
        }
    });
}


/***/ }),

/***/ "./src/MainGUI.tsx":
/*!*************************!*\
  !*** ./src/MainGUI.tsx ***!
  \*************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "react");
/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @material-ui/core */ "@material-ui/core");
/* harmony import */ var _material_ui_core__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_material_ui_core__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _GUI__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GUI */ "./src/GUI.tsx");
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Sample */ "./src/Sample.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};





var MainGUI = /** @class */ (function (_super) {
    __extends(MainGUI, _super);
    function MainGUI(name, engine, parent) {
        var _this = _super.call(this, name, engine) || this;
        _this._parent = parent;
        _this.dimensions.width = 250;
        _this.dimensions.height = 214;
        _this.showCloseButton = false;
        _this.defaultPosition = _GUI__WEBPACK_IMPORTED_MODULE_2__["enumDefaultPosition"].TOP_LEFT;
        return _this;
    }
    MainGUI.prototype.handleEvent = function (event) {
        return false;
    };
    MainGUI.prototype.createCustomGUI = function () {
        var _this = this;
        var GridQwerty = Object(_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["withStyles"])({
            root: {
                maxWidth: 60,
            },
        })(_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"]);
        var Properties = function () {
            var classes = _this._useStyles();
            var _a = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._parent.splitMode), 2), splitLayout = _a[0], setSplitLayout = _a[1];
            var _b = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._parent.splitType), 2), splitType = _b[0], setSplitType = _b[1];
            var _c = __read(react__WEBPACK_IMPORTED_MODULE_0__["useState"](_this._parent.qwertyMode), 2), qwertyMode = _c[0], setQwertyMode = _c[1];
            var changeSplitLayout = function (event, child) {
                _this._parent.splitMode = event.target.value;
                setSplitLayout(_this._parent.splitMode);
            };
            var changeSplitType = function (event, child) {
                _this._parent.splitType = event.target.value;
                setSplitType(_this._parent.splitType);
            };
            var changeQwertyMode = function (event, checked) {
                setQwertyMode(checked);
                _this._parent.qwertyMode = checked;
            };
            react__WEBPACK_IMPORTED_MODULE_0__["useEffect"](function () {
                var handler = function (event) {
                    switch (event.detail.type) {
                        case 'setSplitLayout': {
                            setSplitLayout(_this._parent.splitMode);
                            break;
                        }
                    }
                };
                window.addEventListener('gui_set_value', handler);
                return function () {
                    window.removeEventListener('gui_set_value', handler);
                };
            }, []);
            return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { container: true, spacing: 1 },
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyTitle }, "QWERTY mode")),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](GridQwerty, { item: true, xs: 6, className: classes.propertyValue },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyValue },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Switch"], { checked: qwertyMode, onChange: changeQwertyMode }))),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyTitle }, "Split layout")),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, id: "splitlayout", value: splitLayout, onChange: changeSplitLayout },
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: _Sample__WEBPACK_IMPORTED_MODULE_3__["enumSplitMode"].SIDE_BY_SIDE }, "Side by side"),
                        react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { value: _Sample__WEBPACK_IMPORTED_MODULE_3__["enumSplitMode"].LINEAR }, "Linear"))),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Paper"], { className: classes.propertyTitle }, "Split type")),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 6 },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Select"], { className: classes.propertyValue, id: "splittype", value: splitType, onChange: changeSplitType }, Array.from(_this._parent.splitClasses.keys()).map(function (name) {
                        var stype = _this._parent.splitClasses.get(name);
                        return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["MenuItem"], { key: name, value: name }, stype.className));
                    }))),
                _this.createCustomGUIProperties(),
                react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Grid"], { item: true, xs: 12, style: { textAlign: 'center', marginTop: '8px' } },
                    react__WEBPACK_IMPORTED_MODULE_0__["createElement"](_material_ui_core__WEBPACK_IMPORTED_MODULE_1__["Button"], { variant: "contained", color: "primary", onClick: _this._parent.createNewSplit.bind(_this._parent) }, "Create Split"))));
        };
        return Properties();
    };
    MainGUI.prototype.createCustomGUIProperties = function () {
        return (react__WEBPACK_IMPORTED_MODULE_0__["createElement"](react__WEBPACK_IMPORTED_MODULE_0__["Fragment"], null));
    };
    return MainGUI;
}(_GUI__WEBPACK_IMPORTED_MODULE_2__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (MainGUI);


/***/ }),

/***/ "./src/RTTAndPostProcess/index.ts":
/*!****************************************!*\
  !*** ./src/RTTAndPostProcess/index.ts ***!
  \****************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _SampleBasic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../SampleBasic */ "./src/SampleBasic.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};
var __spread = (undefined && undefined.__spread) || function () {
    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));
    return ar;
};


var RTTAndPostProcess = /** @class */ (function (_super) {
    __extends(RTTAndPostProcess, _super);
    function RTTAndPostProcess() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RTTAndPostProcess.prototype.populateScene = function (scene, camera) {
        camera.position.x = 0;
        camera.position.y = 5;
        camera.position.z = -10;
        camera.setTarget(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero());
        // This creates a light, aiming 0,1,0 - to the sky (non-mesh)
        var light = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["HemisphericLight"]("light", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 1, 0), scene);
        // Default intensity is 1. Let's dim the light a small amount
        light.intensity = 0.7;
        // some material for the sphere.
        var grass0 = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("grass0", scene);
        grass0.diffuseTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/grass.png", scene);
        // Our built-in 'ground' shape.
        var ground = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateGround("ground", { width: 6, height: 6 }, scene);
        ground.material = grass0;
        // a depth pass.
        var depthPass = scene.enableDepthRenderer();
        // first pass, render scene with original materials
        var imagePass = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PassPostProcess"]("imagePass", 1.0, null, babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"].NEAREST_SAMPLINGMODE, this._engine);
        // second pass with a shader material
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.magicVertexShader = "\n            precision highp float;\n\n            attribute vec3 position;\n            attribute vec2 uv;\n\n    #ifdef INSTANCES\n        attribute vec4 world0;\n        attribute vec4 world1;\n        attribute vec4 world2;\n        attribute vec4 world3;\n    #else\n        uniform mat4 world;\n    #endif\n            uniform mat4 view;\n            uniform mat4 projection;\n            uniform mat4 worldViewProjection;\n\n            varying vec2 vUV;\n\n            #include<bonesDeclaration>\n\n            void main() {\n    #ifdef INSTANCES\n        mat4 finalWorld = mat4(world0, world1, world2, world3);\n    #else\n        mat4 finalWorld = world;\n    #endif\n\n                vec3 positionUpdated = position;\n\n                #include<bonesVertex>\n\n                vec4 worldPos = finalWorld * vec4(positionUpdated, 1.0);\n\n                vUV = uv;\n\n                gl_Position = projection * view * worldPos;\n            }";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.magicFragmentShader = "\n            #ifdef GL_ES\n            precision mediump float;\n            #endif\n\n            varying vec2 vUV;\n\n            void main(void)\n            {\n                // basic, just returns a plain color\n                gl_FragColor = vec4(1.0, 1.0, 0.1, 1.0);\n            }\n        ";
        var shaderMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShaderMaterial"]('magic shader material', // human name
        scene, 'magic', // shader path
        {
            attributes: ['position', 'normal', 'uv'],
            uniforms: ['world', 'worldView', 'worldViewProjection', 'view', 'projection', 'time', 'direction']
        });
        shaderMaterial.freeze();
        var shaderMaterialForRobot = shaderMaterial.clone("cloned");
        shaderMaterialForRobot.freeze();
        var renderTarget = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["RenderTargetTexture"]('magic texture', 512, scene);
        scene.customRenderTargets.push(renderTarget);
        renderTarget.onBeforeRender = function (e) {
            var _loop_1 = function (i) {
                var _a;
                var mesh = renderTarget.renderList[i];
                mesh.metadata = mesh.metadata || {};
                if (mesh.material && !mesh.material.isFrozen && mesh.isReady(true)) { // the PBR material takes some time to be loaded, it's possible that in the first few frames mesh.material is null...
                    var _orig_subMeshEffects_1 = [];
                    mesh.subMeshes.forEach(function (submesh) {
                        _orig_subMeshEffects_1.push([submesh.effect, submesh._materialDefines]);
                    });
                    mesh.material.freeze();
                    mesh.metadata._saved_orig_material = mesh.material;
                    mesh.metadata._orig_subMeshEffects = _orig_subMeshEffects_1;
                }
                if (!mesh.metadata._orig_subMeshEffects) {
                    return "continue";
                }
                mesh.material = i == 0 ? shaderMaterial : shaderMaterialForRobot;
                if (mesh.metadata._rtt_subMeshEffects) {
                    for (var s = 0; s < mesh.subMeshes.length; ++s) {
                        (_a = mesh.subMeshes[s]).setEffect.apply(_a, __spread(mesh.metadata._rtt_subMeshEffects[s]));
                    }
                }
            };
            // Apply the shader on all meshes
            for (var i = 0; i < renderTarget.renderList.length; ++i) {
                _loop_1(i);
            }
        };
        renderTarget.onAfterRender = function () {
            var _loop_2 = function (i) {
                var _a;
                var mesh = renderTarget.renderList[i];
                if (!mesh.metadata._orig_subMeshEffects) {
                    return "continue";
                }
                if (!mesh.metadata._rtt_subMeshEffects) {
                    mesh.metadata._rtt_subMeshEffects = [];
                    mesh.subMeshes.forEach(function (submesh) {
                        mesh.metadata._rtt_subMeshEffects.push([submesh.effect, submesh._materialDefines]);
                    });
                }
                mesh.material = mesh.metadata._saved_orig_material;
                for (var s = 0; s < mesh.subMeshes.length; ++s) {
                    (_a = mesh.subMeshes[s]).setEffect.apply(_a, __spread(mesh.metadata._orig_subMeshEffects[s]));
                }
            };
            // Set the original shader on all meshes
            for (var i = 0; i < renderTarget.renderList.length; ++i) {
                _loop_2(i);
            }
        };
        // third pass: merge two passes
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.finalVertexShader = "\n            precision highp float;\n\n            attribute vec3 position;\n            attribute vec2 uv;\n\n            uniform mat4 worldViewProjection;\n\n            varying vec2 vUV;\n\n            void main() {\n                vUV = uv;\n                gl_Position = worldViewProjection * vec4(position, 1.0);\n            }";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore.finalFragmentShader = "\n            #ifdef GL_ES\n            precision mediump float;\n            #endif\n\n            varying vec2 vUV;\n\n            uniform sampler2D textureSampler;\n            uniform sampler2D secondTexture;\n            uniform sampler2D depthTexture;\n\n            void main(void)\n            {\n                vec4 first = texture2D(textureSampler, vUV);\n                vec4 second = texture2D(secondTexture, vUV);\n                // mixes colors\n                gl_FragColor = mix(first, second, vUV.x);\n            }\n        ";
        // create the pass
        var finalPass = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PostProcess"]('Final compose shader', 'final', // shader
        null, // attributes
        ['baseTexture', 'secondTexture', 'depthTexture'], // textures
        1.0, // options
        null, // camera
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"].BILINEAR_SAMPLINGMODE, // sampling
        this._engine // engine
        );
        finalPass.onApply = function (effect) {
            effect.setTextureFromPostProcess('baseTexture', imagePass);
            effect.setTexture('secondTexture', renderTarget);
            effect.setTexture('depthTexture', depthPass.getDepthMap());
        };
        // the render pipeline
        var pipeline = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PostProcessRenderPipeline"](this._engine, 'pipeline');
        var renderPasses = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PostProcessRenderEffect"](this._engine, 'renderPasses', function () { return [imagePass, finalPass]; });
        pipeline.addEffect(renderPasses);
        scene.postProcessRenderPipelineManager.addPipeline(pipeline);
        scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline('pipeline', camera);
        // Our built-in 'sphere' shape.
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["SceneLoader"].ImportMesh("", "resources/3d/BrainStem/", "BrainStem.gltf", scene, function (meshes) {
            renderTarget.renderList.push(ground);
            meshes.forEach(function (mesh) {
                renderTarget.renderList.push(mesh);
            });
        });
    };
    return RTTAndPostProcess;
}(_SampleBasic__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (RTTAndPostProcess);
_SampleBasic__WEBPACK_IMPORTED_MODULE_1__["default"].registerSampleClass("rttandpostprocess", {
    "displayName": "Create a Render Target Texture and use it in a post process pass",
    "description": "",
    "class": RTTAndPostProcess,
});


/***/ }),

/***/ "./src/Raymarching/index.ts":
/*!**********************************!*\
  !*** ./src/Raymarching/index.ts ***!
  \**********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _SampleBasic__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../SampleBasic */ "./src/SampleBasic.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var RayMarching = /** @class */ (function (_super) {
    __extends(RayMarching, _super);
    function RayMarching() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RayMarching.prototype.populateScene = function (scene, camera) {
        camera.position.x = 10;
        camera.position.y = 10;
        camera.position.z = -10;
        camera.setTarget(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero());
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["raymarchVertexShader"] = "\n        attribute vec2 position;\n        uniform vec2 scale;\n\n        // Output\n        varying vec2 vUV;\n        const vec2 madd = vec2(0.5, 0.5);\n        void main(void) {\n            vUV = (position * madd + madd) * scale;\n            gl_Position = vec4(position, 0.0, 1.0);\n        }\n    ";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["raymarchFragmentShader"] = "\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n\n        // Samplers\n        varying vec2 vUV;\n        uniform sampler2D textureSampler;\n        uniform sampler2D depthMap;\n\n        uniform vec2 resolution;\n\n        uniform float camMinZ;\n        uniform float camMaxZ;\n        uniform vec3 camPosition;\n        uniform vec3 camDirection;\n        uniform vec4 vLightData;\n        uniform float camFov;\n        uniform float time;\n\n        uniform mat4 camView;\n        uniform mat4 camProjection;\n        uniform mat4 camWorld;\n        uniform mat4 camTransform;\n\n        uniform vec3 backgroundColor;\n\n        #define MTL_BACKGROUND          -1.0\n        #define MTL_GROUND              1.0\n        #define MTL_AX                  2.0\n        #define MTL_AY                  3.0\n        #define MTL_AZ                  4.0\n        #define MTL_OBJ1                5.0\n        #define MTL_OBJ2                6.0\n\n        #define NORMAL_EPS              0.0001\n\n        #define MAX_RAYCAST_STEPS       100\n        #define STEP_DAMPING            0.86\n        #define DIST_EPSILON            0.001\n\n        #define BACKGROUND_COLOR        vec3(0.3, 0.342, 0.5)\n\n        #include<helperFunctions>\n        #include<__decl__lightFragment>[0]\n\n        struct lightingInfo\n        {\n            vec3 diffuse;\n            vec3 specular;\n        };\n\n\n        lightingInfo computeHemisphericLighting(vec3 viewDirectionW, vec3 vNormal, vec4 lightData, vec3 diffuseColor, vec3 specularColor, vec3 groundColor, float glossiness) {\n            lightingInfo result;\n\n            // Diffuse\n            float ndl = dot(vNormal, lightData.xyz) * 0.5 + 0.5;\n        #ifdef NDOTL\n            result.ndl = ndl;\n        #endif\n\n            result.diffuse = mix(groundColor, diffuseColor, ndl);\n\n        #ifdef SPECULARTERM\n            // Specular\n            vec3 angleW = normalize(viewDirectionW + lightData.xyz);\n            float specComp = max(0., dot(vNormal, angleW));\n            specComp = pow(specComp, max(1., glossiness));\n\n            result.specular = specComp * specularColor;\n        #endif\n                return result;\n        }\n\n        // Primitives\n        float plane(vec3 p, vec3 n, float offs) { return dot(p, n) - offs; }\n        float sphere(vec3 p, float r) { return length(p) - r; }\n        float cone(in vec3 p, vec2 n) { return dot(vec2(length(p.xz), p.y), n);}\n        float cone(vec3 p, float r, float h) {\n            float ang = atan(r, h);\n            vec2 n = vec2(cos(ang), sin(ang));\n            float d = cone(vec3(p.x, p.y - h, p.z), n);\n            return max(d, -p.y);\n        }\n        float cylinder(in vec3 p, float r) { return length(p.xz) - r; }\n        float cylinder(in vec3 p, float r, float h) { return max(cylinder(p, r), abs(p.y) - h*0.5); }\n        float torus(vec3 p, float ri, float ro) { return length(vec2(length(p.xz) - ri, p.y)) - ro; }\n\n        // Boolean operations\n        float diff(float d1, float d2) { return max(-d2, d1); }\n        float add(float d1, float d2) { return min(d2, d1); }\n        float intersect(float d1, float d2) { return max(d2, d1); }\n        // Boolean operations (with material ID in second component)\n        void diff(inout vec2 d1, in vec2 d2) {\n            if (-d2.x > d1.x) {\n                d1.x = -d2.x;\n                d1.y = d2.y;\n            }\n        }\n        void add(inout vec2 d1, in vec2 d2) { if (d2.x < d1.x) d1 = d2; }\n        void intersect(inout vec2 d1, in vec2 d2) { if (d1.x < d2.x) d1 = d2; }\n\n        // Affine transformations\n        vec3 translate(vec3 p, vec3 d) {\n            return p - d;\n        }\n        vec2 rotate(vec2 p, float ang) {\n            float c = cos(ang), s = sin(ang);\n            return vec2(p.x*c-p.y*s, p.x*s+p.y*c);\n        }\n        //  Repetition\n        float repeat(float coord, float spacing) {\n            return mod(coord, spacing) - spacing*0.5;\n        }\n        vec2 repeatAng(vec2 p, float n) {\n            float ang = 2.0*PI/n;\n            float sector = floor(atan(p.x, p.y)/ang + 0.5);\n            p = rotate(p, sector*ang);\n            return p;\n        }\n        vec3 repeatAngS(vec2 p, float n) {\n            float ang = 2.0*PI/n;\n            float sector = floor(atan(p.x, p.y)/ang + 0.5);\n            p = rotate(p, sector*ang);\n            return vec3(p.x, p.y, mod(sector, n));\n        }\n\n        vec2 map(vec3 p) {\n            vec3 yP = p;\n            yP.y = repeat(yP.y, 2.0);\n            vec2 res = vec2(sphere(yP-vec3(2.0,0.0,0.0), 1.0), MTL_GROUND);\n            return res;\n        }\n\n\n        vec3 calcNormal(in vec3 p)\n        {\n            vec2 d = vec2(NORMAL_EPS, 0.0);\n            return normalize(vec3(\n                map(p + d.xyy).x - map(p - d.xyy).x,\n                map(p + d.yxy).x - map(p - d.yxy).x,\n                map(p + d.yyx).x - map(p - d.yyx).x));\n        }\n\n\n        vec2 rayMarch(in vec3 ro, in vec3 rd) {\n            float t = 0.0;\n            float m = MTL_BACKGROUND;\n            for (int i=0; i < MAX_RAYCAST_STEPS; i++) {\n                vec2 res = map(ro + rd*t);\n                if (res.x < DIST_EPSILON) break;\n                t += res.x*STEP_DAMPING;\n                m = res.y;\n            }\n            return vec2(t, m);\n        }\n\n\n        vec3 getMaterialColor(float matID) {\n            vec3 col = backgroundColor;\n            if (matID <= MTL_GROUND) col = vec3(0.8, 0.8, 0.8);\n            else if (matID <= MTL_AX) col = vec3(1.0, 0.0, 0.0);\n            else if (matID <= MTL_AY) col = vec3(0.0, 1.0, 0.0);\n            else if (matID <= MTL_AZ) col = vec3(0.0, 0.0, 1.0);\n            else if (matID <= MTL_OBJ1) col = vec3(0.8, 0.8, 1.8);\n            else if (matID <= MTL_OBJ2) col = vec3(1.4, 1.3, 0.3);\n            else col = vec3(0.7, 0.7, 1.8);\n            return col;\n        }\n\n\n        vec3 applyFog(vec3 col, float dist) {\n            return mix(col, backgroundColor, dist);\n        }\n\n        vec4 render(in vec3 ro, in vec3 rd) {\n            vec2 res = rayMarch(ro, rd);\n            float t = res.x;\n            float mtlID = res.y;\n            vec3  lig = -rd;\n            vec3 pos = ro + t*rd;\n\n            vec4 posProj = camTransform * vec4(pos, 1);\n            float z = (posProj.z + camMinZ) / (camMaxZ + camMinZ);\n            if (z < 0.0 /*|| z > 1.0*/) { // no need to check against 1.0, as if z > 1.0 the check of z against depth in main() will fail\n                mtlID = MTL_BACKGROUND;\n                z = 1.0; // to be sure the test against depth fails in main()\n            }\n\n            vec3 nor = calcNormal(pos);\n            vec3 mtlColor = getMaterialColor(mtlID);\n            float ambient = 0.;\n            lightingInfo info = computeHemisphericLighting(rd, nor, vLightData, vec3(1.0, 1.0, 1.0)/*Light Color*/, vec3(1.0)/*Light Specular*/, vec3(0.)/*Ground Color*/, 0.0/*Glossy*/);\n\n            vec3 ref = reflect(rd, nor);\n            float specular = pow(clamp(dot(ref, vLightData.xyz), 0.0, 1.0), 16.0);\n\n            vec3 col = mtlColor*(ambient + info.diffuse + specular);\n            col = applyFog(col, z);\n\n            return vec4(col, z);\n        }\n\n        vec3 getRayFromScreenSpace()\n        {\n            mat4 invMat =  inverse(camTransform);\n            vec4 near = vec4((vUV.x - 0.5) * 2.0, (vUV.y - 0.5) * 2.0, -1, 1.0);\n            vec4 far = vec4((vUV.x - 0.5) * 2.0, (vUV.y - 0.5) * 2.0, 1, 1.0);\n            vec4 nearResult = invMat*near;\n            vec4 farResult = invMat*far;\n            nearResult /= nearResult.w;\n            farResult /= farResult.w;\n            vec3 dir = vec3(farResult - nearResult );\n            return normalize(dir);\n        }\n\n        void main(void){\n            vec4 baseColor = texture2D(textureSampler, vUV);\n            float depth = texture2D(depthMap, vUV).x;\n            vec2 p = vUV*2.0-1.0;\n            p.x *= resolution.x/resolution.y;\n            vec3 rayDir = getRayFromScreenSpace();\n            vec4 renderData = render(camPosition, rayDir);\n\n            if(renderData.w < depth){\n                baseColor.rgb = renderData.rgb;\n            }\n\n\n            gl_FragColor = baseColor;\n        }\n    ";
        camera.minZ = 1;
        camera.maxZ = 100.;
        //scene.fogEnabled = true;
        var light = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["HemisphericLight"]("light", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 1, 0), scene);
        light.intensity = 0.7;
        var sphere = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateSphere("sphere", { diameter: 2, segments: 32 }, scene);
        sphere.position.y = 1;
        var ground = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateGround("ground", { width: 6, height: 6 }, scene);
        var raymarchPass = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["PostProcess"]("raymarching", "raymarch", [
            'resolution',
            'camMinZ',
            'camMaxZ',
            'camPosition',
            'camDirection',
            'camFov',
            'camView',
            'camProjection',
            'camWorld',
            'camTransform',
            'vLightData',
            'time',
            'backgroundColor'
        ], [
            'depthMap'
        ], 1.0, camera, 0, this._engine, false, '', 0, 'raymarch');
        var render = scene.enableDepthRenderer();
        var time = 0.0;
        raymarchPass.onApply = function (effect) {
            time += scene.getEngine().getDeltaTime() * 0.001;
            effect.setFloat('time', time);
            effect.setTexture('depthMap', render.getDepthMap());
            var cvas = scene.getEngine().getRenderingCanvas();
            effect.setVector2('resolution', new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector2"](cvas.width, cvas.height));
            effect.setVector3('camPosition', scene.activeCamera.position);
            effect.setVector3('camDirection', scene.activeCamera.getForwardRay(1).direction);
            effect.setFloat('camMinZ', scene.activeCamera.minZ);
            effect.setFloat('camMaxZ', scene.activeCamera.maxZ);
            effect.setFloat('camFov', scene.activeCamera.fov);
            effect.setMatrix('camView', scene.activeCamera.getViewMatrix());
            effect.setMatrix('camProjection', scene.activeCamera.getProjectionMatrix());
            effect.setMatrix('camWorld', scene.activeCamera.getWorldMatrix());
            effect.setMatrix('camTransform', scene.activeCamera.getTransformationMatrix());
            effect.setColor3('backgroundColor', new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](scene.clearColor.r, scene.clearColor.g, scene.clearColor.b));
            var lightDir = light.direction.clone().normalize();
            effect.setVector4('vLightData', new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector4"](lightDir.x, lightDir.y, lightDir.z, 0.0));
        };
    };
    return RayMarching;
}(_SampleBasic__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (RayMarching);
_SampleBasic__WEBPACK_IMPORTED_MODULE_1__["default"].registerSampleClass("raymarching", {
    "displayName": "A raymarching test",
    "description": "",
    "class": RayMarching,
});


/***/ }),

/***/ "./src/Sample.ts":
/*!***********************!*\
  !*** ./src/Sample.ts ***!
  \***********************/
/*! exports provided: enumSplitMode, default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "enumSplitMode", function() { return enumSplitMode; });
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _MainGUI__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MainGUI */ "./src/MainGUI.tsx");
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};


var cameraSpeed = 5, shiftMultiplier = 3;
var enumSplitMode;
(function (enumSplitMode) {
    enumSplitMode[enumSplitMode["SIDE_BY_SIDE"] = 0] = "SIDE_BY_SIDE";
    enumSplitMode[enumSplitMode["LINEAR"] = 1] = "LINEAR";
})(enumSplitMode || (enumSplitMode = {}));
var Sample = /** @class */ (function () {
    function Sample(engine, canvas) {
        this._engine = engine;
        this._canvas = canvas;
        this._mapKeys = new Map();
        this._clearColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color4"](0, 0, 0, 1);
        this._cameraSpeed = cameraSpeed;
        this._qwertyMode = false;
        this.splits = [];
        this.splitMode = enumSplitMode.LINEAR;
        this.splitClasses = new Map();
        this.splitType = null;
        this._gui = null;
        window.__sample = this;
        window.__ss = this.splits;
    }
    Object.defineProperty(Sample, "sampleList", {
        get: function () {
            return Sample._sampleList;
        },
        enumerable: true,
        configurable: true
    });
    Sample.registerSampleClass = function (name, sample) {
        if (Sample._sampleList.get(name)) {
            throw "registerSampleClass: name \"" + name + " already registered!\"";
        }
        Sample._sampleList.set(name, sample);
    };
    Sample.createSample = function (name, engine, canvas) {
        var sampleDescr = Sample._sampleList.get(name);
        if (sampleDescr) {
            var sample = new sampleDescr.class(engine, canvas);
            sample.create();
            return sample;
        }
        return null;
    };
    Object.defineProperty(Sample.prototype, "qwertyMode", {
        get: function () {
            return this._qwertyMode;
        },
        set: function (qm) {
            var _this = this;
            this._qwertyMode = qm;
            this.splits.forEach(function (split) { return _this.setCameraKeys(split.camera); });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Sample.prototype, "splitNumber", {
        get: function () {
            return this.splits.length;
        },
        enumerable: true,
        configurable: true
    });
    Sample.prototype.createNewSplit = function () {
        if (this.splitClasses.size === 0) {
            return;
        }
        this.addSplit(this.splitClasses.keys().next().value, "");
    };
    Sample.prototype.onBeforeRender = function (deltaTime) {
        var _this = this;
        this.splits.forEach(function (split) {
            var camera = split.camera;
            camera.speed = _this._cameraSpeed * (_this._mapKeys.get('Shift') ? shiftMultiplier : 1);
            if (_this._mapKeys.get(' ')) {
                camera.cameraDirection = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, _this._cameraSpeed / 5, 0);
            }
            if (_this._mapKeys.get('x')) {
                camera.cameraDirection = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, -_this._cameraSpeed / 5, 0);
            }
        });
        if (this._mapKeys.get("+")) {
            this._mapKeys.set("+", false);
            this.createNewSplit();
        }
        if (this._mapKeys.get("-")) {
            this._mapKeys.set("-", false);
            this.splits.forEach(function (split) {
                if (split.gui) {
                    split.gui.toggleGUI();
                }
            });
        }
        if (this._mapKeys.get("F10") && this._gui) {
            this._mapKeys.set("F10", false);
            this._gui.toggleGUI();
        }
        this.splits.forEach(function (split, splitIndex) {
            if (_this._mapKeys.get("F" + (splitIndex + 1)) && split.gui) {
                _this._mapKeys.set("F" + (splitIndex + 1), false);
                split.gui.toggleGUI();
            }
        });
        if (this._mapKeys.get("/")) {
            this._mapKeys.set("/", false);
            this.splitMode = this.splitMode === enumSplitMode.LINEAR ? enumSplitMode.SIDE_BY_SIDE : enumSplitMode.LINEAR;
            window.dispatchEvent(new CustomEvent('gui_set_value', { detail: { type: 'setSplitLayout' } }));
        }
    };
    Sample.prototype.render = function () {
        var _this = this;
        var w = this._engine.getRenderWidth(), h = this._engine.getRenderHeight(), stepx = w / this.splits.length;
        var _loop_1 = function (i) {
            var split = this_1.splits[i];
            split.scene.autoClear = (i == 0);
            switch (this_1.splitMode) {
                case enumSplitMode.SIDE_BY_SIDE:
                    split.camera.viewport = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Viewport"](i / this_1.splits.length, 0, 1 / this_1.splits.length, 1);
                    break;
                case enumSplitMode.LINEAR:
                    split.camera.viewport = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Viewport"](0, 0, 1, 1);
                    if (this_1.splits.length > 1) {
                        split.scene.onBeforeDrawPhaseObservable.addOnce(function () {
                            _this._engine.enableScissor(stepx * i, 0, stepx * (i + 1), h);
                        });
                        split.scene.onAfterDrawPhaseObservable.addOnce(function () {
                            _this._engine.disableScissor();
                        });
                    }
                    break;
            }
            if (split.isLoading) {
                this_1._engine.scissorClear(stepx * i, 0, stepx * (i + 1), h, this_1._clearColor);
            }
            else {
                split.render();
            }
        };
        var this_1 = this;
        for (var i = 0; i < this.splits.length; ++i) {
            _loop_1(i);
        }
    };
    Sample.prototype.createGUI = function () {
        this._gui = new _MainGUI__WEBPACK_IMPORTED_MODULE_1__["default"]("Global settings", this._engine, this);
        this._gui.createGUI();
    };
    Sample.prototype.create = function () {
    };
    Sample.prototype.resyncCameras = function () {
        var groups = new Map();
        for (var i = 0; i < this.splits.length; ++i) {
            var split = this.splits[i], scamera = split.camera;
            var camera = groups.get(split.group);
            if (!camera) {
                groups.set(split.group, scamera);
                scamera.update();
                continue;
            }
            scamera.speed = camera.speed;
            scamera.position = camera.position.clone();
            scamera.rotation = camera.rotation.clone();
            scamera.cameraDirection = camera.cameraDirection.clone();
            scamera.cameraRotation = camera.cameraRotation.clone();
        }
    };
    Sample.prototype.registerClass = function (splitClassName, splitClass) {
        this.splitClasses.set(splitClassName, splitClass);
    };
    Sample.prototype.addSplit = function (splitClassName, splitName, attachControls, createGUI) {
        if (attachControls === void 0) { attachControls = true; }
        if (createGUI === void 0) { createGUI = true; }
        var splitClass = this.splitClasses.get(splitClassName);
        if (!splitClass) {
            return null;
        }
        var _a = __read(this.createSceneAndCamera(attachControls), 2), scene = _a[0], camera = _a[1];
        var split = new splitClass(scene, camera, this, splitName);
        this.splits.push(split);
        if (createGUI) {
            split.createGUI();
        }
        window.setTimeout(function () { return window.dispatchEvent(new Event('split_added')); }, 16); // let the time to the GUI to render before sending the event
        return split;
    };
    Sample.prototype.getSplitBounds = function (index) {
        var splitIdx = 0;
        if (typeof (index) == 'number') {
            splitIdx = index;
        }
        else {
            splitIdx = this.splits.indexOf(index);
        }
        if (splitIdx < 0) {
            return { x: 0, y: 0, w: 0, h: 0 };
        }
        var screenWidth = this._engine.getRenderWidth(), screenHeight = this._engine.getRenderHeight(), w = screenWidth / this.splits.length;
        return {
            x: splitIdx * screenWidth / this.splits.length,
            y: 0,
            w: w,
            h: screenHeight
        };
    };
    Sample.prototype.removeSplit = function (index) {
        var split = null;
        if (typeof (index) == 'number') {
            split = this.splits.splice(index, 1)[0];
        }
        else {
            var idx = this.splits.indexOf(index);
            if (idx !== -1) {
                split = this.splits.splice(idx, 1)[0];
            }
        }
        if (split && split.gui) {
            split.gui.removeGUI();
        }
        window.dispatchEvent(new Event('split_removed'));
        return split;
    };
    Sample.prototype.attachControlToAllCameras = function () {
        var _this = this;
        this.splits.forEach(function (split) {
            var camera = split.camera;
            camera.attachControl(_this._canvas, true);
        });
    };
    Sample.prototype.detachControlFromAllCameras = function () {
        var _this = this;
        this.splits.forEach(function (split) {
            var camera = split.camera;
            camera.detachControl(_this._canvas);
        });
    };
    Sample.prototype.setCameraKeys = function (camera) {
        camera.keysUp = [Sample.cameraKeys[this._qwertyMode ? "qwerty" : "azerty"].Up];
        camera.keysDown = [Sample.cameraKeys[this._qwertyMode ? "qwerty" : "azerty"].Down];
        camera.keysLeft = [Sample.cameraKeys[this._qwertyMode ? "qwerty" : "azerty"].Left];
        camera.keysRight = [Sample.cameraKeys[this._qwertyMode ? "qwerty" : "azerty"].Right];
    };
    Sample.prototype.createSceneAndCamera = function (attachControls) {
        var _this = this;
        if (attachControls === void 0) { attachControls = true; }
        var scene = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Scene"](this._engine);
        var camera = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["UniversalCamera"]("camera" + this.splits.length, new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 5, -10), scene);
        camera.fov = Math.PI / 4;
        camera.setTarget(babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].Zero());
        camera.inertia = 0;
        camera.angularSensibility = 500;
        this.setCameraKeys(camera);
        scene.onKeyboardObservable.add(function (kbInfo) {
            switch (kbInfo.type) {
                case BABYLON.KeyboardEventTypes.KEYDOWN:
                    _this._mapKeys.set(kbInfo.event.key, true);
                    if (kbInfo.event.key == "F1") {
                        kbInfo.event.preventDefault();
                    }
                    break;
                case BABYLON.KeyboardEventTypes.KEYUP:
                    _this._mapKeys.set(kbInfo.event.key, false);
                    break;
            }
        });
        this.enablePointerLock(scene);
        if (attachControls) {
            camera.attachControl(this._canvas, true);
        }
        scene.activeCamera = camera;
        return [scene, camera];
    };
    Sample.prototype.enablePointerLock = function (scene) {
        var _this = this;
        var locked = false;
        scene.onPointerObservable.add(function (pointerInfo) {
            switch (pointerInfo.type) {
                case BABYLON.PointerEventTypes.POINTERDOWN:
                    if (pointerInfo.event.button == 2) {
                        if (!locked) {
                            locked = true;
                            _this._canvas.requestPointerLock = _this._canvas.requestPointerLock || _this._canvas.msRequestPointerLock || _this._canvas.mozRequestPointerLock || _this._canvas.webkitRequestPointerLock;
                            if (_this._canvas.requestPointerLock) {
                                _this.detachControlFromAllCameras();
                                _this._canvas.requestPointerLock();
                                window.setTimeout(function () { return _this.attachControlToAllCameras(); }, 100);
                            }
                        }
                        else {
                            _this.detachControlFromAllCameras();
                            document.exitPointerLock();
                            locked = false;
                            window.setTimeout(function () { return _this.attachControlToAllCameras(); }, 100);
                        }
                    }
                    break;
            }
        });
    };
    Sample._sampleList = new Map();
    Sample.cameraKeys = {
        "azerty": {
            "Up": 90,
            "Down": 83,
            "Left": 81,
            "Right": 68,
        },
        "qwerty": {
            "Up": 87,
            "Down": 83,
            "Left": 65,
            "Right": 68,
        },
    };
    return Sample;
}());
/* harmony default export */ __webpack_exports__["default"] = (Sample);


/***/ }),

/***/ "./src/SampleBasic.ts":
/*!****************************!*\
  !*** ./src/SampleBasic.ts ***!
  \****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Sample */ "./src/Sample.ts");
/* harmony import */ var _Split__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Split */ "./src/Split.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var SplitBasic = /** @class */ (function (_super) {
    __extends(SplitBasic, _super);
    function SplitBasic(scene, camera, parent, name) {
        if (name === void 0) { name = "default"; }
        return _super.call(this, scene, camera, parent, name) || this;
    }
    return SplitBasic;
}(_Split__WEBPACK_IMPORTED_MODULE_1__["default"]));
var SampleBasic = /** @class */ (function (_super) {
    __extends(SampleBasic, _super);
    function SampleBasic() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SampleBasic.prototype.populateScene = function (scene, camera) {
    };
    SampleBasic.prototype.create = function () {
        this.registerClass("split", SplitBasic);
        var split = this.addSplit("split", "basic", true, false);
        this.populateScene(split.scene, split.camera);
        jQuery(document.body).append('<div id="fps"></div>');
    };
    return SampleBasic;
}(_Sample__WEBPACK_IMPORTED_MODULE_0__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (SampleBasic);


/***/ }),

/***/ "./src/ScrollViewer/constants.ts":
/*!***************************************!*\
  !*** ./src/ScrollViewer/constants.ts ***!
  \***************************************/
/*! exports provided: NEAR, FAR, UI_TEXTURE_ID, RENDERING_2D_TEXTURE, RU, RU2D, RACK_INDEX_BG_COLOR, RACK_INDEX_TEXT_COLOR, NO_COLOR, HOOK_SIZE, DEFAULT_SCALE */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NEAR", function() { return NEAR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "FAR", function() { return FAR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "UI_TEXTURE_ID", function() { return UI_TEXTURE_ID; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RENDERING_2D_TEXTURE", function() { return RENDERING_2D_TEXTURE; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RU", function() { return RU; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RU2D", function() { return RU2D; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RACK_INDEX_BG_COLOR", function() { return RACK_INDEX_BG_COLOR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "RACK_INDEX_TEXT_COLOR", function() { return RACK_INDEX_TEXT_COLOR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "NO_COLOR", function() { return NO_COLOR; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "HOOK_SIZE", function() { return HOOK_SIZE; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "DEFAULT_SCALE", function() { return DEFAULT_SCALE; });
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);

var NEAR = 1;
var FAR = 2;
var UI_TEXTURE_ID = 'UI_TEXTURE_ID';
var RENDERING_2D_TEXTURE = 'RENDERING_2D_TEXTURE';
var RU = 1.75; // 1U = 1.75inches
var RU2D = 2;
var RACK_INDEX_BG_COLOR = '#333333';
var RACK_INDEX_TEXT_COLOR = '#FFFFFF';
var NO_COLOR = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color4"](1, 1, 1, 1);
var HOOK_SIZE = 0.5;
var DEFAULT_SCALE = 20;


/***/ }),

/***/ "./src/ScrollViewer/index.ts":
/*!***********************************!*\
  !*** ./src/ScrollViewer/index.ts ***!
  \***********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ "./src/ScrollViewer/constants.ts");
/* harmony import */ var _utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils */ "./src/ScrollViewer/utils.ts");
/* harmony import */ var _SampleBasic__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../SampleBasic */ "./src/SampleBasic.ts");
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! babylonjs-gui */ "./node_modules/babylonjs-gui/babylon.gui.min.js");
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__);
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __values = (undefined && undefined.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};





var ScrollViewer = /** @class */ (function (_super) {
    __extends(ScrollViewer, _super);
    function ScrollViewer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ScrollViewer.prototype._countChildren = function (lc) {
        var e_1, _a;
        var num = 0;
        try {
            for (var lc_1 = __values(lc), lc_1_1 = lc_1.next(); !lc_1_1.done; lc_1_1 = lc_1.next()) {
                var c = lc_1_1.value;
                num++;
                if (c instanceof babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Container"]) {
                    num += this._countChildren(c._children);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (lc_1_1 && !lc_1_1.done && (_a = lc_1.return)) _a.call(lc_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return num;
    };
    ScrollViewer.prototype.populateScene = function (scene, camera) {
        camera.position.copyFromFloats(-250, 250, -250);
        scene.clearColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color4"](0.9, 0.9, 0.85, 1.0);
        //scene.attachControl();
        var adt = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["AdvancedDynamicTexture"].CreateFullscreenUI(_constants__WEBPACK_IMPORTED_MODULE_1__["RENDERING_2D_TEXTURE"], false, scene);
        adt.renderScale = 1.5;
        adt.isForeground = false;
        var mappingConfig = {
            roomPadding: 5,
            racksSpacingX: 10,
            racksSpacingY: 80,
            minRoomWidth: 100,
            minRoomDepth: 100,
            planPadding: 10,
            roomSpacingX: 50,
            roomHeight: 100,
            planHeight: 0
        };
        var racks = Object(_utils__WEBPACK_IMPORTED_MODULE_2__["createRooms"])({
            rooms: 10,
            racksPerRoom: 100,
            devicesPerRack: 30,
            devicesPerPosition: 1,
            rackHeight: 49,
            racksPerRow: 3,
            deviceHeight: 1
        });
        var rooms = Object(_utils__WEBPACK_IMPORTED_MODULE_2__["racksToRooms"])(racks, mappingConfig);
        var planData = Object(_utils__WEBPACK_IMPORTED_MODULE_2__["createPlan"])("plan001", rooms, mappingConfig);
        var main = Object(_utils__WEBPACK_IMPORTED_MODULE_2__["create2dPlan"])(planData);
        main.forceHorizontalBar = true;
        main.forceVerticalBar = true;
        var checkbox = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Checkbox"]();
        checkbox.top = "5px";
        checkbox.left = "5px";
        checkbox.width = "20px";
        checkbox.height = "20px";
        checkbox.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        checkbox.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].VERTICAL_ALIGNMENT_TOP;
        checkbox.isChecked = false;
        checkbox.color = "green";
        checkbox.onIsCheckedChangedObservable.add(function (value) {
            main.freezeControls = value;
        });
        adt.addControl(checkbox);
        var header = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["TextBlock"]();
        header.top = "5px";
        header.left = "30px";
        header.text = "freeze controls";
        header.width = "120px";
        header.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        header.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].VERTICAL_ALIGNMENT_TOP;
        header.textHorizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        header.textVerticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].VERTICAL_ALIGNMENT_TOP;
        header.color = "black";
        adt.addControl(header);
        var stats = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["TextBlock"]();
        stats.top = "30px";
        stats.left = "5px";
        stats.text = "";
        stats.width = "500px";
        stats.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        stats.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].VERTICAL_ALIGNMENT_TOP;
        stats.textHorizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        stats.textVerticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].VERTICAL_ALIGNMENT_TOP;
        stats.color = "black";
        adt.addControl(stats);
        scene.onBeforeRenderObservable.add(function () { return adt.markAsDirty(); }); // make sure the GUI is redrawn continously
        var numChildControls = this._countChildren(main._children);
        var lastTime = new Date().getTime();
        scene.onAfterRenderObservable.add(function () {
            var curTime = new Date().getTime();
            stats.text = numChildControls + " controls, " + babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].numLayoutCalls + " layout calls, " + babylonjs_gui__WEBPACK_IMPORTED_MODULE_4__["Control"].numRenderCalls + " render calls";
            //console.log("duration=" + (curTime - lastTime));
            lastTime = curTime;
        });
        adt.addControl(main);
    };
    return ScrollViewer;
}(_SampleBasic__WEBPACK_IMPORTED_MODULE_3__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (ScrollViewer);
_SampleBasic__WEBPACK_IMPORTED_MODULE_3__["default"].registerSampleClass("scrollviewer", {
    "displayName": "Display lots of controls in a scroll viewer",
    "description": "",
    "class": ScrollViewer,
});


/***/ }),

/***/ "./src/ScrollViewer/utils.ts":
/*!***********************************!*\
  !*** ./src/ScrollViewer/utils.ts ***!
  \***********************************/
/*! exports provided: randomId, createDevice, createRack, createMany, createChassis, attachDevicesToRack, createRacks, createRooms, parseChassisLayout, createSimpleButton, getScaledValue, createChassisLayoutGrid, getContainerMembers, deviceTo3d, chassisTo3d, rackTo3d, createRackPosition, populateRackPositions, racksToRooms, createPlan, devicesToRacks, create2dPlan, create2dRoom, create2dRack, create2dRackPosition, create2dDevice */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "randomId", function() { return randomId; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createDevice", function() { return createDevice; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createRack", function() { return createRack; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createMany", function() { return createMany; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createChassis", function() { return createChassis; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "attachDevicesToRack", function() { return attachDevicesToRack; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createRacks", function() { return createRacks; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createRooms", function() { return createRooms; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "parseChassisLayout", function() { return parseChassisLayout; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createSimpleButton", function() { return createSimpleButton; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getScaledValue", function() { return getScaledValue; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createChassisLayoutGrid", function() { return createChassisLayoutGrid; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getContainerMembers", function() { return getContainerMembers; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "deviceTo3d", function() { return deviceTo3d; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "chassisTo3d", function() { return chassisTo3d; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "rackTo3d", function() { return rackTo3d; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createRackPosition", function() { return createRackPosition; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "populateRackPositions", function() { return populateRackPositions; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "racksToRooms", function() { return racksToRooms; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createPlan", function() { return createPlan; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "devicesToRacks", function() { return devicesToRacks; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "create2dPlan", function() { return create2dPlan; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "create2dRoom", function() { return create2dRoom; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "create2dRack", function() { return create2dRack; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "create2dRackPosition", function() { return create2dRackPosition; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "create2dDevice", function() { return create2dDevice; });
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs-gui */ "./node_modules/babylonjs-gui/babylon.gui.min.js");
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ "./node_modules/lodash/lodash.js");
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./constants */ "./src/ScrollViewer/constants.ts");
var __assign = (undefined && undefined.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};



function randomId(label) {
    return label + "-" + Math.floor(Math.random() * 10000).toString(32);
}
var createDevice = function (index, data) {
    if (index === void 0) { index = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["random"])(100); }
    if (data === void 0) { data = {}; }
    return __assign({ humanKey: randomId("node"), childType: "PhysicalNode", indexInsideContainer: 0, id: index, members: [] }, data);
};
var createRack = function (index, data) {
    if (index === void 0) { index = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["random"])(1000); }
    if (data === void 0) { data = {}; }
    var room = data.room || "room1";
    return __assign({ room: room, id: index, humanKey: randomId("rack"), height: 42, width: 19, depth: 34, angle: 0, inverted: false, xCoordinate: 0, yCoordinate: 0, positions: [] }, data);
};
var createMany = function (factory, count) {
    if (factory === void 0) { factory = createDevice; }
    if (count === void 0) { count = 10; }
    return Array.from({ length: count }, function (_, index) { return factory(index); });
};
var createChassis = function (index, data) {
    if (index === void 0) { index = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["random"])(1000); }
    if (data === void 0) { data = {}; }
    var layout = "-2,5";
    if (data.layout) {
        layout = data.layout;
    }
    var _a = parseChassisLayout(layout), rows = _a.rows, cols = _a.cols;
    var humanKey = randomId("chassis");
    var members = createMany(function (deviceIndex) {
        return createDevice(deviceIndex, {
            humanKey: randomId("node"),
            indexInsideContainer: deviceIndex % 3
        });
    }, cols * rows);
    return __assign(__assign(__assign({}, createDevice()), data), { members: members,
        layout: layout,
        humanKey: humanKey, childType: "Chassis" });
};
var attachDevicesToRack = function (rack, devices, _a) {
    var _b = _a === void 0 ? {} : _a, _c = _b.devicesPerPosition, devicesPerPosition = _c === void 0 ? 1 : _c, _d = _b.height, height = _d === void 0 ? 1 : _d;
    rack.positions = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["map"])(devices, function (device, index) {
        var p = typeof devicesPerPosition === "number"
            ? index % Math.round(devices.length / devicesPerPosition)
            : index;
        return {
            device: device,
            height: height,
            position: p > 0 ? p * height : p
        };
    });
    return rack;
};
var createRacks = function (index, _a) {
    if (index === void 0) { index = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["random"])(100); }
    var _b = _a === void 0 ? {} : _a, _c = _b.racks, racks = _c === void 0 ? 2 : _c, _d = _b.racksPerRow, racksPerRow = _d === void 0 ? 2 : _d, _e = _b.devicesPerRack, devicesPerRack = _e === void 0 ? 20 : _e, _f = _b.devicesPerPosition, devicesPerPosition = _f === void 0 ? 2 : _f, _g = _b.rackHeight, rackHeight = _g === void 0 ? 50 : _g, _h = _b.deviceHeight, deviceHeight = _h === void 0 ? 1 : _h, _j = _b.deviceFactory, deviceFactory = _j === void 0 ? createDevice : _j, _k = _b.rackFactory, rackFactory = _k === void 0 ? createRack : _k;
    return createMany(function (rackIndex) {
        return attachDevicesToRack(rackFactory(rackIndex, {
            height: rackHeight,
            room: "room-" + index,
            xCoordinate: rackIndex % racksPerRow,
            yCoordinate: Math.floor(rackIndex / racksPerRow)
        }), createMany(deviceFactory, devicesPerRack), { devicesPerPosition: devicesPerPosition, height: deviceHeight });
    }, racks);
};
function createRooms(_a) {
    var _b = _a === void 0 ? {} : _a, _c = _b.rooms, rooms = _c === void 0 ? 1 : _c, _d = _b.racksPerRoom, racksPerRoom = _d === void 0 ? 10 : _d, _e = _b.racksPerRow, racksPerRow = _e === void 0 ? 2 : _e, _f = _b.devicesPerRack, devicesPerRack = _f === void 0 ? 20 : _f, _g = _b.devicesPerPosition, devicesPerPosition = _g === void 0 ? 2 : _g, _h = _b.rackHeight, rackHeight = _h === void 0 ? 50 : _h, _j = _b.deviceHeight, deviceHeight = _j === void 0 ? 1 : _j, _k = _b.deviceFactory, deviceFactory = _k === void 0 ? createDevice : _k, _l = _b.rackFactory, rackFactory = _l === void 0 ? createRack : _l;
    return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["flatten"])(createMany(function (index) {
        return createRacks(index, {
            racksPerRow: racksPerRow,
            deviceFactory: deviceFactory,
            devicesPerPosition: devicesPerPosition,
            devicesPerRack: devicesPerRack,
            rackHeight: rackHeight,
            deviceHeight: deviceHeight,
            rackFactory: rackFactory,
            racks: racksPerRoom
        });
    }, rooms));
}
function parseChassisLayout(chassisLayout, members) {
    var cols = 3;
    var rows = Math.ceil(members / 3) || 3;
    var layout = "H";
    if (layout) {
        layout = chassisLayout[0] === "|" ? "V" : "H";
        var dimensions = chassisLayout.substring(1).split(",");
        cols = dimensions[0] ? +dimensions[0] : cols;
        rows = dimensions[1] ? +dimensions[1] : rows;
    }
    return {
        cols: cols,
        rows: rows,
        layout: layout,
        slots: cols * rows
    };
}
function createSimpleButton(name, text) {
    var button = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Button"].CreateSimpleButton(name, text);
    button.pointerEnterAnimation = function () { };
    button.pointerOutAnimation = function () { };
    button.pointerUpAnimation = function () { };
    button.pointerDownAnimation = function () { };
    return button;
}
function getScaledValue(value) {
    return value * _constants__WEBPACK_IMPORTED_MODULE_2__["DEFAULT_SCALE"];
}
function createChassisLayoutGrid(chassis) {
    /* TODO: implement vertical layout*/
    var _a = parseChassisLayout(chassis.layout, chassis.members.length), cols = _a.cols, rows = _a.rows;
    var grid = [];
    for (var x = 0; x < rows; x += 1) {
        grid[x] = [];
        for (var y = 0; y < cols; y += 1) {
            grid[x][y] = {
                humanKey: "EmptySlot",
                childType: "EmptySlot",
                indexInsideContainer: 0,
                entity: {},
                $members: [],
                parentSlot: 0
            };
        }
    }
    var notPositioned = [];
    Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(chassis.members, function (dev) {
        var x = Math.floor(dev.indexInsideContainer / cols);
        var y = dev.indexInsideContainer % cols;
        var pos = grid[x] ? grid[x][y] : null;
        if (pos && pos.childType === "EmptySlot") {
            grid[x][y] = dev;
        }
        else {
            notPositioned.push(dev);
        }
    });
    var emptyPositions = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["flatMap"])(grid, function (row, rowIndex) {
        return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["reduce"])(row, function (all, dev, index) {
            if (dev.childType === "EmptySlot") {
                all.push({ x: rowIndex, y: index });
            }
            return all;
        }, []);
    });
    Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(notPositioned.sort(function (a, b) { return a.indexInsideContainer - b.indexInsideContainer; }), function (dev) {
        var pos = emptyPositions.shift();
        if (pos) {
            grid[pos.x][pos.y] = dev;
        }
    });
    return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["map"])(grid, function (row, index) {
        var devices = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["map"])(row, function (dev, i) {
            dev.parentSlot = i;
            return deviceTo3d(dev);
        });
        var position = {
            devices: devices,
            id: Date.now(),
            name: chassis.humanKey,
            height: 1,
            parentSlot: index,
            slotSize: _constants__WEBPACK_IMPORTED_MODULE_2__["RU"]
        };
        return position;
    });
}
function getContainerMembers(device) {
    if (!device.members) {
        return [];
    }
    return device.members.sort(function (a, b) {
        a.name = a.humanKey || a.$fkRight.humanKey;
        return a.indexInsideContainer - b.indexInsideContainer;
    });
}
function deviceTo3d(device) {
    return {
        name: device.humanKey,
        type: device.childType,
        indexInsideContainer: device.indexInsideContainer,
        id: device.id,
        powerStatus: device.powerStatus,
        members: getContainerMembers(device),
        parentSlot: device.parentSlot || 0
    };
}
function chassisTo3d(chassis) {
    var device = deviceTo3d(chassis);
    device.layout = parseChassisLayout(chassis.layout, chassis.members.length);
    device.depth = 30;
    device.positions = createChassisLayoutGrid(chassis);
    return device;
}
function rackTo3d(rack) {
    return {
        id: rack.id,
        name: rack.humanKey,
        slots: rack.height,
        width: rack.width,
        height: rack.height * _constants__WEBPACK_IMPORTED_MODULE_2__["RU"],
        room: rack.room,
        depth: rack.depth,
        angle: rack.angle,
        inverted: rack.inverted,
        xCoordinate: rack.xCoordinate,
        yCoordinate: rack.yCoordinate,
        parentPosition: { x: 0, y: 0, z: 0, col: 0, row: 0 },
        positions: populateRackPositions(rack)
    };
}
var createRackPosition = function (rackPosition, spreadedPositions) {
    var height = rackPosition.height, position = rackPosition.position;
    var target = spreadedPositions[position];
    if (!target) {
        target = {
            height: height,
            parentSlot: position,
            devices: [],
            isChassis: rackPosition.device.childType === "Chassis" &&
                rackPosition.device.members.length > 0,
            slotSize: _constants__WEBPACK_IMPORTED_MODULE_2__["RU"]
        };
        for (var h = 0; h < rackPosition.height; h += 1) {
            if (spreadedPositions[position + h]) {
                // invalid overlap
                return null;
            }
        }
        for (var h = 0; h < height; h += 1) {
            spreadedPositions[position + h] = target;
        }
    }
    if (target.height !== height) {
        return null;
    }
    return target;
};
function populateRackPositions(rack) {
    var spreadedPositions = [];
    var positionsHash = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["reduce"])(rack.positions, function (all, rackPosition) {
        var position = createRackPosition(rackPosition, spreadedPositions);
        if (position) {
            if (position.isChassis) {
                position.devices.push(chassisTo3d(rackPosition.device));
                all[position.parentSlot] = position;
            }
            else {
                var device = deviceTo3d(rackPosition.device);
                position.devices.push(device);
                all[position.parentSlot] = position;
            }
        }
        return all;
    }, {});
    var positions = Object.values(positionsHash);
    Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(positions, function (position) {
        if (!position.isChassis) {
            Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(position.devices, function (device, index) {
                device.parentSlot = index;
            });
            position.devices.sort(function (a, b) {
                return a.indexInsideContainer - b.indexInsideContainer;
            });
        }
    });
    return positions;
}
function racksToRooms(racks, config) {
    var rooms = Object.values(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["reduce"])(racks, function (roomsHash, rack, index) {
        var rack3d = rackTo3d(rack);
        if (!roomsHash[rack.room]) {
            roomsHash[rack.room] = {
                id: index,
                cols: Math.max(0, rack3d.xCoordinate),
                rows: Math.max(0, rack3d.yCoordinate),
                name: rack.room,
                width: 2 * config.roomPadding,
                depth: 2 * config.roomPadding,
                height: config.roomHeight,
                racks: [rack3d],
                info: {
                    maxRackWidth: 3,
                    maxRackDepth: 34,
                    maxRackHeight: 49
                }
            };
        }
        else {
            roomsHash[rack.room].racks.push(rack3d);
            roomsHash[rack.room].cols = Math.max(roomsHash[rack.room].cols, rack3d.xCoordinate);
            roomsHash[rack.room].rows = Math.max(roomsHash[rack.room].rows, rack3d.yCoordinate);
            roomsHash[rack.room].info.maxRackWidth = Math.max(roomsHash[rack.room].info.maxRackWidth, rack3d.width);
            roomsHash[rack.room].info.maxRackDepth = Math.max(roomsHash[rack.room].info.maxRackDepth, rack3d.depth);
            roomsHash[rack.room].info.maxRackHeight = Math.max(roomsHash[rack.room].info.maxRackHeight, rack3d.height);
        }
        return roomsHash;
    }, {}));
    Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(rooms, function (room) {
        room.rows += 1;
        room.cols += 1;
        var roomGrid = Array.from({ length: room.rows }, function (_, row) {
            var rowWidth = 0;
            var lastXCoords = config.roomPadding;
            var racksRow = Array.from({ length: room.cols }, function (__, col) {
                var rack = room.racks.find(function (r) { return r.xCoordinate === col && r.yCoordinate === row; });
                if (rack) {
                    rack.parentPosition.x = lastXCoords;
                    rack.parentPosition.col = rack.xCoordinate;
                    rack.parentPosition.row = rack.yCoordinate;
                    lastXCoords +=
                        ([90, 270].includes(rack.angle) ? rack.depth : rack.width) +
                            config.racksSpacingX;
                    rack.parentPosition.z =
                        config.roomPadding + row * (rack.depth + config.racksSpacingY);
                    rowWidth +=
                        ([90, 270].includes(rack.angle) ? rack.depth : rack.width) +
                            config.racksSpacingX;
                }
                return rack;
            }).filter(Boolean);
            room.depth += room.info.maxRackDepth + config.racksSpacingY;
            room.height += room.info.maxRackHeight + config.racksSpacingY;
            room.width = Math.max(rowWidth, room.width);
            return racksRow;
        });
        room.racks = roomGrid.flat();
        if (room.width < config.minRoomWidth) {
            room.width = config.minRoomWidth;
        }
        if (room.depth < config.minRoomDepth) {
            room.depth = config.minRoomDepth;
        }
    });
    return rooms;
}
function createPlan(name, rooms, config) {
    var plan = {
        name: name,
        rooms: rooms
    };
    var maxRoomWidth = 10;
    var roomWidthSum = 0;
    var maxRoomDepth = 10;
    var roomWidthCumulative = 0;
    Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(plan.rooms, function (room, index) {
        maxRoomWidth = Math.max(maxRoomWidth, room.width);
        roomWidthSum += room.width;
        maxRoomDepth = Math.max(maxRoomDepth, room.depth);
        room.parentPosition = {
            col: index,
            row: 0,
            x: config.planPadding + index * config.planPadding + roomWidthCumulative,
            y: 0,
            z: config.planPadding
        };
        roomWidthCumulative += room.width;
    });
    plan.width =
        2 * config.planPadding +
            roomWidthSum +
            config.planPadding * (plan.rooms.length - 1);
    plan.depth = 2 * config.planPadding + maxRoomDepth;
    plan.height = config.planHeight;
    return plan;
}
function devicesToRacks(roomName, devices) {
    var devicesChunks = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["chunk"])(devices, 43);
    var racksPerRow = 2;
    return createMany(function (index) {
        return attachDevicesToRack(createRack(index, {
            height: 42,
            room: roomName,
            xCoordinate: index % racksPerRow,
            yCoordinate: Math.floor(index / racksPerRow)
        }), devicesChunks[index], { devicesPerPosition: 1, height: 1 });
    }, devicesChunks.length);
}
var rackMargin = 10;
var headerColor = "#424242";
var containerColor = "#757575";
var slotsColor = "#e0e0e0";
var borderColor = "#bdbdbd";
function create2dPlan(_a) {
    var id = _a.id, depth = _a.depth, width = _a.width, rooms = _a.rooms;
    var scroll = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["ScrollViewer"]("plan-" + id + "-scroll");
    scroll.width = 1;
    scroll.height = 0.9;
    scroll.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].VERTICAL_ALIGNMENT_BOTTOM;
    var plan = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Rectangle"]("plan-" + id);
    scroll.addControl(plan);
    plan.background = "";
    plan.thickness = 0;
    plan.widthInPixels = getScaledValue(width);
    plan.heightInPixels = getScaledValue(depth);
    plan.horizontalAlignment = 0;
    plan.verticalAlignment = 0;
    Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(rooms, function (roomData, index) {
        var room = create2dRoom(roomData);
        var position = roomData.parentPosition;
        room.topInPixels = getScaledValue(position.y) + 50;
        room.leftInPixels = getScaledValue(position.x);
        plan.addControl(room);
    });
    return scroll;
}
function create2dRoom(_a) {
    var id = _a.id, info = _a.info, cols = _a.cols, racks = _a.racks;
    var room = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["StackPanel"]("room-" + id);
    room.isVertical = false;
    room.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
    room.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].VERTICAL_ALIGNMENT_TOP;
    room.background = "";
    room.widthInPixels = (getScaledValue(info.maxRackWidth) + rackMargin) * cols;
    room.height = 1;
    for (var col = 0; col < cols; col += 1) {
        var colStack = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["StackPanel"]("room-" + id + "-col-" + col);
        colStack.background = "";
        colStack.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        colStack.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].VERTICAL_ALIGNMENT_TOP;
        colStack.isVertical = true;
        colStack.height = 1;
        colStack.widthInPixels = getScaledValue(info.maxRackWidth) + rackMargin;
        room.addControl(colStack);
    }
    info.maxRackWidth += _constants__WEBPACK_IMPORTED_MODULE_2__["RU2D"];
    Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(racks, function (rackData) {
        var _a = __read(create2dRack(rackData), 1), rack = _a[0];
        var position = rackData.parentPosition;
        var col = room.getChildByName("room-" + id + "-col-" + position.col);
        col.addControl(rack);
    });
    return room;
}
function create2dRack(_a) {
    var id = _a.id, slots = _a.slots, height = _a.height, positions = _a.positions, width = _a.width, name = _a.name;
    var slotSize = _constants__WEBPACK_IMPORTED_MODULE_2__["RU2D"];
    var widthInPixels = getScaledValue(width + slotSize);
    var rack = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Rectangle"]("rack-" + id);
    rack.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Rectangle"].HORIZONTAL_ALIGNMENT_LEFT;
    rack.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Rectangle"].VERTICAL_ALIGNMENT_TOP;
    rack.heightInPixels = getScaledValue(height + slotSize) + rackMargin; // includes one extra slot for name
    rack.widthInPixels = widthInPixels;
    rack.color = headerColor;
    rack.thickness = 2;
    rack.paddingBottomInPixels = rackMargin;
    var rackContainer = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["StackPanel"]("rack-" + id + "-container");
    rackContainer.isVertical = true;
    rackContainer.height = 1;
    rackContainer.widthInPixels = widthInPixels;
    rack.addControl(rackContainer);
    var rackHeader = createSimpleButton("rack-" + id + "-header", name);
    rackHeader.background = headerColor;
    rackHeader.color = "white";
    rackHeader.thickness = 0;
    rackHeader.textBlock.fontSize = getScaledValue(0.9);
    rackHeader.heightInPixels = getScaledValue(slotSize);
    rackHeader.width = 1;
    rackHeader.textBlock.zIndex = 2;
    var rackStatus = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Rectangle"]("rack-" + id + "-status");
    rackStatus.height = 1;
    rackStatus.width = 1;
    rackStatus.thickness = 0;
    rackStatus.zIndex = 1;
    rackStatus.alpha = 0.6;
    rackHeader.addControl(rackStatus);
    rackContainer.addControl(rackHeader);
    var rackSlots = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["StackPanel"]("rack-" + id + "-slots");
    rackSlots.width = 1;
    rackSlots.heightInPixels = getScaledValue(slotSize) * slots;
    rackSlots.isVertical = false;
    rackContainer.addControl(rackSlots);
    var rackSlotNumbers = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["StackPanel"]("rack-" + id + "-slot-numbers");
    rackSlotNumbers.background = slotsColor;
    rackSlotNumbers.widthInPixels = getScaledValue(slotSize);
    rackSlotNumbers.height = 1;
    rackSlotNumbers.isVertical = true;
    rackSlots.addControl(rackSlotNumbers);
    for (var index = 1; index <= slots; index += 1) {
        var position = createSimpleButton("rack-" + id + "-pos-" + index, "" + index);
        position.heightInPixels = getScaledValue(slotSize);
        position.width = 1;
        position.background = slotsColor;
        position.thickness = 0.5;
        position.color = borderColor;
        position.textBlock.fontSize = getScaledValue(0.7);
        position.textBlock.color = "black";
        rackSlotNumbers.addControl(position);
    }
    rackSlotNumbers.useBitmapCache = true;
    var rackPositions = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["StackPanel"]("rack-" + id + "-positions");
    rackPositions.background = containerColor;
    rackPositions.widthInPixels = widthInPixels - rackSlotNumbers.widthInPixels;
    rackPositions.height = 1;
    rackPositions.isVertical = true;
    rackSlots.addControl(rackPositions);
    rackPositions.useBitmapCache = true;
    var rackHeight = slots * slotSize;
    var positionsHash = Object(lodash__WEBPACK_IMPORTED_MODULE_1__["keyBy"])(positions, "parentSlot");
    var slot = 0;
    while (slot <= slots) {
        if (positionsHash[slot]) {
            var positionData = positionsHash[slot];
            positionData.width = width;
            var rackPosition = create2dRackPosition(positionData);
            rackPosition.heightInPixels =
                getScaledValue(positionData.height) * slotSize;
            rackPositions.addControl(rackPosition);
            slot += positionData.height;
            continue;
        }
        else {
            var emptyPosition = create2dRackPosition();
            emptyPosition.heightInPixels = getScaledValue(1) * slotSize;
            emptyPosition.background = "#757575";
            rackPositions.addControl(emptyPosition);
        }
        slot += 1;
    }
    return [rack, rackPositions, rackStatus];
}
function create2dRackPosition(data) {
    var position = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["StackPanel"]("rack-position-" + (data ? data.id : Date.now()));
    position.isVertical = false;
    position.background = slotsColor;
    position.shadowOffsetY = -2;
    position.shadowColor = borderColor;
    position.width = 1;
    if (data) {
        var devices = data.devices, width_1 = data.width, height_1 = data.height, depth_1 = data.depth;
        var slots_1 = devices.length;
        var slotSize = width_1 / slots_1;
        Object(lodash__WEBPACK_IMPORTED_MODULE_1__["forEach"])(devices, function (deviceData) {
            deviceData.width = slots_1 > 0 ? width_1 / slots_1 : width_1;
            deviceData.height = height_1;
            deviceData.depth = depth_1;
            var _a = __read(create2dDevice(deviceData), 1), device = _a[0];
            device.widthInPixels = getScaledValue(width_1) / slots_1;
            position.addControl(device);
        });
    }
    return position;
}
function create2dDevice(device) {
    var id = device.id, type = device.type;
    var deviceContainer = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Rectangle"]("device-" + id);
    deviceContainer.heightInPixels = getScaledValue(_constants__WEBPACK_IMPORTED_MODULE_2__["RU2D"]);
    deviceContainer.useBitmapCache = true;
    deviceContainer.shadowOffsetY = 2;
    deviceContainer.shadowOffsetX = 2;
    deviceContainer.paddingBottomInPixels = 2;
    deviceContainer.thickness = 0;
    deviceContainer.shadowColor = borderColor;
    deviceContainer.background = slotsColor;
    deviceContainer.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
    deviceContainer.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].VERTICAL_ALIGNMENT_TOP;
    deviceContainer.useBitmapCache = true;
    if (type === "EmptySlot") {
        return [deviceContainer, null];
    }
    var deviceIcon = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Image"]("device-" + type + "-icon", "/textures/devices/" + type + ".png");
    deviceIcon.width = 0.1;
    deviceIcon.height = 1;
    deviceIcon.paddingBottomInPixels = 2;
    deviceIcon.paddingLeftInPixels = 2;
    deviceIcon.paddingRightInPixels = 2;
    deviceIcon.paddingTopInPixels = 2;
    deviceIcon.zIndex = 2;
    deviceIcon.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
    deviceContainer.addControl(deviceIcon);
    var deviceName = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["TextBlock"]("device-" + id + "-name", device.name);
    deviceName.width = 0.9;
    deviceName.height = 1;
    deviceName.fontSize = getScaledValue(0.9);
    deviceName.zIndex = 2;
    deviceName.textHorizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
    deviceName.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Control"].HORIZONTAL_ALIGNMENT_RIGHT;
    deviceContainer.addControl(deviceName);
    var deviceStatus = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_0__["Rectangle"]("device-" + id + "-status");
    deviceStatus.width = 1;
    deviceStatus.height = 1;
    deviceStatus.zIndex = 1;
    deviceStatus.thickness = 0;
    deviceStatus.background = slotsColor;
    deviceStatus.alpha = 0.6;
    deviceContainer.addControl(deviceStatus);
    return [deviceContainer, deviceStatus];
}


/***/ }),

/***/ "./src/ScrollViewer2/index.ts":
/*!************************************!*\
  !*** ./src/ScrollViewer2/index.ts ***!
  \************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _SampleBasic__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../SampleBasic */ "./src/SampleBasic.ts");
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! babylonjs-gui */ "./node_modules/babylonjs-gui/babylon.gui.min.js");
/* harmony import */ var babylonjs_gui__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__);
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __values = (undefined && undefined.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};


var ScrollViewer2 = /** @class */ (function (_super) {
    __extends(ScrollViewer2, _super);
    function ScrollViewer2() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ScrollViewer2.prototype._countChildren = function (lc) {
        var e_1, _a;
        var num = 0;
        try {
            for (var lc_1 = __values(lc), lc_1_1 = lc_1.next(); !lc_1_1.done; lc_1_1 = lc_1.next()) {
                var c = lc_1_1.value;
                num++;
                if (c instanceof babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Container"]) {
                    num += this._countChildren(c._children);
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (lc_1_1 && !lc_1_1.done && (_a = lc_1.return)) _a.call(lc_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return num;
    };
    ScrollViewer2.prototype.populateScene = function (scene, camera) {
        var adt = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["AdvancedDynamicTexture"].CreateFullscreenUI("UI");
        var checkbox = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Checkbox"]();
        checkbox.top = "5px";
        checkbox.left = "5px";
        checkbox.width = "20px";
        checkbox.height = "20px";
        checkbox.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        checkbox.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].VERTICAL_ALIGNMENT_TOP;
        checkbox.isChecked = false;
        checkbox.color = "green";
        checkbox.onIsCheckedChangedObservable.add(function (value) {
            sv.freezeControls = value;
        });
        adt.addControl(checkbox);
        var header = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["TextBlock"]();
        header.top = "5px";
        header.left = "30px";
        header.text = "freeze controls";
        header.width = "120px";
        header.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        header.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].VERTICAL_ALIGNMENT_TOP;
        header.textHorizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        header.textVerticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].VERTICAL_ALIGNMENT_TOP;
        header.color = "white";
        adt.addControl(header);
        var stats = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["TextBlock"]();
        stats.top = "30px";
        stats.left = "5px";
        stats.text = "";
        stats.width = "500px";
        stats.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        stats.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].VERTICAL_ALIGNMENT_TOP;
        stats.textHorizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
        stats.textVerticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].VERTICAL_ALIGNMENT_TOP;
        stats.color = "white";
        adt.addControl(stats);
        var sv = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["ScrollViewer"]();
        sv.width = 0.50;
        sv.height = 0.75;
        sv.background = "orange";
        sv.forceHorizontalBar = true;
        sv.forceVerticalBar = true;
        window.sv = sv;
        adt.addControl(sv);
        var cwidth = 10000, cheight = 10000;
        var numButtons = 10000;
        var btnWidth = 100, btnHeight = 30, btnFontSize = 12;
        var colors = ['red', 'blue', 'green', 'yellow', 'white', 'lightgreen'];
        var main = new babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Container"]();
        main.width = cwidth + "px";
        main.height = cheight + "px";
        sv.addControl(main);
        for (var i = 0; i < numButtons; ++i) {
            var btn = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Button"].CreateSimpleButton("btn" + i, "Button " + i);
            btn.width = btnWidth + "px";
            btn.height = btnHeight + "px";
            btn.horizontalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].HORIZONTAL_ALIGNMENT_LEFT;
            btn.verticalAlignment = babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].VERTICAL_ALIGNMENT_TOP;
            btn.fontSize = btnFontSize;
            btn.background = colors[Math.floor(Math.random() * colors.length)];
            btn.left = Math.random() * cwidth + "px";
            btn.top = Math.random() * cheight + "px";
            main.addControl(btn);
        }
        scene.onBeforeRenderObservable.add(function () { return adt.markAsDirty(); }); // make sure the GUI is redrawn continously
        var numChildControls = this._countChildren(main._children);
        scene.onAfterRenderObservable.add(function () {
            stats.text = numChildControls + " controls, " + babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].numLayoutCalls + " layout calls, " + babylonjs_gui__WEBPACK_IMPORTED_MODULE_1__["Control"].numRenderCalls + " render calls";
        });
    };
    return ScrollViewer2;
}(_SampleBasic__WEBPACK_IMPORTED_MODULE_0__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (ScrollViewer2);
_SampleBasic__WEBPACK_IMPORTED_MODULE_0__["default"].registerSampleClass("scrollviewer2", {
    "displayName": "Display lots of controls in a scroll viewer",
    "description": "",
    "class": ScrollViewer2,
});


/***/ }),

/***/ "./src/SketchfabMarkers/DepthLinearNoShader.ts":
/*!*****************************************************!*\
  !*** ./src/SketchfabMarkers/DepthLinearNoShader.ts ***!
  \*****************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Split__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Split */ "./src/Split.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var DepthLinearNoShader = /** @class */ (function (_super) {
    __extends(DepthLinearNoShader, _super);
    function DepthLinearNoShader() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DepthLinearNoShader.prototype.createGUI = function () {
        this.gui.dimensions.height = 50;
        this.gui.showCloseButton = false;
        _super.prototype.createGUI.call(this);
    };
    DepthLinearNoShader.prototype.initialize = function () {
        var _this = this;
        var light = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["HemisphericLight"]("HemiLight", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 2, 0), this.scene);
        this.camera.maxZ = 100;
        var renderer = this.scene.enableDepthRenderer(this.camera, false);
        renderer.useOnlyInActiveCamera = true;
        renderer.getDepthMap().ignoreCameraViewport = false;
        // Box1
        var boxMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("box", this.scene);
        boxMaterial.diffuseTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/crate.png", this.scene);
        var box = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateBox("box", {}, this.scene);
        box.material = boxMaterial;
        // Box2
        var box2Material = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("box2", this.scene);
        box2Material.diffuseTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/crate.png", this.scene);
        var box2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateBox("box2", {}, this.scene);
        box2.material = box2Material;
        box2.position.x = 1.5;
        box2.position.z = 2;
        var canvasZone = document.body;
        var sprites = [
            { pos: new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](1, 0, 0), elem: document.createElement('div'), color: '#00ff00', width: 40, height: 40 },
            { pos: new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 0.5, 1.0), elem: document.createElement('div'), color: '#ff0000', width: 40, height: 40 }
        ];
        sprites.forEach(function (sprite) {
            sprite.elem.style.position = 'absolute';
            sprite.elem.style.width = sprite.width + 'px';
            sprite.elem.style.height = sprite.height + 'px';
            sprite.elem.style.backgroundColor = sprite.color;
            sprite.elem.style.top = '0px';
            sprite.elem.style.left = '0px';
            canvasZone.appendChild(sprite.elem);
        });
        var depthMap = renderer.getDepthMap();
        var buffer = new Float32Array(4 * depthMap.getSize().width * depthMap.getSize().height);
        //this.scene.autoClear = true;
        this.scene.onAfterRenderObservable.add(function () {
            depthMap.readPixels(0, 0, buffer); // that's too slow to do that each frame...
            sprites.forEach(function (sprite) {
                var posInView = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(sprite.pos, _this.scene.getViewMatrix());
                var posInViewProj = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"].TransformCoordinates(sprite.pos, _this.scene.getTransformMatrix());
                var screenCoords = posInViewProj.multiplyByFloats(0.5, -0.5, 1.0).add(new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0.5, 0.5, 0.0)).
                    multiplyByFloats(_this.scene.getEngine().getRenderWidth(), _this.scene.getEngine().getRenderHeight(), 1);
                var px = screenCoords.x - sprite.width / 2;
                var py = screenCoords.y - sprite.height / 2;
                sprite.elem.style.left = (px + canvasZone.offsetLeft) + 'px';
                sprite.elem.style.top = (py + canvasZone.offsetTop) + 'px';
                px = Math.floor(px + sprite.width / 2);
                py = Math.floor(_this.scene.getEngine().getRenderHeight() - (py + sprite.height / 2));
                var zInZBuff = buffer[4 * (px + py * depthMap.getSize().width)];
                var z = (posInView.z - _this.camera.minZ) / (-_this.camera.minZ + _this.camera.maxZ);
                if (z > zInZBuff) {
                    sprite.elem.style.opacity = "0.3";
                }
                else {
                    sprite.elem.style.opacity = "1.0";
                }
            });
        });
    };
    return DepthLinearNoShader;
}(_Split__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (DepthLinearNoShader);


/***/ }),

/***/ "./src/SketchfabMarkers/DepthLinearShader.ts":
/*!***************************************************!*\
  !*** ./src/SketchfabMarkers/DepthLinearShader.ts ***!
  \***************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Split__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Split */ "./src/Split.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var DepthLinearShader = /** @class */ (function (_super) {
    __extends(DepthLinearShader, _super);
    function DepthLinearShader() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DepthLinearShader.prototype.createGUI = function () {
        this.gui.dimensions.height = 50;
        this.gui.showCloseButton = false;
        _super.prototype.createGUI.call(this);
    };
    DepthLinearShader.prototype.initialize = function () {
        var _this = this;
        var light = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["HemisphericLight"]("HemiLight2", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 2, 0), this.scene);
        var renderer = this.scene.enableDepthRenderer(this.camera, false);
        renderer.useOnlyInActiveCamera = true;
        renderer.getDepthMap().ignoreCameraViewport = false;
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["custom2VertexShader"] = "\n            precision highp float;\n            attribute vec3 position;\n            attribute vec2 uv;\n            uniform mat4 worldViewProjection;\n            varying vec2 vUV;\n            void main(void) {\n                gl_Position = worldViewProjection * vec4(position, 1.0);\n                vUV = uv;\n            }";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["custom2FragmentShader"] = "\n            precision highp float;\n            const float znear = 1.0;\n            const float zfar = 10000.0;\n            varying vec2 vUV;\n            uniform vec2 screenSize;\n            uniform sampler2D textureSampler;\n            uniform highp sampler2D depth;\n            float linearDepth(float z) {\n                float zlin = (znear * zfar) / (zfar - z * (zfar - znear));\n                return (zlin - znear) / (zfar - znear);\n            }\n            void main(void) {\n                vec2 coords = gl_FragCoord.xy / screenSize;\n                float d = texture2D(depth, coords).x;\n                float z = linearDepth(gl_FragCoord.z);\n                float a = z > d ? 0.3 : 1.0;\n                gl_FragColor = vec4(texture2D(textureSampler, vUV).xyz, a);\n            }";
        // Box1
        var boxMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("boxb", this.scene);
        boxMaterial.diffuseTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/crate.png", this.scene);
        var box = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateBox("boxb", {}, this.scene);
        box.material = boxMaterial;
        // Box2
        var box2Material = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("box2b", this.scene);
        box2Material.diffuseTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/crate.png", this.scene);
        var box2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateBox("box2b", {}, this.scene);
        box2.material = box2Material;
        box2.position.x = 1.5;
        box2.position.z = 2;
        // Sprite1
        var spriteMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShaderMaterial"]("mat2", this.scene, {
            vertex: "custom2",
            fragment: "custom2",
        }, {
            attributes: ["position", "uv"],
            uniforms: ["worldViewProjection", "screenSize"],
            needAlphaBlending: true
        });
        spriteMaterial.setTexture("depth", renderer.getDepthMap());
        spriteMaterial.setTexture("textureSampler", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/floor.png", this.scene));
        spriteMaterial.backFaceCulling = false;
        spriteMaterial.disableDepthWrite = true;
        spriteMaterial.alphaMode = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Engine"].ALPHA_COMBINE;
        spriteMaterial.depthFunction = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Engine"].ALWAYS;
        var sprite = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreatePlane("spriteb", { size: 0.3 }, this.scene);
        sprite.material = spriteMaterial;
        sprite.position.x = 1.0;
        // Sprite2
        var sprite2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreatePlane("spriteb", { size: 0.3 }, this.scene);
        sprite2.material = spriteMaterial;
        sprite2.position.y = 0.5;
        sprite2.position.z = 1.0;
        var engine = this.scene.getEngine();
        this.scene.onBeforeRenderObservable.add(function () {
            spriteMaterial.setVector2("screenSize", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector2"](engine.getRenderWidth(), engine.getRenderHeight()));
        });
        [sprite, sprite2].forEach(function (spr) {
            spr.onBeforeRenderObservable.add(function () {
                spr.lookAt(_this.camera.position);
            });
        });
    };
    return DepthLinearShader;
}(_Split__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (DepthLinearShader);


/***/ }),

/***/ "./src/SketchfabMarkers/DepthNonLinearShader.ts":
/*!******************************************************!*\
  !*** ./src/SketchfabMarkers/DepthNonLinearShader.ts ***!
  \******************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Split__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Split */ "./src/Split.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();


var DepthNonLinearShader = /** @class */ (function (_super) {
    __extends(DepthNonLinearShader, _super);
    function DepthNonLinearShader() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DepthNonLinearShader.prototype.createGUI = function () {
        this.gui.dimensions.height = 50;
        this.gui.showCloseButton = false;
        _super.prototype.createGUI.call(this);
    };
    DepthNonLinearShader.prototype.initialize = function () {
        var _this = this;
        var light = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["HemisphericLight"]("HemiLight", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector3"](0, 2, 0), this.scene);
        var renderer = this.scene.enableDepthRenderer(this.camera, true);
        renderer.useOnlyInActiveCamera = true;
        renderer.getDepthMap().ignoreCameraViewport = false;
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["custom1VertexShader"] = "\n            precision highp float;\n            attribute vec3 position;\n            attribute vec2 uv;\n            uniform mat4 worldViewProjection;\n            varying vec2 vUV;\n            void main(void) {\n                gl_Position = worldViewProjection * vec4(position, 1.0);\n                vUV = uv;\n            }";
        babylonjs__WEBPACK_IMPORTED_MODULE_0__["Effect"].ShadersStore["custom1FragmentShader"] = "\n            precision highp float;\n            varying vec2 vUV;\n            uniform vec2 screenSize;\n            uniform sampler2D textureSampler;\n            uniform highp sampler2D depth;\n               void main(void) {\n                vec2 coords = gl_FragCoord.xy / screenSize;\n                float d = texture2D(depth, coords).x;\n                float z = gl_FragCoord.z;\n                float a = z > d ? 0.3 : 1.0;\n                gl_FragColor = vec4(texture2D(textureSampler, vUV).xyz, a);\n            }";
        // Box1
        var boxMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("box", this.scene);
        boxMaterial.diffuseTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/crate.png", this.scene);
        var box = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateBox("box", {}, this.scene);
        box.material = boxMaterial;
        // Box2
        var box2Material = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("box2", this.scene);
        box2Material.diffuseTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/crate.png", this.scene);
        var box2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateBox("box2", {}, this.scene);
        box2.material = box2Material;
        box2.position.x = 1.5;
        box2.position.z = 2;
        // Sprite1
        var spriteMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["ShaderMaterial"]("mat1", this.scene, {
            vertex: "custom1",
            fragment: "custom1",
        }, {
            attributes: ["position", "uv"],
            uniforms: ["worldViewProjection", "screenSize"],
            needAlphaBlending: true
        });
        spriteMaterial.setTexture("depth", renderer.getDepthMap());
        spriteMaterial.setTexture("textureSampler", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Texture"]("resources/texture/floor.png", this.scene));
        spriteMaterial.backFaceCulling = false;
        spriteMaterial.disableDepthWrite = true;
        spriteMaterial.alphaMode = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Engine"].ALPHA_COMBINE;
        spriteMaterial.depthFunction = babylonjs__WEBPACK_IMPORTED_MODULE_0__["Engine"].ALWAYS;
        var sprite = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreatePlane("sprite", { size: 0.3 }, this.scene);
        sprite.material = spriteMaterial;
        sprite.position.x = 1.0;
        // Sprite2
        var sprite2 = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreatePlane("sprite", { size: 0.3 }, this.scene);
        sprite2.material = spriteMaterial;
        sprite2.position.y = 0.5;
        sprite2.position.z = 1.0;
        var engine = this.scene.getEngine();
        this.scene.autoClear = true;
        this.scene.onBeforeRenderObservable.add(function () {
            spriteMaterial.setVector2("screenSize", new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Vector2"](engine.getRenderWidth(), engine.getRenderHeight()));
        });
        [sprite, sprite2].forEach(function (spr) {
            spr.onBeforeRenderObservable.add(function () {
                spr.lookAt(_this.camera.position);
            });
        });
    };
    return DepthNonLinearShader;
}(_Split__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (DepthNonLinearShader);


/***/ }),

/***/ "./src/SketchfabMarkers/index.ts":
/*!***************************************!*\
  !*** ./src/SketchfabMarkers/index.ts ***!
  \***************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Sample__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sample */ "./src/Sample.ts");
/* harmony import */ var _DepthNonLinearShader__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./DepthNonLinearShader */ "./src/SketchfabMarkers/DepthNonLinearShader.ts");
/* harmony import */ var _DepthLinearShader__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./DepthLinearShader */ "./src/SketchfabMarkers/DepthLinearShader.ts");
/* harmony import */ var _DepthLinearNoShader__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./DepthLinearNoShader */ "./src/SketchfabMarkers/DepthLinearNoShader.ts");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __read = (undefined && undefined.__read) || function (o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
};





var CSMSample = /** @class */ (function (_super) {
    __extends(CSMSample, _super);
    function CSMSample(engine, canvas) {
        var _this = _super.call(this, engine, canvas) || this;
        _this._clearColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color4"](51 / 255, 52 / 255, 75 / 255, 1);
        _this._cameraSpeed = 2.5;
        _this.splitMode = _Sample__WEBPACK_IMPORTED_MODULE_1__["enumSplitMode"].SIDE_BY_SIDE;
        _this.registerClass("depth_nonlinear_shader", _DepthNonLinearShader__WEBPACK_IMPORTED_MODULE_2__["default"]);
        _this.registerClass("depth_linear_shader", _DepthLinearShader__WEBPACK_IMPORTED_MODULE_3__["default"]);
        _this.registerClass("depth_linear_noshader", _DepthLinearNoShader__WEBPACK_IMPORTED_MODULE_4__["default"]);
        return _this;
    }
    CSMSample.prototype.create = function () {
        var split1 = this.addSplit("depth_nonlinear_shader", "Non linear depth");
        split1.initialize();
        var split2 = this.addSplit("depth_linear_shader", "Linear depth");
        split2.initialize();
        /*let split3 = this.addSplit("depth_linear_noshader", "s3") as DepthLinearNoShader;

        split3.initialize();*/
    };
    CSMSample.prototype.createNewSplit = function () {
    };
    CSMSample.prototype.createSceneAndCamera = function (attachControls) {
        var _a = __read(_super.prototype.createSceneAndCamera.call(this, attachControls), 2), scene = _a[0], camera = _a[1];
        scene.clearColor = this._clearColor;
        scene.autoClear = false;
        camera.angularSensibility = 1500;
        return [scene, camera];
    };
    return CSMSample;
}(_Sample__WEBPACK_IMPORTED_MODULE_1__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (CSMSample);
_Sample__WEBPACK_IMPORTED_MODULE_1__["default"].registerSampleClass("sketchfabmarkers", {
    "displayName": "Show front-facing markers as in Sketchfab",
    "description": "",
    "class": CSMSample,
});


/***/ }),

/***/ "./src/Split.ts":
/*!**********************!*\
  !*** ./src/Split.ts ***!
  \**********************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _SplitGUI__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./SplitGUI */ "./src/SplitGUI.tsx");

var Split = /** @class */ (function () {
    function Split(scene, camera, parent, name) {
        if (name === void 0) { name = "default"; }
        this.scene = scene;
        this.camera = camera;
        this.name = name;
        this.isLoading = false;
        this.group = 0;
        this._container = parent;
        this.gui = new _SplitGUI__WEBPACK_IMPORTED_MODULE_0__["default"](this.name, this.scene.getEngine(), this._container, this);
    }
    Split.prototype.render = function () {
        this.scene.render();
    };
    Split.prototype.createGUI = function () {
        this.gui.createGUI();
    };
    Split.className = "Split";
    return Split;
}());
/* harmony default export */ __webpack_exports__["default"] = (Split);


/***/ }),

/***/ "./src/SplitGUI.tsx":
/*!**************************!*\
  !*** ./src/SplitGUI.tsx ***!
  \**************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _GUI__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./GUI */ "./src/GUI.tsx");
var __extends = (undefined && undefined.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();

var SplitGUI = /** @class */ (function (_super) {
    __extends(SplitGUI, _super);
    function SplitGUI(name, engine, container, parent) {
        var _this = _super.call(this, name, engine) || this;
        _this._container = container;
        _this._parent = parent;
        return _this;
    }
    SplitGUI.prototype.getBounds = function () {
        return this._container.getSplitBounds(this._parent);
    };
    SplitGUI.prototype.canClose = function () {
        return this._container.splitNumber > 1;
    };
    SplitGUI.prototype.closed = function () {
        this._container.removeSplit(this._parent);
    };
    return SplitGUI;
}(_GUI__WEBPACK_IMPORTED_MODULE_0__["default"]));
/* harmony default export */ __webpack_exports__["default"] = (SplitGUI);


/***/ }),

/***/ "./src/Utils.ts":
/*!**********************!*\
  !*** ./src/Utils.ts ***!
  \**********************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! babylonjs */ "babylonjs");
/* harmony import */ var babylonjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(babylonjs__WEBPACK_IMPORTED_MODULE_0__);
var __awaiter = (undefined && undefined.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (undefined && undefined.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};


var Utils = /** @class */ (function () {
    function Utils() {
    }
    Utils.XMScalarModAngle = function (angle) {
        // Normalize the range from 0.0f to XM_2PI
        angle = angle + Math.PI;
        // Perform the modulo, unsigned
        var fTemp = Math.abs(angle);
        var PIPI = Math.PI * 2;
        fTemp = fTemp - (PIPI * Math.floor(fTemp / PIPI));
        // Restore the number to the range of -XM_PI to XM_PI-epsilon
        fTemp = fTemp - Math.PI;
        // If the modulo'd value was negative, restore negation
        if (angle < 0.0) {
            fTemp = -fTemp;
        }
        return fTemp;
    };
    Utils.addSkybox = function (skyboxName, scene, size) {
        if (skyboxName === void 0) { skyboxName = "Runyon_Canyon_A_2k_cube_specular.dds"; }
        if (size === void 0) { size = 1000; }
        var skybox = babylonjs__WEBPACK_IMPORTED_MODULE_0__["MeshBuilder"].CreateBox("skyBox", { size: size }, scene);
        var skyboxMaterial = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["StandardMaterial"]("skyBox", scene);
        skyboxMaterial.backFaceCulling = false;
        skyboxMaterial.reflectionTexture = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["CubeTexture"]("resources/texture/" + skyboxName, scene);
        skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
        skyboxMaterial.diffuseColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0);
        skyboxMaterial.specularColor = new babylonjs__WEBPACK_IMPORTED_MODULE_0__["Color3"](0, 0, 0);
        skyboxMaterial.disableLighting = true;
        skyboxMaterial.disableDepthWrite = true;
        skybox.material = skyboxMaterial;
        skybox.alwaysSelectAsActiveMesh = true;
        return skybox;
    };
    Utils.loadObj = function (scene, path, name) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                //OBJFileLoader.COMPUTE_NORMALS = true;
                //OBJFileLoader.INVERT_Y  = false;
                babylonjs__WEBPACK_IMPORTED_MODULE_0__["OBJFileLoader"].OPTIMIZE_WITH_UV = true;
                babylonjs__WEBPACK_IMPORTED_MODULE_0__["OBJFileLoader"].MATERIAL_LOADING_FAILS_SILENTLY = false;
                babylonjs__WEBPACK_IMPORTED_MODULE_0__["OBJFileLoader"].INVERT_TEXTURE_Y = false;
                return [2 /*return*/, babylonjs__WEBPACK_IMPORTED_MODULE_0__["SceneLoader"].AppendAsync(path, name, scene)];
            });
        });
    };
    return Utils;
}());
/* harmony default export */ __webpack_exports__["default"] = (Utils);


/***/ }),

/***/ "./src/allSamples.ts":
/*!***************************!*\
  !*** ./src/allSamples.ts ***!
  \***************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _CSM_index__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./CSM/index */ "./src/CSM/index.ts");
/* harmony import */ var _CSM2_index__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./CSM2/index */ "./src/CSM2/index.ts");
/* harmony import */ var _DepthMinMax_index__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./DepthMinMax/index */ "./src/DepthMinMax/index.ts");
/* harmony import */ var _DrawEdges_index__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./DrawEdges/index */ "./src/DrawEdges/index.ts");
/* harmony import */ var _Raymarching_index__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Raymarching/index */ "./src/Raymarching/index.ts");
/* harmony import */ var _RTTAndPostProcess_index__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./RTTAndPostProcess/index */ "./src/RTTAndPostProcess/index.ts");
/* harmony import */ var _ScrollViewer_index__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ScrollViewer/index */ "./src/ScrollViewer/index.ts");
/* harmony import */ var _ScrollViewer2_index__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ScrollViewer2/index */ "./src/ScrollViewer2/index.ts");
/* harmony import */ var _SketchfabMarkers_index__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./SketchfabMarkers/index */ "./src/SketchfabMarkers/index.ts");











/***/ }),

/***/ "@material-ui/core":
/*!*****************************!*\
  !*** external "MaterialUI" ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = MaterialUI;

/***/ }),

/***/ "@material-ui/core/colors":
/*!************************************!*\
  !*** external "MaterialUI.colors" ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = MaterialUI.colors;

/***/ }),

/***/ "babylonjs":
/*!**************************!*\
  !*** external "BABYLON" ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = BABYLON;

/***/ }),

/***/ "jquery":
/*!*************************!*\
  !*** external "jQuery" ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = jQuery;

/***/ }),

/***/ "react":
/*!************************!*\
  !*** external "React" ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = React;

/***/ }),

/***/ "react-dom":
/*!***************************!*\
  !*** external "ReactDOM" ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = ReactDOM;

/***/ })

/******/ });
//# sourceMappingURL=babylondev.js.map